# GitHub:在 Ruby 上扩展，有一个游牧式的技术团队| Derrick Harris | > S C A L E | Medium

> 原文:[https://medium . com/s-c-a-l-e/github-scaling-on-ruby-with-a-nomadic-tech-team-4db 562 b 96 DCD？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://medium.com/s-c-a-l-e/github-scaling-on-ruby-with-a-nomadic-tech-team-4db562b96dcd?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

# GitHub:在 Ruby 上扩展，有一个游牧式的技术团队



Source: GitHub



*山姆·兰伯特(Sam Lambert)于 2013 年加入 GitHub，担任公司第一任数据库管理员，现为公司技术总监。在这次采访中，他讨论了这项服务——目前拥有超过 1000 万用户和 2500 万个项目——如何能够以相对简单的技术栈保持规模。他还谈到 GitHub 基本上没有办公室的工作场所——大约 60%的员工远程工作，使用强大的自制聊天机器人* [*Hubot*](https://hubot.github.com/) *进行协作。*

T2】

我通常认为 GitHub 更多的是技术提供者，而不是技术使用者，但这可能是不公平的。你能给我介绍一下支撑 GitHub 的技术和哲学吗？

SAM LAMBERT: 我们在内部开发软件和服务时采用了非常 Unix 的理念。我们喜欢不断为我们的许多基础设施的简单性感到自豪。我们真的试图避开复杂性和过度工程化。我们喜欢对我们的工作方式和工作内容做出更务实的选择。

很长一段时间以来，我们的基础设施中非常关键的部分都是用 Shell 脚本和简单的脚本串在一起的，这种方式非常有效，并且仍然非常适合我们。

就您的技术堆栈而言，这会带来什么？

作为 GitHub 用户，您所看到和使用的核心是一个 Ruby on Rails 应用程序。这是一款已经有七年历史的应用，由创始人在创办公司时创建。这是应用程序的核心，但显然堆栈中有大量的 Git。我们有定制的 C 守护进程，可以做代理、Git 请求和数据聚合之类的事情。

MySQL 是我们的核心数据存储，我们用它来存储支持网站的所有数据以及用户周围的元数据。我们也在一些非持久缓存中使用 Redis，比如 memcached。

c、Shell、Ruby——非常简单的整体堆栈。我们真的不是一个过于复杂的商店，我们不打算尝试为每个小项目放弃新的语言。

我们有为我们工作的核心 Ruby 提交者，这允许我们扩展我们所拥有的，并对我们所有的技术选择保持务实的观点，并试图保持我们的堆栈更小。事实上，对于我们已经选择的堆栈，您没有什么不能做的。为了继续这场比赛并让它继续发展，我们必须不断地将各种各样的技术应用到我们所拥有的东西上。

考虑到 GitHub 上托管的所有项目和实验，这有点讽刺意味。你有没有见过新事物，并试图改变它？

我们当然会关注新技术。我们的员工在工作中有很大的自由，人们会尝试各种各样的东西和实验。通常，这只是为了知道为什么你没有使用技术。你可以看着某样东西，理解它为什么有趣，你试图解决的问题是什么，也许然后采取一些方法来扩展你已经在做的事情。或者在它成熟的时候把它放在架子上一段时间。



但是有一个有趣的讽刺是，世界上一半的新项目都发生在 GitHub 上，而我们倾向于坚持使用相当保守的堆栈。我们的 CTO 经常开玩笑说我被他面试加入公司的时候，是 GitHub 的第一个 DBA。我在采访中说，“我真的很惊讶能坐在这里。我以为 GitHub 在使用某种新的、时髦的数据存储。”然后随着采访过程的进行，我越来越明白，这实际上是一群非常务实的黑客，他们只在 Ruby 上黑客，在 C 上黑客，用更稳定的堆栈花时间做更有趣的事情，而不是追逐最新最闪亮的技术。



T2】

## 跟上那些饭桶

让你的团队忙碌的挑战是什么？

很大一部分是体积。显然，我们的用户群正在增长。我们也有一个非常技术性的用户群，他们似乎设法以一种模糊的方式找到使用 API 的方法。使用一个标准的框架，有很多东西直到它成为一个大的用例你才能看到它的极端。Rails 使用的许多模式在大范围内都不是最佳的。我们可能会遇到这样的问题，不得不重写某些功能。

显然，我们也有大量的 Git。在后端基础设施中扩展像 Git 这样的东西是完全不同的。这不是其他任何人想要达到的目标。在扩展 Git(应用程序本身)方面，我们实际上处于前沿，这很有趣。

我们有一个很棒的团队，他们致力于这项工作，并且非常努力地加入额外的功能。我们就像某个基础设施中的 Git 主机，这意味着需要做各种工作来平衡公共库和私有库，并确保当用户试图访问代码时身份验证和权限是正确的。

> “对于一个 Rails 应用程序来说，github.com 是一个非常非常快速的网站，我们有一个座右铭‘除非它很快，否则不会发货’"

所以 Git 是你技术操作中最独特的方面？

绝对的。除了众所周知的以外，我们不想在任何其他方面独一无二。这也是我们真正引以为豪的事情。我经常对人们说，“让我们只编写对存储 Git 数据的公司有意义的定制架构元素。”

我们不需要重新发明轮子，我们不需要编写我们自己的数据库，我们不需要开始编写我们自己的框架——因为它们都在常见的领域中。这是一个网站，这是虚拟主机。在不寻常的领域，我们完全接受编写定制应用程序或构建定制应用程序的需求。

就你的团队所从事的工作而言，最能推动工程的指标是什么？

我们对性能非常着迷。我们希望确保该网站总是高性能和持续快速。对于一个 Rails 应用来说，github.com 是一个非常非常快速的网站，我们有一个座右铭“除非它很快，否则它不会被发布”

就我们关注的一个具体指标而言，它是存储 Git 的容量。这是我们必须继续发展的东西。随着我们的使用量越来越多，我们开始看到这种基础设施的压力越来越大。我们目前正在进行一些非常有趣的项目，这将让我们继续扩大规模。

> “通常情况下，扩展问题很快就会出现。它们不会慢慢地、逐渐地出现。”

T2】

## 这里没有云计算

GitHub 的底层基础设施是什么样的？你是在云中还是在本地服务器上？

我们托管在自己的数据中心。我们实际上有一个惊人的供应故事。我们基本上可以像配置云一样配置硬件。我们有一个非常小，但非常敬业的物理基础设施团队，他们在为我们提供这些我们可以使用的惊人服务方面做了非凡的工作。

如果我需要一台新主机，我基本上可以告诉我们的聊天机器人 Hubot，我需要在这些机箱上安装 *X* 数量的此类主机，它将在几分钟内完成构建和部署。我们拥有这种难以置信的扁平、灵活但却是物理的基础设施。作为一个使用这种基础设施的人，它是非凡的，看着它工作是非常棒的。

**听起来你好像在避免与物理设备相关的费力费时的采购步骤。**

实际上，我们在硬件方面有一些闲置产能。物理基础设施团队将调配空的机器，并准备好由将要使用它们的团队进行调配。例如，数据库基础架构团队可以查看数据库所需的类池中有多少台机器，本质上，他们已经编写了自己的傀儡角色和关于这些节点如何工作的分类。然后，他们可以自行调配或标记它们，以便为团队提供容量。

**您是否会定期扩展服务器的占用空间，或者目前这是一种非常可控的增长模式？**

我们在如何订购和供应方面保持对它的控制。但就网站的使用率而言，正在以越来越快的速度上升。世界上越来越多的公司意识到他们是科技公司，因此 GitHub 的使用量正在不断增长。

不过，我们处理得很好。通常情况下，扩展问题很快就会出现。它们不会慢慢地、逐渐地出现。它们来得很快，我们在它们发生时就处理它们，我们有时会有一些有趣的用例。人们给网站带来奇怪的东西，他们会揭示轻微的缩放问题，但我们有一个应用程序，我们可以快速开发，人们很好地理解这个领域。我们很快就解决了这些问题，并部署修复程序，继续前进。

> “我的一些同事没有固定的办公地点。他们只是从一个城市飞到另一个城市，在任何地方工作。他们只是游牧民族，他们遍布世界各地。”

T2】

## 构建全球工程网络

是否有一些问题让你夜不能寐，或者长期的担忧总是萦绕在你的脑海中？

保卫我们的基础设施当然是我们一直在考虑的事情。我不会说这会让你晚上睡不着觉，但这是我们肯定会考虑的事情。

和扩展我们的组织。我们的规模越大，我们需要的工程师就越多，但我们需要让这种增长符合我们的文化。我认为招聘是每个科技公司都面临的挑战——继续从世界各地不同背景中获得优秀、有才华的员工。但你必须找到与你有相同工程价值观的人，他们喜欢做与你所拥有的和你所能提供的相似的事情。

我还担心继续接受公司的分布式本质。该公司目前有 60%位于偏远地区；我现在在英国。我周游世界，在不同的地方工作。基于我们的文化和分布式自然，这是完全可能的。

这似乎很独特。这 60%的员工是在家工作还是在分支机构工作？

他们在家工作。你可以在任何地方工作。去年，我大概在全球五六个不同的城市工作过。只是在我的笔记本电脑上工作，无论我们决定去哪里。一个月前，我在威斯康辛州树林里的一个小屋里工作。

我有些同事没有固定的办公地点。他们只是从一个城市飞到另一个城市，在任何地方工作。他们只是游牧民族，他们遍布世界各地。这是我们可以提供给人们的东西，已经融入了我们的文化。

不需要在任何办公室工作。我们的办公室实际上更像是一个社交场所。我们有让人们见面和享受在一起的地方，但是没有必要在一起。

我和一个同事对我们的后端进行了巨大的重构，从本质上把它从一个单一的环境转变为一个分布式的环境。我们有许多决策要做——许多重组和新模式。在整个项目中，我们从未进行过面对面的交谈。我们只是通过聊天和发出拉请求一起工作，然后我们在那个项目结束时相遇——在他加入 GitHub 大约 6 个月后。

再说一遍，这就是我们的工作方式。这是我们文化的运作方式。没有必要为了提高工作效率和做我们所做的事情而亲临现场。

> “很长很长一段时间，您的登机人员都在加入我们的聊天室，观察其他人在做什么。……我加入了这家公司，只是闲聊天，观察人们是如何工作的，他们做了什么，我只是通过这种方式学习。”

T2】

## Hubot 前来救援

**您之前提到 Hubot 是一款配置工具，但还有其他功能吗？这听起来是公司如何在如此分散的员工中运作的关键。**

[Hubot](https://hubot.github.com/) 在 GitHub 里基本上什么都能做。例如，你可以问 Hubot 某个员工在哪里，它会告诉你他们在世界上的什么地方，或者他们在我们某个办公室的几楼。

大概有 40 种不同的配置命令。你可以做一个 MySQL 栈。您可以进行故障转移、删除表、备份表、克隆、运行迁移，什么都可以做。你可以减轻攻击。

基本上，你可以想象在我们的基础设施上做的任何事情，你都可以通过 Hubot 来完成。与任何代码交互都没有任何要求。你可以通过 Hubot 运行它。



A humorous schematic for Hubot. Source: GitHub



**所以它不仅仅是一个自动化引擎……**

是的，这是自动化，但它远不止这些。这也是背景。

很长一段时间以来，你的新成员一直在加入我们的聊天室，观察其他人在做什么。因为我们实际上不在任何地方，当一个问题出现时，你会看到警报来聊天，你可以开始调出图表，房间里的每个人都可以看到，每个人都可以看到你在看什么。我加入了公司，我只是在聊天，只是看着人们如何工作，他们做什么，我只是通过这种方式学习。

我试着回想我以前工作过的团队是如何调试东西的。每个人都将在自己的终端或自己的仪表板上查看图表，然后试图笨拙地彼此共享它们，或者粘贴终端输出。

有了聊天，你只需一头扎进去，上下文就全在那里了。基本上，我们公司有了这个巨大的共享控制台。例如，如果您收到一个关于数据库故障的警报，有几个人加入进来，您可以看到它已经被诊断出来并且已经被处理了。没有重复的工作，需要知道的人可以直接获得上下文。当我们遇到大事件时(碰木头，它们不常发生)，我们能够真正地协同工作。

如果我们通过 Hubot 发布到我们的状态页面或更新页面，人们可以仔细检查你要写的内容。

这只是一种完全协作的体验，也是越来越多的公司开始采用的方式。你听说过大公司整合 Hubot 来做这些奇妙的用例。只是看着很惊艳，真的。

旧的工作方式，我觉得我再也不能回到过去了。我已经习惯了和我所有的同事和团队在一起，通过聊天来合作我们想要做的事情。这是一种全新的工作方式，增加了很多东西，解决了很多问题，我认为很多传统公司都没有解决。