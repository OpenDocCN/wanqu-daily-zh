# 删除代码| Ned 批处理程序

> 原文:[http://nedbatchelder.com/text/deleting-code.html?UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://nedbatchelder.com/text/deleting-code.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

创建于 2002 年 12 月 22 日，最后更新于 2012 年 11 月 6 日

本文档还有[俄文](//nedbatchelder.com/text/deleting-code_ru.html)版本。

有大量关于如何编写代码的信息。以下是一些关于如何删除代码的建议。

# 删除代码的最好方法

这似乎是显而易见的，但我猜不是，因为开发人员有各种删除代码的方法。以下是删除代码的方法:

> 在编辑器中选择一段代码，按退格键，然后完成它。

大多数开发人员不喜欢丢弃东西。他们希望保留大量代码，以备不时之需。他们努力编写那一大块代码。他们调试过了，可以用了。他们不想就这么扔掉。

这些开发人员希望保留他们的旧代码，他们以某种方式禁用它:注释掉它，对它进行条件化，或者只是不再调用它。

对于那些开发人员，我说，“使用源代码(控件)，卢克”。一个源代码控制系统(像 [Git](http://git-scm.com/) 、 [Mercurial](http://mercurial.selenic.com/) 或 [Subversion](http://subversion.apache.org/) )意味着你永远不必担心某样东西会永远消失。如果你再次需要的话，你的库会有旧的代码。

如果您没有源代码控制系统(！？！？！)或者只是不想麻烦地翻查历史，然后将代码块复制到某个单独的文件中，并保存起来。但是不要把它放在不属于它的地方:在你的源代码中。

# 有什么大不了的？

如果你有一大块你不再需要的代码，有一个很大的理由去删除它，而不是让它处于禁用状态:减少噪音和不确定性。开发人员最大的敌人是他们代码中的噪音或不确定性，因为它们阻碍了他们将来有效地工作。

处于禁用状态的代码块只会导致不确定性。这让其他开发者产生了疑问:

*   为什么以前的代码是这样的？
*   为什么这种新方式更好？
*   我们要变回老样子吗？
*   我们将如何决定？

如果其中一个问题的答案对人们来说很重要，那么就写一个评论把它说出来。不要让你的同事猜测。

很容易注释掉一两行(或者二十行！)代码行:

> ```
> //  OldWayStepOne(fooey);
> //  OldWayStepTwo(gooey);
>     NewWay(fooey, gooey);  
> ```

这很糟糕。注释应该用来给人们提供阅读或编写代码时需要的信息。它们应该用来帮助将来使用代码的开发人员。这些评论没有做到这一点。事实上，他们做的恰恰相反。除了删除正在编译的旧代码之外，这些注释还在代码中添加了混乱、不确定性和疑问。

未来的开发人员看着这些代码，知道它曾经以旧的方式工作，他们也知道现在它以新的方式工作，但是他们不知道为什么旧的方式一直存在:

*   也许 NewWay 只是一个实验？如果有，那它有什么好的地方？如何以及何时最终决定保留它？
*   也许老方法更好，但它有问题？如果是的话，它有什么问题？是旧的代码有问题，还是我们称之为错误？什么时候能修好？
*   可能是设计变了，OldWay 在做不必要的工作？

任何被注释掉的代码都是一个隐含的问题:为什么它还在这里？有理由保留一段注释掉的代码。你知道很快就会被逆转的改变发生了。开发人员不确定会发生什么变化。保留代码是可以的，但是要说你为什么要保留它。评论是给人看的，评论里的一行代码不告诉任何人任何事情。

> 不要在没有说明原因的情况下注释掉一段代码(在注释中)。

这样不是更好吗？：

> ```
> //  OldWay did a better job, but is too inefficient until MumbleFrabbitz
> //  is overhauled, so we'll use NewWay until the M4 milestone.
> //    OldWayStepOne(fooey);
> //    OldWayStepTwo(gooey);
>     NewWay(fooey, gooey);  
> ```

现在，谁知道曼波弗拉比茨是否真的会为了 M4 里程碑而被彻底改造？也许不会。没关系；谁知道未来会怎样？但至少这样开发者会知道为什么代码还在。有了关于为什么做出改变以及为什么旧代码还在那里的信息，开发人员将知道他们什么时候可以最终完全投入到新的方式中，或者什么时候他们可以切换回更好的解决方案。

# 条件编译

想要注释掉大块内容的开发人员将使用条件编译(如果语言支持的话)。在 C++中:

> ```
> #if 0 OldWayStepOne(fooey);
>     ...
>     OldWayStepTwenty(hooey);
> #endif 
> ```

在 Python 中:

> ```
> if 0:
>     OldWayStepOne(fooey)
>     ...
>     OldWayStepTwenty(hooey)
> 
> ```

这并不比注释掉代码更好:这只是对正在进行删除的人来说更方便。事实上，在某些方面，这比注释掉代码更糟糕。一些 ide 没有将这段代码作为注释进行语法着色，所以其他开发人员很容易阅读这段代码而没有意识到它已经被禁用了。

同样的规则也适用于注释掉代码:

> 不要在没有解释原因的情况下条件化代码。

如果您必须使用 C 预处理器来删除代码，那么“#if 0”确实是最好的方法，因为它至少清楚地表明代码不应该被编译。

在 Lotus 中，Notes 的源代码包括许多用“#ifdef LATER”删除的代码行，这是在没有称为“LATER”的预处理程序符号的(正确)假设下。这是一种非常弱的文档形式；这表明代码还没有准备好被编译，但是以后会。但是什么时候？开发人员之间流传的一个笑话是，我们应该定义“以后”，看看会发生什么！

通过使用从未定义过的符号来删除代码，您会让开发人员对这些符号的含义产生怀疑。也许有一个名为“稍后”的代码配置必须考虑在内。

# 未调用代码

假设你有一个很棒的类，它有很多方法。有一天，你发现你不再调用一个特定的方法。你把它留在里面还是拿出来？

这个问题没有唯一的答案，因为它取决于类和方法。答案取决于您是否认为该方法将来可能会被再次调用。一个粗略的答案可能是:如果类是框架的一部分，那么保留它，如果它是应用程序的一部分，那么移除它。(我将不得不写另一篇关于框架与应用程序的文章)。

# 留下指针

您可能会考虑的一个折衷方案是删除一大块未使用的代码，但留下一个指针，如果需要的话，可以在那里找到它。我以前用过这样的评论:

> ```
> //  (There used to be another algorithm here that used hashing, that
> //  was faster, but had race conditions.  If you want it, it's in
> //  commit 771de15b or earlier of ThingMap.java in the repo.)
> 
> ```

它很小，不引人注目，但它提供了一点历史，以及一个寻找更多信息的地方。

# 意外掉落

有时候，在编写代码时，您真的不确定是保留还是删除一行代码，您想在决定做什么之前尝试编译或运行代码。你注释掉这一行。许多文件被更改，当您准备签入代码时，您已经忘记了所有那些临时删除的文件在哪里。你签入了代码，却留下了到处都是意外的痕迹。

> 在被注释掉的代码行中总是使用独特的标记，这样当需要清理和签入的时候，你就可以快速找到它们。

一个简单的约定是这样的:

> ```
> //- OldWayImUnsureOf(zooey);
> 
> ```

一切都不同了。通过使用“//-”注释掉这一行，您就留下了一个标记，当您准备签入代码时，可以很容易地找到它。

您也可以将它用于更大的块:

> ```
> #if 0 //- I don't think I need this with the new FooBar
>     OldWayStepOne(fooey);
>     ...
>     OldWayStepTwenty(hooey);
> #endif
> 
> ```

# 保持东西整洁

删除代码时，很容易留下幻影存根。努力把这些修剪好。例如，在这里去掉 OldWay 时:

> ```
> if (bDoThing) { OldWay(); } 
> ```

不要只是拿出打电话给 OldWay 的线路。把空的 if 也去掉。然后，如果 b 任何东西只在这里测试过，也把它去掉。检查设置 bDoThing 的代码。现在过时了吗？摆脱它。冷酷无情。保持代码整洁。确保它是有意义的，没有死角的坡道，只有知道过去是什么才能理解。

留下这段代码是很诱人的，因为很难理解是否仍然需要它。但是如果你留下了空的 if 子句，其他开发人员会发现它，意识到它不可能是正确的，必须进行调查。他们需要更长的时间去理解空的 if，而不是你去移除它。

# 别担心，开心点

我知道砍掉你辛辛苦苦编写的代码似乎有些极端。别担心:会好的。你想关掉它或者别的什么是有原因的。如果你需要回去的话，源代码控制系统仍然会有一个副本。从这个角度来看:与您在项目的剩余生命周期中不得不看着那些愚蠢的注释掉的行的确定性相比，您需要回去得到它的机会有多大？

继续，删除旧代码。你不会错过的。

# 请参见