# 如何阅读他人的代码——需要记住的八件事

> 原文：<https://spin.atomicobject.com/2017/06/01/how-to-read-code/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

“我讨厌阅读别人的代码”是所有经验水平的软件开发人员的共同心声。然而，这是一项必要的技能，尤其是对于开发现有代码库的开发人员来说，如果您用正确的视角和正确的工具来处理它，这将是一次令人愉快且富有启发性的经历。

我们之所以讨厌看别人的代码，是因为不是我们自己写的。这并不是说我们都有一个秘密的信念，认为我们是这个星球上最好的程序员，没有人能像我们一样写代码。这是因为创建代码有一个激烈的思考过程，而被动的读者无法获得直接体验的好处。

你在屏幕上看到的代码可能涉及多人。它可能包括辩论和合作。可能要花上几周的时间才能敲定一个版本，它符合一些没有记录在案的限制，而这些限制只有最初的作者才知道——但你不会知道这些。

作为一个读者，你所看到的只是成品，而且，除非你做一点点挖掘，否则你唯一能得到的上下文就是屏幕上的其他单词。

## 1.学会挖掘

当你第一次进入一个成熟的代码库时，你可能感觉不像一个开发人员。你可能感觉更像一个考古学家，一个私家侦探，或者一个圣经学者。那很好，因为你已经有一大把铲子供你使用了。

如果你足够幸运，能够开发一个从一开始就处于版本控制中的代码库，那就庆祝一下吧。您可以访问大量的元数据，这将使您不仅理解代码，而且理解上下文变得更加容易。我假设你使用的是 [Git](https://git-scm.com) ，但是如果你使用的是 [SVN](https://subversion.apache.org) ，同样的想法也适用。

### 责备

您可以在文件上使用`git blame`来获得作者姓名、最后修改日期以及每行的提交散列。熟悉作者。如果你幸运的话，他们可能只有几个，而且他们可能都还在和你一起工作，所以你可以把他们作为一种资源。如果你运气不好，可能会有几十个你从未听说过的作者。

不管怎样，试着感受一下谁是主要的贡献者。如果你遇到一个你想不出来的奇怪函数，使用`git blame`来找出作者并追踪他或她进行询问。

### git log

使用`git log`查看整个回购的提交历史。这个命令打印提交消息，所以如果您想在提交消息引用 someFunction: `git log | grep someFunction -C 3` ( `-C 3`将用三行上下文显示您的匹配项)的地方搜索提交，不要忘记 grep。

`git log`也可以用-p 标志显示单个文件的历史:`git log -p index.js`。注意那些最近一直在修改东西的人，这样如果他们提出问题，你就知道该把他们引向哪里。

## 2.回到过去

您可以签出任何您想要的提交并运行它，就像它是项目中最近的提交一样。在一些难以追踪的错误出现之前，您可能想要检查最后一次已知的好的提交，或者您可能只是感到无聊，并且有心情从历史的角度来看您的项目在几年前是在哪里。

如果你的项目托管在 GitHub 或类似的网站上，你可以通过阅读问题、拉请求和代码评审获得大量的视角。注意引起最多讨论的问题。这些可能是你最终会遇到的痛点，你会提前知道如何处理它们。

## 3.阅读规格

规格是新的注释。阅读单元规格以弄清楚功能和模块应该做什么，以及它们被设计来处理什么样的边缘情况。阅读集成规范，了解用户将如何与您的应用程序交互，以及您的应用程序支持哪种工作流。

## 4.把评论当成暗示

如果你遇到一个令人困惑的函数，然后读到一个相关的注释，让你更加困惑，考虑一下这个注释可能已经过时，没有被维护。程序员的眼睛有一种跳过绿色文本行的方式，可能注释解释了几个月(或几年)不存在的函数迭代，而其他人没有注意到。

## 5.查找 Main

这似乎是显而易见的，但是请确保您知道代码从哪里开始执行，以及它是如何设置自己的。看看这里包含的文件、被实例化的类和被设置的配置选项。

您可能会在代码库的其余部分到处看到它们。这里的一些模块可能非常通用，并且与代码库的其余部分分离。它们代表了更小、更容易理解的功能，您应该在尝试处理更大的应用程序之前熟悉这些功能。

对这个文件运行一个`git blame`，看看它的哪些部分最近发生了变化。最近更改的一段代码可能会提示您最近几周开发团队所面临的一些挑战。也许他们引入了一个新的库，也许他们一直在努力配置一个不太好的库，或者也许只是需要定期更新的样板代码。

尝试在其他一些源文件中找到对这些模块的引用，以了解它们是如何以及何时被使用的。这可以让你感觉到它们如何适应整个应用程序。

## 6.通知样式

您学习这个应用程序的原因是因为您最终将为它编写代码，所以请注意它的风格。当然，这包括表面的东西，如命名约定、间距约定和大括号放置，但也包括代码约定。

抽象的一般层次是什么？如果它是具有许多层的高度抽象的代码，您应该期望编写相同类型的代码。

如果你在历史中挖掘足够多的内容，你可能会找到某个开发人员决定提取一段代码的确切时间点。之前是什么样子，之后又是什么样子？当你写代码的时候，试着遵循同样的惯例。

在更微观的层面上，其他团队成员使用什么样的代码来完成工作？如果开发人员喜欢循环胜过地图，那么你也应该喜欢循环胜过地图。

如果你遇到一个你不喜欢的惯例，和你的团队谈谈将来可能改变惯例，但是不要在同一个文件中混合搭配一堆不同的风格。一份文件看起来越像是一个人写的，就越好。始终如一比可爱更重要。

## 7.期望找到垃圾

您可能会发现从未使用过的功能，或者您可能会发现从未使用过的整个文件。您可能会发现被注释掉的代码已经很多年没碰过了(`git blame`)。不要放慢脚步，花太多时间去想它，也不要害怕摆脱这种东西。

如果代码在那里是有原因的，有人会在代码审查中标记它。你将减少下一个读者的心理负担。

## 8.不要迷路

把这些事情记在心里，当你发现自己在杂草中时，不要难过。不要指望它是一个线性的过程，也不要指望 100%理解所有的事情。注意重要的细节，知道如何挖掘周围找到你的问题的答案，你会发现自己理解得非常快。