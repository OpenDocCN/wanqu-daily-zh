# 脸书扩展的四大秘密——高可扩展性

> 原文:[http://high scalability . com/blog/2010/6/10/the-four-meta-secrets-of-scaling-at-Facebook . html？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://highscalability.com/blog/2010/6/10/the-four-meta-secrets-of-scaling-at-facebook.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

![](../Images/ba2becbea367181702ee8de333d36cc4.png)

脸书工程总监 Aditya Agarwal 在脸书做了一个精彩的[Scale 演讲，涵盖了他们的架构，但这个演讲实际上更多的是关于如何通过保留一个组织文化中最好的部分来扩展这个组织。这个演讲的重点是:](http://www.infoq.com/presentations/Scale-at-Facebook)

> 你可以得到正确的代码，你可以得到正确的产品，但是你首先需要得到正确的文化。如果你没有得到正确的文化，那么你的公司将无法扩展。

这就引出了脸书规模的四大秘密:

1.  缩放需要迭代
2.  不要过度设计
3.  为工作选择合适的工具，但是要意识到你的选择会带来开销。
4.  获得正确的文化。移动快攻的东西。巨大的影响-小团队。大胆创新。

## 一些背景

*   **脸书大** : 4 亿活跃用户；用户平均每天花费 20 分钟；每周在脸书上分享 50 亿条内容(状态更新、评论、点赞、照片上传、视频上传、聊天消息、收件箱消息、群体事件、粉丝页面、好友连接)；每月上传 30 亿张照片；250 个每月拥有超过 100 万用户的应用；8 万个连接应用，50 万个应用；200 万开发者；每秒 1.5 亿次 memcache 操作；数以千计的 memcache 服务器，拥有数十 TB 的内存；300 个开发者。
*   **脸书难上规模**。每种类型的内容都有自己的访问模式，这使得扩展非常困难。每个人用不同的方式使用脸书。每次经历都是独一无二的。大多数网站都有添加更多服务器的扩展故事，因为数据可以分区。水平缩放。在脸书，用户不能被划分，因为用户可以加入任何网络。这是一个全球性的网络，试图捕捉世界上的每个人，它允许任何人与任何人成为朋友，并可以代表用户之间的任何关系。每个新用户都可以访问任何其他用户的数据，这意味着没有办法按照地理位置或任何其他指标来划分用户。脸书上的每个用户都有 130 个好友，但没有任何方法可以让你对数据进行分区，从而只在那个群集中访问。
*   **整体架构有 4 个主要组件**:负载平衡器、Web 服务器(用 PHP 编写)、服务(快速、复杂、搜索、广告、scribe)、Memcached(快速、简单)、数据库(缓慢、持久)。

## 四大缩放元秘密

**1。缩放需要迭代**。的解决方案通常在开始时是有效的，但是你必须随着时间的推移对它们进行修改。第一年有效的方法以后可能不再有效。例如，PHP 一开始使用起来很简单，但是当你有成千上万的 web 服务器时，它就不是一个好的选择。

再比如照片。他们目前每秒提供 120 万张照片。第一代是用简单的方法建造的。不要担心扩展太多。专注于获得正确的功能。上传者将文件存储在 NFS，元数据存储在 MySQL 中。它在最初的 3 个月里有效，并导致了许多不眠之夜。他今天仍然会用同样的方式做这件事。上市时间是他们最大的竞争优势。拥有这个特性比确保它是一个经过深思熟虑的可扩展解决方案更重要。

第二阶段是优化。是否有不同的访问模式可以优化？结果是较小的图像被更频繁地访问，所以它们被缓存了。他们也开始使用 CDN。NFS 不是为存储 800 亿个小文件而设计的，所以所有元数据都不适合内存，所以查找需要 2 或 3 个磁盘 io，速度很慢。

第三代是覆盖系统，它创建一个存储在文件系统中的 blob 文件。图像存储在 blob 中，并且您知道照片在 blob 中的偏移量。每张照片一个 IO。

**2。不要过度设计**。当您横向扩展系统时，只需使用您需要使用的东西。弄清楚你需要在哪里迭代一个解决方案，优化一些东西，或者完全自己构建一部分堆栈。他们花了很多时间试图优化 PHP，他们最终编写了 HipHop，一个将 PHP 转换成 C++的代码转换器。它节省了大量内存和 CPU。你不必在第一天就这样做，但你可能不得不这样做。在你写一门全新的语言之前，先关注产品。

**3。为工作选择合适的工具，但要意识到你的选择会带来开销**。如果你真的需要使用 Python，那就去做吧，我们会尽力帮助你成功。意识到这种选择是有开销的，通常是在部署、监控、运营等方面。

如果您选择使用服务架构，您将不得不自己构建大部分后端，这通常需要相当多的时间。有了灯堆，你可以免费得到很多东西。一旦您离开灯组，如何进行服务配置和监控就取决于您了。随着您对服务方法的深入了解，您必须重新发明轮子。

**4。获得正确的文化**。**快速移动**——打破东西。**巨大的冲击**——小团队。大胆创新。在内部建立一个环境，促进先建立正确的东西，然后根据需要进行修复，不要担心创新，不要担心破坏东西，胸怀大志，思考在建立第一件事之后你需要建立的下一件事是什么。你可以得到正确的代码，你可以得到正确的产品，但是你首先需要得到正确的文化。如果你没有得到正确的文化，那么你的公司将无法扩展。

1.  **快速移动**。先上市。如果你打碎东西没关系。例如，他们现在在由三个人开发的 HipHop 上运行他们的整个 web 层。风险很大，它会使网站定期停机(内存不足，无限循环)，但当他们想出如何让它工作时，会有很大的回报。另一种选择是对每个变化进行 3 个月的测试，这会减慢一切。这是一个特殊的例子，但最重要的是文化，让人们相信最重要的是他们能以多快的速度移动。
2.  **巨大的冲击**。小团队可以做大事。搜索、照片、聊天、HipHop 都是小团队在做主要功能。找到合适的人，授权给他们，让他们工作。
3.  **加粗**。不要害怕失败。尝试事情失败是可以的。说让我们制造一个新的 JVM 是疯狂的，但是当它工作时，回报是惊人的。

脸书没有产品所有者。每个人都拥有产品。让人们拥有他们所从事的工作。如果你把所有权交给一个人，那么很可能没有其他人会把它推向下一个层次。想法来自用户和内部人员。如果你不能把责任推下去，你孤立了那些觉得自己是真正所有者的人，那么你唯一能够激励的人就是那些认为自己是真正所有者的人。因此，为什么不将整个责任分散开来呢？

隔离文化中你重视并希望保留的部分。它不会自动发生。脸书组织了黑客马拉松，其目的是向新工程师展示，如果他们早上 8 点来上班，他们可以在 12 小时内在网站上获得一个新功能。快速行动不只是老生常谈，一家公司必须想出办法让人们觉得这是现实。

## **相关文章**