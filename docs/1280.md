# 护士简介:LinkedIn 的自动补救| LinkedIn 工程

> 原文:[https://engineering . LinkedIn . com/sre/introducing-nurse-auto-remediation-LinkedIn？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://engineering.linkedin.com/sre/introducing-nurse-auto-remediation-linkedin?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

在确保站点可用性方面，随着规模的扩大，要么自动化，要么死亡。

确保 LinkedIn 为全球 3.64 亿用户正常工作需要一个庞大而强大的工程师团队。自从我三年半前加入 LinkedIn 以来，我们已经增加了 2 亿名成员，从几百名工程师发展到遍布全球的数千名工程师。确保我们的网站始终可用并正常工作需要持续监控；当我们为会员添加更多的功能时，我们给网站增加了更多的复杂性。不久前，我们有一个专门的运营工程师团队，他们的唯一工作是了解每个站点组件，并确保我们尽快解决问题。这些工程师是一线响应人员和故障排除人员，执行一级问题检测、关联和解决。人类的眼睛和手始终维护着我们的站点稳定目标。

![](../Images/582dcceea1919c25163855d035943a30.png)

我们的持续增长给这些运营工程师带来了一个问题，我们的领导不得不做出决定:不断增加监控站点的人数，或者建立自动化来帮助他们完成工作。选择是明确的。我们启动了一项自动化警报响应的计划，让我们的运营工程师更关注警报的质量，而不是警报的数量。

在本帖中，我们将分享更多关于我们的方法、设计策略，以及自动化对于我们的站点可靠性工程(SRE)团队和网络运营中心(NOC)团队的发展意味着什么。

### 我们的方法

首先，我们必须定义如何识别问题和处理问题。LinkedIn 有一个非常强大的系统来收集成千上万的传感器，我的同事 Stephen Bisordi 最近在[的博客文章](https://engineering.linkedin.com/metrics/scaling-collection-self-service-metrics)中详细讨论了这一点。这些传感器连接到确定错误状态的警报，特别重要的警报会转发给我们的操作工程师，以便进行额外的研究、解决和采取行动。

然而，随着时间的推移，警报的数量开始超过我们的操作工程师进行分类的时间。为了解决这一问题，我们考虑了几个警报目标。在短期内，我们希望在我们的工程师参与调查之前，将更简单的警报自动化。通过减少我们监控的警报数量，我们应该能够更好地将我们的工程师集中到更高价值的活动上，如改善监控和注意模式。我们的长期目标是创建关键警报，展示 LinkedIn 会员正在经历的*症状*。这些*症状*的原因的解决将是自动的。只有当自动化失败时，才应该派人去调查。

以不可用的登录服务器为例，基于症状的警报是“无法登录”“无法登录”的*原因*可能多种多样。操作工程师会发现这一症状，并执行额外的故障诊断以确定确切的原因，每个原因都有不同的解决步骤。具有不同解决步骤的原因列表可能是:

*   向下处理
*   磁盘空间不足
*   线程不足

每个原因都是不同的警报，每个警报都会导致不同的解决步骤。我们有一个利用良好的监测系统来检测原因；我们需要一种方法来描述补救步骤并根据这些步骤来执行。

我们没有创建一个单一的整体实体来负责监控、工作流和行动，而是调整监控系统来请求工作流，而不是运营工程师的关注。这些工作流封装了解决问题所需的操作。这些行动描述了解决问题的途径。

![](../Images/9c6c8c642d271b5408d321ec07c25144.png)
图 1:三权分立

让我们举一个应用程序离线的例子。监控系统检测到主机由于服务离线而不处于其预期状态，即不能够服务流量，并使用一系列解决步骤来将主机移动到可能更好的状态。图 2 详细描述了一个可能的工作流:收集事件发生原因的数据，重新启动流程，并将整个工作流的结果放入一个票据中。这个工作流是一个强大的模式。根据我们网站的繁忙程度，我们可以在一天中看到几十个具有类似工作流的警报。这些步骤中只有一个会导致警报被清除:重启。

![](../Images/be654d03a1e86dff4678251324ee1d0b.png)
图 2:工作流程示例

我们运营工程师的首要任务是维护网站。它需要收集数据和记录行动，以解决长期问题和跟踪重复出现的问题。然而，一个工程师被持续不断的低级补救任务淹没，可能没有时间去注意更深层的模式。有了自动化的帮助和适当的审计，我们可以注意到我们产品的真实操作问题。

### 遇见护士

护士是我们的自动修复平台，我们在 2014 年 4 月开始实施。护士不仅帮助你康复，她们还承担医院的大部分工作，包括大部分的手术任务。

护士的设计很简单。护士充当许多系统之间的代理，如图 3 所示。我们的监控系统向我们的补救代理发布补救工作流请求。我们已经实现了与我们的代码部署系统、票务系统、远程执行系统的集成，以及几乎任何我们可以写入集成的其他系统。我们允许我们的站点可靠性工程师和操作工程师将任意数量的工作流操作合并到我们提供集成的系统中。这些措施是我们的工程师为解决警报而执行的步骤。

![](../Images/1cf7b7139d971e5e0c75b0a8f5e30d70.png)
图 3:经纪人为中心

在我们对 Nurse 进行 beta 测试期间，我们亲眼看到了它的实用性。发生了严重的电力中断，导致许多服务器离线。一个团队已经将他们的大部分监控转换为护士，并能够在电力恢复的几分钟内恢复他们的整个堆栈。其他受影响的团队必须通过监控来识别服务器，并手动发出恢复命令。

护士使我们能够灵活地自动执行较低级别的操作任务，并增加对补救任务的可审计和一致的跟踪。我们的运营工程师和站点可靠性工程师可以专注于更好的事件跟踪和更短的基于原因的警报持续时间。

### 下一步是什么

我们对护士有许多长期目标:

*   减少[监控疲劳](http://fractio.nl/2014/08/26/cardiac-alarms-and-ops/)
*   减少停机时的恢复时间
*   允许操作工程师专注于基于症状的警报

此外，护士在辅助故障诊断的概念上有所帮助。如果触发了基于症状的警报，您需要验证潜在的原因。护士可以升级基于症状的警报，例如用户无法登录，已经研究了潜在的原因:线程利用率、容量问题和下游运行状况。从护士那里接收升级的人可以自动地看到整体服务的健康状况，为开始对不健康的服务进行故障排除添加了大量的上下文。

护士也是我们运营工程师职业转型的关键。自动补救系统节省了时间，并为我们的团队提供了培养新技能和探索新角色的机会。对一些人来说，他们可以转变成现场可靠性工程师；对于其他人来说，他们将围绕深入的站点健康和故障排除创造新的机会。

这种自动化对于保持 LinkedIn 的增长至关重要，因为 Nurse 允许我们的运营团队扩展到新的工程可能性。护士每周执行超过 150 小时的补救工作流程，为我们的运营工程师节省了职业发展的关键时间，并将更多时间用于清理技术债务和改进流程。如果你有兴趣加入我们的团队，请查看我们的[空缺职位](https://www.linkedin.com/vsearch/j?company=linkedin&title=software)。

### 承认

整个旅程中，LinkedIn SRE 都非常热情。如果没有整个开发团队的辛勤工作和奉献精神，尤其是马特·克内赫特和 T2·阿迈德·沙里夫的努力，护士是不可能成功的。

### 额外资源

脸书对自己的自动化有着有趣的理解，脸书的 FBAR。 [StackStorm](http://stackstorm.com) 是一个伟大的开源项目，希望解决护士试图解决的许多目标。我们是在 11 月份有了一个正常工作的原型后才知道 StackStorm 的。 [Evan Powell](https://twitter.com/epowell101) 和[Dmitri Zimine](https://www.linkedin.com/in/zimine)stack storm 的创始人在 LinkedIn 的旅程中帮了很大的忙。对于湾区的 sre，有资源继续对话，包括[自动调解会议](http://www.meetup.com/Auto-Remediation-and-Event-Driven-Automation/)。