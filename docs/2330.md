# 亚马逊网络服务 10 年的 10 个教训

> 原文：<http://www.allthingsdistributed.com/2016/03/10-lessons-from-10-years-of-aws.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

![](img/44fb860a4576b17b592c1fa8ad3f8721.png)

AWS 的时代是 2006 年 3 月 14 日亚马逊 S3 的推出，现在差不多 10 年了。回顾过去的 10 年，我们学到了数百条关于构建和运营服务的经验教训，这些服务需要安全、可靠、可扩展，并以尽可能低的成本提供可预测的性能。鉴于 AWS 是在全球范围内构建和运营这些服务的先驱，这些经验教训对我们的业务至关重要。正如我们之前多次说过的，“没有经验的压缩算法。”每月有超过 100 万的活跃客户，而这些客户又可能服务于数以亿计的自己的客户，因此我们不缺乏获得更多经验的机会，或许也没有更好的环境来持续改进我们服务客户的方式。

我挑选了其中的一些经验与你分享，希望对你也有用。

**1。构建可进化的系统**

几乎从第一天起，我们就知道我们正在构建的软件不会是一年后运行的软件。我们的期望是，对于每一两个数量级，我们都需要重新审视和修改架构，以确保我们能够解决规模问题。

但是我们不能采用通过停机维护来升级系统的老方法，因为全球许多企业都依赖我们的平台来实现 24/7 可用性。我们需要构建这样一个架构，这样我们就可以在不关闭服务的情况下引入新的软件组件。亚马逊杰出的工程师 Marvin Theimer 曾开玩笑地说，亚马逊 S3 的发展可以被描述为从单引擎塞斯纳飞机开始，但随着时间的推移，飞机升级到 737，然后是一组 747，一直到现在的大型空中客车 380 机队。与此同时，我们在空中加油，把顾客从一架飞机转移到另一架飞机，而他们甚至没有意识到这一点。

**2。期待意想不到的**

失败是必然的，随着时间的推移，一切最终都会失败:从路由器到硬盘，从操作系统到损坏 TCP 包的内存单元，从短暂的错误到永久的失败。无论您使用的是最高质量的硬件还是最低成本的组件，这都是必然的。

这在规模上变成了一个更重要的教训:例如，随着 S3 处理数万亿的存储事务，任何哪怕是最微小的错误都将成为现实。这些故障场景中有许多是可以预先预测的，但更多的是在设计和构建时未知的。

我们需要构建这样的系统，即使我们不知道失败可能是什么，也要将失败视为自然现象。即使“房子着火了”，系统也需要保持运行重要的是能够管理受影响的部分，而不需要关闭整个系统。我们已经开发了管理故障发生的“爆炸半径”的基本技能，从而可以保持系统的整体健康。

**3。原语而非框架**

很快，我们开始意识到客户想要使用我们服务的方式是一项正在进行的工作。当客户将 IT 硬件和数据中心的旧世界抛在身后时，他们开始开发具有前所未见的新的有趣使用模式的系统。因此，我们需要超级敏捷，以确保满足客户的需求。

我们提供的最重要的机制之一是为客户提供一组原语和工具，他们可以从中挑选自己喜欢的方式来使用 AWS 云，而不是只提供一个他们被迫使用的框架，其中包括一切和厨房水槽。这种方法使我们的客户变得如此成功，甚至后来的 AWS 服务也使用我们的客户已经习惯的完全相同的原始服务。

同样重要的是要认识到，在客户拥有服务并实际开始使用它之前，很难预测他们的某些优先事项。这就是为什么我们交付的新服务通常具有最少的功能集，并允许我们的客户帮助推动使用新功能扩展服务的路线图。

**4。自动化是关键**

开发需要运营的软件服务与构建需要交付给客户的软件截然不同。大规模管理系统需要完全不同的思维模式，以确保我们满足客户对可靠性、性能和可扩展性的期望。

实现这一目标的关键机制是尽可能实现管理自动化，消除容易出错的手动操作。为此，我们需要构建管理 API 来控制我们运营的关键功能。AWS 也帮助其客户做到这一点。通过将您的应用程序分解成基本的构建块，每个构建块都有一个管理 API，您可以应用自动化规则来保持大规模的可靠和可预测的性能。一个很好的试金石是，如果您需要 SSH 到一个服务器或实例，您仍然有更多的自动化。

**5。API 是永远的**

这是我们从亚马逊零售的经历中已经学到的一课，但它对于 AWS 以 API 为中心的业务变得更加重要。一旦客户开始使用我们的 API 构建他们的应用程序和系统，改变这些 API 就变得不可能了，因为如果我们这样做，将会影响客户的业务运营。我们知道设计 API 是一项非常重要的任务，因为我们只有一次机会把它做好。

**6。了解您的资源使用情况**

在为服务构建财务模型以确定适当的收费模型时，请确保拥有关于服务成本及其运营的可靠数据，尤其是对于经营高容量低利润业务而言。作为服务提供商，AWS 需要非常关注我们的成本，以便我们能够向客户提供服务，并确定我们可以提高运营效率以进一步削减成本的领域，然后以更低价格的形式将这些节省的成本回馈给我们的客户。

早期，我们不知道服务于某些使用模式所需的资源的一个例子是 S3:我们假设存储和带宽是我们应该收费的资源；运行了一段时间后，我们意识到请求的数量是一个同样重要的资源。如果客户有许多小文件，那么即使他们发出数以百万计的请求，存储和带宽也没有多大用处。我们必须调整我们的模型，以考虑资源使用的所有方面，这样 AWS 才能成为可持续发展的业务。

**7。从头开始构建安全性**

保护您的客户应该永远是您的第一要务，对于 AWS 来说也是如此……从运营角度以及工具和机制来看都是如此；它将永远是我们的头号投资领域。

我们很快了解到的一种方法是，要构建安全的服务，有必要在服务设计的最开始就集成安全性。安全团队并不是一个在构建完成后进行验证的团队。他们必须在第一天就成为合作伙伴，以确保安全性从根本上来说坚如磐石。在安全问题上没有妥协。

**8。加密是一等公民**

对于客户来说，加密是一种关键机制，可以确保他们完全控制谁可以访问他们的数据。十年前，加密工具和服务很难使用，直到运营几年后，我们才知道如何最好地将加密集成到我们的服务中。

它从在 S3 为合规性使用案例提供服务器端加密开始。如果您检查我们数据中心的任何磁盘，没有一个数据是可访问的。但随着亚马逊 CloudHSM(针对硬件安全模型)和后来的亚马逊密钥管理服务的推出，客户可以使用自己的密钥进行加密，这就不再需要 AWS 来管理他们的密钥。

一段时间以来，在每个新服务的设计阶段都集成了对加密的支持。例如，在 Amazon Redshift 中，默认情况下，每个数据块都用随机密钥加密，这些随机密钥的集合也用主密钥加密。主密钥可以由客户提供，确保只有他们能够解密和访问他们的关键业务数据或个人身份信息。

加密仍然是我们业务的重中之重。我们将继续让我们的客户更轻松地使用加密技术，以便他们能够更好地保护自己和客户。

**9。网络的重要性**

AWS 已经开始支持许多不同的工作负载；从高容量事务处理到大规模视频转码，从高性能并行计算到海量网站流量。就网络而言，这些工作负载都有独特的要求。

AWS 开发了一种独特的技能来创新数据中心布局和运营，这样我们就可以拥有灵活的网络基础设施，可以适应客户的工作负载需求，无论它们是什么。随着时间的推移，我们认识到，我们不应该害怕开发我们自己的硬件解决方案，以确保我们的客户能够实现他们的目标。这使我们能够满足我们非常具体的要求，例如能够在网络上隔离 AWS 客户，以实现最高级别的安全性。

AWS 设计的网络硬件和软件如何帮助我们进一步提高客户性能的另一个成功例子是解决虚拟机网络访问的虚拟化税。由于网络访问是一种共享资源，客户以前有时会遇到网络严重抖动的情况。开发支持单根 IO 虚拟化的网卡使我们能够为每个虚拟机提供自己的硬件虚拟化网卡。这将延迟降低了 2 倍以上，并将网络延迟可变性提高了 10 倍以上。

10。没有看门人

随着时间的推移，AWS 团队提供了许多服务和功能，为我们的客户创建了一个非常广泛和深入的平台。但是 AWS 不仅仅是我们内部构建的服务:我们的合作伙伴提供了一个非常丰富的服务生态系统，将平台扩展到许多新的方向。

例如，我们有像 Stripe 这样的合作伙伴为 Twilio 提供支付服务，使电话在 AWS 上可编程。我们的许多客户也在 AWS 的基础上构建平台，以满足特定的垂直需求:飞利浦正在构建用于管理医疗保健数据的 Healthsuite 数字平台，Ohpen 在 AWS 上构建了零售银行平台，Eagle Genomics 构建了基因组处理平台，等等。重要的是，在 AWS 平台上没有看门人告诉我们的合作伙伴他们能做什么和不能做什么。“没有看门人”解放了创新过程，为许多意想不到的发明打开了大门，这些发明肯定会随之而来。

我期待着看到未来 10 年我们学到的东西，以及 AWS 客户的成就。记住，这还是第一天