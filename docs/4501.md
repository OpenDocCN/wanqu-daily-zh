# 我们如何建立自动化支持。这是一个合作的故事… |作者 Jeffrey Doker |构建 Kickstarter

> 原文：<https://kickstarter.engineering/how-we-built-automated-support-f2ea669252f?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

# 我们如何构建自动化支持

这是一个关于 Kickstarter 的数据团队如何与社区支持团队和工程团队合作构建一个名为 Sassy 的支持自动化工具的故事，以及我们的工作场所合作如何在这个过程中得到丰富。



# 起源于移情

成功的公司往往对他们的用户有一种深刻的、基本的同理心。在 Kickstarter，我们试图将同理心带到组织的每个部分，从以人为本的产品设计到社区支持电子邮件的关怀和语气。

在数据团队中，我们试图通过用户生成的数据来了解他们。这有时证明是一个挑战，因为数据点只是创建它们的人类的影子。

我们还试图与 Kickstarter 其他部门的同事产生共鸣。例如，我们的社区支持团队通过所谓的 CS 轮换来促进这一点，在这种情况下，公司中的每个人都有一个 CS 培训班次，并临时充当 CS 代理，在一周的时间内回答一些用户支持问题。

我在 2015 年秋季进行了 CS 轮岗，那是它提供的第一周。回答问题比我想象的要困难得多，但是我发现我喜欢与那些真正使用我帮助构建和维护的产品的人联系并帮助他们。分析 A/B 测试结果时，我有一种通常没有的兴奋感。

这种轮换不仅帮助我更好地理解了我们用户的模式和痛点，也是了解我们 CS 团队使用的工作流的一个很好的练习。

虽然给用户邮件写回复是一个缓慢而艰苦的过程，但经验丰富的 CS 特工们却能以闪电般的速度工作。他们不得不—支持票的数量很大，需要大量人力来及时准确地处理它们。

随着我对 CS 工作流的了解，我还了解到 CS 团队对探索增强支持很感兴趣，这意味着雇佣外部承包商来管理某些类型的票证，甚至可能在他们的工作流中引入一些自动化。跨团队合作的机会开始萌芽。

# 人类自动化

快速工作对我们的 CS 团队来说是必要的，但同样重要的是确保我们的用户被像人一样对待。当用户写下棘手的票证时，能够更深入地挖掘是很重要的，但通常这些高接触深度挖掘只能在交换一些诊断故障排除消息后才能真正开始。这些最初的电子邮件通常能直接解决用户的问题。

我很快了解到，社区支持的很大一部分包括回复许许多多简单明了、几乎完全相同的罚单:密码重置、支付故障排除，以及用户要求更改承诺都是司空见惯的事情。像整个行业的许多支持团队一样，Kickstarter 的 CS 团队创建了一系列“宏”——对简单问题的预先编写的回答，可以通过几次按键来回应许多这些罚单。经验丰富的 CS 特工已经记住了这些宏的分数，并且能够产生正确的宏，个性化它，并在几秒钟内启动它。

这一切都是在一个名为 [Zendesk](https://www.zendesk.com/) 的客户服务软件中完成的，该软件除了支持宏之外，还允许用户电子邮件被标记、优先排序并路由到不同的支持代理。使用 [Zendesk API](https://developer.zendesk.com/rest_api) ，这其中的许多也可以自动控制。

虽然宏的使用已经为我们节省了大量时间，但我们想看看是否可以走得更远。这里的 CS 团队规模很小，斗志旺盛，他们花在最快速的基于宏观的电子邮件上的时间占用了他们本可以用来解决需要专家和人类帮助的更困难问题的时间。

CS 和数据团队一起确定了一些用例，在这些用例中，高度自动化且最终耗时的人类行为可能能够在机器学习的帮助下实现自动化。

1.  **自动确定优先级**:CS 团队最近根据问题/票证的复杂程度将支持划分为几个不同的级别。确定票据优先级并将票据路由到适当的代理或组的任务可以自动化。
2.  **自动应答**:一些常见的罚单，往往用简单的、不加修改的宏来回答。如果机器学习算法能够可靠地识别这些门票，我们就可以自动回复某些首次接触的门票，让人类参与任何后续回复的循环。

带着这些目标，我们开始构建一个被称为 Sassy 的票证分类服务——支持+分类器的组合。

# 推销和服务

到目前为止，自动化社区支持的想法只是数据团队和社区支持团队的想法。为了向产品团队推销这个想法，我在 R 开发了一个闪亮的机票分类服务的应用原型。它的一侧有一个文本框，另一侧有一个响应宏和相关性分数的列表。当您键入问题时，宏分数会更新，最相关的宏会出现在列表的顶部。



*Early prototype built with R and Shiny*



幕后是在 [Glmnet](https://web.stanford.edu/~hastie/glmnet/glmnet_alpha.html) 中训练的[多类逻辑回归分类器](https://en.wikipedia.org/wiki/Multinomial_logistic_regression)。我与 CS 团队一起将宏分组到十几个主题桶中，并在我的训练集中使用这些桶作为标签。人们喜欢这个原型，我们决定真实地构建这个服务。

回到 Kickstarter 的工程方面，我们刚刚开始一项计划，将我们的 monolithic Rails 应用程序分解为更小的自治微服务。经过深思熟虑和试点测试，我们的工程团队决定用 Java 编写这些服务。

我有一些编写 C++代码的经验，所以我很高兴能离开 R 和 Ruby 一段时间，在静态类型的 Java 世界中工作。平台团队中的一些善良的工程师(包括几个月前在我的 CS 轮班中的某人)帮助构建了所有健壮的管道和基础设施，以构建分类 Java 服务的框架。我的工作是植入人工智能。

# 弥合差距

在这里，我开始遇到数据科学中的经典问题，即如何弥合原型和生产之间的差距——如何将训练模型的东西与服务于模型的东西连接起来。

我知道 R 非常适合从原始数据构建 ML 模型，我的原型是用 R 构建的，但是我们不想在生产级服务中使用那些 R 对象来服务请求；那是 Java 的工作。另一方面，我没有用 Java 训练模型的经验，我甚至不确定是否有可靠的库可以严格地在 Java 世界中创建 ML 模型。

这是我们偶然发现一个叫做 [H2O](https://www.h2o.ai/) 的机器学习平台，它基本上就是为了解决这个问题而设计的。我能够使用 H2O 高度可定制的 ML 模型在 R 中训练我的多类分类器(我最终使用了一个[梯度提升树模型](http://blog.kaggle.com/2017/01/23/a-kaggle-master-explains-gradient-boosting/)，然后将我训练的模型导出为一个[普通旧 Java 对象](https://en.wikipedia.org/wiki/Plain_old_Java_object) (POJO)文件。然后，这个 POJO 可以被插入到 Java 服务中，而没有任何依赖性——模型本身的所有逻辑都用简单的 Java 类和容器编码在 POJO 中。

我编写了一个训练脚本，从我们的支持票数据库获取原始数据，清理并标记 R 中的文本，在 H2O 训练一个模型，将该模型导出到一个 POJO 文件，并将该文件复制到 Java 源代码中。为了发布，模型必须通过一系列的准确性测试。我必须插入到 Java 服务中来服务请求的逻辑非常简单，POJO 虽然包含了成千上万行生成的代码，但工作起来非常棒。



*A few of the half-million lines of an autogenerated H2O POJO file*



这次进军 Java 领域也为我们新的面向服务的架构范例提供了一个模板。我们保持我们的类足够抽象，以便轻松地将分类服务扩展到将来可能需要的其他分类任务，例如预测项目成功的模型或垃圾邮件分类器。

我们在 2017 年初将该服务部署到野外。它通过从我们的应用程序发送的 POST 请求处理 Zendesk 票据，该请求包含票据文本和一些其他元数据。然后，Java 服务对文本进行清理和标记，通过模型 POJO 的逻辑传递文本，并使用标签列表和相应的概率进行响应。然后调用者可以根据响应采取行动，比如按优先级路由票据，甚至调用 Zendesk 自动响应票据。这些动作由调用者通过 Zendesk API 应用于票据的标签触发。

# 由 Sassy 授权

这个项目的部分乐趣是在 Sassy 的整个开发过程中与其他团队合作。这并没有在产品部署时结束。随着时间的推移，定期修改训练标签和重新训练模型的过程由社区支持团队负责。关于哪些宏应该被分组在一起，哪些宏应该被用作自动响应，以及哪些宏永远不应该被自动化的决定是只能由 CS 来回答的问题。

我和 CS 团队的成员一起工作，让他们熟悉如何使用 Github，进行和提交更改，以及打开和合并拉请求。关于模型训练标签的所有细节都包含在一个简单的配置文件中，它们拥有编辑该文件的所有权，并且使用简单的控制台命令运行再训练脚本。通过一点努力，让工程团队之外的人使用一些工程工具，Sassy 现在能够更加自主地发展——我们独立的团队更加紧密地结合在一起。

以下是用于将宏分组到时髦标签中的配置文件的示例片段:

```
config:
  -
    parent_macro:
      parent_macro_passwords
    macros:
      - macro_pw_trouble
      - macro_acct_profile_forgot_password
  -
    parent_macro:
      parent_macro_media_video
    macros:
      - macro_creator_build_video_resolution
      - macro_creator_build_embed_video_in_update
      - macro_creator_build_insert_video_in_description
```

CS 代理定期手动监控 Sassy 的准确性，并且 CS 和数据利益相关者经常聚在一起讨论结果。通过掌握这个过程的大部分，我的 CS 同事对我们正在使用的 ML 模型的优势和局限性有了强烈的直觉。这有助于我们共同对模型进行更明智的更新，良性循环将继续下去。

# 未来的时髦

这项被称为 Sassy 的服务目前正在使用中，它可以根据优先级对门票进行分类，甚至可以自动回复某些类型的门票。随着我们获得更好的训练数据，迭代不同的模型，并探索其他产品的体现，Sassy 将继续进一步发展。例如，通过一点工作，Sassy 的未来版本可能会在网站上提供实时、自动、即时的支持。我们对未来充满希望。

从为期一周的 CS 轮值答疑开始，发展成为跨团队协作，社区支持、数据和工程部门构建并部署全新的服务。我们在整个过程中互相学习，我们的团队和我们自己也因此变得更加强大。

