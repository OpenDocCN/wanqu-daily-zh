# 不要从你自己的服务器上发送邮件

> 原文：<https://www.attejuvonen.fi/dont-send-email-from-your-own-server/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

运行自己的服务器接收邮件是没问题的，但是省省你自己的头痛吧，不要试图发送任何邮件。这是一个关于不要相信你在网上读到的东西的警示故事。这也是一个分散式通信协议的故事，这种协议被全世界广泛采用，却被一家大型广告技术公司慢慢扼杀。但最重要的是，这是一个关于我试图给我妈妈发电子邮件的故事。

## 序言

那是 2016 年一个寒冷的早晨。在像正常人一样使用电子邮件二十年后，我终于受够了。我打算建立我自己的服务器。我会做得很完美，这样我就不必处理这些由其他人运行我的电子邮件服务器引起的问题。你问，什么问题？两个字:垃圾邮件过滤。

有一次我会回复我妈妈的电子邮件——一个 Gmail 地址——一周后她会打电话来确认我是否还活着，因为她从来没有收到我的电子邮件。然后，我会打电话给我的电子邮件服务提供商，当时是我的 ISP，他们会告诉我，Gmail 将他们列入黑名单几天，因为有人在使用他们的服务器发送垃圾邮件。“但是不要担心”，他们会说，“它现在工作了”。当然，也许今天*有效*。也许明天我妈妈又要担心了，因为有人没有设置退信通知。(有趣的事实:后来这个 ISP 关闭了我的电子邮件地址，因为他们预计会被收购，所以要停止 B2C 服务。)

你是否曾经注册了一项服务，并想知道为什么要等 2 个小时才能收到确认邮件？这曾经是我的一个常见问题，我现在知道这是由一种叫做*灰名单*的反垃圾邮件方法引起的。灰色列表意味着来自陌生服务器的电子邮件会被退回，并附上一张纸条，上面写着“请稍后再试”。然后发送服务器再次尝试。再一次。再一次。几个小时后，接收服务器说“好吧，我猜你不是垃圾邮件发送者，因为你经历了所有这些麻烦”，电子邮件最终到达收件箱。呃，好吧，那么…首先我们把光纤包裹在整个地球上，这样我们就可以在全世界范围内发送近乎即时的信息。然后有人看着这个系统说“我知道我们如何能使它变得更好:让我们创建一个延迟消息几个小时的协议！”我猜是进步吧？

## 我全新的电子邮件服务器

关于设置电子邮件服务器，你需要知道的第一件事是，它不仅仅是原始的电子邮件协议。这是整个舞蹈。如果你想让酷孩子和你一起玩，你需要配置一堆不同的东西，像反向 DNS，DKIM，SPF，HELO，和大约 12 个其他协议，我正在努力忘记这些，在这个时候就不一一列举了。之后，你需要牺牲一只山羊，表演一场雨舞。如果你的电子邮件仍然没有送达，你还不如向雨神祈祷，因为酷孩子(Gmail 和 Outlook)肯定不会告诉你你做错了什么。

所以我做了整个舞蹈动作。然后我使用了一堆服务，比如 DKIMValidator、mail-tester 和 Glockapps，来验证我的服务器运行正常。我解决了他们指出的可能会对我的送达产生负面影响的每一件小事。我继续，直到没有什么需要修复的了。尽管做了这些努力，我的个人邮件还是没有通过垃圾邮件过滤器。这对我来说是深不可测的:我是唯一一个从这个专用域和专用 IP 发送电子邮件的人，我只发送个人电子邮件，不知何故，这些电子邮件被贴上了垃圾邮件的标签。

也许有人已经进入了我的服务器，并在我不知情的情况下用它来发送垃圾邮件？我知道事实并非如此，因为我已经配置了 DMARC，Gmail 正在向我发送 DMARC 报告，报告显示在我给妈妈发邮件的日子里，有 1 封邮件从我的服务器发送到 Gmail。我还定期检查我的域名和 IP 地址是否不在任何垃圾邮件发送者的黑名单上。

## 雨神，你听到我的祈祷了吗？

Outlook 和 Gmail 都提供了报告邮件送达问题的表格。Gmail 没有回应我的祈祷。Outlook 回答说我“没有资格获得缓解”。他们不会说为什么，但他们很友好地提供了一些有用的提示，比如“确保你的电子邮件列表是最新的”。我试图再次向他们解释，我主要给我妈妈发电子邮件，我没有任何电子邮件列表，因为我不是垃圾邮件发送者。他们在“审查”了我的情况后回答说，我应该“确保退订过程是可见的”，以及其他一些他们认为对那些试图给自己所爱的人发送私人邮件的人会有帮助的建议。

cool kids 还提供一些交互式工具来监控电子邮件的可送达性，并帮助解决问题。Gmail 的产品名为 *Postmaster tools* ，而 Outlook 提供*垃圾邮件报告程序*和*智能网络数据服务程序*。我加入了所有这些。他们都没有向我出示任何数据，因为我不是一个 *~~垃圾邮件发送者~~大容量发送者*。

Gmail 为那些对提高 Gmail 邮件发送能力感兴趣的人提供了这篇文章。这篇文章的标题是 *~~垃圾邮件发送者~~群发者指南*，这给了你一些 Gmail 想要提高谁的可送达性的提示。

以下是小型电子邮件提供商 Migadu T1 的一句话:

> 在某些情况下，收件人服务器故意拒绝正确的电子邮件，只是因为我们是一个低容量的发件人。具有讽刺意味的是，理想的发送者应该是这样的。

等等，什么？为什么会有人这么做？ [AWS 文档](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/dedicated-ips.html#dedicated-ips-managed-reputation)似乎证实了这一点:

> 如果您使用专用 IP 地址，您有责任通过发送数量一致且可预测的电子邮件来维护发件人的声誉[…]您必须通过发送每天逐渐增加的电子邮件数量来预热这些地址[…]一旦您的专用 IP 地址预热完毕，您必须维护一个

一致的发送模式[…]大多数互联网服务提供商(ISP)仅在收到来自某个给定 IP 地址的大量邮件时，才会跟踪该地址的信誉。

我相信你已经注意到了这种模式，但我还是要把它说出来:Gmail 和 Outlook 不会发送来自低容量发件人的明显合法的电子邮件。送达工具、缓解措施和指南仅适用于~~垃圾邮件发送者~~的大量发送者。在一个最大的电子邮件提供商是巨大的广告技术公司的反乌托邦里，这几乎是你所期待的。

## 我放弃

在我积极使用自己的服务器从同一个域名和同一个 IP 地址发送电子邮件的 2 年时间里，有一段时间我的电子邮件会进入 Gmail 的收件箱。还有一段时间，我的电子邮件被放在垃圾邮件中，有时被直接退回，有时被接收和丢弃，甚至没有进入垃圾邮件文件夹。你永远不知道 Gmail 会对你的邮件做什么。前景更糟。在那两年里，我从未能够把一封电子邮件放入 Outlook 的收件箱。甚至对我的女朋友也没有，她经常从同一个地址给我回邮件。是的，Outlook 的垃圾邮件过滤在某种程度上比 Gmail 更糟糕。

## 但是你做了吗？

是的，我确实做了那件事。是的，我加入了 DNSWL。是的，我配置了返回路径头以匹配回复头。是的，我确实告诉我的服务器，当它告诉其他服务器它来自 127.0.0.1 时，它是淘气的。是的，我确实配置了 SPF 3.0，这甚至不是真的，你甚至不会注意到我只是编造的，因为电子邮件的可送达性是一个反乌托邦的地狱景象。

由于某种原因，当我讲述这个故事时，许多人都不相信。一个常见的回答是“你是不是在喊雨神的名字时做了逆时针旋转的动作……”是的，我做了，我还试着顺时针旋转，以防那会有用，还有为什么会这样？为了便于讨论，让我们假设我确实做错了什么。让我们假设从你的个人邮件服务器向 Outlook 和 Gmail 发送邮件是可能的。如果实现起来如此困难，这看起来是值得的努力吗？

我不是唯一有这个问题的人。黑客新闻上不时会出现一个关于电子邮件投递能力的帖子，很多人都在抱怨这个问题。[这里有一个](https://news.ycombinator.com/item?id=19756125)。这些帖子似乎也让个人电子邮件的传播者脱颖而出，比如说“让你的电子邮件被投递是很容易的。就做这一件事……”不要相信你在互联网上看到的一切，即使它被许多有信誉的来源重复。这些人本意是好的，但是他们没有提出任何证据，这让我得出一个明显的结论，他们实际上没有*衡量*他们的解救能力。他们只是*觉得他们的电子邮件已经送达。当偶然的邮件丢失时，很容易认为收件人只是选择不回信。你知道吗，也许他们中的一个真的有发送电子邮件的秘方，来自神圣少女 IP 块的 IP，一个被幸运兔子的脚触摸的域，无论什么。我再问一遍:这似乎是一项值得的努力吗？*

。

免责声明:反乌托邦地狱景观的笑话是从约翰·奥利弗偷来的。Gmail 的垃圾邮件过滤功能几乎总能让我给妈妈发邮件，真正的麻烦是给新联系人发邮件。