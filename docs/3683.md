# 克里斯·梅森-Linux.com 访谈脸书如何使用 Linux 和 Btrfs

> 原文：<https://www.linux.com/news/learn/intro-to-linux/how-facebook-uses-linux-and-btrfs-interview-chris-mason?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

Chris Mason 是 Btrfs 的主要作者，Bt rfs 是开源文件系统，被视为 SUSE Enterprise Linux 的默认文件系统。Mason 开始在 Oracle 从事 Btrfs 方面的工作，然后去了脸书，作为公司 Linux 内核团队的一员，继续从事文件系统方面的工作。 当脸书有新的内核需要发布时，梅森会帮助确保一切都经过了适当的测试，并满足性能需求。

我们和梅森坐下来，详细了解了 Btrfs 的现状，以及脸书是如何使用 Linux 和 Btrfs 的。以下是采访的编辑版本。T3】

**Linux.com: Btrfs 已经发展很久了。黄金时间准备好了吗？我知道一些 Linux 发行版使用它作为默认的文件系统，而其他的没有。**

Chris Mason:在 SUSE Linux Enterprise Server 中肯定是默认的。SUSE 在支持 Btrfs 上花费了相当多的精力和人力，我真的很感激。红帽没有以同样的方式捡起它。这是人们选择他们最关心的特性和他们想在其上构建的特性的一种方式。T3】

**Linux . com:Bt rfs 在哪些领域更有意义？如果我没错的话，脸书也使用 Btrfs？**

Mason:在脸书内部，我们再次选择了我们认为 Btrfs 的特性真正有利于手头工作负载的目标地区。 我们正在努力关注的大领域是系统管理任务，快照类型的事情。

**Linux.com:我们都知道脸书是 Linux 的重度用户。在脸书庞大的基础设施中，Linux 在哪里被使用？**

梅森:描述脸书的基础设施最简单的方式就是它几乎全是 Linux。 我们针对 btrf 的地方实际上是 围绕分发操作系统的管理任务，使用 btrf 的快照功能快速分发更新，使用 btrf 的校验和功能等等。

我们还有一批 机器 运行 Gluster ，同时使用 XFS 和 Btrfs 。目标是有主数据存储的。他们喜欢 Gluster 用例的Bt rfs的原因之一是因为数据 CRC(循环冗余校验)和元数据 CRC 让我们能够检测硬件中的问题，例如硬件中的静默数据损坏。实际上，我们已经发现了 btrf 的几个主要硬件错误，因此它对btrf 非常有益。T25】

**Linux.com:当我们在脸书谈论 Linux 的时候，我很好奇你离主流有多近或多远，因为没有人使用股票内核；每个人都创建了一个小分支，并针对用例进行了调整和调优。**

Mason:从 Linux 的角度来看，我们使用 Linux 内核的主要目标是尽可能多地跟踪主线。我们的目标是每年至少更新一次内核。我们正试图转向比那更频繁的更新周期。我们有一个上游优先策略，在我们使用它之前，我们得到主线中的变化。如果我们想在内核中拥有一个特性，它必须首先进入主线。T3】

**Linux.com:为什么需要自己的叉子？**

梅森:不可能运行主线内核。你必须有某种分叉，你微调东西，你调整东西，你为你自己的用例应用一些补丁。 我们的目标是让叉子尽可能的小。当我们从 4.0 内核迁移到 4.6 内核时，我们仍在迁移的过程中，当我们能够获得与一个补丁相当的生产工作负载性能时，我真的很高兴。这真的是一件大事。能够基本上采用一个普通的 4.6 内核，并拥有与我们修补的 4.0 内核相同的性能。 这确实是我们的长期目标:越来越接近能够运行主线，这样我们就可以非常快速地从一个内核过渡到另一个内核。T9】

**Linux.com:我们都见过运行非常旧的 Linux 内核的机器，而你的目标是尽可能运行最新的。有什么好处？**

梅森:作为一个工程师 ing 组织，最大的好处，就是我们要雇佣做上游事情的人。 开发人员 想要从事新的和创新的技术，他们想要在上游完成他们的工作，他们想要参加这些会议， 和 他们想要成为社区的一部分。我们希望能够将我们的工作放入上游内核，然后将它带回脸书。更容易找到并雇佣上游开发人员，这也是降低维护工作量的最佳方式。

**Linux.com:在服务器领域，我们经常从系统管理员那里听到“一旦安装并运行，就不要碰它”，这与我们在现代 it 基础设施中看到的相反，在现代 it 基础设施中，口号似乎是更快地移动以保持安全。**

梅森:我认为脸书的规模让我们更容易测试东西。这并不是说测试工作本身更容易，而是我们可以将这项工作分散到大量的机器上。我们有能力将测试工作带到我们所谓的“影子层”在这些影子层上，我们可以在非生产环境中重放生产流量，这样我们就可以在一个非常安全的地方 检查 性能 并确保 稳定性。我们可以增加流量，这样我就可以开始说，“好的，我将生产流量的 5%重放，一直到 100，然后观察当前的性能。”在这个过程中，我可以得到两个内核之间非常强的 A/B 比较。T11】

我们拥有验证内核和帮助测试上游内核的工具。在 upstream 中修复新的有趣的 bug 比不断地寻找 upstream 已经修复的旧 bug 更容易。T3】

**Linux.com:有哪些事情让你忧心忡忡？**

梅森:就运行Linux 内核或文件系统 s 而言，我们测试得非常好，Linux 周围有如此多的社区支持，所以我真的不担心运行它。T11】

**Linux.com:你参与 Linux 已经很长时间了，Linux 刚刚庆祝了 25 周年，你认为 Linux 在这 25 年里取得了什么成就？**

Mason:除了 技术 的贡献显而易见之外， 是 他创造内核 社区开发者的能力，人们对从一个版本到另一个版本的前进非常感兴趣。Linux 没有像许多其他项目那样进行碎片化。这并不完全是 Linu s 的，但是我给 Linus 如此多的信任 是因为 与 他建立的 进程，与内核一起前进要比分叉它并做一些不同的事情容易得多。

我认为这是一个 n 重要的 贡献，就内核社区如何团结在一起并带来新公司而不是将他们赶走而言，许多人都忽略了这一点。T11】

【Linux 开发入门。查看来自 Linux 基金会的[“Linux 介绍、开源开发和 GIT”课程](https://training.linuxfoundation.org/linux-courses/development-training/introduction-to-linux%2C-open-source-development%2C-and-git)。