# 北弗吉尼亚州(US-EAST-1)地区亚马逊 S3 服务中断摘要

> 原文：<https://aws.amazon.com/message/41926/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

我们想向您提供一些关于 2017 年 2 月 28 日上午发生在北弗吉尼亚(US-EAST-1)地区的服务中断的附加信息。亚马逊简单存储服务(S3)团队正在调试一个导致 S3 计费系统进展比预期慢的问题。太平洋标准时间上午 9 点 37 分，一名授权的 S3 团队成员使用已建立的剧本执行了一项命令，该命令旨在移除 S3 计费流程使用的 S3 子系统之一的少量服务器。不幸的是，该命令的一个输入不正确，并且删除了比预期更多的服务器。被意外移除的服务器支持另外两个 S3 子系统。其中一个子系统，即索引子系统，管理该区域中所有 S3 对象的元数据和位置信息。这个子系统对于处理所有的 GET、LIST、PUT 和 DELETE 请求是必要的。第二个子系统是放置子系统，它管理新存储的分配，并要求索引子系统正常运行。放置子系统在 PUT 请求期间用于为新对象分配存储。移除大部分容量导致这些系统都需要完全重启。当这些子系统重新启动时，S3 无法满足请求。US-EAST-1 地区依赖 S3 进行存储的其他 AWS 服务，包括 S3 控制台、亚马逊弹性计算云(EC2)新实例发布、亚马逊弹性块存储(EBS)卷(当需要来自 S3 快照的数据时)和 AWS Lambda 也受到影响，同时 S3 API 不可用。

S3 子系统旨在支持大量容量的移除或故障，对客户影响很小或没有影响。我们在构建系统时假设系统偶尔会出现故障，我们依赖移除和替换容量的能力作为我们的核心运营流程之一。虽然这是我们自启动 S3 以来维护系统所依赖的一项操作，但我们已经多年没有在较大的区域完全重启索引子系统或安置子系统了。S3 在过去几年经历了巨大的增长，重新启动这些服务和运行必要的安全检查以验证元数据完整性的过程比预期的要长。索引子系统是需要重新启动的两个受影响的子系统中的第一个。到太平洋标准时间下午 12:26，索引子系统已经激活了足够的容量，可以开始为 S3 的 GET、LIST 和 DELETE 请求提供服务。到太平洋标准时间下午 1:18，索引子系统完全恢复，GET、LIST 和 DELETE APIs 运行正常。S3 PUT API 也需要放置子系统。当索引子系统运行时，放置子系统开始恢复，并在太平洋标准时间下午 1:54 完成恢复。此时，S3 运行正常。受此事件影响的其他 AWS 服务开始恢复。其中一些服务在 S3 中断期间积累了大量工作，需要更多时间才能完全恢复。

由于此次运营事件，我们正在进行几项更改。虽然去除容量是一项关键的操作实践，但在这种情况下，所使用的工具使得太多的容量被过快地去除。我们修改了该工具，以更慢的速度移除容量，并添加了安全措施，以防止容量在任何子系统低于其最低所需容量水平时被移除。这将防止不正确的输入在将来触发类似的事件。我们也在审核我们的其他操作工具，以确保我们有类似的安全检查。我们还将做出改变，以缩短关键 S3 子系统的恢复时间。我们采用多种技术让我们的服务能够从任何故障中快速恢复。其中最重要的一个包括将服务分成小的部分，我们称之为单元。通过将服务分解成单元，工程团队可以评估和彻底测试甚至最大的服务或子系统的恢复过程。随着 S3 规模的扩大，该团队已经做了大量工作，将部分服务重构为更小的单元，以减小爆炸半径并提高恢复能力。在此事件中，索引子系统的恢复时间仍然比我们预期的要长。S3 团队计划在今年晚些时候进一步划分索引子系统。我们正在重新安排这项工作的优先次序，以便立即开始。

从事件开始到太平洋标准时间上午 11:37，我们无法在 AWS 服务健康仪表板(SHD)上更新单个服务的状态，因为 SHD 管理控制台依赖于亚马逊 S3。相反，我们使用 AWS Twitter feed (@AWSCloud)和 SHD 横幅文本来传达状态，直到我们能够在 SHD 上更新个别服务的状态。我们知道，SHD 在运营事件期间为我们的客户提供了重要的可见性，我们已经更改了 SHD 管理控制台，以跨多个 AWS 区域运行。

最后，我们要为此次事件给我们的客户造成的影响道歉。虽然我们对亚马逊 S3 的长期可用性记录感到自豪，但我们知道这项服务对我们的客户、他们的应用程序和最终用户以及他们的业务有多么重要。我们将尽一切努力从这次事件中吸取教训，并利用它来进一步提高我们的可用性。