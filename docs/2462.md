# 从边项目到 2.5 亿的每日请求|由戈登·温特罗|得到张贴

> 原文:[https://medium . com/get-put-post/from-side-project-to-2.5 亿-daily-requests-909b9e373d94？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://medium.com/get-put-post/from-side-project-to-250-million-daily-requests-909b9e373d94?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

## 什么是 IP 信息，开发者可以用你的 API 做什么？

IPInfo 是一个 IP 细节 API。它有地理位置的详细信息，所以你知道城市，地区，国家，通常还有 IP 的邮政编码或区号。如果您在网站上定制内容，您可以根据国家或城市向不同的人显示不同的功能。

另一个细节是组织。如果你查找你的 IP 地址，你到家了，它可能会说这是一个康卡斯特或美国电话电报公司的 IP 地址。它还返回主机名 IP。此外，我们有一个完全免费的计划——你可以在没有任何 IP 地址的情况下卷曲 ipinfo.io，它会给你你自己的 IP 详细信息。使用/8.8.8.8:



我们也有一些可选的附加组件，如运营商字段或托管提供商(例如，检测亚马逊 AWS 或 Rackspace IP 地址)。我们有一些基本的代理，可以让你知道一个 IP 地址是否是一个已知的代理。

## 谁是几个样本客户？

特斯拉在他们的网站上用它来寻找经销商。通过 API，他们可以自动检测到我住在山景城，并根据我的 ip 地址显示最近的经销商在帕洛阿尔托。



我们有很多不同的广告网络使用我们来定制他们的产品和内容。特别是，移动广告网络会根据你所在的国家显示不同的报价。

他们有好几个品牌。猫途鹰和施乐用它来定制他们网站的部分内容。布鲁克林图书馆使用它，但我不确定它的用途:)



## 你每天有 2.5 亿次请求。请告诉我你是如何获得初始用户的，以及最好的增长渠道是什么。

最初，我发布了一个带有引导主题的简单网页。所有的数据来自现有的地理 IP 数据库，它只是在地图上显示你的 IP 位置。在[主页](http://ipinfo.io/)上还能看到这个。



很快，我在 StackOverflow 上看到一个[问题，问是否有好的 API 可以查看你的 IP 位于何处。我想我已经有了所有的数据，所以构建一个简单的 API 很容易。我诚实地在几个小时内完成了它，然后回答了问题。](http://stackoverflow.com/questions/409999/getting-the-location-from-an-ip-address/17864552)

几个月后，我收到了来自 Linode 的电子邮件通知，说您的 CPU 使用率超出了图表。这很奇怪——我在同一个服务器上托管了很多网站，所以我不知道这里发生了什么。我登录，查看访问日志，每天都有数百万个 API 请求。多亏了 StackOverflow，它才真正开始起飞。

## 它刚刚进站？不对外销售？

是啊，绝对的。除了对基本 IP 信息的 GET 请求之外，这个 API 没有其他功能，所以我研究了如何改进它。有几个人一天处理 1000 万个请求，有一堆人处理大约 100 万个请求。

我决定尝试一些使用访问令牌的付费计划，并对每天 1000 个请求免费开放。我认为大多数小的副业项目每天需要的会比这个少，并且可以免费使用。在添加接入令牌和速率限制后，我添加了四个计划:每月 10 美元、50 美元、100 美元和 200 美元。



在推出付费计划的一周左右时间里，我的第一个付费客户是特斯拉。它在持续增长，我看到越来越多的企业客户对直接[下载我们的数据](http://ipinfo.io/data)感兴趣，而不是通过 API 访问它。



Ben’s Stack Overflow profile



我们没有使用付费广告或其他宣传手段。除了写一堆关于如何在我的网页上找到一个访问者的国家，如何用 javascript 获得某人的 IP，以及其他任何与我的 API 相关的问题的答案之外，这些都是完全入站的。我可以和阅读过不同帖子的人联系，他们会在自己的回答中链接到这个网站。

## 你能告诉我更多关于你的筹码吗？

有一些变化。

最初，我有一个 Linode 服务器。在收到 CPU 使用警告后不久，我添加了几台[数字海洋](https://www.digitalocean.com/)服务器，并使用[亚马逊 53 号路由](https://aws.amazon.com/route53/)让 DNS 使用循环法路由到其中一台服务器。它在一段时间内工作得相当好，但是添加新的服务器需要 DNS 更新，这需要一段时间来传播。如果服务器有任何问题，它会因为延迟而继续获得流量。

不久之后，我将所有东西都转移到 AWS，服务器放在弹性负载平衡器后面，这样我就可以在没有任何停机时间的情况下快速切换服务器。AWS 缩放组也在一定程度上帮助实现了自动化。

我在 3 个地区(美国东海岸、美国西海岸和法兰克福)设置了服务器，然后利用 Route 53 的[基于延迟的路由](http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-latency)路由到延迟最低的服务器，这有助于保持 API 的延迟超低，无论您在世界的任何地方。我还将很快在新加坡增加服务器，以进一步减少亚洲的延迟。



这种设置工作得很好，但部署是一个巨大的痛苦。我需要启动全新的新服务器，在那里部署最新的代码，将新服务器添加到负载平衡器，然后停用旧服务器。这都是脚本，但它仍然涉及运行一堆不同的脚本，并检查一切都按预期工作。

> AWS 确实有 [CodeDeploy](https://aws.amazon.com/codedeploy/) 来解决这个问题，但是它在一些核心区域之外还不可用，这意味着我不能使用它。

所以我才换了 [Elastic Beanstalk](https://aws.amazon.com/elasticbeanstalk/) ，基本上是 AWS 的托管版。它创建了与我以前几乎完全相同的服务器设置，但是部署现在只是运行一个简单的弹性 Beanstalk 命令，它为我处理一切。



始终一致的一点是，每台服务器都可以独立地响应每个 API 请求，没有共享数据库或任何东西。请求所需的一切都保存在内存中，所以当一个新的服务器开始运行时，请求可以直接进入。它非常快，我们每天 2.5 亿个请求中的 90%以上都在不到 10 毫秒的时间内得到处理。

## 听起来你的正常运行时间很长。你需要什么样的监控来追踪它？

主要是 AWS 日志，还有 [Pingdom](https://www.pingdom.com/) 为了安全起见。AWS 有很好的指标。有负载平衡器报告显示您的 IP 延迟。它们还显示了按 2xx、3xx 等细分的请求摘要。假设 Amazon 在保持负载平衡器运行方面做得不错，您可以看到从负载平衡器到我的后端有多少请求失败了。



此外，我每天将我们的负载平衡器日志导入到类似[的红移](https://aws.amazon.com/redshift/)中，并生成一系列报告。我主要尝试深入研究失败的请求。我担心的主要事情不是发送错误的数据。

## 您有在部署之前运行的持续集成测试吗？

该网站每天都会使用新数据进行重新部署，我们有一系列脚本来获取原始数据，对其进行处理，检查所有更新是否正确，然后部署到我们当前所在的 3 个不同的服务器区域。

## 你有任何关于服务中断的战争故事吗？

哈哈，到目前为止所有的问题都是因为我。正如我提到的，我们进行检查以确保我们生成的数据库在部署时没有损坏。随着时间的推移，这些检查已经演变为捕捉以前发生的错误。

例如，有一次一个必需的输入文件丢失了，脚本生成了一个空的组织数据库，我们部署了它，然后收到了一堆电子邮件…



随着时间的推移，集成测试变得更加全面！

## 其他人可以在 API 之上构建哪些用例？

**内容定制。**一个明显的例子是，像亚马逊这样的电子商务网站在不同的国家有不同的商店。如果你知道一个德国访问者正在浏览书籍，你应该把他们重定向到一个. de 网站，并显示德语选项。

**网络定制。**有一些非常有用的广告创意(比如能够以不同的方式瞄准 T-Mobile 和 AT & T 用户)，我很想知道人们还能利用这些数据做些什么。例如，如果用户使用慢速移动网络，而不是 wifi。也许你会提供低分辨率的图像或者不显示广告，因为它们不能很好地转换。

**位置混搭。**如果您有基于位置的数据，您可以将它与 ipinfo API 混合使用。比如，我看到很多人在整合天气数据库。

















