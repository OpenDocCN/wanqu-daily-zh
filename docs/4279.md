# 你不是谷歌。软件工程师为……而疯狂

> 原文:[https://blog . bradfieldcs . com/you-are-not-Google-84912 cf 44 AFB？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://blog.bradfieldcs.com/you-are-not-google-84912cf44afb?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

# 你不是谷歌

软件工程师为最荒谬的事情而疯狂。我们喜欢认为自己是超理性的，但当我们必须选择一种技术时，我们最终会陷入一种疯狂——从一个人的黑客新闻评论跳到另一个人的博客帖子，直到在昏迷中，我们无助地飘向最亮的光，趴在它面前，忘记了我们最初在寻找什么。

这不是理性的人做决定的方式，但这是软件工程师决定使用 MapReduce 的方式。

乔·海勒斯坦在他的本科数据库课上(54 分钟):

> 问题是，世界上大概有 5 家公司提供这么大的工作岗位。对于其他所有人来说…你做这些 I/O 是为了容错，而你并不真正需要。2000 年代，人们对谷歌有点狂热:“我们会以谷歌的方式做一切事情，因为我们还运营着世界上最大的互联网数据服务”[侧着头，等待笑声]



How many stories are your data center buildings? Google chose to stop at 4, for this one in Mayes County, Oklahoma.



拥有比你需要的更多的容错能力听起来不错，但是考虑一下成本:你不仅要做更多的 I/O，你可能要从一个有事务、索引和查询优化器的成熟系统切换到一个相对陈旧的系统。多么[重大的退步](https://homes.cs.washington.edu/~billhowe/mapreduce_a_major_step_backwards.html)。有多少 Hadoop 用户有意识地做出这些权衡？这些用户中有多少人明智地做出了这些权衡？

MapReduce/Hadoop 在这一点上是一个软目标，因为即使是货物爱好者也意识到飞机不在途中。但是同样的观察可以做得更广泛:如果你正在使用一项源自一家大公司的技术，但是你的用例非常不同，你不太可能是故意到达那里的；不，更有可能的是，你是通过一种仪式化的信念达到这个目标的，即模仿巨人会带来同样的财富。



好吧，所以是的:这是另一个“不要货邪教”的文章。但是等等！我为你准备了一份有用的清单，你可以用它来做出更好的决定。

## 酷科技？UNPHAT。

下次你发现自己在谷歌上搜索一些很酷的新技术来(重新)构建你的架构时，我劝你停下来，转而跟随**un hat**:

1.  在你理解问题之前，甚至不要开始考虑解决方案。你的目标应该是在*问题*领域内“解决”大部分问题，而不是解决方案领域。
2.  **枚举**多个候选解。不要只是开始戳你的最爱！
3.  考虑一个候选方案，然后阅读**论文**如果有。
4.  确定设计或开发候选解决方案的**历史背景**。
5.  权衡利弊。*确定什么被降低优先级*以实现什么*被优先*。
6.  **想！**冷静而谦逊地思考这个解决方案有多适合你的问题。*什么样的事实会让你改变主意？*例如，在你选择*而不是*使用 Hadoop 之前，数据需要小多少？

## 你也不是亚马逊

应用 UNPHAT 非常简单。考虑一下我最近与一家公司的对话，该公司曾考虑使用 Cassandra 对夜间加载的数据进行大量读取工作流:

读过 Dynamo 的文章，知道 Cassandra 是一个很接近的衍生产品，我明白这些分布式数据库优先考虑*写可用性*(亚马逊希望“添加到购物车”的操作永远不会失败)。我也很欣赏他们通过牺牲一致性以及传统 RDBMS 中的基本每个特性来做到这一点。但是我与*交谈的公司*不需要优先考虑写入可用性，因为访问模式要求每天一次大写入。🤔



Amazon sells a lot of stuff. If “add to cart” occasionally failed, they would lose a lot of money. Is your use case the same?



这家公司考虑 Cassandra，因为有问题的 PostgreSQL 查询需要几分钟，他们认为这是硬件限制。问了几个问题后，我们确定该表大约有 5000 万行，80 字节宽，因此如果需要完整的文件扫描，从 SSD 中完整读取大约需要 5 秒钟。这很慢，但比实际查询快了两个数量级。🤔

此时，我真的很想多问几个问题(明白问题！)并开始权衡问题增长时的 5 种策略(列举多个候选解决方案！)，但很明显，卡桑德拉将是完全错误的解决方案。他们所需要的只是一些耐心的调整，也许是重新建模一些数据，*也许是*(但可能不是)另一种技术选择…但肯定不是亚马逊为其购物车创建的高写可用性关键价值存储！

## 再者，你不是 LinkedIn

我惊讶地发现，一个学生的公司选择围绕卡夫卡来设计他们的系统。这令人惊讶，因为据我所知，他们的业务每天只处理几十笔非常高价值的交易——好的时候可能有几百笔。在这种吞吐量下，主数据存储可能是写入实体书的人。

相比之下，Kafka 旨在处理 LinkedIn 所有分析事件的吞吐量:这是一个巨大的数字。甚至在几年前，这相当于每天大约 1 万亿个事件，峰值超过每秒 1000 万条消息。我知道 Kafka 对于较低吞吐量的工作负载仍然有用，但是低了 10 个数量级？



The sun, while massive, is only 6 orders of magnitude larger than earth.



也许工程师们真的*根据他们的预期需求和对卡夫卡理论的良好理解做出了明智的决定。但我猜想，他们依赖于社区对卡夫卡的热情(通常是合理的),很少考虑它是否适合这份工作。我是说… 10 个数量级！*

## *你又不是亚马逊*

*比亚马逊的分布式数据存储更受欢迎的是他们认为使他们能够扩展的架构模式:面向服务的架构。正如沃纳·威格尔在 2006 年接受吉姆·格雷采访时指出的，亚马逊在 2001 年意识到他们正在努力扩展他们的前端，而面向服务的架构最终帮助了他们。这种情绪在一个工程师和另一个工程师之间回荡，直到只有几个工程师和几乎没有任何用户的初创公司开始将他们的 brochureware 应用程序分成纳米服务。*

*但是当亚马逊决定转向 SOA 时，[他们拥有大约 7800 名员工，销售额超过 30 亿美元。](http://media.corporate-ir.net/media_files/irol/97/97664/reports/2001annualreport.pdf)*



*The Bill Graham Auditorium in San Francisco has capacity for 7,000 people. Amazon had around 7,800 employees when it moved to SOA.*



*这并不是说你应该推迟 SOA 直到你达到 7800 名员工……只是，*为你自己考虑一下**。这是解决你问题的最佳方案吗？你的问题到底是什么，还有什么其他方法可以解决它？**

**如果你告诉我，如果没有 SOA，你的 50 人工程组织将会陷入停顿，我会想为什么这么多大公司用一个大型但组织良好的单一应用程序就能做得很好。**

## **甚至谷歌也不是谷歌**

**使用像 Hadoop 和 Spark 这样的大规模数据流引擎可能会特别有趣:通常传统的 DBMS 更适合工作负载，有时数据量非常小，甚至可以放在内存中。您知道吗，大约 10，000 美元就能买到 1tb 的内存。即使你有 10 亿用户，这也只能给每个用户 1kB *的内存*。**

**对于您的工作量来说，这可能还不够，您将需要读写磁盘。但是，您真的需要读写成千上万的磁盘吗？你到底有多少数据？GFS 和 MapReduce 是为了处理计算整个 web 的问题而创建的，比如重建整个 web 的搜索索引。**



**Hard drives prices are now much lower than they were in 2003, the year the GFS paper was published.**



**也许你已经读过 GFS 和 MapReduce 的论文，并且意识到 Google 的部分问题不在于容量，而在于吞吐量:他们分布存储，因为从磁盘上流式传输字节需要太长时间。但是，2017 年你将使用的设备的吞吐量是多少呢？考虑到你不会像谷歌那样需要那么多，你能买更好的吗？使用固态硬盘的成本是多少？**

**也许你希望扩大规模。但是你算过吗？您积累数据的速度是否可能快于固态硬盘价格下降的速度？您的业务需要增长多少才能让所有数据不再适合一台机器？截至 2016 年，Stack Exchange 每天服务 2 亿个请求，[仅由四个 SQL 服务器](https://nickcraver.com/blog/2016/02/17/stack-overflow-the-architecture-2016-edition/)提供支持:一个用于堆栈溢出的主服务器，一个用于其他一切的主服务器，以及两个副本。**

**同样，您可能会经历类似 UNPHAT 的过程，但仍然决定使用 Hadoop 或 Spark。这个决定甚至可能是正确的。重要的是你*实际上使用了正确的工具来完成工作*。谷歌很清楚这一点:一旦他们认为 MapReduce 不是构建索引的合适工具，他们就停止使用它。**

## **首先，理解问题**

**我的信息不是新的，但也许它是对你说的版本，或者也许它不够令人难忘，足以让你应用它。如果没有，你可以试试里奇·希基的谈话[吊床驱动开发](https://www.youtube.com/watch?v=f84n5oFoZBc)，或者波利亚的书 [*如何解决*](https://www.amazon.com/How-Solve-Mathematical-Princeton-Science/dp/069111966X) ，或者海明的课程 [*做科学和工程的艺术*](https://www.youtube.com/playlist?list=PL2FF649D0C4407B30) 。我们恳求你做的是**思考**！并真正理解你试图解决的问题。用波利亚的原话来说:**

> **回答你不理解的问题是愚蠢的。为自己不希望的结果而工作是令人难过的。**

