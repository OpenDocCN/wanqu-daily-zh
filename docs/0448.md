# 以小块构建和部署代码以降低风险

> 原文：<http://www.theeffectiveengineer.com/blog/build-and-deploy-code-in-small-chunks?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>



2011 年末，该公司上市后不久，LinkedIn 暂停了整整两个月的功能开发。动机呢？工程团队需要重组其整个代码部署过程，以简化开发。在这之前，工程师会通过从主干(主分支)分叉出一个分支来开发一个新功能，在几天或几周的时间内构建和测试该功能，然后将大量代码更改合并回主干。然后，他们不得不修复令人痛苦的合并冲突，并重新测试他们所有的更改，以确保他们不会因为自功能开发开始以来任何新代码签入 trunk 而引入任何不兼容。

旧的基于分支的工作流速度慢且容易出错。为了在某一天发布代码，工程师会在发布前三周将他们的代码合并到主干中，以留出缓冲空间来消除任何缺陷和错误。即使有三周的时间，实际部署需要 7 个小时以上才能完成的情况并不少见，因为疯狂的合并会导致不稳定，并且经常需要最后一刻的补丁。

因此，LinkedIn 投资了必要的工具和流程，将整个公司迁移到基于主干的开发，所有工程师都致力于一个共享分支(主干)。这是一个谷歌和脸书等其他公司成功扩展的过程。<sup id="fnref:google-fb-trunk">工程师们不是在几天或几周内孤立地构建整个特性，而是致力于直接提交到主干中的更小的变化。</sup>

这种增量方法的好处是巨大的:

*   您被鼓励在更小的逻辑块上工作，这样您可以更快更容易地将代码提交到主分支中，而不会有痛苦的合并冲突。
*   “合并地狱”通常发生在一个版本消失之前，因为代码变更不再是建立在许多天或几周前的分叉之上。
*   工程师的上下文切换显著下降——工程师在提交之前开发和测试他们的代码，并且在几天或几周后的未来合并点不必经历相同的过程。
*   代码变更，因为它们更小，变得更容易审查——导致更高的代码质量。
*   更多的工程师可以更早地提供有价值的反馈，因为代码被检入主分支。
*   总体风险降低了，因为提交但未部署的代码更少了。

LinkedIn 的高级工程副总裁凯文·斯科特告诉《连线》杂志，“如果我们没有完成所有这些工作来改变我们构建软件的方式，我们就不可能建立代言，新的影响者产品，新版本的个人资料和移动领域正在发生的事情，我们对招聘人员产品的升级，以及正在推出的所有这些重大变化。”[1]增量的、基于主干的方法使他们能够将更多的时间集中在实际的功能工作上，而不是协调合并。

当我在 Quora 工作时，我们将这种增量方法发挥到了极致——我们使用连续部署，通过一系列测试的每个提交都会立即自动部署到产品中。对于我们的团队来说，一天部署 50 次以上的代码是很正常的。甚至在我现在工作的初创公司，我们一天要部署好几次软件。关注更小的和增量的变更不仅不会增加风险，还会使代码质量更高，并显著减少任何协调开销。以更小的块构建和部署代码意味着我们可以在用户面前快速轻松地验证更改。这反过来意味着我们更有可能成功。

