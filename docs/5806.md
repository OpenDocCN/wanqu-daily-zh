# 永远不要在你的代码中使用“用户”这个词

> 原文：<https://codewithoutrules.com/2018/09/21/users-considered-harmful/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

当你开始一个项目六个月的时候，你意识到你在开始时做的一个微小而简单的假设是完全错误的。现在，您需要在保持现有系统运行的同时解决问题——如果您一开始就做对了，那么要付出更多的努力。

今天我想告诉你一个常见的错误，一个会给你带来无尽麻烦的单词。当然，我说的是“用户”。

这个词有两个基本问题:

1.  “用户”几乎不能很好地描述你的需求。
2.  “用户”助长了基本的安全设计缺陷。

“用户”这个概念非常模糊，使用更准确的术语会更好。

## 你没有用户

首先，没有一个软件系统实际上有“用户”。乍一看，“用户”是一个很好的描述，但是一旦你仔细观察，你会发现你的业务逻辑实际上比这更复杂。

我们将考虑三个例子，从一个极端的例子开始。

### 机票预订系统没有“用户”

我曾经为一个机票预订系统开发访问控制逻辑。以下是部分需求列表:

*   如果有 PNR 定位器，旅行者可以通过网站查看他们的预订。
*   购买者可以通过网站修改预订，如果他们有信用卡号码的最后 4 位数字。
*   旅行社可以查看和修改通过他们的代理机构进行的预订。
*   根据旅客提供的识别信息，航空公司值机代理可以根据他们的角色和机场查看和修改预订。

诸如此类。映射到人类的一些基本概念是“旅行者”、“代理”(网站也可能是代理)和“购买者”。“用户”的概念根本没有用，我们根本没有使用这个词——例如，在许多请求中，我们必须包括旅行者和代理的凭证。

### Unix 没有“用户”

让我们来看一个非常不同的案例。Unix(现在称为 POSIX)有用户:用户可以登录并运行代码。这似乎很好，对不对？但是让我们仔细看看。

如果我们仔细检查所有我们称之为用户的东西，我们有:

*   通过终端或图形用户界面登录的人。
*   也作为“用户”运行的系统服务(如邮件或 web 服务器)，例如`nginx`可能作为`httpd`用户运行。
*   在服务器上，经常会有多个管理帐户被使用这个“用户”的人共享(例如，`ubuntu`是运行 Ubuntu 的 AWS 虚拟机上的默认 SSH 帐户)。
*   `root`，和上面的都不太一样。

**这是四个相当不同的概念，但在 POSIX 里都是“用户”。**正如我们稍后将看到的，将所有这些概念分解成一个模糊的概念“用户”会导致许多安全问题。

但是在操作上，我们甚至没有办法在 POSIX 用户模型的边界内说“只有 Alice 和 Bob 可以登录到共享管理帐户”。

### SaaS 提供商没有“用户”

Jeremy Green [最近在 tweeted 上发了一篇关于软件即服务的用户模型的文章](https://twitter.com/jagthedrummer/status/1037812206602252291)，这也是促使我写这篇文章的第一个原因。他的基本观点是，SaaS 的服务几乎总是:

1.  组织中为服务付费的人。
2.  组织中实际使用服务一个或多个人员。

如果你一开始就把这些结合成一个单一的“用户”,你将会陷入一个痛苦的世界。你不能建模团队，你不能一次为多个人建模支付——现在你需要改进你的系统。现在，你可以从 SaaS 事件中吸取教训，继续你的生活。

但这只是一个更广泛的问题的一个例子:“用户”这个概念太模糊了。如果你开始怀疑“用户”这个词，你很可能最终意识到你实际上至少有两个概念:团队(支付和所有权的单位)和团队成员(实际使用服务的人)。

## 作为安全问题的“用户”

“用户”这个词不仅仅是业务逻辑的问题:它也有严重的安全后果。“用户”这个词非常模糊，它混淆了两个根本不同的概念:

*   一个人类。
*   它们在软件中的表现。

要了解为什么这是一个问题，假设您访问了一个恶意网站，该网站上有一张利用浏览器缓冲区溢出的图片。远程站点现在控制您的浏览器，并开始将您的所有文件上传到他们的服务器。它为什么能做到这一点？

因为你的浏览器是以你的操作系统“用户”的身份运行的，而你的操作系统“用户”被认为是和你一模一样的人，一个完全不同的“用户”。你，用户，不想上传那些文件。操作系统帐户，也就是用户，可以上传这些文件，因为你的浏览器是在你的用户下运行的，所以它的所有操作都被认为是你想要的。

这就是所谓的[糊涂副手问题](https://en.wikipedia.org/wiki/Confused_deputy_problem)。如果你用“用户”这个词来描述两个本质上不同的东西是一样的，那么这个问题更有可能成为你设计的一部分。

## 预先设计的价值

成为一名高效程序员的关键是用更少的努力完成同样的工作。使用像“用户”这样模糊的术语来建模你的软件将会花费大量的时间和精力来修正。**立即开始编码似乎很有成效，但实际上恰恰相反。**

下次你开始一个新的软件项目时，花几个小时预先确定你的术语和概念:你仍然不会完全正确，但是你会做得更好。你未来的自己会感谢你阻止了所有浪费的工作。