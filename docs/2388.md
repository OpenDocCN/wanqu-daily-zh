# NPM 和左垫:我们忘记了如何编程吗？大卫·哈尼

> 原文:[http://www . haney codes . net/NPM-left-pad-have-we-forgot-how-to-program/？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)



# 介绍

好了，开发者们，是时候认真谈谈了。正如你可能已经知道的，本周 React、Babel 和 NPM 的一系列其他高知名度的软件包都出现了问题。它们断裂的原因相当令人震惊:

一个简单的名为 [left-pad](https://www.npmjs.com/package/left-pad) 的 NPM 包依赖于他们的代码。

在我写这篇文章的时候，[在 GitHub](https://github.com/azer/left-pad) 上有 11 颗星。整个包是 [11 行简单的代码，实现了一个基本的左键盘字符串功能](https://github.com/azer/left-pad/blob/master/index.js)。为了防止这些链接失效，以下是 left-pad 包的完整代码:

```
module.exports = leftpad;
function leftpad (str, len, ch) {
  str = String(str);
  var i = -1;
  if (!ch && ch !== 0) ch = ' ';
  len = len - str.length;
  while (++i < len) {
    str = ch + str;
  }
  return str;
} 
```

我在这里关心的是*这么多的包和项目*为一个简单的左填充字符串函数承担了一个**依赖**，而不是他们的开发者花 2 分钟自己写这样一个基本的函数。

由于了解了左倾翻的灾难，我开始调查 NPM 的生态系统。以下是我观察到的一些情况:

*   有一个名为 [isArray](https://www.npmjs.com/package/isarray) 的包每天有 88 万次下载，2016 年 2 月有 1800 万次下载。它拥有 **72 个从属 NPM 包**。下面是它的**整整 1 行代码**:

    `return toString.call(arr) == '[object Array]';`

*   有一个名为[的包是-正整数](https://www.npmjs.com/package/is-positive-integer) ( [GitHub](https://github.com/tjmehta/is-positive-integer) )它是 **[4 行长](https://github.com/tjmehta/is-positive-integer/blob/master/index.js)** 并且截至昨天需要 **3 个依赖**才能使用。作者后来对它进行了重构，要求 0 个依赖项，但是我想知道为什么一开始不是这样。

*   一个全新安装的[巴别塔](https://www.npmjs.com/package/babel)包包括**41000 个文件**

*   一个空白的基于 jspm/npm 的应用模板现在从**的 28000 多个文件**开始

所有这一切让我想知道…

# 我们已经忘记如何编程了吗？

在什么可能的生存层面上，这是对过去问题的更好的解决方案？对于一个空白的项目模板来说，数百个依赖项和 28，000 个文件有什么不复杂和疯狂的呢？

我得到的印象是，NPM 生态系统的参与者已经创造了一个微型包装的嗜好。他们似乎更喜欢依赖别人写的东西，而不是写任何函数或代码。对我来说，好像一个参与 NPM 的开发人员的全部工作就是编写尽可能少的代码，将现有的库调用串在一起，以便创建一些新的功能，独特地满足他们的个人或业务需求。

# 函数不是包

函数太小，不能放入包和依赖项中。纯函数没有内聚力；它们只是随机的代码片段，仅此而已。谁真的想要“余弦”依赖关系？我们都非常喜欢“三角学”依赖，它包含了许多我们不想自己编写的“棘手”函数。这更类似于。NET 和其他框架创建了一个基本功能的“核心”库。这样的库由语言的创造者审查，并保证是正确的和没有错误的。

# 第三方问题

绝对不能保证别人写的东西是正确的，甚至是有效的。即使正确，它是可能的最佳解决方案吗？至少当你自己写代码的时候，你可以很容易地修改它来修复 bug，提高效率。并不是说一行函数中应该有很多 bug。

第二，即使这个包的逻辑是正确的，我还是忍不住对这样一个事实感到惊讶:开发人员对单行函数的依赖，他们应该闭着眼睛也能写出来。在我看来，如果你不能在 5 分钟内(包括你搜索的时间)写出一个左填充、is-正整数或 isArray 函数，那么**你实际上不知道如何编码**。任何这些都会成为一个很好的代码筛选面试问题，以确定候选人是否会编码。

最后，把 API 串在一起，称之为编程，并不能使它成为编程。这是一种疯狂的依赖黑客形式，涉及到云、过度工程化的东西以及远远超出创建优秀应用程序实际需要的复杂性。

更糟糕的是，如果你的任何代码(或第三方依赖代码)有错误或中断，如果你不知道如何编程，你就不知道如何调试或修复它。

# 争取较少的依赖

您使用的每一个包都会向您的项目添加另一个**依赖项**。顾名思义，依赖关系是你**为了让你的代码运行而需要**的东西。你所依赖的越多，你的失败点就越多。更不用说出错的可能性了:你有没有审查过那些编写了你日常依赖的函数的程序员？

对于任何需要花费大量时间、金钱和/或调试来自己编写的复杂功能，采取依赖的态度。像数据库访问层(ORM)或缓存客户端这样的东西应该是依赖关系，因为它们很复杂，依赖关系的风险值得节省和提高效率。

但是，出于对编程的热爱，请编写您自己的基本编程函数。依赖这些一行程序简直是疯了。不相信我？只要问问 React 团队他们这一周过得怎么样，他们是否希望自己写了这 11 行来左填充字符串。

*在推特上关注大卫·哈尼[@哈尼特伦](http://www.twitter.com/haneytron)T3】*

*2017 年 1 月 13 日更新，对语法和句子结构做了一些小的改动。*

* * *

#### 请参见

