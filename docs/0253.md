# 分裂原子|尼龙

> 原文:[https://www.nylas.com/blog/splitting-the-atom?UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://www.nylas.com/blog/splitting-the-atom?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

当我们开始构建一个新的电子邮件客户端时，我们有一些初始要求。

首先，我们觉得电子邮件太重要了，不能在浏览器标签中丢失。对于许多专业人士来说，电子邮件客户端将每天全天开放，通常在一个专用屏幕上。一个严肃的电子邮件客户端应该有在 Windows、Mac 和 Linux 上运行的感觉。这意味着它应该有真正的窗口，自己的图标，以及在后台或离线运行的能力。

![Planets](../Images/6255a64322c645f76840f38ba605d233.png)

其次，我们认为真正突破性的软件必须包含创造性和定制化。就像 Emacs、Excel、Photoshop 或《我的世界》一样，未来的电子邮件客户端必须能够被最终用户扩展。没有放之四海而皆准的解决方案。

第三，我们的团队希望使用现代技术来吸引大量的开发人员。这里显而易见的选择是 JavaScript，它在过去几年中赢得了开发人员的青睐。JS 已经成长起来，走过了闪烁的 MySpace 页面和虚假的 snow，今天拥有一套强大的开发工具，大量成熟的开源项目，以及适用于每种设备的跨平台引擎。这种语言对初学者和专家来说都很棒，我们看到它在未来的几年里仍然处于开发者创新的前沿。

### 跨平台的探索

![Native Checklist](../Images/640e40f91dba7aaf5c30f1d7ad4450c3.png)

如何构建一个能在 Mac、Windows 和 Linux 上运行的原生应用？十年前，C++或 Java 会是显而易见的选择，但是苹果已经不再直接支持 Java，开发者 mindshare 已经转向其他领域——现代网络技术。今天，我们知道我们最好的选择是网络。但是，如何利用最新的 web 技术，如 ES6 和 HTML5，而不被浏览器束缚住呢？

答案就在 [Atom](https://atom.io/) 中，这是 GitHub 在过去几年中悄悄开发的一个“可破解”文本编辑器。

### 分裂原子

乍一看， [Atom](https://atom.io/) 只是另一个流行的文本编辑器。但在表面之下，它要多得多。Atom 实际上是一个 web 应用，由一个新的桌面应用框架提供支持，该框架结合了 NodeJS 和 Chromium。这个基础允许整个应用程序用 JavaScript 编写，具有对文件系统的本地访问、完整的网络 IO 和各种 NodeJS 模块。与其他为 JavaScript 提供桌面环境的项目不同，Atom 的核心包括紧密的系统集成、[清晰的文档](https://github.com/atom/electron/tree/master/docs)，以及许多推动其通过恐怖谷的小细节。

## 我们正在派生 Atom——可破解的文本编辑器——来创建一个强大、快速、灵活的邮件客户端。

Atom 为桌面上的 JavaScript 提供了坚实的基础，其应用程序代码提供了许多设计良好的通用组件，如包管理器和自动更新器。随着开发的进展，我们期待着向上游贡献补丁。

但这是我们改变的地方。Atom 是专门为文本编辑器设计的，虽然它是一个很好的构建模块，但我们新的电子邮件客户端提出了一系列完全不同的挑战。

### 对速度的需求

为了感觉像一个本地应用程序，我们的新邮件客户端需要非常高的性能。界面延迟——或者更糟，视觉上明显的渲染——会暴露其网络基础，给我们的用户带来不和谐的体验。虽然对于简单的网站来说，性能不是问题，但是我们知道我们的应用程序会成长为一个拥有巨大 DOM 树的大型 web 应用程序——修改 DOM 非常慢。早期，我们的团队在 AngularJS 中构建并开源了一个基本的邮件客户端，因此我们知道基于模板的 web 框架的苦恼…

我们的解决方案是使用 [React](https://facebook.github.io/react/) 。React 作者首创的[“虚拟 DOM”](http://blog.reverberate.org/2014/02/react-demystified.html)概念是大规模 JavaScript 应用中性能问题的最佳解决方案之一。React 的[算法](http://calendar.perfplanet.com/2013/diff/)批量修改 DOM，最大限度地减少昂贵的操作和回流，这些操作和回流会随着应用的增长降低应用的性能。这对我们来说是一个巨大的胜利，也是我们的 UI 如此快速和稳定的主要原因。

### 赢得西方的通量

JavaScript 的大部分内容看起来仍然像是蛮荒的西部——在那里，兴奋和机遇伴随着“一切皆有可能”的态度。这在增长到数千行和许多开发人员的大型应用程序中变得特别危险。为了避免崩溃，你需要结构化、模块化和可预测性。

![MOVE FAST AND BREAK NOTHING](../Images/1823e1deb3828fadbe549d54b2a6a1ff.png "MOVE FAST AND BREAK NOTHING")

当我们开始构建我们的新邮件客户端时，我们希望使用一种架构，这种架构将大型应用程序开发的最佳实践整理成文，并且理想情况下甚至可以防止糟糕的架构决策成为可能。我们还希望从第一天开始就设计可扩展性。这意味着应用程序的组件应该松散连接，并为扩展提供丰富的接口。

为了实现这一点，我们使用了“ [Flux](https://facebook.github.io/flux/) ”的变体——用户界面中单向数据流的模式。Flux 旨在解决大型 MVC 应用程序的常见问题，通过应用程序实现单向数据流，以及视图和业务逻辑之间的松散耦合。它还要求使用[“命令”模式](http://gameprogrammingpatterns.com/command.html):应用程序的每一个变化都会触发一个全局声明的动作。动作可以从应用程序的任何地方发送，同样也可以从任何地方观察。这在小组件之间创建了松散的耦合，因此是一种自然可扩展的模式。

我们对这种架构感到兴奋还有许多其他原因。Flux 将业务逻辑排除在 React 组件之外，防止视图和模型的脆弱缠绕，并为我们的团队提供了一种用于单向数据流和松散耦合的简明领域语言。

例如，一个按钮不可能直接修改一个线程——这个动作可能导致接口和本地缓存不同步。相反，该按钮触发一个*动作*，该动作触发一个*存储*中的业务逻辑，该业务逻辑修改本地缓存并使整个应用程序接收一个具有新状态的更新。

### 动作要快，不要打破任何东西

如果你有一个大的代码库，我们相信快速发布可靠软件的唯一方法是编写测试。句号。人们每天都依赖电子邮件，因此稳定性和可靠性对我们来说非常重要。这意味着我们需要为核心业务逻辑和 UI 组件编写测试——最好是单元测试。

![MOVE FAST AND BREAK NOTHING](../Images/92d90b2bd308be05ead9081f5e5192db.png "MOVE FAST AND BREAK NOTHING")

我们已经使用 Selenium 很长时间了，但是总觉得它的测试太难写，而且在开发过程中运行起来太耗时。有了 React，测试变得简单且超级快速，因为组件是“无 DOM”地呈现 JavaScript 对象，而不是 HTML。最重要的是，每个 React 组件只依赖于它的内部和父状态，这意味着组件可以真正地在隔离状态下测试。UI 组件的单元测试！

### 为冒险做准备

我们汇集了一些非凡的技术——[电子](https://github.com/atom/electron)、[反应](https://facebook.github.io/react/)和[通量](https://facebook.github.io/flux/)——并为一些全新的东西奠定了基础:一个强大且可扩展的个人数据工具。在接下来的几个月里，我们将分享更多关于我们新客户端的架构以及我们使其可扩展的具体方法。加入我们的邮件列表，随时了解最新动态！