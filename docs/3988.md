# 在 KenCochrane.com 码头工作了 5 年

> 原文:[https://www.kencochrane.net/2017/03/24/5-years-at-docker/?UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://www.kencochrane.net/2017/03/24/5-years-at-docker/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

2017 年 2 月 15 日是我加入 [dotCloud/Docker](https://www.docker.com) 五周年纪念日。关于在 Docker 的那 5 年，我想了很多，并认为这会成为一篇好的博文。这将是相当长的时间，但我认为这将是值得的，看看如何 Docker 随着时间的推移进展。

### 我是如何被聘用的

在我解释我如何得到这份工作之前，我需要先介绍一下背景。在 dotCloud/Docker 工作之前，我在一家名为 [CashStar](https://www.cashstar.com) 的初创公司工作。在 CashStar，我是第一个被雇佣来建造他们正在开发的 SaaS 产品的工程师。当我到那里时，他们只有一个 powerpoint 演示和一个半工作演示。这很好，因为这意味着我可以自由地做我想做的事情，选择我认为最适合这项工作的技术。我选择了一个典型的 Linux 栈，以下面的为基础:Linux，Python/Django，MySQL。这个堆栈非常适合我们正在做的事情。如果我必须再做一次，我可能做的唯一改变是用 PostgreSQL 替换 MySQL。

几年后，我们有了一个拥有大客户的好产品，以及一个支持它的大团队。感恩节到圣诞节是我们一年中最忙的时候，然后新年过后事情就慢下来了。这是一个很好的时机来回顾过去的一年，看看我们的痛点是什么，并开始规划我们明年的路线图。我们面临的一个棘手问题是将我们的应用程序部署到我们的服务器上。大约在同一时间，PaaS 开始流行起来，我开始对市场上不同的 python PaaS 做一些研究，希望找出它们是如何工作的。为了能记住我的发现，我为每一个写了一篇[博客，并附上了我的笔记。其中一篇博文是关于一个叫做](/tags/paas/)[点云](/blog/2011/04/deploying-my-django-application-to-dotcloud/)的新平台即服务的。我真的很喜欢他们做的事情，所以我开始跟踪他们，并试图弄清楚他们是如何做事情的，这样我就可以在 CashStar 建立自己的内部 PaaS。

后来有一天，我看到了这条微博:

我没有在找工作，但我总是在寻找可以找到的工作，因为你永远不知道下一个好机会什么时候会出现。我发了一封电子邮件，看看他们是否对一名远程员工感兴趣，他们说感兴趣，于是我参加了面试。在接下来的一周左右，我会见了一些人，每个人都非常棒，我能够更好地了解他们是如何构建 PaaS 的。在与 jérme Petazzoni 的一次采访中，我第一次听说 Linux 容器。由于对 Linux 容器一无所知，我很快做了研究，以便为下一次面试做好准备，以防他们问我任何关于它们的问题。我很快学会了一些东西:

1.  没有太多的文档，即使有，也是非常有限和低水平的。(不适合胆小的人)
2.  这真是很酷的东西
3.  它相当新，并且只在最新的内核中受支持
4.  它很难使用

大约在同一时间，我试图找出一种更好的方法来打包 python 应用程序(T1)，使它们更像 Java 应用程序(War 文件)，我读了越多关于 linux 容器的书，并与 dotCloud 的人交谈，我越意识到这是未来。

在与 dotCloud 的每个人交谈后，他们向我提出了一个报价。我在 CashStar 过得很好，在我离开之前，我想确保这是一个正确的举动，在我辞职去旧金山的一家小型创业公司远程工作之前，我只在谷歌闲逛时见过几次人。我和妻子本打算去佛罗里达度假，但我们决定取消旅行，而是自己掏钱飞到旧金山，亲自去见见 dotCloud 公司员工。在我决定接受这份工作之前，我想和团队一起出去，多了解他们一点。我们也想看看旧金山是否也是一个适合搬家的好地方，如果真到了那一步的话。

在与所罗门·希克斯坐了几个小时，听他谈论他对未来的展望后，我决定这是我的地方，并在当晚签署了我的聘书。当我回家的时候，我给了现金之星我的通知。

### 码头办公室

办公室很温馨，布置得像个丛林。它甚至出现在 TechCrunch 的婴儿床上。查看视频视频里有各种东西，从大豆包，100 多种植物，还有一只名叫戈登的宠物龟

![](../Images/f6073b72e6ac2d0b867f6b08567fd161.png)



#### 办公室吉祥物戈登





我刚被雇佣的时候，每个人都有一把 Nerf 枪，这样你在丛林里工作的时候就可以自卫了。这在一段时间内很有趣，但很快我们到处都有 Nerf 飞镖，人们厌倦了捡起它们。我们很快为所有新员工更换了耳机。

### 点云的站点可靠性工程师(SRE)

我在 dotCloud 的第一份工作是 PaaS 的网站可靠性工程师，Jerome Petazzoni 是我的经理。团队中还有另一个不相干的人，他的名字叫查尔斯·胡珀。如果你不确定什么是 SRE，或者有一本 [SRE 的书](https://landing.google.com/sre/book.html)，一些来自谷歌的 SRE 的书刚刚出版，这是一本好书，去看看吧。

dotCloud 的 SRE 基本上负责确保平台始终正常运行，如果出现问题，帮助解决问题，并防止同样的问题再次发生。

以下是我在典型的一天里所做的事情:

1.  登录，查看 IRC，发邮件，看看前一天晚上发生了什么。
2.  检查 nagios 以查看是否有任何活动的警报。
3.  修复 nagios 问题
4.  检查支持票
5.  参与任何项目
6.  会议(起立等)

我已经不记得为什么了，但是我做了一件所罗门非常喜欢的事情，为了表示他的感谢，他给我做了一枚属于我自己的 SRE 徽章。这是我在一家公司获得的最酷的奖项之一。

![dotCloud SRE badge](../Images/cef878e156f3bc9ec0ef1b4a4c301fe5.png)

#### 项目

除了日常任务之外，每个人都有自己的项目来帮助改进 dotCloud。这是我参与的一些项目。

##### pypi 镜子

在点云上，我们处理部署的方式是这样的。您可以通过 git、rsync 等将您的代码推送给我们，然后我们将获取这些代码，读取您的配置文件，并构建一个容器映像，我们将使用它部署到不同的主机。

作为配置的一部分，你可以安装依赖项，使用 python 服务，这可以使用 pip 来完成，它会从 [pypi](https://pypi.python.org) 下载 python 包。5 年前，pypi 存在稳定性问题，[他们建议](https://jacobian.org/writing/when-pypi-goes-down/)对 pip 使用`--use-mirrors`标志，这将允许您使用官方镜像，因此如果其中一个镜像关闭，将会造成更少的损坏。最坏的情况是你再试一次。

我们将此构建到 python 服务中，并带有重试逻辑，以便在镜像失败时进行处理。这工作得很好，但由于某种原因，我们会在一些部署可以工作，而另一些不能的地方结束。在深入了解这一点后，这是因为一些官方的 pypi 镜像与主镜像不同步。如果你选择了一个旧的包，你很好，但是如果你选择了一个新的包，如果你最终在一面最新的镜子上，那就是运气了。

经过一些研究，我发现没有简单的方法来判断镜子是否过时。镜子由志愿者维护，没有监控设置。我很快对镜子进行了检查，发现超过一半的镜子已经过时，有些镜子已经几个月没有更新了。为了更好地监控镜子，我创建了一个图书馆和一个 T2 网站。

既然我们已经了解了这个问题，就更容易发现问题所在。我联系了负责不同步镜像的人，当其中一个镜像没有所有者时，我接管了对它的维护。几周后，我们有了最新的所有镜像，有了新的网站，如果其中一个镜像再次进入不良状态，它会让我们知道。

几年前，pypi 不再使用镜像，现在使用 CDN，所以这不是很有用，但这是一个很好的学习经验，了解所有这些基础设施是如何工作的，并且在构建 Docker 注册表时会派上用场。

##### AppTracker 和 Packer

在 dotCloud，我们试图在 dotCloud 上运行尽可能多的 dotCloud 基础设施，但最终需要在主机和平台之间有一个层。这一层很重要，而且很难升级。dotCloud 是作为一堆不同的微服务编写的，当我们需要升级平台时，这是一个很大的任务。

最初，平台的部署方式是使用一个结构脚本来引导节点，提供服务，并将其添加到集群中。一旦它启动并运行，它将开始接受工作，并向它部署新的服务。当只有少量服务器时，这个结构脚本工作得很好，但是当有数百台服务器时，它就不好用了。

这是它是如何工作的。

1.  你将登录到特殊的部署主机，我们称之为运营商。
2.  确保您处于 tmux 会话中。
3.  给定发布的标签，下拉最新的代码。
4.  运行结构脚本。答:该脚本将在集群中的所有节点上并行运行。b .它会将代码推送到主机 c .它会为每个组件运行安装脚本 d .清理
5.  这个过程需要几个小时，如果主机安装失败，你要到最后才能知道，然后你需要登录到主机，调查，然后重新更新。

由于这一过程需要一整天，这限制了我们可以进行的部署数量，所以我们最终一周只部署了几次。

我的目标是通过以下方式使这个过程变得更好。

1.  更快的
2.  更加稳定、可重复和可预测
3.  自动回滚
4.  目标安装(仅在需要的主机上安装服务)
5.  更高的可见度
6.  易于使用，将来易于自动化。

有了这些目标，我决定改变我们部署应用程序的方式，这就是我想到的。

有四个主要部分:

1.  AppTracker :管理部署的大脑
2.  **Packer** :为服务构建一个自包含的安装包(tar ball)。
3.  Grabber :驻留在主机上的服务，处理服务的安装。
4.  **版本**:跟踪每台主机上运行的版本。

每个部分的细节如下，但是用这个新的过程，我能够完成我所有的目标。部署时间从一整天缩短到平均不到 2 分钟。

其主要原因如下:

1.  我们不是将所有代码都推送到每个节点，而是只将需要的代码拉送到每个主机。下载比上传快多了。
2.  我们构建一次包，存储在 s3 中，而不是在每个节点上构建。如果构建失败，我们在到达主机之前就知道了。
3.  我们只构建和部署我们需要的服务，而不是做所有的工作。
4.  我们在流程的每一步都添加了监控和通知功能，这样我们就可以随时知道我们所处的位置，所以如果出现问题，很容易解决。

###### 应用跟踪

AppTracker 是一项允许您将我们的任何服务部署到任何主机的服务。您可以选择一个服务版本，以及您希望它安装在哪里。您可以使用正则表达式部署到整个集群，或者只是节点的子集。

当一个请求进来时，它会查看是否是最近构建的，如果不是，它会将请求发送到 packer 进行构建。

在我们的版本控制系统中有一个 webhook 设置，它会自动触发新代码的新构建。由于您的代码已经构建好了，所以当您想要进行部署时，这样会更快。

有一个易于使用的网站，以及一个命令行界面和自动化任务的网络服务。

###### 包装工人

Packer 支持 python 和 node.js，因为这是我们当时使用的两种语言，但它可以很容易地扩展以添加更多。

有一个请求传入，然后它会下载代码，并读取该服务的配置文件。它会看到它是什么类型的构建(python，node.js 等)。然后，它会做所有需要做的事情，删除依赖项等，并构建一个独立的包，将其存储在 s3 中。然后，它会让应用跟踪器知道它已经完成，然后它会在发布/订阅频道上向 grabber 发送一条消息。

这可能对你来说很熟悉，它正在做一些类似于 docker 今天对 docker 构建图像所做的事情，并将其推送到注册表。不像 Dockerfiles 那么高级，但也是一样的。

###### 强夺者

Grabber 驻留在每台主机上，它知道自己所在的集群及其主机名。它在发布/订阅通道上侦听新请求。当它得到一个消息时，它会查看该消息是否是给自己的，如果是，则需要安装的版本是否已经安装。如果尚未安装，它将安装新版本。

安装非常简单，它将从 s3 中提取 tar 文件，解压到给定的目录中。切换符号链接，然后停止旧版本并启动新版本。它检查以确保启动正确，如果没有，它回滚到旧版本。

它把它的更新发送到 apptracker，并实时发送到 apptracker 网站，以便了解发布的进度。如果任何节点出现故障，部署人员将能够在网站上看到故障日志，并轻松触发重试，或者登录主机进行更仔细的查看。

###### 版本

这是一个简单的服务，它查看所有主机，并列出哪些主机具有哪个版本的应用程序。这些数据显示在 appTracker 网站的一个表格中。只需点击几下，就可以更新不同步的版本。

每个主机上都有一个守护进程，它收集关于每个服务的信息，并每分钟向主服务报告一次。还设置了 nagios alerts，这样如果满足某些条件，它就会呼叫一个待命人员。

##### 服务

dotCloud 上的服务是用一种叫做 [cloudlets](https://github.com/shykes/cloudlets) 的东西编写的，这是 docker 图像格式的前身。它很难使用，但在当时，它是最好的东西。我们从这个项目中学到了很多东西，它帮助 Docker 形成了今天的样子。

记不清是什么时候了，但最终负责管理 dotCloud 上的语言和数据库服务。这意味着我需要让他们跟上新功能和新版本。这对`node.js`来说是一个真正的痛苦，它似乎每隔一周就发布一个新版本。

最终，我们开始推广我们的定制服务，这是一种通用服务，可以让你做任何你想做的事情。这变得非常流行，并让我们更多地考虑容器即服务模型，而不是 PaaS 模型。

##### 磁盘监视器和内存监视器

在 dotCloud 上，我们对运行应用程序的人有一些资源限制。限制内存相当容易，但是磁盘就有点难了。我们说过我们有限制，但我们很少强制执行，我们唯一一次这样做是当我们注意到有人有比他们需要的更多的空间，并且它将消耗服务器上所有可用的空间。

我创建了几个工具，在每台主机上运行，并向我们报告每项服务的磁盘和内存使用情况，然后我们可以按帐户分组。当有人超标时，我们可以联系他们，让他们知道超标了，并进行清理。大多数磁盘空间问题都是由日志文件引起的。有几个应用程序会进入糟糕的状态，并在几个小时内轻松输出数百 GB 的日志文件。如果我们注意到这一点，我们通常会收到传呼，进入，清理日志，并让这个人知道这个应用程序行为怪异。因为每次都是同样的人，我们有点习惯了，他们也没有。有时我们只需要重启容器，它就会自动修复。

##### 扫雷艇

有一段时间，我们运行了一个免费的集群，供人们尝试服务。每当你提供免费的东西时，总会有人尝试和它玩游戏。我们遇到的两个最大的问题是运行比特币矿工和 minecraft 服务器。minecraft 服务器并不反对我们的 TOS，但它们通常会消耗大量资源，并给主机上的其他人带来问题。

为了解决这个问题，我们曾经登录到每个主机，看看哪些服务使用了最多的资源，如果是比特币矿工，我们会停止容器，并联系所有者。我们会关闭它，他们会重新启动它。

这变得很累，所以我写了一个程序来自动完成这个任务。没过多久，他们就有了检查以确保它正常运行的工具，如果它正常运行，他们会自动将其重新启动。我们就这样来来回回，直到我达到极限(5 次)，我就会删除这个应用程序。如果一个帐户有多次违规，他们将被暂停。有一段时间真是猫捉老鼠的游戏。但是因为它是自动化的，它不再占用我们太多的时间，而且只是一个烦恼。

#### 黑客日

我们每个月都会有一次黑客日，黑客日的目标是做一些事情来改进平台，并做一些不在你当前 sprint 计划中的事情。以下是我记得的一些 hackday 项目:

![](../Images/e1ac969c26bc49eec826a73fec4ebf3c.png)



#### 安德里亚戴着黑色礼帽





##### help.dotcloud.com

一个简单的网页，链接到 dotCloud 的所有不同的帮助选项。

##### status.dotcloud.com

当服务器崩溃或停机时，值班人员会收到呼叫，他们会开始调查需要做什么。他们还负责让客户了解情况，这样他们就知道自己是否受到了影响，以及何时会得到解决。

我做了一个简单的网站，待命人员可以登录，选择受影响的服务器和服务，然后同时更新 twitter、dashboard.dotcloud.com、status.dotcloud.com 和 IRC。这是在 statuspage.io 和 status.io 出现之前。在此之前，它需要用户一次登录一个服务，并发布消息。这使得它变得更快更容易。

这还使我们能够捕获指标，以了解我们有多少次停机，以及哪些主机受影响最大。

### Djangocon 2012 谈论 PCI 兼容应用

我的第一次会议演讲是在华盛顿特区的 DjangoCon 2012 上，内容是关于构建符合 PCI 的 web 应用。我还能和使用 dotCloud 的人交谈，并帮助回答他们的任何问题。我还发了一堆 t 恤。

如果你有兴趣的话，这里有一段视频。

### 码头枢轴

2013 年 3 月 10 日，约翰·科斯塔(John Costa)和查尔斯·胡珀(Charles Hooper)以及我飞到旧金山，在那里呆了两周，为一些网络云项目工作。我们不知道等待我们的是什么。

3 月 11 日星期一早上，我们聚集在网络厨房，所罗门把我们召集在一起，讨论我们下周要做的事情。我们会努力让 Docker 准备好发布。在那之前，Docker 是所罗门和其他几个工程师正在做的一个内部项目。

我们赞助了 PyCon，那是接下来的一个周末，所以我们的想法是推出 Docker，然后在 PyCon 上与每个人谈论它。几乎所有人都在甲板上。我们分成两队。一个团队将继续在 dotCloud 上工作，一切照常。另一个队将全力以赴，为码头工人进入黄金时段做好准备。

我被选为码头工人队队员。在这一点上，我还没怎么用过 Docker，所以我必须快速上手。我们最终每天工作 15 个小时。我们会在早上 8-9 点左右到达办公室，然后在晚上 11 点-午夜离开。我们每天都这样，直到我们去了皮肯。

我做了很多不同的事情:

1.  帮助创建 docker 注册表
2.  增加了对 docker 登录的支持
3.  证明文件
4.  流浪乞讨人员
5.  测试

在任何一天，我都在 python、ruby、go 和 Bash 之间跳跃。很模糊，但我们为皮肯做好了一切准备。我为 Solomon 预留了一个闪电演讲时段，他将利用这个时段通过一个快速演示来介绍 Docker。我们没想到会有那么多人参加闪电谈话，但我们的目标是记录下来，然后我们可以播放视频。我们一点也不知道会议座无虚席，而且进行得很顺利。

![](../Images/420256a5890a5f04e307f37aa17451cd.png)



#### 我(穿红衣服的)和戈登一起努力工作





![](../Images/2d587bdca4e0e448e08c020de8ca535b.png)



#### Ken 和 Sam 讨论如何建立 docker 注册表





#### 码头下水

所罗门进行了闪电般的演讲，紧接着，一大堆人开始过来要求访问 Docker。那时我们还没有开放 github repo，所以人们开始认为它是 vaporware。我们开始收集名字，并根据具体情况让人们访问回购，但这不会长久，我们需要真正推出 Docker，但这需要更多的工作。这意味着接下来的一周没有多少睡眠。

#### 血腥星期一

3 月 18 日星期一，在 PyCon 度过了一个漫长的周末后，我们再次聚集在 dotCloud 的厨房里。所罗门召集所有人，让所有人都知道 PyCon 是成功的，每个人都喜欢 Docker，他做出了艰难的决定，将 dotCloud 从 PaaS 转向 Docker。有一些裁员，不幸的是，那天我们失去了一些同事，但由于新的方向，我们需要保持精简，需要继续前进。

我们的目标是保持 PaaS 的正常运行，但我们不会增加更多的功能，我们会准备出售它，并寻找买家。我们不想让我们的客户无所适从，因为它在赚钱，所以尽可能长时间地保持下去是有意义的。该公司再次一分为二，一个属于 dotCloud，另一个属于 Docker。我们被给予了一天的休息时间来思考支点，并从繁忙的前一周中得到一些休息。我们会在周二回来，然后上路，目标是在周末之前正式发布 Docker。

我被分配到新的 Docker 团队，但我仍然负责维护 PaaS，所以我在做双重工作。幸运的是，随叫随到并没有那么糟糕，大部分时间都花在了构建 Docker 上。

#### 码头工人，未来

一旦决定将公司中枢化，在短时间内有很多事情要做。我被分配了一些需要尽快完成的任务。其中之一是人们可以上传和分享他们的码头工人图像的地方。我们创建了 [docker registry](https://github.com/docker/docker-registry) ，这是一个任何人都可以使用的开源项目，但是我们希望有一个任何人都可以立即使用的中心位置。我们决定称之为码头工人指数。因为我有丰富的 web 应用经验，所以我被分配了构建它的任务。因为我们是一家 python 商店，我对 python web 框架[姜戈](https://www.djangoproject.com/)最熟悉，所以我决定用它来写。我们使用引导程序进行用户界面，我开始了。

#### 码头工人

我们有一个受欢迎的开源项目，人们喜欢这个名字。现在我们需要一个标志。撒切尔派斯肯斯的任务是雇人设计一个标志。他在 99designs.com 上创建了一个竞赛，社区被允许投票选出获胜者。[投票结果](https://99designs.com/logo-design/contests/create-cool-open-source-project-logo-219415/poll/kl5pe8/results)

这里是宣布新 Docker 标志和风格的[博客帖子](https://blog.docker.com/2013/06/announcing-new-docker-style/)。

这个标志和设计非常受欢迎，我们已经分发了成千上万的贴纸和 t 恤来证明这一点。

#### 码头索引

docker index 最初是一个相当基础的 web 应用程序，它有一个与 docker 注册中心和 docker 引擎交互的 API。它提供了通过网站或 docker 引擎注册账户的能力。注册后，你可以推送自己的公共 docker 图片，并与全世界分享。随着时间的推移，我增加了搜索和官方图片的功能，这使得入门更加容易。

在第一年左右的时间里，我是唯一一个全职从事索引工作的人，时不时地，Thatcher 会帮我做一些 UX/UI 方面的事情。最终，我们慢慢地将人员添加到索引团队中，甚至创建了另一个团队来创建一个管理 Docker 用户的中心服务。我们把这个团队叫做 docker.io。过了一会儿，我成了这两个团队的工程经理，这个团队工作得很好，我们完成了很多工作。

##### 自动化构建系统

所罗门有一个想法，将码头工人的一个新的码头文件特征与索引联系起来。他想让人们把他们的 github repos 链接到索引，然后当有人做了代码更改时，使用 git repo 中的 Dockerfile 自动重建该项目，并推送到注册表。我喜欢这个想法，并在一个黑客日建立了第一个概念证明，并在下周投入生产。它真的很受欢迎，事实上太受欢迎了，我们不得不重写它，这样它才能更好地扩展。[达斯汀·莱塞威尔](https://twitter.com/dustinlacewell)接管了这个项目并构建了第二版，现在仍然在维护自动化构建系统的团队中工作。

此后，他们发布了该系统的第 3 版，增加了更多的功能，并具有更大的扩展能力。

##### 构建触发器

自动化构建系统非常流行，人们开始在他们的 CI/CD 链中使用它，正因为如此，他们希望在自动化构建被触发时有更大的灵活性。有些人想先运行他们的单元测试，然后只有通过了才能建立形象。对于当前的设置，这是不可能的，所以我创建了构建触发器，它允许您用 HTTP POST 命中一个特殊的端点，它将直接触发您的自动化构建。

##### 存储库链接

我们建议的一件事是将您的自定义图像基于我们的官方图像，这样您就可以在一个已知良好的受支持图像的基础上进行构建。问题是当官方图片更新时，人们并没有更新他们的图片。当有安全补丁添加到基本映像时，这很重要。我为人们创建了一种方法，将他们的存储库链接到另一个存储库，如果那个存储库改变了，它会自动触发子映像的重建。

这也是另一个非常受欢迎的特性，它给自动化构建团队带来了一些麻烦，因为每当官方图像更新时，都会引发连锁反应，让自动化构建系统一下子产生大量构建。此后，他们改进了自动化构建系统的可伸缩性，以更好地处理这些事件。我们还在官方映像团队和自动化构建团队之间建立了一些通信，以便他们在发布即将到来时给他们一个提醒，这样他们就可以确保他们有足够的能力来处理负载。

##### 合作者

这允许你给其他用户推送你的图片，这很受欢迎，但是人们想要更多。所以我们开始致力于组织和团队功能。

#### 坞站集线器

就在旧金山第一届 DockerCon 之前，我们决定将 docker index 更名为 Docker Hub。这需要做大量的工作，将两个不同的网站(docker.io 和 index.docker.io)合并成一个网站 hub.docker.com，并确保两个网站之间的 UI/UX 是相同的。这需要大量的工作，但我们能够做到这一点，它使网站看起来更好，并增加了一些我们已经工作了一段时间的功能。

##### 私有存储库

从 docker index 开始，我就有了私人回购的概念，这允许你推高一个图像，而不是将其公开。我只在内部向 docker 员工公开了它以供试用，为了确保它真的像宣传的那样工作，我们希望确保只有您想授予访问权限的人才能访问它。这也是我们想要收费的一个功能，所以为了让它工作，我们必须添加一个计费组件。

##### 演员表

在我们开始对 hub 收费之前，我们需要一种收集资金的方法，所以我建立了一个计费服务，允许人们订阅一个计划，并在计费周期结束时自动更新。在反复使用 Recurly 和 Stripe 之后，我们最终使用了 Recurly，因为 strip 当时没有一些特性。一旦计费完成，我们就可以开始向使用该中心的人收费，并开始支付由于公共存储库的所有流量而产生的巨额 AWS 账单。

##### 组织和团队

一旦我们发布了私有存储库，我们需要一种更好的方式来与他人共享它们，所以我们也发布了一种方式来创建一个组织帐户，并将人们分组为团队，并基于团队而不是个人来共享东西。我们还添加了一种将用户帐户转换为组织帐户的方法。作为 docker.io 项目的一部分，大部分工作由( [Josh Hawn](https://twitter.com/Josh_Hawn) 、Thatcher 和 John C)完成，我帮助将它与 docker 索引代码集成在一起。

#### 坞站集线器 2.0

当我们开始在 docker hub 上工作时，我们的目标是开始将单一的应用程序分解成更小的微服务，我们开始这样做了，但导致我们出现问题的一个问题是前端。跨多个服务提供一个公共前端并不理想。解决这个问题的方法是将前端和后端服务分开，并在两者之间使用 API。Hub 1.0 有一个不可更改的最后期限，所以我们无法以理想的方式完成它。因此，我们的目标是推出 Hub 1.0，然后开发打破 Hub 前端和后端的 Hub 2.0，并发布新的前端。

一个问题是，在 Docker 工作的大多数人都是后端人员，我们几乎没有前端经验。所以我们出去雇佣了一些知道他们在做什么的人。我们首先雇佣了克里斯·比斯卡尔迪，然后雇佣了 T2 的内森·谢和 T4 的阿鲁南·拉宾德拉。他们三个和一些设计师一起， [Nick Kraly](https://www.linkedin.com/in/nickkraly/) 和 [Josh South](https://www.linkedin.com/in/joshuasouth/) 设计并构建了前端，而我们则致力于为他们提供后台 API。

这比我们计划的时间长得多，但我们最终推出了 hub 2.0 测试版，然后切换到新的 hub 2.0，这就是你今天看到的 hub。关于更多细节，Docker 上有一篇来自 Chris [UI 的很棒的博文。](https://blog.docker.com/2015/08/ui-at-docker/)

#### 坞站集线器楼梯

我们不得不不断应对的一个问题是，docker 的增长速度超出了所有人的预期，随之而来的是对 docker hub 的需求。docker 的下载量和带宽都在增长。这是一张小图表，显示了这些年来它是如何增长的。

![](../Images/ed0c513bb1688f8ef8ec3a7b0af9f076.png)



#### Docker Hub 增长曲线(2015 年 6 月)





#### Docker 云

2015 年 10 月 [Docker 收购了 Tutum](https://blog.docker.com/2015/10/docker-acquires-tutum/) ，我是对该公司进行尽职调查的小组成员之一，在此过程中，我非常熟悉他们的产品。我也是最熟悉 Docker Hub 的人，所以如果我是那个帮助将这两个产品整合到我们现在称之为 [Docker Cloud](https://cloud.docker.com) 的人，这是有意义的。

Tutum 人在西班牙和纽约工作，因为我在缅因州，和纽约是同一个时区，和旧金山的 8 个小时只相差 5 个小时。我与他们一起工作，让他们获得他们需要的一切，这样我们就可以在我们的两个服务之间有一个很好的紧密集成。

我们需要的一件事是为这项新服务向人们收费(计量计费)，而当前的计费系统没有设置计量计费。由于我编写了计费服务的第一个版本，所以我编写第二个版本是有意义的。

我创建了一个名为 billing_v2 的新微服务，它拥有 hub 仍在使用的所有原始计费功能，并添加了 docker cloud 需要的新功能，然后我们将 hub 和 cloud 进行了交换，以使用新的计费服务。这是一项在短时间内完成的大任务，所以我也得到了马特·特斯彻和约翰·科斯塔的帮助。

一旦计费功能完成，云/中心集成完成，我们就开始使用 Docker Cloud。

## 会议

因为我是东海岸仅有的员工之一，所以我可以参加很多很酷的会议，谈论 Docker。以下是我这些年来做过的一些演讲。

### DjangoCon US 2013

我在芝加哥的 DjangoCon US 2013 上介绍了 Docker talk。实际上，我在演讲后见到了达斯汀·莱斯威尔，并说服他申请了码头工人公司的一份工作。这里有[我的幻灯片](https://www.slideshare.net/dotCloud/docker-at-djangocon-kencochranedockertalk2013)，还有[的博文](https://blog.docker.com/2013/09/docker-at-djangocon-us-2013/)和视频:

### Rackspace 求解

我们的首席执行官 Ben Golub 在旧金山的 Rackspace solve 会议上做了一个演讲，非常受欢迎，他们希望在纽约的会议上做这个演讲。本不能出席，所以我能代替他。

这是我第一次不在一屋子开发者面前的会议演讲。这更多的是针对 C 级主管，所以我必须打扮一下(我不能戴我的帽子！)，我不能躲在讲台后面。

自从和纽约的人谈过之后，我决定早上飞过去，然后晚上飞回来。RackSpace 派了一辆车去机场接我。这也是第一次，我通常坐地铁进城，但我不想拒绝直接搭车到门口，这给了我最后一次练习演讲的时间。问题是交通太拥挤了，我花了 2 个小时才到达会场，而且比预定的上台时间提前了 5 分钟。刚好够时间去洗手间，拿起麦克风，跳上舞台。

因为我急着要上台，所以我没有意识到他们安排我做了 30 分钟的演讲，而最初我们同意我做 40 分钟的演讲。这就产生了一个问题，我准备了一个 40 分钟的演讲，需要在 30 分钟的时间里演讲。没有什么比动态地从你的演讲中去掉 10 分钟更复杂的了。我认为我做得不错，但这确实阻止了我尽最大努力。这里是关于我的演讲和视频的更多细节。

### 蒙特利尔 PyCon 2014

我在蒙特利尔的 Pycon 码头举行了一次海报发布会。这很酷，因为我已经有一段时间没有去过蒙特利尔了，所以很高兴看到这个城市，并帮助码头工人。我又遇到了[尼克·朗](https://twitter.com/fxdgear)，说服他参加 DockerCon，最终说服他来 Docker 和我一起工作。

我带了大约 50 件 t 恤来参加会议，这是我行李中所能携带的全部物品。当我到了那里，我放下箱子，转身和聚集的人群交谈，在我意识到之前，我转过身，所有的衬衫都不见了。他们走得太快了。

### DockerCon 2014

DockerCon 2014 是我们的第一个 DockerCon，它位于旧金山，比我们预期的要受欢迎得多。它是非常有趣的。我在一个艺术画廊帮助筹备会议，我们有一个摄影师给每个人拍照。下面是我和约翰高兴得跳起来的照片。

我不需要在这次会议上发表演讲，但是我帮助创建了现场演示，还推出了 docker hub。

### 2014 年欧洲码头

2014 年，我们在阿姆斯特丹举办了欧洲码头博览会，我有机会参加。这是我第一次去欧洲旅行，所以我不知道该期待些什么。太棒了，我玩得很开心。我希望将来有一天能把这个家庭带回来。

在去 DockerCon [的路上，CoreOS](https://coreos.com/) 发布了一篇[的博客文章](https://coreos.com/blog/rocket.html)称[在 Docker 社区引起了](http://siliconangle.com/blog/2014/12/02/coreos-launches-container-wars-with-rival-tech-to-fight-docker/)一场[轰动](https://www.theregister.co.uk/2014/12/01/coreos_rocket_announcement/)。一些人称之为集装箱战争的开始。这不是大多数人期望在会议前几天度过的方式，但作为一个公司，我们都团结起来，仍然举办了一场好的会议。那天我们也学到了很多，关于如何，以及如何作为一个公司处理棘手的情况。

这是我关于这个中心的演讲视频。

我真正喜欢的一件事是所有不同类型的食物，我通常不能带回家。如果你问我，这可能是旅行的最好理由:)

![](../Images/f0098a370de28665b74251266e6570ed.png)



#### 嗯，阿姆斯特丹的培根





### DockerCon US 2015

DockerCon US 2015 又回到了旧金山，我又一次得以参加。我们在这次 dockerCon 上推出了 Hub 2.0 测试版，我们花了很多时间来准备它，它受到了好评。我还和 bc Wong 谈了一次话，这是视频。

### 2015 年欧洲码头

2015 年，DockerCon Europe 在西班牙巴塞罗那举行，幸运的是，Tutum 的办公室离马德里不远。所以我们的计划是去多克尔松，然后坐火车去马德里，和图图姆人一起工作几天，然后飞回家。

这是我第一次不用做报告的会议，但我通过帮助完成其他任务来弥补。其中一项任务是把我们分发给每位与会者的各种各样的礼包塞进去。我还帮助注册，为码头摊位配备工作人员，并参加了一次顾问委员会会议。

作为给每个参加 DockerCon 的人的礼物，我们与 Yubico 合作，给每个人发了一个 yubikey。

问题是我们准备发给每个人的 Yubikeys 卡在了海关。为了解决这个问题，他们让人在他们的手提行李中携带一批新的产品飞往西班牙，并亲自送到会议现场。问题是新的还没有组装好，所以我们找了一些志愿者，把他们组装在一起。

![](../Images/6203c1346187a6a81e4ccad66941739f.png)



#### 构建 yubikey 包





完成后，我们需要把它们放在观众席的椅子上，这样客人就看不到它们了，直到我们说，把手伸到你的座位下面。这是我们的奥普拉时刻。

### 西雅图码头

我没能参加在西雅图举行的 DockerCon US 2016，但我参与的项目是在那里启动的。查看 keynote 视频，了解 AWS Docker。

### 聚会

除了会议之外，我还在东北部的不同聚会上做了一些演讲，我甚至自己成立了几个聚会小组。[纽约码头工人](http://www.meetup.com/Docker-NewYorkCity/events/133363792/)、[波士顿码头工人](https://www.meetup.com/Docker-Boston/events/133343702/)和[缅因州码头工人](https://www.meetup.com/Docker-Maine/events/228462437/)。

当我在纽约参加第一次 Docker NYC meetup 时，我顺便访问了[数字海洋](https://www.digitalocean.com/)的办公室，并帮助他们建立了一个 [Docker 一键式应用](https://www.digitalocean.com/products/one-click-apps/docker/)，以便在他们的服务中轻松使用 Docker。他们让我在他们的办公室呆了一下午，真是太好了。为了感谢他们，我给他们寄去了所有的衬衫。

![](../Images/c3a43488404e8073c5e695e5664d477d.png)



#### Ken 与 Ben 和 Moisey Uretsky 数字海洋联合创始人





![](../Images/548ba00c2835cead618aa3decb80ab1d.png)



#### 穿着 Docker 衬衫的数字海洋团队





### Docker 核心

在过去的 3 年里，我一直在 Docker 注册表、索引和 hub 上工作。当我在云上工作，再次弄脏我的手时，我意识到我真的错过了。我喜欢当工程经理，但我更喜欢当工程师。我也意识到我需要开始做一些不同的事情，所以在与所罗门和萨姆·阿尔巴交谈后，我能够转移到核心团队，在他们需要帮助的地方帮助他们。

#### Docker 1.11 版本

我在 Docker 核心团队的第一个任务就是帮助 Docker 1.11 发布。Docker 1.11 是构建在 containerD 之上的第一个版本，正因为如此，Docker 打包需要改变以支持安装多个二进制文件。我从事 rpm 和 Debian 打包已经有一段时间了，但是我还是一头扎进去，做了我需要做的事情来帮助发布。这很有趣，并被重新引入到 docker 引擎中。

#### 坞站 CS 版本

Docker CS 版本是我们在商业上支持的版本，并支持端口补丁，因此公司不必像他们希望的那样快速升级。我通过记录和更新他们使用的一些工具来帮助 CS 版本。我在这个项目上工作的时间不长，但它让我深入了解了这一切是如何工作的，并提供了非常有用的信息。

#### AWS 的 Docker

在过去的一年里，我一直在版本团队工作，为 AWS 产品构建 [Docker。这很有趣，我学到了很多关于 AWS 的知识，比我想象的还要多。我还第一次去了拉斯维加斯的 AWS reinvention。这也是我参加过的最大的会议，它分布在长街上的三个不同的赌场，从一个会场走到另一个会场需要 25 分钟。也许有一天 DockerCon 会那么大？](https://www.docker.com/docker-aws)

## 下一步是什么？

现在我已经在 Docker 工作了 5 年，我有时会想我下一步会做什么。我不太确定，但我肯定会很棒。很抱歉写了这么长的帖子，但我想它展示了我们在过去 5 年里所做的一切，我肯定我也错过了很多。

如果你喜欢这个帖子，你可能会喜欢[杰罗姆·佩塔佐尼](https://twitter.com/jpetazzo)的帖子[从 dotcloud 到 docker](https://jpetazzo.github.io/2017/02/24/from-dotcloud-to-docker/) 。