# Vista 到底发生了什么:一个圈内人的回顾| Ben Fathi | Medium

> 原文：<https://blog.usejournal.com/what-really-happened-with-vista-an-insiders-retrospective-f713ee77c239?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

# Vista 到底发生了什么:一个内部人士的回顾



It was a tradition for Windows team members to sign a poster (in this case an image of the DVD) upon release of a version of Windows. By the time the release party was over, there would be hundreds or thousands of signatures on the poster.



> "经验是你需要时才会得到的东西。"——史蒂夫·赖特。

我很喜欢阅读特里·克劳利(Terry Crowley)富有思想的博客文章(【Vista 到底发生了什么)。Terry 在 Office 组织中工作，从合作伙伴工程团队的关键角度出发，出色地报道了 Windows Vista 和相关但注定失败的 Longhorn 项目中的复杂阴谋。

他正确地指出了困扰这个项目的许多问题，我不想在这里重复这些问题。我认为尝试提供一个内部人士对相同事件的观点是公平的。我不能指望像特里那样雄辩或透彻，但我希望能揭示出这个项目出了什么问题。自 Windows Vista 最初发布以来，十年已经过去了，但这些教训现在似乎比以往任何时候都更有意义。

T2】

Windows 是一头野兽。成千上万的开发人员、测试人员、项目经理、安全专家、UI 设计师、架构师，应有尽有。这还不包括人力资源人员、招聘人员、营销人员、销售人员、律师，当然还有上述各个领域的许多经理、主管和副总裁。整个系综由合作伙伴团队(微软内部和外部)的数千名其他人支持，他们提供从底层硬件到平台之上的设备驱动程序和应用程序的一切。



Aerial photo of the Windows team taken on the soccer field at Microsoft



在组织上，当时，Windows 实际上是三个团队:核心、服务器和客户端。核心团队交付了所有 Windows 版本共享的操作系统的所有核心组件(内核本身、存储、安全、网络、设备驱动程序、安装和升级模型、Win32 等)。反过来，服务器团队专注于服务器市场所需的技术(终端服务、集群和高可用性、企业管理工具等)，而客户端团队则负责与桌面和消费者版本相关的技术(浏览器、媒体播放器、图形、外壳等)。对于一个服务于众多客户的平台来说，这似乎是一个合乎逻辑的组织结构。

当然，有许多重组，但即使 Windows 越来越受欢迎，团队规模越来越大，基本结构仍然保持不变。

公平地说，从文化和组织上来说，核心团队比客户端团队更接近服务器团队——至少在 Vista 发布之前是这样。这意味着在“核心”团队项目中对服务器平台需求的更大强调:更多的可扩展性工作、更多的冗余功能、在操作系统版本中解决更多的企业需求，同时 Windows 试图成长以解决利润丰厚的服务器市场以及它已经占据主导地位的消费者桌面市场。

当我在 1998 年初来到微软时，Windows 意味着 Windows NT——在架构上、组织上和产品上。Windows 95 代码基本上被抛弃了，Windows NT 被用于 Windows 的每一种个性——从笔记本电脑到集群数据库服务器。两年后，Windows 95/98 代码库将为最后一个版本——备受指责的 Windows ME——而复活，但该项目是由一个小团队执行的，而绝大多数人都在 NT 代码库上工作。

我很幸运地在“野兽之腹”呆了十几年，在 Windows 2000 开发的全盛时期加入，就在“Cairo”被取消之后，一直呆到 Windows 7 完成。

在我任职的前七年，我管理着负责存储、文件系统、高可用性/集群、文件级网络协议、分布式文件系统、复制协议和相关技术的团队。这与 Windows 2000、XP、Server 2003 和 Longhorn 大致相同。

后来，我花了一两年时间为微软管理安全——大约从“长角牛重置”开始，直到 Vista 发布。我的职责包括从 Windows 中的安全技术到作为附加解决方案的防病毒产品，再到安全营销和紧急响应，例如安全补丁的创建、测试和交付。这是在 Vista 接近尾声的时候，当时病毒和蠕虫正在让 Windows 陷入困境，微软构建安全软件的声誉在市场上遭受了巨大打击。

Vista 发布后，在 Windows 7 期间，我负责管理 Windows 的核心开发团队。这意味着开发人员拥有几乎所有在“幕后”运行的技术，并被客户端和服务器团队使用。Vista 发布后，Windows 团队按专业进行了组织，在组织的每一级都有一个“三合一”(开发、测试、项目管理)负责人，所以我有两个犯罪伙伴。我管理所有的开发团队，而他们分别管理测试和程序管理团队。

T2】

Windows 团队有过尝试大型和雄心勃勃的项目的历史，这些项目往往在几年后被放弃或改变用途。一个更早的例子是雄心勃勃的 Cairo 项目，它最终被摧毁，一些组件被抢救出来，作为 Windows 2000 的一部分运出。

依我拙见，Windows 版本最大的问题是每个版本的长度。平均来说，一个版本从开始到完成需要大约三年的时间，但是其中只有大约六到九个月的时间用于开发“新”代码。剩下的时间花在集成、测试、alpha 和 beta 阶段——每个阶段持续几个月。

一些项目需要超过六个月的核心开发，因此它们并行进行，并在准备就绪时与主要代码库合并。这意味着当大量功能被集成或替换时，主树几乎总是处于半中断状态。在 Windows 7 发布期间，实施了更严格的控制，以确保持续健康和正常运行的代码基础，但早期版本曾连续数月受到日常不稳定的困扰。

开发的混乱本质经常导致团队玩进度鸡，让他们自己和其他人相信他们的代码比其他项目更好，他们可以及时地“润色”剩下的几件工作，所以他们将被允许在半成品状态检入他们的组件。

三年的发布周期也意味着当我们开始发布时，我们很少知道竞争格局和外部生态系统会是什么样子。错过一个版本意味着取消(因为该功能在两个版本或六年后几乎没有意义)，或者更糟糕的是，被放逐到西伯利亚——继续开发一个组件，该组件大多数被几千人的组织的其余部分忽略，注定最终失败或不相关，但团队或高管根本不能放弃它。我个人负责过几个这样的项目。后知后觉是 20/20。

考虑到每个团队都忙于将他们自己的议程和特性推进到版本中，他们经常忽略与其他组件的集成、用户界面、端到端测试以及丑陋和乏味的问题，如升级，将这些棘手的问题留到最后解决。反过来，这意味着一些团队很快成为瓶颈，因为每个人都在最后一刻寻求他们的帮助来完成他们的 UI 或升级测试。

在任何给定的时间点，都有多个主要版本和多个次要项目在进行中。不同的团队负责不同健康状态下的代码库，这导致了一个模型，随着时间的推移，“富人越来越富，穷人越来越穷”——由于这样或那样的原因，落后的团队往往会落后。

当一个项目接近完成时，项目经理将开始寻找下一个版本的需求，而“健康的”(富有的)团队中的开发人员将开始在下一个版本的新“分叉的”源代码树中实现新的代码，但是组织的大部分(穷人)仍然停留在当前的版本上。特别是，测试团队很少从发布中解放出来，直到它发布，所以新代码在项目的开始没有被彻底测试，并且“不健康”的团队总是落后，对当前发布进行最后的润色，并且越来越落后。这些团队通常也是士气最低和人员流失最严重的团队，这意味着工程师继承了他们没有编写过的脆弱代码，因此也不理解这些代码。我可以写一些引人注目的恐怖故事，讲述这些团队多年来在代码库中引入的一些“错误修复”和“增强”。

在 Vista/Longhorn 的大部分时间里，我负责 Windows 中的存储和文件系统技术。这意味着我参与了 WinFS 的工作，尽管它主要是由 SQL 数据库团队驱动的，该团队是 Windows 团队的姐妹组织。

比尔·盖茨非常详细地亲自参与，甚至被戏称为“WinFS 项目经理”:负责该项目的项目经理。

数百年(如果不是数千年的话)的工程设计形成了一个已经过时的想法:如果我们将数据库的查询功能与文件系统的流功能和非结构化数据功能相结合，并将其作为创建独特的新“富”应用程序的编程范例，会怎么样？

事后看来，很明显 Google 轻松地解决了这个问题，为非结构化*和*结构化数据提供了无缝和快速的索引体验。他们这样做是为了整个互联网，而不仅仅是你的本地磁盘。你甚至不需要重写你的应用程序来利用它。即使 WinFS 取得了成功，要利用它的特性重写应用程序也要花费数年时间。

当长角牛被取消，Vista 从它的余烬中匆忙拼凑出来时，WinFS 被踢出了 OS 版本。它作为一个独立的项目被 SQL 团队追求了几年。此时，Windows 已经有了一个内置的索引引擎和集成的搜索体验——完全在侧边实现，无需应用程序更改。因此，WinFS 的相关性变得更加模糊，但该项目仍在继续。

> 在 Longhorn“重置”之后，Longhorn 中与安全相关的大量架构更改被保留为 Windows Vista 项目的一部分我们在快速扩张的互联网世界中学到了很多关于安全性的知识，并希望将这些知识应用到操作系统的架构层面，以提高所有客户的整体安全性。

我们别无选择。Windows XP 已经表明，我们是自己成功的受害者。当面对互联网时代的现实时，一个为可用性而设计的系统在安全性方面远远不够。解决这些安全问题意味着创建一个并行项目，Windows XP Service Pack 2，这是一个巨大的工程(尽管它的名字如此),从 Longhorn 那里吸走了成千上万的资源。

需要说明的是，Windows NT 内核一直支持多个用户身份，并正确地实现了管理权限边界，但为了增强 Windows 95 的兼容性，这些在用户模式中被忽略了。这意味着默认情况下，系统上的默认用户被设置为“开箱即用”的管理权限。

应用程序经常(并且经常不知不觉地)滥用这种特权，通过覆盖公共文件和注册表设置来侵犯彼此。当然，恶意软件也是如此，它们很容易接管系统，因为用户是以超级用户权限运行的。

在 Vista 中实施严格的管理边界意味着打破 Windows 世界中几乎所有的应用程序。解决方案的一部分是 UAC(用户账户控制)，可以说是 Vista 最讨厌的功能。当用户运行一个命令或点击一个试图提升特权级别的脚本时，系统会询问用户她是否真的想提升特权级别。安装遗留应用程序几乎总是需要特权提升，所以用户与系统的第一次交互是大量令人困惑的 UAC 弹出窗口，破坏了体验。

毫不夸张地说，如果剥夺了登录用户的管理权限，99%的 Windows 应用程序甚至无法正确安装。与 Windows 95 几十年的向后兼容性意味着我们的手被束缚了:提高安全性，打破应用程序兼容性。

无论从哪方面来看，Vista 都比微软早期推出的任何操作系统安全得多，但在这个过程中，我们也以前所未有的方式破坏了应用程序和设备驱动程序的兼容性，因为我们不再支持“已知的坏”API，也不再使用 UAC 等机制来解决它们。

客户讨厌它，因为他们的应用程序坏了，生态系统合作伙伴也讨厌它，因为他们觉得没有足够的时间来更新和认证他们的驱动程序和应用程序，因为 Vista 被赶出了大门，与复兴的苹果公司竞争。

在许多情况下，这些安全更改意味着需要对第三方设备驱动程序和解决方案进行深入的架构更改。大多数生态系统供应商没有动力对他们的传统应用进行大量投资。这些解决方案中的一些采用了非正统的方法来修改数据结构，甚至修改内核中的指令，以实现它们的功能，绕过 API 和多处理器锁，这通常会造成混乱。曾经有一段时间，大约 70%的 Windows 系统崩溃(“蓝屏”)是由这些第三方驱动程序以及它们不愿意使用受支持的 API 来实现其功能造成的。反病毒供应商因使用这种方法而臭名昭著。

作为微软安全部门的负责人，我亲自花了数年时间向反病毒供应商解释，为什么我们不再允许他们“修补”内存中的内核指令和数据结构，为什么这是一个安全风险，为什么他们需要使用经过批准的 API，以及为什么我们不再支持他们在 Windows 内核中有深度钩子的传统应用程序，这与黑客攻击消费者系统的方法相同。

我们的“朋友”，反病毒供应商，威胁要起诉我们作为回报，声称我们正在阻止他们的生计和滥用我们的垄断权！有这样的朋友，谁还需要敌人？他们只是希望他们的旧解决方案继续工作，即使这意味着降低我们共同客户的安全性，而这正是他们应该改善的。

在那些年里，计算行业发生了如此多的翻天覆地的变化——互联网的出现、移动电话的兴起、云计算的出现、新的广告支持的商业模式的诞生、社交媒体的病毒式增长、摩尔定律的不断发展、64 位计算的成熟、廉价可靠的存储、丰富的网络带宽、不断发展的安全和隐私环境以及开源的流行，这些只是从各个方向攻击 Windows 的几个因素。

对于一个大获成功的平台来说，毫不奇怪的是，它的反应是坚持并不断改进现有的系统——简而言之就是创新者的困境。我们添加的代码越多，我们创造的复杂性越大，团队越大，生态系统越大，越难超越竞争对手。

似乎竞争的力量还不够，这也是工程师和程序经理大军花费无数小时、数天、数周和数月与 DOJ 和公司律师的代表一起，记录以前版本的现有 API，以遵守政府的反垄断裁决的时候。

严峻的现实是，在其生命周期的这一点上，花了大约三年时间才推出 Windows 的主要版本，对于快速发展的市场来说，这实在太慢了。WinFS、安全性和托管代码只是 Longhorn 日程上的几个大项目。还有数百个较小的赌注。

当你有一个几千人的组织和几十亿的客户时，每个人都有发言权。同样的操作系统版本应该在即将到来的平板电脑和智能手机上运行，也应该在你的笔记本电脑上，在数据中心运行的服务器上，以及在嵌入式设备上，如“由 Windows 驱动”的 NAS 盒上运行，更不用说在云中的虚拟机管理程序(HyperV)上运行了。当我们试图在市场的所有部分同时向前发展时，这些需求将团队拉向相反的方向。

T2】



孤立地看待长角牛和 Vista 是不可能的。它们只有在与紧随其后的版本(一方面是 Windows 2000 和 XP，另一方面是 Windows Server 2008 和 Windows 7)结合起来看时才有意义，并且在回顾时对更广泛的行业有充分的了解。

Windows 是自身成功的受害者。它已经成功地渗透了许多市场，而这些业务中的每一个现在都对操作系统的设计施加了一些影响，将它推向不同的、往往是相互冲突的方向。试图满足所有这些不同的需求意味着不能完全满足其中的任何一个。

一个在 90 年代取得巨大成功的架构在十年后陷入了困境，因为我们周围的世界变化越来越快，而组织却在努力跟上它。

要明确的是，我们看到了所有这些趋势，我们努力应对它们，但是，如果我可以混合我的比喻，当你怀孕两年而三年释放时，很难在一毛钱上改变一艘航空母舰。

简而言之，三、四年前，当我们计划一个特定的操作系统版本时，我们认为自己了解的东西已经过时了，有时甚至在产品最终发布时被证明是错误的。

我们所能做的最好的事情是支持向一个不断简化的设备增量且无摩擦地交付新的基于云的服务。相反，我们不断向现有的基于客户端的单一系统添加功能，在每次发布之前都需要数月的测试，在我们需要加速的时候减慢了我们的速度。当然，我们不敢删除旧的功能，这些功能是为了兼容已经在以前版本的 Windows 上运行的应用程序而需要的。

现在想象一下，为几十亿客户、几百万家企业、几千个合作伙伴、几百种场景和几十种外形规格的用户支持同一个操作系统十几年或更长时间，您将开始对支持和兼容性噩梦有所了解。

事后看来，Linux 在这方面做得更成功。开源社区和软件开发方法无疑是解决方案的一部分。Unix/Linux 的模块化和可插拔架构在这方面也是一个很大的架构改进。

苹果采取了一种完全不同的方法，也展示了如何限制问题空间，以提高整体质量和最终用户体验。面对新的外形，它选择放弃服务器和存储方面的努力，放弃了对早期不兼容的 PowerPC 架构的支持，并催生了一个全新的操作系统，与 MacOS 截然不同的 iOS。相比之下，Windows 试图满足所有人的所有需求。

一个组织，迟早会把它的组织结构图作为它的产品运出去([康威定律](https://en.wikipedia.org/wiki/Conway%27s_law))；Windows 组织也不例外。



The Windows “War room”, later renamed the “Ship room”.



如果你愿意，还可以加上内部组织动态和个性。我们都有自己喜欢的功能，我们自己的生态系统合作伙伴推动我们采用新标准，帮助他们在平台上认证他们的解决方案，为他们的特定场景添加 API。我们都有雄心证明我们的技术，我们的想法，将赢得这场战斗…如果我们能让它进入 Windows 的下一个版本，并立即获得数百万的客户。

我们相信它足以在计划会议和日常作战室中为它而战。像任何其他组织一样，我们也有一些经理希望获得晋升，并扩大他们的影响范围——或者团队规模。

开发团队和测试团队经常发生冲突，前者努力让代码签入，而后者却因为发现了与客户环境毫无相似之处的更加复杂和深奥的测试用例而得到回报。至少可以说，内部动态是复杂的。好像这还不够，我们每年至少有一次大规模的重组和新的组织动态需要处理。

顺便说一句，所有这些都不应该被视为借口或道歉。这不是那个意思。

我们犯错了吗？是的，很多。

我们是不是故意做出错误的决定？不，我想不起来了。

它是一个极其复杂的产品，有一个惊人的庞大生态系统(当时世界上最大的生态系统)吗？是的，就是这样。

我们能做得更好吗？是的，你打赌。在快速变化的市场中，渐进主义是你的敌人。

我们今天会做出不同的决定吗？没错。后知后觉是 20/20。我们当时不知道我们现在所知道的。

我们是否从这些错误中吸取了教训，并在下一次做得更好？是的。我想每个 Windows 用户都会同意，作为 Vista 的继任者，Windows 7 是一款非常成功的产品。事实上，大多数分析师和用户认为它和 Windows XP 是 Windows 有史以来最好的两个版本。我听到用户说微软将不得不“把它从他们冰冷的手里撬出来。”作为 Windows 7 核心开发团队的负责人，我很自豪能够参与其中。Windows 团队从 Vista 的许多错误中吸取了教训，我们交付了一个更好的产品。它在建筑上几乎和 Vista 一样雄心勃勃吗？不。我们还是花了三年才发货吗？是的。

Windows 8 的遭遇是一个完全不同的故事，我没有资格对此发表评论，因为那时我已经离开公司很久了。

我们应该沮丧还是遗憾地回顾 Vista？不，我更愿意把它看作是学到的教训。我很确定我们中没有人会在后来的项目中犯同样的错误。我们从经验中学习——这意味着下次我们会犯一整套不同的错误。犯错是人之常情。



T2】

如果你喜欢这篇文章，你可能也会喜欢我写的关于操作系统平台发展的后续文章:

其他一些可能感兴趣的博客帖子: