# 保守旅行的秘密

> 原文：<http://donmelton.com/2013/01/03/keeping-safari-a-secret/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

在我们开发 Safari 的大部分时间里——远在它被叫做 T1 之前——它假装是微软的 Internet Explorer。具体来说，就是苹果公司自 1998 年以来随操作系统提供的 Mac 版 ie 浏览器。Safari 推出不到 6 个月，就开始伪装成 Mozilla 浏览器。

我们为什么要这么做？当 Safari 的代码和行为如此不同时，我们是如何让它伪装成这些浏览器的呢？

斯科特·福斯特尔不仅让我负责开发一款浏览器，并组建一个团队来开发这款浏览器，我还必须对整个该死的项目保密。顺便说一句，这真的让雇佣最初团队的大部分人变得很复杂，因为我不能告诉他们他们在做什么，直到他们接受了这份工作。谈谈你的管理挑战。但那是后话了。

所以，保密。我们没有像当时的 Jony Ive 的设计团队那样，或者像几年后的 iPhone 团队那样，处于物理锁定状态。但是除非你知道去找谁，否则你永远也不会在校园里找到我们。如果你知道，你也不太可能知道我们在做什么，除非你抓到我们中的一个人在运行 Safari——这是我们通常关着办公室门做的事情。

我也不担心谈话。福斯特尔当然信任我——这是让他成为伟大老板的众多因素之一。我信任我的团队——否则我不会雇用他们。我们和苹果公司的内部测试人员都不会告密。beta 测试者太少了，但是他们是无可指责的。

那时推特和脸书还不存在。苹果公司没有人会蠢到写关于工作的博客，所以我担心什么呢？

服务器日志。他们吓死我了。

当 Web 浏览器从 Web 服务器获取页面时，浏览器用用户代理字符串(基本上是其名称、版本、平台等)向该服务器标识自己。浏览器还会给服务器一个 IP 地址，这样服务器就知道将页面返回到哪里。这种交换不仅使网络工作，还允许服务器告诉谁在使用什么浏览器以及他们在哪里使用它。

你可以看到这是怎么回事，对不对？但是等等，还有更多…

早在 1990 年左右，一些有远见的 IT 人员为苹果公司获得了整个 A 类 IP 地址网络。没错，苹果有 16，777，216 个静态 IP 地址。因为所有这些地址都属于同一个地址，也就是现在所说的“/8 块”，所以每个地址都以相同的数字开头。在苹果公司，这个数字是`17`。

IP 地址`17.149.160.49`？那是苹果。`17.1.2.3`？是的，苹果。`17.18.19.20`？还有，苹果。`17.253.254.255`？苹果，该死的！

我被耍了。

尽管我们像一些中情局的秘密行动一样操作这个项目——带着忠诚誓言等等——当我们在苹果校园网上使用它时，我们不能让 Safari 成为“Safari”。否则，某处的某个 Web 服务器管理员可能正在扫描他们的日志文件，并注意到用户代理字符串和 IP 地址来源之间的连接。然后，史蒂夫·乔布斯想在 2003 年 1 月 7 日的 Macworld 上展示的大惊喜就要被拍了。很可能，我也会。

所以每当我们在苹果的时候，我们都把我巧妙设计的 Safari 用户代理字符串藏了起来。我说“我的”,是因为这实际上是 Safari 和 WebKit 中为数不多的几段代码中的一段，1)我可以说是我设计的，2)实际上仍在源代码中。感谢上帝，我的工程团队移除或重构了我所有的其他黑客。我雇佣了优秀的员工。

每当我们离开苹果校园网时，比如在家里，我们都会修改 Safari 来启用它的真实用户代理字符串。为了兼容性测试，我们不得不这样做。这让我可以调整字符串，以最大限度地兼容当时的网站。这解释了为什么 Safari 用户代理字符串中有如此多的额外信息，例如`KHTML, like Gecko`—其他浏览器引擎的名称。

我们不能在禁用真实 Safari 用户代理字符串的情况下发货，但我们想出了下一个最好的办法——在特定日期后自动启用它。大约 10 年前的这个时候，也就是 Safari 首次亮相的前几天，它从低调到为自己的真实身份感到骄傲。

在首次亮相之前的几天里，我紧张得失眠，因为我在互联网上搜索服务器日志。