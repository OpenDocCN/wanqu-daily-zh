# 谷歌扼杀 SaaS 初创公司的新方法|冈萨罗·赛恩斯-特拉帕加| Medium

> 原文：<https://gomox.medium.com/google-safe-browsing-can-kill-your-startup-7d73c474b98d?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

# 谷歌扼杀你的 SaaS 创业公司的创新方法

*如果你因为谷歌安全浏览将你的网站或 SaaS 列入黑名单而陷入恐慌，* [*请跳到描述如何处理这种情况的章节*](#d447) *。* [*黑客新闻评论页*](https://news.ycombinator.com/item?id=25802366) *也有很多很有意思的评论。*

在过去，当谷歌(或谷歌释放的任何调谐不当的人工智能)决定要扼杀你的业务时，它通常会拒绝进入其多个围墙花园中的一个，仅此而已。你可能听说过恐怖故事:



I swear I have already checked the FAQ!



他们都符合同样的模式。首先，一家企业**选择了**，它使用谷歌服务的方式使得它的生存完全依赖于谷歌服务。第二，作为自动化巨兽，谷歌做着自己的事情:它稍微调整了一下自己屁股在星球大小的皮扶手椅上的位置，并在没有真正注意到的情况下，在这个过程中碾压了无数(相对而言)蚂蚁大小的企业。第三，也是最后一点，蚂蚁规模的企业拼命地试图通知谷歌，他们正在被击败，但他们只能到达一个自动建议箱。

有时，蚂蚁大小的 CEO 认识谷歌的高层，因为他们是大学好友，或者首席技术官写了一篇蚂蚁大小的中型文章，不知何故登上了黑客新闻的头版。然后，谷歌注意到蚂蚁大小的问题，有时认为它值得解决，通常是因为担心蚂蚁革命可能带来的监管影响。

出于这个原因，传统的蚂蚁大小的智慧表明，如果可能的话，你不应该建立你的业务过度依赖谷歌的服务。如果你设法避免依赖谷歌的多重围墙花园生存，你可能会没事。



All this flat blue surface with a cool red roof thing! So convenient!



## 天底下有什么新鲜事

在今天这一集“互联网今非昔比”中，让我们来谈谈谷歌无意中摧毁你的初创公司的一种全新方式，即**不需要你以任何方式(故意)使用谷歌服务**。

你知道吗，你网站的域名可能会被谷歌列入黑名单，而且这个黑名单不仅仅是直接在谷歌 Chrome 中执行的**，还有其他一些软件和硬件供应商。您知道吗，这些其他供应商同步这个列表时会有各种各样的时间和解释，这种方式会使修复任何问题变得非常有压力和不可预测。你知道谷歌审查黑名单报告的预计时间，不管多无效，都是以周为单位的吗？**



This is now your website or SaaS application



这个黑名单“功能”被称为[谷歌安全浏览](https://en.wikipedia.org/wiki/Google_Safe_Browsing)，这里的图像描绘了如果你的一个域名碰巧在安全浏览数据库中被标记，你的用户将看到的微妙信息。警告文本的范围从“前方欺骗性网站”到“前方网站包含恶意软件”([查看完整列表](https://support.google.com/chrome/answer/99020))，但它们都有一个同样可怕的红色背景设计，以及一个几乎不可能让人们跳过警告并使用该网站的用户界面。

我们第一次遇到这个问题时，我们从大量客户报告中得知，他们在尝试使用我们的 SaaS 时看到了红色警告页面。第二次，我们准备得更充分，因此有一些空闲时间来写这篇文章。

例如， [InvGate](https://www.invgate.com/) (我们公司)是一个面向 IT 部门的 SaaS 平台，运行在 AWS 上，拥有 1000 多家中小企业和企业客户，为数百万最终用户提供服务。这意味着我们的产品被 IT 团队用来管理他们自己用户的问题和请求。你可以想象当 IT 经理的 IT 票证系统突然开始向他们的最终用户显示这种不祥的安全警告时，他们的愉快反应。

当我们第一次遇到这个问题时，我们疯狂地试图了解发生了什么，并了解谷歌安全浏览(GSB 从现在开始)是如何工作的，同时我们的技术支持团队试图跟上客户报告这个问题。我们很快意识到我们用来提供静态资产(CSS、Javascript 和其他媒体)的一个 [Amazon Cloudfront CDN](https://aws.amazon.com/cloudfront/) URL 已经被标记，这导致我们的整个应用程序对于使用该特定 CDN 的客户实例失败。对据称受影响的系统的快速检查显示，一切看起来都很正常。

当我们的 DevOps 团队全力以赴建立新的 CDN 并准备将客户转移到新的域名时，我发现谷歌的文档声称 GSB 提供了额外的解释，说明为什么一个网站在违规网站的[谷歌搜索控制台](https://search.google.com/search-console)(从现在起 GSC)中被标记。我不会用细节来烦你，但为了访问这些信息，你必须在 GSC 的[声称拥有该网站的所有权，这需要你建立一个自定义 DNS 记录或将一些文件上传到违规域名的根目录。我们抢着这么做，20 分钟后，设法找到了关于我们网站的报告。](https://support.google.com/webmasters/answer/9008080?hl=en)

这份报告大概是这样的:



That's… not particularly useful.



该报告还包含一个“请求审查”按钮，我很快就点击了这个按钮，但并没有在网站上采取任何行动，因为没有任何关于所谓问题的信息。我提交了一份审查报告，指出没有列出违规的网址，尽管文件表明谷歌总是提供示例网址来帮助网站管理员识别问题。



Great! Requesting a review of an invalid report can cause my future reviews to be even slower.



大约一个小时后，在我们将客户移出 CDN 之前，我们的网站被从 GSB 数据库中清除了。我收到了一封自动发送的电子邮件，确认审查已经成功，大约在 2 小时后。没有澄清是什么首先导致了这个问题。

## 之后发生了什么

在这一事件发生后的一周内，尽管我们的网址已经从安全浏览黑名单中清除，但我们仍不断收到一些公司难以进入我们系统的零星报告。

Google 安全浏览为商业和非商业软件开发人员提供了两种不同的 API，以便在他们的产品中使用黑名单。特别是，我们发现至少一些使用 Firefox 的客户也遇到了问题，客户的反病毒/反恶意软件和网络安全设备也标记了我们的网站，并阻止用户在问题解决后的许多天访问它。

我们继续将所有客户从以前的黑名单中移除，并转移到一个新的 CDN 上，因此问题得到了永久解决。我们从未正确确定问题的原因，但我们将其归因于谷歌总部的一些人工智能被迷幻药绊倒。

## 如何防止谷歌安全浏览标记您的网站

我的意见:如果你在 SaaS 经营一家有可用性 SLA 的企业，无缘无故地被谷歌安全浏览标记代表着对业务连续性的一个非常真实的风险。

可悲的是，鉴于标记和审查网站机制的不透明性，我不认为你有办法完全防止这种事情发生在你身上。但是你当然可以设计你的应用程序和流程，以最小化它发生的机会，降低实际被标记的影响，并最小化规避问题(如果出现)所需的时间。

以下是我们正在采取的步骤，因此我建议:

*   明智地说，不要把所有的鸡蛋放在一个篮子里。 GSB 似乎标志着整个领域或子域。因此，将您的应用程序分布在多个域中是一个好主意，因为这将减少任何单个域被标记的影响。【比如:company.com 为你的网站，app.company.net 为你的应用，eucdn.company.net 为欧洲的客户，useastcdn.company.net 为美国东海岸的客户等等。
*   不要在你的主域中托管任何客户生成的数据。我在研究这一问题时发现的许多黑名单案例都是由 SaaS 客户无意中将恶意文件上传到服务器上造成的。这些文件对系统本身无害，但是它们的存在会导致整个域被列入黑名单。你的用户上传到你的应用程序的任何东西都应该在你的主域之外托管。例如:使用 companyusercontent.com 存储客户上传的文件*。*
*   **在谷歌搜索控制台中主动要求所有生产领域的所有权。**如果你这样做，这不会阻止你的网站被列入黑名单，但你会收到一封电子邮件，这将使你对问题做出快速反应。这需要一点时间，当您实际处理这种影响客户的事件时，这是宝贵的时间。
*   如果需要的话，做好跳域名的准备。这是最难做到的事情，但它是防止被列入黑名单的唯一有效工具:设计您的系统，使其引用的服务域名可以很容易地被修改(通过使用脚本或编排工具来执行这种更改)，甚至可能有备用名称可用。*例如，让 eucdn.company2.net 成为 eucdn.company.net 的 CNAME，如果第一个域被阻止，则使用工具更新应用程序的配置，以从备用域加载其资产。*

## 如果你的 SaaS 应用或网站被谷歌安全浏览列入黑名单，该怎么办

以下是我的建议:

*   如果你可以轻松快速地将你的应用程序切换到一个不同的域名，这是唯一能够可靠、快速和伪确定地解决事件的方法。如果可能的话，就这么做。你完了。
*   如果失败，一旦你确定了被封锁的域名，查看谷歌搜索控制台上出现的报告。如果您在此之前没有声明该域的所有权，您必须现在就声明，这将需要一段时间。
*   如果你的网站真的被黑了，解决问题(即删除违规内容或被黑的页面)，然后请求安全审查。如果你的网站没有被黑客攻击，或者安全浏览报告是无意义的，无论如何都要请求安全审查，并声明报告是不完整的。
*   然后，不要痛苦地等待，假设停机时间对你的系统或业务至关重要，无论如何都要着手迁移到一个新的域名。审查可能需要几周时间。

## 顶部有一颗樱桃🍒

第二次，在第一次事件发生几个月后，我们收到了一封来自搜索控制台的电子邮件，警告我们我们的一个域名被标记了。在最初的邮件报告几个小时后，作为 G Suite 域名管理员，我收到了另一封有趣的邮件，你可以在下面看到。



The "sc" in sc-noreply@google.com stands for "Search Console"



让我总结一下那是什么，因为它相当令人兴奋。此电子邮件是指搜索控制台黑名单警报电子邮件。这第二封邮件说的是 *G 套件的自动钓鱼邮件过滤器*认为*谷歌搜索控制台关于我们的域名被列入黑名单的邮件*是**伪造的**。最确定的是**不是**，因为当我们收到邮件时，我们的域名确实被列入了黑名单。所以谷歌甚至不能确定它自己的关于网络钓鱼的电子邮件警告是否是网络钓鱼。(LOL？🤔)

## 关于互联网未来的一些令人不寒而栗的最终想法

任何从事科技工作的人都非常清楚，大型企业科技巨头在很大程度上是互联网的看门人。但是我倾向于用一种松散的，隐喻的方式来解释。这篇文章中描述的安全浏览事件非常清楚地表明，谷歌**字面上的**控制着谁可以访问你的网站，无论你在哪里以及如何操作它。Chrome 占有大约 70%的市场份额，Firefox 和 Safari 都在一定程度上使用 GSB 的数据库，谷歌可以轻而易举地让互联网上的任何网站几乎无法访问。

这是一种非凡的力量，不适合谷歌的“*人工智能将在它认为方便的时候审查你的问题。*