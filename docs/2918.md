# 成为一名飞行员如何让我成为一名更好的程序员——来自红色星球的思考——来自红色星球的思考

> 原文:[http://nathan marz . com/blog/how-being-a-pilot-make-me-a-better-programmer . html？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://nathanmarz.com/blog/how-becoming-a-pilot-made-me-a-better-programmer.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

两年前，我花了九个月的时间为我的私人飞行员执照进行培训。除了有趣和令人兴奋，飞行还需要很多知识和技能:空气动力学、侧风着陆、失速恢复、导航、识别和处理系统故障等等。

每当我探索一个完全不同的知识领域时，总有一件事让我感到惊讶，那就是它对我所关心的其他学科的出血效应。有些基本原则是跨领域的，在完全不同的环境中看到这些原则会让你对它们有更深的理解。航空也不例外——它教会了我如何成为一名更好的程序员。我不能说它教会了我任何全新的东西，但如果不理解这些原则，将来可能会有可怕的死亡风险，这是编程无法做到的。

### 不要将系统视为黑盒

我永远不会忘记我做旋转训练的那一天。在一个旋转中(这里是一个的视频[)，飞机基本上变成了天空中的一块大石头，在向地面垂直坠落的同时翻滚旋转。我听说它被称为“无轨过山车”。我的教练在我第一次旋转时给了我很大的刺激——后来他说:“我从来没见过有人像这样骂人！”](https://www.youtube.com/watch?v=2LorHnCe3BA)

很容易把飞机想象成一个“黑匣子”，轭和方向舵使飞机转向，而油门为空速或爬升增加能量。在正常的稳定飞行中，这基本上就是输入的作用。然而，转念一想，那样想飞机的输入会让你丧命。增加动力会加剧旋转，向上俯仰会阻止你退出旋转。试图向右滚动反而会向左滚动，可能会很剧烈。要退出尾旋，你必须以不同的方式操作飞机:将动力置于空转状态，只用方向舵停止旋转，并向下俯冲至接近垂直的俯冲状态。然后飞机再次飞行，你可以小心地从俯冲中恢复。

要成为一名飞行员，你可以试着记住任意一套在各种情况下如何驾驶飞机的规则:在巡航飞行中这样做，在着陆时那样做，在旋转中这样做。但是没有什么是直观的，你会犯很多错误。当出现问题时尤其如此:如果你在飞行中遇到引擎问题，了解引擎、化油器和燃料系统的工作原理可能意味着在你的乘客自拍时安全降落在跑道上，或者在你的乘客拼命给亲人发短信时危险降落在高速公路上。当您理解工具的实现时，您会更加有效和安全地使用工具。

在软件领域，我认为没有什么比数据库更像是一个黑匣子了。程序员希望使用数据库接口来存储和检索数据，然后将它交给运营人员让它健壮地运行。然而，一个数据库的界面仅仅告诉你使用这个数据库的一小部分意义，还有很多重要的信息它没有告诉你。哪些查询将高效运行？哪些查询会消耗大量资源？如果有硬件故障会发生什么？如果一个应用程序有一个错误，触发了对数据库的意外拒绝服务攻击，那么其他应用程序会怎么样？仅仅是一个应用程序失败，还是会引发更大的级联失败？如果数据库是分布式的，数据如何在节点间划分？当存在数据倾斜时会发生什么？

理解这些问题的答案对于构建健壮的系统至关重要，您需要知道数据库如何有效地回答这些问题。当您理解了您所使用的数据库背后的机制时，您就会更好地理解它们的限制和故障模式，并且您可以使用这些知识来构建更好的系统。

例如，我开发 [Lambda 架构](https://www.amazon.com/Big-Data-Principles-practices-scalable/dp/1617290343)的一个主要动机是避免应用程序增量读写分布式数据库的标准架构的故障模式和复杂性。这种复杂性的一个例子是管理在线压缩——如果不小心处理，将会导致连锁故障和大规模停机(许多公司都有过惨痛的教训)。另一个例子是最终的一致性——在完全增量的架构中实现一致性非常容易出错，最小的错误都会导致数据损坏(很难跟踪的罕见错误)。我坚信避免失败的最好方法是设计架构，这样那些失败模式首先就不存在了。越是可能出错，就越会出错。

我建议通读一下[凯尔·金斯伯里](https://twitter.com/aphyr)的[杰普森](https://aphyr.com/tags/jepsen)的帖子，亲自看看数据库健壮性和复杂性之间的关系。这些帖子的一个共同主题是分布式数据库经常与它们的营销相矛盾，比如在分区期间默默地丢失大量数据。对我来说，知道一些东西是如何工作的给了我信心，它会正常工作，如果实现太复杂或令人困惑，我会非常谨慎地进行。

有一个更重要的原因来理解你的工具是如何工作的。太多的程序员对待他们的工具就像对待乐高积木一样，并且限制了这些工具的使用和组合。但是当你理解了你的工具是如何工作的，那么你就可以根据什么是理想的解决方案进行推理，如果理想的工具存在的话。软件变成了粘土而不是乐高。在我的职业生涯中，我反复发现，我们使用的语言、数据库和其他工具离理想状态相差甚远，根本创新的机会一直存在。这种想法直接导致我创建了[风暴](http://storm.apache.org)、[卡斯卡路](https://github.com/nathanmarz/cascalog)和[大象数据库](https://github.com/nathanmarz/elephantdb)，所有这些都给了我和我的团队巨大的杠杆作用。即使自己构建理想的工具不切实际，了解什么是理想的也非常有助于评估可能的解决方案。

我是马丁·汤普森的术语“机械同情”的忠实粉丝。如果没有对实现的深刻理解，他所熟知的那种高绩效工作是绝对不可能的。一般来说，对依赖项的实现理解得越多，性能优化就越容易。

如果你读了我的上一篇关于计算机科学教育的有限价值的文章，你可能会认为我为理解你的依赖的内部而争论是自相矛盾的。毕竟，这是计算机科学教育的主要焦点。我的回答是，我提倡为程序员提供计算机科学教育，就像我提倡为飞行员提供航空工程学位一样。这些学位是相关的、有用的、有帮助的，但是它们本身并不能让你成为一个好的程序员或好的飞行员。您可以了解您的工具如何工作，通常在战壕中比在白板上更有效。当你拓展你领域的边界时，抽象教育就有了回报。我从计算机科学教育中获得的深刻的问题解决和算法技能在这方面对我帮助很大，如果我是一名试飞员，我想正式的航空工程教育是必不可少的。

### 正确监控生产系统

航空也帮助我对监控生产系统有了更深入的了解。我曾经认为监控是事后的想法，是在实际系统建立之后添加的东西。现在，我考虑监控任何系统的核心部分，并从一开始就考虑到这一点。

在航空领域，你用各种仪器监控飞机。主要仪器使用陀螺仪和气压测量高度、空速、方向和方位。你还有一个名为 [VOR](https://en.wikipedia.org/wiki/VHF_omnidirectional_range) 的导航工具，可以从固定的无线电信标确定你的方向(但不是你的距离)。仅仅依靠这些原始的仪器，你就可以在能见度为零的情况下安全飞行，这是令人惊讶的。

去年我在模拟器上做了一些特殊训练，在那里我告诉教练尽全力杀我。他热情地让我经历了各种不同寻常的情况，包括恶劣天气和系统故障。当飞机上的一个引擎发生故障时，这是相当明显的，但当一个仪器发生故障时，有时唯一的方法是通过查看其他仪器(特别是当你在云中并且没有外部参考可以使用时)。但是当仪器不一致的时候，怎么知道哪个仪器坏了呢？错误的决定可能会导致更糟糕的决定——比如当你以为自己在 3500 英尺的高空巡航时，却让飞机径直撞向地面。

有一次，当我爬进一朵云时，他堵塞了我的静态源端口。当我看到我的高度计冻结时，我开始以为我让飞机向下倾斜了一点，停止了爬升。但是当我反复检查我的仪器时，我发现其他仪器并不支持这个假设。如果我凭第一直觉向上俯仰，我可能会让飞机失速，并把自己置于一个非常糟糕的(模拟的)境地。相反，我正确地诊断了问题，并切换到备用静态端口，使高度计恢复了生命。

在另一个场景中，他杀死了我的真空泵，导致我的定向陀螺仪失败。然后我只能用磁罗盘导航。因为我知道磁罗盘在加速时是不准确的，所以我没有对它在转弯时给我的奇怪读数反应过度。如果我记得在转弯时读数是如何根据你面对的方向而偏离的(当我进行仪器评级时，我会将这一点内在化)，我将能够更精确地完成这些转弯。

这里有两个教训。首先，我能够正确地阅读这些仪器，因为我了解它们是如何计算测量值的。其次，仪器之间的冗余允许我诊断和调试任何问题。同样的经验也适用于软件。

将软件部署到生产环境就像驾驶飞机穿过云层。你知道飞机是精心设计和测试过的，但是在这个特殊时刻它是否正常工作只能由你的仪器来决定。

考虑生产软件系统的一个基本属性:它不会丢失或损坏数据。您可能有彻底的测试，但是在生产中会发生意想不到的事情。一旦软件被部署，你如何知道这个重要的属性被维护？当我大学毕业开始我的第一份工作时，该公司产品的一些代码让我震惊——而且不是以一种好的方式。代码由大量特殊情况组成，用于处理数据库随时间推移而损坏的各种方式。

作为一名程序员，我最大的“啊哈”时刻之一是拥抱“你的代码是错误的！”。即使你有一个很棒的测试套件，bug 也可以并且确实可以进入生产。这意味着巨大的影响。当你承认错误是不可避免的，那么破坏数据的错误也是不可避免的。当其中一个错误在生产中出现时，您需要尽快知道，以防止更多的损坏。也许这个 bug 会在某个地方触发一个异常，但是你不能依赖这个。你唯一的选择就是装备你的系统。如果您不这样做，那么您的客户将成为您的数据破坏工具，这对任何人都没有好处。

这里有一个我彻底测试未能发现的数据丢失错误的例子。我有一个 Hadoop 任务，通过为密钥生成随机数，将数据“混洗”到 reducers。事实证明，为了使 Hadoop 完全容错，任务每次运行时都必须输出相同的结果。因为我的代码在每次运行时都会随机生成密钥，所以 reduce 任务随机失败会导致一些数据丢失。不用说，发现这是我们数据丢失的原因是那些令人毛骨悚然的“为什么我会成为一名程序员？”调试会话。

您可以做很多事情来监控数据损坏。一个很好的技巧是不断地生成“虚拟数据”并通过您的生产系统推送。然后，检查处理的每个阶段是否都准确地输出了预期的结果。最终结果是一个简单的工具，要么显示“腐败”要么显示“非腐败”，其中“腐败”案例显示了预期结果和实际结果之间的差异。

仅仅因为您的“虚拟数据”工具显示“未损坏”并不意味着数据损坏没有发生。这种技术必然会在您的系统中传递相对较小规模的数据，因此如果您有不经常发生的数据损坏错误，您可能不会检测到它们。要正确理解“未腐败”指标的实际含义，需要了解“虚拟数据”工具的工作原理。

检测数据损坏的另一个好方法是通过计数之类的集合。例如，在具有许多阶段的批处理管道中，在给定输入记录数的情况下，您通常可以准确地知道某个阶段的输出中预期有多少条记录。有时这种关系不是静态的，但是有一种简单的方法来增加处理代码，以确定应该有多少条输出记录。使用这种技术可以发现我之前描述的随机数错误。

许多数据处理管道都有一个规范化阶段，例如将自由形式的位置字段转换成结构化的位置(例如，“SF”变成了“San Francisco，CA，USA”)。一个有用的度量是未能标准化的数据记录的百分比。如果该百分比在短时间内发生显著变化，这意味着 1)规格化器有问题，2)数据输入有问题，3)用户行为突然改变，或者 4)您的仪器坏了。

显然，这些工具都不完美。但是你的支票越多，导致腐败的漏洞就越难被忽视。通常你的测量部分重叠-这种冗余是一件好事，有助于验证仪器功能正常。这方面的一个例子是测量流水线的总延迟以及测量各个组件的延迟。如果延迟没有增加，您要么有一个 bug，要么错过了什么。

[Gil Tene](https://twitter.com/giltene) 有一个[的精彩演讲](https://www.azul.com/files/HowNotToMeasureLatency_LLSummit_NYC_12Nov2013.pdf)，讲述了人们在测量系统延迟时所犯的难以置信的常见错误。我强烈推荐检查一下，这是一个很好的例子，需要理解你的测量如何正确地解释它们。

当我现在构建软件时，我不认为我构建的任何部分是健壮的，除非我可以用生产中的度量来验证它。我看到生产中发生了太多疯狂的事情，以至于我不相信测试足以让软件变得健壮。监控对于发现生产行为的预期与现实之间的差异至关重要。使软件的预期属性可度量并不总是容易的，它通常对软件设计有重大影响。由于这个原因，我在开发过程的所有阶段都要考虑它。

### 结论

我已经讨论了作为一名程序员，aviation 提高了我的一些最大的领域:更深入地研究我使用的工具，并以更全面的方式思考仪器仪表。然而这里有一个更广泛的观点。成为一名飞行员似乎与成为一名程序员无关，然而这两个领域之间有着惊人的重叠。我发现，每当我从事与职业完全无关的课题时，总会有一些重叠的领域以意想不到的方式提高我。

这可以被理解为一种普遍的生活哲学:坚持不懈地寻找方法走出你的舒适区，做挑战和挫败你的事情。除了学习新事物，你会因为惊人的知识重叠而在你做的每件事上都变得更好。对我来说，最极端的例子发生在三年前，当时我连续三个月演单口喜剧。我从站立演讲中学到的经验对提高我作为一名技术演讲人的技能是非常宝贵的。令人惊讶的是，它也帮助我成为了一名更好的作家。

最后一件事——不要让我在这篇文章中偶然提到的死亡吓跑了你体验小型飞机飞行的乐趣。大多数人唯一一次听说小型飞机是在它们坠毁的时候，所以对它们的普遍恐惧只是简单的选择偏见。如果你有几个小时的时间和额外的几百美元，我强烈建议你做一次入门飞行，体验一下当飞行员的兴奋感。