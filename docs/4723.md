# 即将到来的软件天启——大西洋

> 原文:[https://www . theatlantic . com/technology/archive/2017/09/saving-the-world-from-code/540393/？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://www.theatlantic.com/technology/archive/2017/09/saving-the-world-from-code/540393/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)



2014 年 4 月 10 日晚上有六个小时，华盛顿州的所有人都没有 911 服务。打电话求助的人得到的是忙音。一名西雅图妇女在陌生人试图闯入她家时至少拨打了 37 次 911。当他最终从窗户爬进她的客厅时，她拿起了一把菜刀。那人逃走了。

据报道，当时最大的一次 911 服务中断是由运行在科罗拉多州恩格尔伍德服务器上的软件引起的。该服务器由一家名为 Intrado 的系统提供商运营，它持续记录着它向全国各地的 911 调度员发送了多少个电话。Intrado 的程序员为计数器的最高值设定了一个阈值。他们从数百万中挑选了一个数字。

4 月 10 日午夜前不久，计数器超过了这个数字，导致了混乱。因为计数器用于为每个呼叫生成唯一的标识符，所以新的呼叫被拒绝。因为程序员没有预料到这个问题，他们没有创建警报来引起注意。没人知道发生了什么。华盛顿、加利福尼亚、佛罗里达、卡罗莱纳和明尼苏达的调度中心为 1100 万美国人服务，努力理解呼叫者得到忙音的报告。直到早上才意识到英格伍德的 Intrado 软件有责任，修复方法是改变一个数字。

不久前，紧急电话是在本地处理的。停机时间很短，很容易诊断和修复。手机的兴起和新功能的承诺——如果你可以发短信给 911 会怎样？还是发视频给调度员？—推动了依赖互联网的更复杂系统的开发。有史以来第一次，可能会出现全国性的 911 服务中断。现在已经有四年了。

有人说软件正在“吞噬世界”越来越多的曾经由机械或人工控制的关键系统开始依赖代码。这一点在 2015 年夏天可能再清楚不过了，当时有一天，美国联合航空公司(United Airlines)因其出发管理系统出现问题而停飞了其机队；升级后，纽约证券交易所暂停交易；*华尔街日报*网站首页崩溃；西雅图的 911 系统再次瘫痪，这一次是因为另一个路由器出了故障。这么多软件系统同时出现故障，起初让人感觉是一场协同的网络攻击。几乎更可怕的是，那天晚些时候，我意识到这只是一个巧合。

“当我们拥有机电系统时，我们曾经能够彻底地测试它们，”麻省理工学院航空航天学教授 Nancy Leveson 说，她已经研究软件安全 35 年了。她因关于 Therac-25 的报告而闻名，Therac-25 是一种放射治疗机器，由于软件错误导致 6 名患者死亡。“我们过去能够思考它能做的所有事情，它能进入的所有状态。”例如，在铁路交叉口控制列车运行的机电联锁只有这么多种配置；几张纸就可以描述整个系统，您可以针对每种配置运行物理火车，看看它会如何运行。一旦您构建并测试了它，您就确切地知道您在处理什么。

软件不一样。只需编辑某处文件中的文本，同一块硅片就能成为自动驾驶仪或库存控制系统。这种灵活性是软件的奇迹，也是它的诅咒。因为可以便宜改，所以软件不断改；因为它脱离了任何物理事物——一个比另一个复杂一千倍的程序占用了相同的实际空间——它往往会无限制地增长。“问题是，”莱弗森在一本书中写道，“我们正试图建立超出我们智力管理能力的系统。”

<aside class="ArticlePullquote_root__YtnHv">The software did exactly what it was told to do. The reason it failed is that it was told to do the wrong thing.</aside>

我们思考工程故障的标准框架——例如，反映在医疗设备的法规中——是在第二次世界大战后不久、软件出现之前为机电系统开发的。这个想法是，通过使部件可靠(比方说，你制造的发动机能承受 40，000 次起飞和着陆循环)和计划这些部件的故障(你有两个发动机)，你就能制造出可靠的东西。但是软件不会*破解*。Intrado 的故障阈值不像导致客机坠毁的故障铆钉。软件完全按照要求做了。事实上，它做得很完美。它失败的原因是它被告知去做错误的事情。软件失败是理解和想象的失败。Intrado 实际上有一个备用路由器，如果它被自动切换，几乎可以立即恢复 911 服务。但是，正如在给 FCC 的一份报告中所描述的，“这种情况发生在应用程序逻辑中的一个点上，该点不是为执行任何自动纠正措施而设计的。”

这就是用代码制作东西的麻烦所在，而不是实物。正如莱韦森所说，“复杂性是肉眼看不见的。”

他现在正试图改变我们制作软件的方式，这似乎都是从同一个前提开始的:代码太难思考了。在试图理解这些尝试本身之前，有必要理解为什么会这样:是什么样的代码让它变得如此陌生，与之前的任何东西都不一样。

技术进步曾经改变了世界的面貌——你可以看到道路被铺好；你可以看到天际线上升。今天，你很难分辨出什么时候某样东西被重制，因为它经常被代码重制。例如，当你踩下汽车的油门时，你不再直接控制任何东西；踏板和油门之间没有机械连接。取而代之的是，你向一个软件发出命令，决定给引擎多少空气。汽车是一台你可以坐在里面的电脑。方向盘和踏板也可以是键盘按键。

像所有其他东西一样，这辆车已经被电脑化，以实现新的功能。当一个程序负责油门和刹车时，它可以在你离另一辆车太近时让你减速，或者精确控制燃油喷射以帮助你节省汽油。当它控制转向时，它可以在你开始漂移时让你保持在你的车道上，或引导你进入停车位。没有代码就无法构建这些特性。如果你尝试，一辆汽车可能重达 40，000 磅，是一个不可移动的钟表机构。

软件使我们能够制造出有史以来最复杂的机器。然而，我们几乎没有注意到，因为所有这些复杂性都被封装在微小的硅芯片中，成千上万行代码。但是我们看不到复杂性并不意味着它已经消失了。

著名的荷兰计算机科学家 Edsger Dijkstra 在 1988 年写道，程序员“必须能够从概念层次的角度进行思考，这比以前一个人需要面对的层次要深得多。”Dijkstra 认为这是一个警告。随着程序员急切地将软件注入关键系统，他们越来越成为构建世界的关键 Dijkstra 认为他们可能高估了自己。

<aside class="ArticlePullquote_root__YtnHv">“Software engineers don’t understand the *problem* they’re trying to solve, and don’t care to.”</aside>

编程之所以如此困难，是因为它要求你像计算机一样思考。从某种意义上来说，在计算的早期，当代码以字面上的 1 和 0 的形式出现时，它的奇怪之处更加明显。当一个程序员一行一行地仔细阅读“100001010011”和“000010011110”时，任何人都可以看到这个程序员与他们试图解决的实际问题是多么的疏远；很难判断他们是在试图计算火炮轨迹还是在模拟井字游戏。类似于英语的 Fortran 和 C 等编程语言的引入，以及被称为“集成开发环境”或 ide 的工具的引入，有助于纠正简单的错误(如 Microsoft Word 的语法检查器，但不用于代码)，模糊了这种基本的疏远——程序员不直接处理问题，而是花时间为机器编写指令。

麻省理工学院软件安全专家莱韦森说:“问题是软件工程师不理解他们试图解决的问题，也不关心这个问题。”。原因是他们太专注于让他们的代码工作。“软件工程师喜欢为编码错误提供各种工具和材料，”她说，指的是 ide。"软件出现的严重问题与需求有关，而不是编码错误."例如，当你编写控制汽车油门的代码时，重要的是关于何时、如何以及开多大的规则。但是这些系统已经变得如此复杂，几乎没有人能够保持头脑清醒。“现在汽车中有 1 亿行代码，”莱韦森说。“你无法预料所有这些事情。”

2007 年 9 月，Jean Bookout 和她最好的朋友开着一辆丰田凯美瑞在高速公路上行驶，这时油门好像卡住了。当她把脚从踏板上拿开时，汽车并没有减速。她试了试刹车，但它们似乎失去了动力。当她以每小时 50 英里的速度转向出口匝道时，她拉下了紧急刹车。汽车在撞上路边的路堤前留下了 150 英尺长的刹车痕迹。乘客被杀。一个月后，Bookout 在医院醒来。

该事件是近十年来对丰田汽车所谓意外加速的调查中的众多事件之一。丰田将事故归咎于设计不良的地垫、“粘性”踏板和驾驶员失误，但外界怀疑有缺陷的软件可能是原因。美国国家公路交通安全管理局(National Highway Traffic Safety Administration)从美国国家航空航天局(NASA)招募了软件专家，对丰田的代码进行了深入审查。近 10 个月后，美国宇航局团队没有发现软件是原因的证据——但表示他们无法证明不是。

正是在图书借阅事故的诉讼过程中，有人最终找到了令人信服的联系。原告的专家证人迈克尔·巴尔(Michael Barr)让一组软件专家花了 18 个月的时间研究丰田代码，从美国国家航空航天局(NASA)中断的地方开始。巴尔将他们发现的东西描述为“意大利面条式代码”，这是程序员对软件的行话，已经变成了一团乱麻。当代码积累了很多年后，就变成了意大利面条，一个又一个的特性堆积在已经存在的东西之上，并被编织在已经存在的东西周围；最终，代码变得无法遵循，更不用说详尽地测试缺陷了。

<aside class="ArticlePullquote_root__YtnHv">“If the software malfunctions and the same program that crashed is supposed to save the day, it can’t.”</aside>

Barr 的团队使用与事故中涉及的凯美瑞相同的模型，证明了车载计算机上的关键任务有超过 1000 万种失败的方式，可能导致意外加速。 [*](#Correction) 他们证明了一个小小的比特翻转——计算机内存中的 1 变成 0，反之亦然——都可能导致汽车失控。丰田设置的故障安全代码不足以阻止它。“你有软件看着软件，”巴尔作证说。“如果软件出现故障，而崩溃的同一个程序或同一个应用程序本应拯救世界，但它无法拯救世界，因为它不起作用。”

巴尔的证词为原告赢得了 300 万美元的赔偿金，赔偿了布克奥特和她朋友的家人。据《纽约时报》报道，这是针对丰田电子油门控制系统问题的第一起类似案件，也是丰田首次被陪审团认定对意外加速事故负责。双方决定在裁定惩罚性赔偿之前解决此案。丰田总共召回了 900 多万辆汽车，并支付了近 30 亿美元的和解金和与意外加速相关的罚款。

对软件来说，未来还会有更多糟糕的日子。重要的是，我们要更好地制造它，因为如果我们不这样做，随着软件变得更加复杂和互联——随着它控制更多的关键功能——那些日子可能会变得更糟。

问题是程序员很难跟上他们自己的创作。自 20 世纪 80 年代以来，程序员的工作方式和他们使用的工具几乎没有什么变化。有一个人数不多但越来越多的群体担心现状是不可持续的。“即使是非常优秀的程序员也很难理解他们正在使用的系统，”克里斯·格兰杰(Chris Granger)说，他是一名软件开发人员，曾在微软担任 Visual Studio 的负责人，Visual Studio 是一种 IDE，每年售价 1199 美元，近三分之一的专业程序员使用它。他告诉我，当他在微软时，他安排了一次对 Visual Studio 的端到端研究，这是唯一一次这样的研究。在一个半月的时间里，他在单向镜后面观察人们写代码。“他们如何使用工具？他们是怎么想的？”他说。“他们如何坐在电脑前，他们触摸鼠标吗，他们不触摸鼠标吗？所有这些我们认为是教条的东西，我们实际上并没有进行实证检验。”

这些发现令他吃惊。“Visual Studio 是世界上最大的软件之一，”他说。“超过 5500 万行代码。我在这项研究中发现的一件事是超过 98%的内容是完全不相关的。所有这些工作都投入到这件事情中，但它忽略了人们面临的根本问题。我从中学到的最大的一点是，基本上*人们在他们的头脑中玩电脑*。”程序员就像试图蒙着眼睛下棋的棋手——他们花费了太多的精力去想象棋子在哪里，以至于几乎没有时间去思考游戏本身。

<aside class="ArticlePullquote_root__YtnHv">Computers had doubled in power every 18 months for the last 40 years. Why hadn’t programming changed?</aside>

约翰·瑞西格在他的学生中也注意到了同样的事情。Resig 是一名著名的 JavaScript 程序员，他编写的软件为超过一半的网站提供支持，他还是在线教育网站 Khan Academy 的技术负责人。2012 年初，他一直在努力学习该网站的计算机科学课程。为什么学习编程这么难？本质问题似乎是代码太抽象了。写软件不像用冰棒做一座桥，在那里你可以看到棍子，摸到胶水。为了“制作”一个程序，你输入单词。当你想改变程序的行为时，不管是一个游戏，一个网站，还是一个物理模拟，你实际上改变的是文本。因此，表现好的学生——事实上是唯一幸存下来的学生——是那些能够在脑海中一次一条指令地浏览文本，像计算机一样思考，试图跟踪每个中间计算的学生。瑞西格和格兰杰一样，开始怀疑是否必须如此。在过去的 40 年里，计算机的能力每 18 个月就翻一番。为什么编程没有改变？

事实上，他们两个同时用同样的术语思考同样的问题，这不是巧合。他们都刚刚看过计算机研究员 Bret Victor 在蒙特利尔酒店给一群软件工程学生做的同样精彩的演讲。这个演讲在 2012 年 2 月被发布到网上后迅速走红，它似乎提出了两个大胆的主张。首先，我们制作软件的方式从根本上被打破了。第二是维克多知道如何修理它。

B ret Victor 确实不喜欢写代码。“这听起来很奇怪，”他说。“当我想做一件东西时，特别是当我想用软件创造一些东西时，我必须克服这种最初的厌恶感，在这种情况下，我不是在操纵我想做的东西，而是在文本编辑器中写一堆文本。”

"人们强烈认为这是错误的做事方式。"

维克多有戴维·福斯特·华莱士的风度，在羞怯的外表下有着闪电般的智力。他今年 40 岁，头发花白，留着稀疏的胡须。他的声音很温和，几乎是悲伤的，但他想分享他的想法，当他开始滚动时，他似乎会跳过音节，仿佛摆脱了他自己的发声机制。

尽管他经营着一个研究计算未来的实验室，但他似乎对技术本身不感兴趣，而更感兴趣的是使用技术的人的想法。像任何一个优秀的工具制造者一样，他有一种看待世界的方式，这种方式是技术和人文并重的。他以全班第一名的成绩从加州理工学院电气工程专业毕业，然后从加州大学伯克利分校的研究生院毕业后，继续在一家开发音乐合成器的公司工作。这是一个与他的双重人格完全匹配的问题:他可以花同样多的时间思考表演者用键盘创作音乐的方式——键盘成为他们手的延伸的方式——就像他可以花同样多的时间思考数字信号处理的数学一样。

当他发表那个让他出名的演讲时，也就是瑞西格和格兰杰在 2012 年初看到的那个，维克多终于找到了似乎贯穿他所有作品的原则。(他实际上称这个演讲为“原则上的发明”)原则是这样的:“创作者需要与他们所创作的东西有直接的联系。”编程的问题在于它违背了原则。这就是为什么软件系统如此难以想象，并且漏洞百出:程序员盯着一页文本，从他们实际制作的东西中抽象出来。

“我们目前对计算机程序的概念，”他说，“直接来源于 50 年代后期的 Fortran 和 ALGOL。那些语言是为穿孔卡片设计的。“代码现在在屏幕上以字母的形式出现在 C 或 Java(Fortran 和 ALGOL 的衍生物)等语言中，而不是一堆有孔的卡片，这并没有减少代码的死性和间接性。

<aside class="ArticlePullquote_root__YtnHv">To Victor, the idea that people were trying to understand cancer by staring at a text editor was appalling.</aside>

这与文字处理有相似之处。过去，在编写文档的程序中，你只能看到文本本身，要改变布局、字体或页边空白，你必须编写特殊的“控制代码”，或者告诉计算机的命令，比如，“这部分文本应该用斜体。”问题是，在你打印文档之前，你看不到这些代码的效果。很难预测你会得到什么。你必须想象计算机将如何解释这些代码——也就是说，你必须在脑子里玩计算机游戏。

然后 WYSIWYG(发音为“wizzywig”)出现了。它代表“所见即所得”当你用斜体字标记一个段落时，字母就在屏幕上倾斜。如果你想改变页边空白，你可以拖动屏幕顶部的标尺，然后*查看*改变的效果。因此，这份文件感觉像是真实的东西，你可以戳戳它。只要看一眼，你就能知道自己是否做错了什么。对一个复杂系统的控制——文档的布局和格式引擎——使得任何人都可以在页面上点击。

Victor 的观点是编程本身应该是这样的。对他来说，人们盯着文本编辑器做重要的工作，比如设计自适应巡航控制系统或试图了解癌症，这种想法令人震惊。程序员的职责就是确保有一天他们不必这么做。

有足够的先例表明这不是一个疯狂的想法。例如，Photoshop 将强大的图像处理算法交给了那些可能甚至不知道算法是什么的人。这是一个复杂的软件，但复杂的方式是一个好的合成器是复杂的，有旋钮，按钮和滑块，用户可以像学习乐器一样演奏。Squarespace 是一家以在播客上大肆宣传而闻名的公司，它开发了一种工具，让用户通过点击来建立网站，而不是用 HTML 和 CSS 编写代码。它足够强大，可以完成曾经由专业网页设计师完成的工作。

但这些只是一小部分例子。压倒一切的现实是，当有人想用计算机做一些有趣的事情时，他们必须编写代码。Victor 是一个理想主义者，他不认为这是一个机会，而是程序员普遍的道德失败。他的讲话是战斗的号召。

它的核心是一系列演示，试图展示对于各种问题(电路设计、计算机动画、调试算法)可用的工具是多么原始，以及更好的工具可能是什么样子。他的演示很精彩。具有讽刺意味的是，最能激发每个人想象力的，从表面上看却是最微不足道的。它显示了一个分屏，一边是一个看起来像马里奥的游戏，另一边是控制它的代码。随着维克多更改代码，游戏世界的事情也发生了变化:他减少了一个数字，重力的强度，马里奥这个角色漂浮起来；他增加了另一个，玩家的速度，马里奥在屏幕上飞奔。

假设你想设计一个关卡，让马里奥从一只乌龟身上跳下来，然后进入一个小通道。游戏程序员习惯于分两个阶段解决这种问题:首先，你盯着你的代码——控制马里奥跳多高、跑多快、乌龟的背有多有弹性的代码——并在你的文本编辑器中对其进行一些修改，利用你的想象力来预测它们会产生什么影响。然后，你可以重放游戏，看看到底发生了什么。

<video autoplay="autoplay" loop="loop" muted="muted" playsinline="playsinline" poster="https://cdn.theatlantic.com/assets/media/files/videos/screen_shot_2017-09-20_at_10.09.49_am.jpg" webkit-playsinline="webkit-playsinline"><source src="https://cdn.theatlantic.com/assets/media/files/videos/bret-victor-inventing-on-principle.mp4"> Shadow Marios move on the left half of a screen as a mouse drags sliders on the right half.</video>

[CUSEC / Vimeo](https://vimeo.com/36579366)



维克多想要更直接的东西。“如果你有一个时间过程，”他说，指的是马里奥通过关卡的路径，“你想立即看到变化，你必须将时间映射到空间。”他按了一个按钮，不仅显示马里奥现在在哪里，还显示他在未来的每一个时刻会在哪里:影子马里奥的曲线延伸到远处。更重要的是，这个投影路径是反应式的:当维克多改变游戏的参数时，现在可以通过快速拖动鼠标来控制，路径的形状也随之改变。这就像是从上帝的角度看比赛。整个问题已经被简化为使用不同的参数，就像调整立体声接收器的音量一样，直到你让 Mario 来穿线。有了正确的接口，就好像你根本不用编写代码一样；你直接操纵了游戏的行为。

当观众第一次看到这一幕时，他们简直要窒息了。他们知道他们看到的不是一个孩子的游戏，而是他们行业的未来。大多数软件都包含随着时间推移以复杂的方式展现的行为，Victor 已经证明，如果你有足够的想象力，你可以发现并改变这种行为，就像在你手中玩一样。一位看过演讲的程序员后来写道:“突然间，我所有的工具都感觉过时了。”

当 John Resig 看到“发明原理”的演讲时，他放弃了在可汗学院学习编程课程的计划。他希望网站的编程练习能像 Victor 的演示一样工作。左边是代码，右边是正在运行的程序:图片、游戏或模拟。如果你改变代码，它会立即改变图片。“在一个真正有反应的环境中，”Resig 写道，“你可以完全改变学生学习的模式...[他们]现在可以立即看到结果，并直观地了解底层系统的内在工作方式，而无需遵循明确的解释。”可汗学院可能已经成为世界上最大的计算机编程班，平均每月有 100 万学生积极使用这个程序。

曾在微软 Visual Studio 工作过的 Chris Granger 同样受到了启发。2012 年 1 月，在看了 Victor 的演讲视频后的几天内，他构建了一个新编程环境的原型。它的关键功能是它会给你程序行为的即时反馈。你可以在控制它的代码旁边看到你的系统在做什么。就像摘下眼罩一样。格兰杰称这个项目为“光桌”

2012 年 4 月，他在 Kickstarter 上为 Light Table 寻求资金。在编程界，这是一个轰动。一个月内，该项目筹集了 20 多万美元。这些想法传播开来。*活跃度*的概念，即能够立即看到数据流过你的程序，进入了谷歌和苹果提供的旗舰编程工具。制作新的 iPhone 和 Mac 应用程序的默认语言称为 Swift，由苹果从头开始开发，以支持一种称为 Playgrounds 的环境，这种环境的灵感直接来自 Light Table。

但是看到他的演讲最终产生的影响，Bret Victor 大失所望。“很多事情看起来都是对我所说内容的曲解，”他后来说。当人们开始邀请他参加会议，谈论编程工具时，他知道有些事情不对劲。“每个人都认为我对编程环境感兴趣，”他说。实际上，他对人们如何看待和理解系统很感兴趣——用他的话说，是“动态行为的视觉表现”尽管代码越来越成为*创造*动态行为的首选工具，但它仍然是理解它的最差工具之一。“按原则发明”的目的是为了表明，通过在系统行为和代码之间建立直接的联系，可以缓解这个问题。

<aside class="ArticlePullquote_root__YtnHv">“I’m not sure that programming has to exist at all.”</aside>

在后来的两次演讲中，“停止画死鱼”和“画动态可视化”，维克多走得更远。他演示了自己开发的两个程序——第一个是为动画师设计的，第二个是为试图可视化他们的数据的科学家设计的——每一个程序都需要编写大量的自定义代码，并简化为在所见即所得的界面中运行。Victor 认为，同样的技巧可以应用于当今几乎所有编写代码的问题。“我不确定编程是否必须存在，”他告诉我。“或者至少是软件开发人员。”在他看来，软件开发人员的正确角色是创建工具，消除对软件开发人员的需求。只有这样，有最紧迫计算问题的人才能直接理解这些问题，而不需要中间的代码。

当然，要做到这一点，你必须让程序员自己参与进来。在最近的一篇文章中，维克多恳求专业软件开发人员停止将他们的才华投入到构建 Snapchat 和优步等应用的工具中。“日常生活的不便并不是大问题，”他写道。相反，他们应该关注科学家和工程师——就像他对我说的那样，“这些人正在做真正重要的工作，非常重要的工作，并且使用非常非常糟糕的工具。”他写道，这类令人兴奋的工作，尤其是一类用于“基于模型的设计”的工具，已经进行了很多年，但大多数程序员对此一无所知。

“如果你真的仔细看看你所拥有的、你正在使用的、公司正在使用的所有工业产品，你在里面唯一的非工业产品就是代码。”Eric Bantégnie 是 Esterel Technologies(现归 ANSYS 所有)的创始人，该公司是一家法国公司，生产用于构建安全关键软件的工具。像 Victor 一样，Bantégnie 认为工程师不应该通过在 IDE 中键入数百万行代码来开发大型系统。“没有人会手工制造汽车，”他说。“在许多地方，代码仍然是手工制品。当你手工制作 10，000 行代码时，这没问题。但你的系统有 3000 万行代码，比如空客，或者 1 亿行代码，比如你的特斯拉或高端汽车——这变得非常非常复杂。”

Bantégnie 的公司是基于模型设计的工业应用的先驱之一，在这种设计中，你不再直接编写代码。相反，你创建一种流程图，描述你的程序应该遵循的规则(“模型”)，计算机根据这些规则为你生成代码。例如，如果你正在为一部电梯制作控制系统，一个规则可能是当门打开时，有人按下大厅的按钮，你应该关上门并开始移动轿厢。在基于模型的设计工具中，你可以用一个小图来表示这个规则，就像在白板上画出逻辑一样，由代表不同状态的方框组成，比如“门开着”、“移动着”和“门关着”，以及定义如何从一种状态进入另一种状态的线条。这些图表使系统的规则变得显而易见:只要看一眼，你就能看出让电梯运行的唯一方法是关门，或者说让门打开的唯一方法是停下来。

<aside class="ArticlePullquote_root__YtnHv">“The people know how to code. The problem is *what* to code.”</aside>

不太像 Photoshop。当然，Photoshop 的美妙之处在于你在屏幕上处理的图片是最终产品。相比之下，在基于模型的设计中，屏幕上的图片更像是蓝图。尽管如此，用这种方式制作软件与传统编程有本质的不同。在传统编程中，你的任务是把复杂的规则翻译成代码；你的大部分精力都花在了翻译上，而不是考虑规则本身。在基于模型的方法中，你*所拥有的*就是规则。这就是你花时间思考的问题。这是一种少关注机器，多关注你试图让它解决的问题的方式。

“一般来说，软件编码的主要问题——我自己就是一名程序员,”Bantégnie 说，“不是程序员的技能。人们知道如何编码。问题是*用什么*来编码。因为大多数需求都是自然语言，含糊不清，而且需求从来都不是非常精确的，所以负责编码的人通常会有不同的理解。”

从这个角度来看，软件变得难以驾驭，因为描述软件应该做什么的媒体——对话、散文描述、一张纸上的图画——与描述软件做什么的媒体——即代码本身——太不一样了。从一个到另一个失去了太多。基于模型的设计背后的想法是缩小差距。完全相同的模型被系统设计者用来表达他们想要的东西，也被计算机用来自动生成代码。

当然，要使这种方法成功，许多工作必须在项目开始之前就做好。有人首先必须建立一个工具来开发对人来说自然的模型——感觉就像他们自己做的笔记和图画——同时还足够明确，让计算机能够理解。他们必须编写一个程序，将这些模型转化为真正的代码。最后，他们必须证明生成的代码将总是做它应该做的事情。“幸运的是，我们受益于 20 年的初始背景工作，”Bantégnie 说。

Esterel Technologies 于 2012 年被 ANSYS 收购，它是法国核能和航空航天行业在 20 世纪 80 年代开始的研究的产物，这些行业担心随着安全关键代码的复杂性不断膨胀，越来越难保持代码没有错误。“我开始于 1988 年，”法国战斗机和商务飞机制造商达索航空公司的科学研究负责人伊曼纽尔·莱迪诺说。“当时，我正在研究军用航空电子系统。负责系统集成和调试的人注意到错误的数量在增加。”80 年代，飞机上的机载电脑数量激增。不再只有一台飞行计算机，现在有几十台，每台负责与控制、导航和通信相关的高度专业化的任务。当数据从传感器涌入，飞行员输入命令时，协调这些系统来驾驶飞机，这需要完美的时间反应交响乐。“在正确的时间以正确的顺序处理数百甚至数千个可能的事件，”莱迪诺说，“被诊断为错误膨胀的主要原因。”

Ledinot 认为手工编写如此复杂的代码是不可持续的。很难理解它在做什么，也几乎不可能验证它是否能正常工作。他去寻找新的东西。“你必须明白，在这样一个过程中，更换工具是极其昂贵的，”他在一次谈话中说。"除非走投无路，否则你不会做出这种决定。"

<aside class="ArticlePullquote_root__YtnHv">Most programmers *like* code. At least they understand it.</aside>

他开始与法国计算研究中心 INRIA 的计算机科学家 Gerard Berry 合作开发一款名为 Esterel 的工具，Esterel 是法语“实时”的缩写 Esterel 背后的想法是，虽然传统的编程语言可能适合描述以预定顺序发生的简单程序，如食谱，但如果你试图在系统中使用它们，其中许多事件可能在几乎任何时间以几乎任何顺序发生，如在飞机驾驶舱中，你不可避免地会陷入混乱。控制软件的混乱是危险的。在一篇论文中，Berry 甚至预测“低级编程技术对于大型安全关键程序来说将不再是可接受的，因为它们使得行为理解和分析几乎不可行。”

Esterel 被设计成让计算机为你处理这种复杂性。这是基于模型的方法的承诺:您创建了一个系统行为的模型，而不是编写普通的编程代码——在这种情况下，该模型专注于如何处理单个事件，如何区分事件的优先级，哪些事件依赖于哪些其他事件，等等。该模型成为计算机用来进行实际编程的详细蓝图。

莱迪诺和贝里工作了近 10 年，让埃斯特尔可以用于生产。“在 2002 年，我们拥有了第一个具有自动代码生成功能的操作软件建模环境，”莱迪诺告诉我，“以及“阵风”战斗机中的第一个嵌入式模块。”如今，ANSYS SCADE 产品系列(用于“安全关键应用开发环境”)被航空航天和国防工业、核电厂、运输系统、重工业和医疗设备领域的公司用来生成代码。“我最初的梦想是在世界上的每一架飞机上都有 SCADE 生成的代码，”埃斯特尔科技公司的创始人 Bantégnie 说，“我们离这个目标不远了。”空客 A380 上几乎所有的安全关键代码，包括控制飞机飞行表面的系统，都是用 ANSYS SCADE 产品生成的。

对客户(尤其是航空业的客户)的部分吸引力在于，尽管手工构建高度可靠的软件是可能的，但这可能是一项艰巨的工作。Ravi Shivappa 是 Meggitt PLC 的集团软件工程副总裁，Meggitt PLC 是 ANSYS 的客户，为飞机制造组件，如发动机的气动火灾探测器，他解释说，传统的项目从大量的英文需求文档开始，这些文档规定了软件应该做的一切。(要求可能是这样的，“当这个部分的压力上升到阈值以上时，打开安全阀，除非手动超控开关打开。”)以这种方式描述需求的问题是，当您用代码实现它们时，您必须煞费苦心地检查每一个需求是否得到满足。当客户更改需求时，代码也必须更改，并进行广泛的测试，以确保在此过程中没有任何其他问题被破坏。

严格的监管标准增加了成本。联邦航空局对软件安全非常狂热。该机构要求一个安全关键软件的每个需求都可以追溯到实现它的代码行，反之亦然。所以每一行代码发生变化，都必须追溯到设计文档中相应的需求，并且您必须能够证明代码实际上满足了需求。这个想法是，如果出了问题，你能够找出原因；这种实践为大型代码库带来了秩序和责任。但是，Shivappa 说，“这是一个非常劳动密集型的过程。”他估计，在他们使用基于模型的设计之前，在一个为期两年的项目中，只有两到三个月花在编写代码上，其余的时间都花在文档上。

<aside class="ArticlePullquote_root__YtnHv">We already know how to make complex software reliable, but in so many places, we’re choosing not to.</aside>

正如 Bantégnie 解释的那样，让计算机而不是人类将你的需求转化为代码的美妙之处在于，你可以确信——事实上你可以用数学方法证明——生成的代码确实满足这些需求。基于模型的方法的大部分好处来自于能够动态地添加需求，同时仍然确保满足现有的需求；随着每一个变化，计算机可以验证你的程序仍然工作。你可以自由调整你的蓝图，而不用担心引入新的错误。用联邦航空局的话来说，你的代码是“结构正确”

尽管如此，大多数软件，即使是在安全至上的航空领域，都是以老式的方式制作的，工程师用散文编写需求，程序员用 c 之类的编程语言编写需求。Bret Victor 在他的文章中明确指出，基于模型的设计相对不常见。“联邦航空局的很多人认为代码生成很神奇，因此呼吁进行更严格的审查，”Shivappa 告诉我。

大多数程序员都有同感。他们*喜欢*代码。至少他们明白。使用“有限状态机”和“递归系统”的数学方法为您编写代码并验证其正确性的工具听起来很深奥，很难使用，甚至好得令人难以置信。

这种模式以前已经出现过。每当编程离写字面上的 1 和 0 又进了一步，最大的反对声音来自程序员。参与阿波罗计划的著名软件工程师玛格丽特·哈米尔顿——实际上是“软件工程”一词的创造者——告诉我，1964 年，她在麻省理工学院德雷珀实验室的第一年，她记得在一次会议上，一个派别与另一个派别就从“某种非常低级的机器语言”过渡到“汇编语言”的问题进行了争论“最底层的人在为保住它而斗争。论点是如此的相似:“我们怎么知道汇编语言会做得对？”"

“站在一边的人脸红了，他们开始尖叫，”她说。她说她“惊讶于他们变得如此情绪化。”

<aside class="ArticlePullquote_root__YtnHv">You could do all the testing you wanted and you’d never find all the bugs.</aside>

达索航空公司的 Emmanuel Ledinot 指出，当汇编语言本身被淘汰，取而代之的是今天仍然流行的编程语言，如 C，这一次是汇编程序员持怀疑态度。他说，难怪“人们不那么容易过渡到基于模型的软件开发:他们认为这是另一个失去控制的机会，甚至比他们已经失去的还要多。”

对基于模型的设计的偏见，有时被称为模型驱动工程，或 MDE，事实上是如此根深蒂固，根据最近的一篇论文，“一些人甚至认为调查人们对 MDE 的看法比研究新的 MDE 技术更有必要。”

这听起来几乎像一个笑话，但是对于基于模型的方法的支持者来说，这是一个重要的观点:我们已经知道如何使复杂的软件可靠，但是在很多地方，我们选择不这样做。为什么？

2011 年，Chris Newcombe 已经在亚马逊工作了将近七年，并被提升为首席工程师。他曾参与该公司一些最关键的系统，包括零售产品目录和管理全球每台 Kindle 设备的基础设施。他是备受推崇的亚马逊网络服务团队的领导者，该团队为网飞、Pinterest 和 Reddit 等网络巨头维护云服务器。在亚马逊之前，他帮助建立了世界上最大的在线游戏服务 Steam 的主干。他是那些默默工作保持互联网运行的工程师之一。他从事的产品被认为是巨大的成功。但他所能想到的是，那些系统的设计中深埋着等待发生的灾难。

他在一篇论文中写道:“在每秒百万次请求规模的系统中，人类直觉很难估计所谓‘极其罕见’的事件组合的真实概率。”。“人类的易错性意味着一些更微妙、更危险的错误被证明是设计上的错误；代码忠实地实现了预期的设计，但该设计未能正确处理特定的‘罕见’场景。”

纽科姆确信，真正关键系统背后的算法——例如，存储大量网络数据的系统——不仅应该是好的，而且应该是完美的。一个细微的错误都可能是灾难性的。但是他知道找到漏洞有多难，尤其是当算法变得越来越复杂的时候。你可以做所有你想做的测试，但你永远也找不到。

<aside class="ArticlePullquote_root__YtnHv">“Few programmers write even a rough sketch of what their programs will do before they start coding.”</aside>

这就是为什么当他在一篇论文的附录中看到数学和代码的奇怪混合物——或者看起来像代码的东西——描述了一种叫做“TLA+”的算法时，他如此感兴趣令人惊讶的是，这种描述据说在数学上是精确的:用 TLA+编写的算法原则上可以被证明是正确的。在实践中，它允许你为你的问题创建一个现实的模型，并且不仅仅是彻底地测试它，而是彻底地*。这正是他一直在寻找的:一种编写完美算法的语言。*

*TLA+代表“动作的时序逻辑”，在精神上类似于基于模型的设计:它是一种写下计算机程序需求的语言——TLA+称之为“规范”。这些规格可以完全由计算机来验证。也就是说，在您编写任何代码之前，您需要编写一个程序逻辑的简明大纲，以及您需要它满足的约束条件(比如，如果您正在编写一个 ATM 程序，一个约束条件可能是您永远不能从您的支票帐户中两次提取相同的钱)。TLA+然后彻底检查你的逻辑，事实上，满足这些约束。如果没有，它会告诉你它们是如何被违反的。*

*这种语言是由获得图灵奖的计算机科学家莱斯利·兰波特发明的。兰伯特留着大胡子和蓬乱的白发，戴着大眼镜，有一双和善的眼睛，看起来他可能是美国霍格沃茨最友好的教授之一。现在在微软研究院，他被认为是“分布式系统”理论的先驱之一，该理论描述了由相互通信的多个部分组成的任何计算机系统。Lamport 的工作为许多支持现代网络的系统奠定了基础。*

*对于 Lamport 来说，今天的软件充满 bug 的一个主要原因是程序员直接开始写代码。他在一篇文章中写道:“建筑师在砌砖或钉钉子之前会绘制详细的平面图。”"但是很少有程序员在开始编码之前写下他们的程序将要做什么的草图."程序员被编码的本质所吸引，因为代码是程序运行的动力；花时间在其他事情上看起来会让人分心。从破解代码的微观机制中可以获得一种耐心的快乐，一种沉思的满足感。但是兰波特认为，代码从来就不是用来作为思考的媒介。“当你用编程语言思考时，它确实会限制你的思考能力，”他说。代码让你只见树木不见森林:它把你的注意力吸引到单个部分的工作上，而不是你的程序如何组合在一起，或者它应该做什么——以及它是否真的如你所想。这就是为什么兰波特创造了 TLA+。与基于模型的设计一样，TLA+将你的注意力吸引到系统的高层结构，它的基本逻辑，而不是实现它的代码。*

*纽科姆和他在亚马逊的同事将继续使用 TLA+在主要系统中寻找微妙的关键漏洞，包括 S3 背后的核心算法漏洞，这可能是世界上最可靠的存储引擎。它现在在公司里被广泛使用。在使用过 TLA+的小宇宙中，他们的成功并不罕见。微软的一名实习生使用 TLA+发现了一个可能导致世界上所有 Xbox 在使用四个小时后崩溃的漏洞。欧洲航天局的工程师用它重写了一个探测器的操作系统，代码减少了 10 倍，该探测器是第一个软着陆彗星的探测器。英特尔经常用它来验证其芯片。*

*但是 TLA+只占据了主流的一个很小很远的角落，如果可以说它占据了那里的任何空间的话。即使对于像纽科姆这样经验丰富的工程师来说，这种语言起初读起来也是怪异和深奥的——一个符号的动物园。对兰波特来说，这是教育的失败。尽管编程诞生于数学，但它已经在很大程度上脱离了数学。大多数程序员都不太精通 TLA+需要用到的数学——主要是逻辑和集合论。“很少有程序员——包括很少的编程老师——理解最基本的概念以及它们在实践中的应用。他们似乎认为他们需要的只是代码，”兰波特说。“认为在比代码更高的层次上，你需要能够精确地思考，而数学实际上允许你精确地思考，这种想法完全是外来的。因为他们从来没学过。”*

<aside class="ArticlePullquote_root__YtnHv">*“I hope people won’t be allowed to write programs if they don’t understand these simple things.”*</aside>

*Lamport 认为这种无法从数学角度思考他们正在做的事情的现象是现代软件开发的一个简单问题:风险在不断上升，但程序员没有进步——他们没有发展出处理日益复杂的问题所需的能力。“在 15 世纪，”他说，“人们过去常常在不懂微积分的情况下建造大教堂，而现在我认为你不会允许任何不懂微积分的人建造大教堂。我希望经过一段适当长的时间后，如果人们不理解这些简单的事情，就不会被允许编写程序。”*

*纽科姆并不确定是程序员应该受到责备。“我听莱斯利说过，他认为程序员害怕数学。我发现程序员没有意识到——或者不相信——数学可以帮助他们处理复杂性。复杂性是程序员面临的最大挑战。”他说，让人们使用 TLA+的真正问题是让他们相信这不会浪费他们的时间。作为一个物种，程序员总是非常务实。像 TLA+这样的工具散发着象牙塔的气味。当程序员遇到“正式方法”(之所以这么叫是因为它们涉及数学的，“正式的”精确的程序描述)，他们根深蒂固的本能是退缩。*

*大部分在大学学过计算机科学的程序员都短暂地遇到过形式化方法。通常它们是在一些琐碎的事情上演示的，比如从零开始计数的程序；学生的工作是从数学上证明程序确实从零开始计数。*

*“我需要改变人们对正式方法的看法，”纽科姆告诉我。甚至 Lamport 自己似乎也没有完全理解这一点:形式方法有一个形象问题。解决问题的方法不是恳求程序员改变——而是改变你自己。Newcombe 意识到，要将像 TLA+这样的工具带入编程主流，你必须开始说他们的语言。*

*首先，他说，当他向亚马逊的同事介绍 TLA+时，他会避免告诉他们它代表什么，因为他担心这个名字会让它看起来不必要的令人生畏:“行动的时序逻辑”完全是一种在学术界很流行的高调，但会让大多数执业程序员望而却步。他还尽量不使用“正式”、“验证”或“证明”这些术语，这些术语会让程序员想起乏味的课堂练习。相反，他将 TLA+呈现为一种新的“伪代码”，一种真正代码的垫脚石，允许你详尽地测试你的算法——并让你在设计过程的早期就准确地思考。“工程师考虑的是调试，而不是‘验证’，”他写道，因此他将自己关于这个主题的内部谈话命名为“调试设计”纽科姆没有哀叹程序员用代码看世界，而是欣然接受了这一事实。他知道否则他会失去他们。纽科姆说:“很多人都说，‘现在我明白了。’。*

<aside class="ArticlePullquote_root__YtnHv">*This code has created a level of complexity that is entirely new. And it has made possible a new kind of failure.*</aside>

*从那以后，他离开了亚马逊，去了甲骨文公司，在那里，他能够说服他的新同事尝试一下 TLA+。对他来说，使用这些工具现在是一种责任。“我们需要在这方面做得更好，”他说。*

*“我是自学的，从九岁起就开始编程，所以我的直觉是开始编程。那是我唯一的——那是我的思考方式:你会勾画一些东西，尝试一些东西，你会有机地发展它。”在他看来，这是今天许多程序员仍然在做的事情。“他们谷歌，他们看 Stack Overflow”(一个受欢迎的网站，程序员在那里回答彼此的技术问题)“他们得到代码片段来解决他们在这个小功能中的战术问题，他们把它粘在一起，然后迭代。”*

*"这完全没问题，除非你遇到真正的问题."*

*2015 年夏天，美国安全研究人员查理·米勒和克里斯·瓦拉塞克确信汽车制造商没有认真对待软件缺陷，他们展示了一辆 2014 款吉普切诺基可能被黑客远程控制。他们利用了这一事实，即汽车的娱乐系统具有蜂窝连接(例如，你可以用 iPhone 启动汽车)，连接到更多的中央系统，如控制挡风玻璃雨刷、转向、加速和刹车的系统(例如，当你转动方向盘时，你可以在后视屏幕上看到回应的指南)。作为他们在晚上和周末发动的攻击的证据，他们在一名记者在高速公路上驾驶米勒的车时侵入了他的车，并使它失控；这位记者知道将要发生什么，当他们切断引擎时，他惊慌失措，迫使他在一段没有肩膀可逃的路上缓慢爬行。*

*虽然他们实际上没有创造出一个，但他们表明，有可能编写一个聪明的软件，一个“车辆蠕虫”，它将使用被黑客攻击的吉普切诺基的车载计算机来扫描和攻击其他人；如果他们想的话，他们可以同时访问全国范围内的易受攻击的汽车和 SUV。(至少有五款菲亚特克莱斯勒车型受到影响，包括吉普切诺基。)有一天，他们可以告诉他们所有人，比如说，突然左转或高速关闭发动机。*

*“我们需要以不同的方式思考软件，”瓦拉塞克告诉我。汽车公司长期以来一直用数百家不同供应商生产的零件组装他们的最终产品。但是那些部分曾经是纯机械的，而现在，它们常常带有数百万行代码。虽然其中一些代码——用于自适应巡航控制、自动制动和车道辅助——确实让汽车变得更加安全(“我的吉普车上的安全功能已经救我无数次，”米勒说)，但它也创造了一个全新的复杂程度。这使得一种新的失败成为可能。*

<aside class="ArticlePullquote_root__YtnHv">*In the world of the self-driving car, software can’t be an afterthought.*</aside>

*“汽车里有很多窃听器，”埃斯特尔背后的法国研究员杰拉德·贝里在一次谈话中说。“这不像航空电子设备，在航空电子设备中，这一点非常重要。众所周知，软件不同于机械。”汽车行业可能是那些还没有意识到他们实际上是在软件行业的行业之一。*

*“在汽车制造业中，我们没有一个知道自己在做什么的软件安全监管机构，”在丰田案中作证的软件专家迈克尔·巴尔说。他说，NHTSA“只有有限的软件专业知识。他们是从机械历史中得出这个结论的。”让基于模型的设计和代码生成对航空业具有吸引力的监管压力，在汽车制造业来得更慢。达索航空公司的 Emmanuel Ledinot 推测这种差异也可能有经济原因。汽车制造商根本无法承担一个部件哪怕几分钱的价格上涨，因为它要乘以数百万倍；因此，嵌入汽车的计算机必须被精简到最低限度，只有很小的空间来运行没有被手工调整到尽可能精简的代码。“我认为，在过去的十年里，引入基于模型的软件开发对他们来说成本太高了。”*

*有人怀疑动机正在改变。“我认为自动驾驶汽车可能会推动他们，”莱迪诺告诉我，“ISO 26262 和自动驾驶汽车可能会慢慢推动他们在关键部件上采用这种方法。”(ISO 26262 是 2011 年发布的汽车安全标准。)巴尔说了大致相同的话:在自动驾驶汽车的世界里，软件不能是事后想起的东西。它不能像今天的机票预订系统或 911 系统或股票交易系统那样构建。代码将在路上负责上亿人的生活，它必须工作。这不是一项小任务。*

*“计算从根本上是看不见的，”杰拉德·贝里在他的演讲中说。“当你的轮胎瘪了，你看看你的轮胎，它们瘪了。当你的软件坏了，你看着你的软件，你什么也看不见。”*

*“所以这是一个大问题。”*

* * *

*<small>[*](#Key%20Tasks) *这篇文章原本是说丰田凯美瑞有一千万种方法导致意外加速。我们对这个错误感到抱歉。*</small>*

