# 原力中的巨大扰动...

> 原文:[https://www . beat worm . co . uk/blog/internet/IMD b-boards-no-more？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://www.beatworm.co.uk/blog/internet/imdb-boards-no-more?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

## ...仿佛数以百万计的声音突然惊恐地呼喊，又突然沉寂。我担心发生了可怕的事情。

<small>[下载这篇文章的 EPub 版本](https://my.mixtape.moe/xjrcjb.epub)redditor[agonnaz](https://www.reddit.com/user/agonnaz)T5】</small>

<small>**更新:** [我以前的同事马蒂亚斯](http://willerup.com/imdb.html)写下了他对自己在这个故事中的角色的想法</small>

![scribbled design notes](../Images/a55698913144845d1feecc905c6f43c6.png "The last page of notes about a boards meeting that survives in my old filofax")

周五的某个时候， [IMDb 宣布](https://www.imdb.com/board/announcement)他们打算永久关闭他们的留言板系统。我不觉得这是一个特别令人惊讶的决定。我更惊讶的是，留言板在 2017 年还在那里，看起来在过去的十五年左右的时间里基本上没有什么变化。他们已经涂了几层油漆，并进行了一些功能改进，但他们似乎主要是由内部技术团队在本世纪初开发的相同系统设计支持的。在早期开发的大部分时间里，我是主要的开发人员。正如[多年来在我的主页](https://www.beatworm.co.uk/)上所说的，“你可以把留言板的事情归咎于我”。

### 很久以前，在一个遥远的星系里

2001 年底，我非常兴奋地被邀请加入 IMDb 开发团队。30 岁，已经有将近十年的专业软件开发经验。尽管 2001 年听起来像是现代网络的相对石器时代，当然在很多方面确实如此。那时，我已经在最初的网络热潮中花了几年时间开发基本的网络应用程序，我对 IMDb 感到敬畏，即使在当时，它也是一家颇为受人尊敬的互联网机构。它成立于 1990 年，因此比万维网的发明早了好几年，最初是通过 [USENET](https://en.wikipedia.org/wiki/Usenet) 帖子分享数据列表。当我加入的时候，他们拥有[亚马逊](https://amazon.com)已经几年了，并开始扩大团队。

当我开始的时候，他们正处于推出 IMDbPro 的风口浪尖，并有一个雄心勃勃的路线图，从内到外彻底重建主网站，使用小型开发团队从头开始构建的闪亮的新技术堆栈来支持 IMDbPro 应用服务器。我认为这是一个**非常**聪明的黑客——imdb.com 是一个非常受欢迎的网站，这种在相同的数据馈送(仍然基本上是格式化的文本列表，使用旧的基于 USENET 的工具的惯例)基础上向网站的订阅混音添加行业聚焦功能的方法意味着，实际上我们可以使用 pro 网站的小得多的用户群作为新技术的试验台，并逐渐将这一部分移植到高得吓人的“消费者”网站，而不必重写和重新启动。为了进一步增加交易的甜头，如果你看看这种安排，这意味着测试床用户将实际上支付新软件的费用，并帮助你消除错误。

2001 年，一个闪亮的新的高性能 web 栈意味着 [perl](https://perl.org/) 。 [Apache](https://httpd.apache.org/) 1.3.x 运行 [mod_perl](perl.apache.org) 更准确的说。如果您不知道 mod_perl 是什么，它是一个半混乱的天才，将 perl 语言解释器包装到 apache 模块中作为一个持久的运行时，并向它公开 HTTP 服务器的内部 API。这使您可以编写实际上是 apache 服务器的应用程序，直接访问 HTTP 服务生命周期的每个部分。此外，通过使用另一个简洁的工具， [Registry.pm](http://search.cpan.org/~gozer/mod_perl-1.31/lib/Apache/Registry.pm) 你可以使用被设计为作为 [CGI](https://www.oreilly.com/openbook/cgi/ch01_01.html) 脚本工作的模块或脚本，并且在不修改的情况下获得相同的速度提升。有了这些技术，您可以编写几乎和 Apache 一样快的 perl 应用程序，在 90 年代末/00 年代初，它是 this 或 PHP。我认为，那时的 PHP 相当糟糕，酷孩子都在用 perl。Perl 有库，擅长将 UNIX 的现有部分粘合在一起。这意味着您需要手动编写的应用程序要少得多。是的，通过*手*。让我深入研究一下

### 是照片变小了

那时编写 web 软件是一个相当不同的前景。在我的圈子里，我们真的没有太多的框架。有一些企业将你的大型 IBM、Oracle 和 Microsoft 客户机/服务器应用程序转换成某种可怕的内部网套件，这种套件需要 [ActiveX 支持](https://msdn.microsoft.com/en-us/library/aa751971(v=vs.85).aspx_)来加载任何页面，我也曾饶有兴趣地使用过 [Zope](http://www.zope.org) ，但总的来说，如果你在做任何有趣的事情，你会使用 FreeBSD 或 linux (2.2，支持 SMP！).

您最有可能使用 Apache 1.3，forking，并用某种 UNIX 脚本语言(通常是 perl，但任何常见的嫌疑都相对常见，包括真正的 shell 脚本)将您的站点编写为静态页面、服务器端模板和 CGI exec-d 程序的组合，或者您可能会用 c 编写二进制的性能关键型 CGI。

对于数据处理，你可以将你的应用程序直接连接到一个预先存在的公司 RDBMs，如果你有这样的东西，你的 DBA，如果你有这样的东西，让你，或者你可以在你的 web 主机上或附近部署一个 SQL db 通常是 [MySQL](http://mysql.org) 3.22，带有 [ISAM](https://en.wikipedia.org/wiki/ISAM) 和对外键支持的准宗教式不容忍，但这没问题，你可以在应用程序代码中进行所有的数据验证。([有点像 2017 年的 JavaScript 数据库](https://mongodb.com))

我们有用于常见任务的库，如解析有线协议和文件格式，以及包装实用程序来完成诸如生成图形或调整图形大小之类的事情，但您会以特定的方式将这些选择缝合在一起，以形成一个“系统”。一个典型的 web 堆栈是基于表格的 HTML，带有属性样式和*用于排版和间距*的内联图像，可能是预渲染的，但也可能是动态生成的，然后是一些用于用户管理的 CGI 脚本，其中充满了手工编码的 cookie 和会话跟踪。持久化的关系数据库，使用手工编码的 SQL 和定制的数据库模式。通过自己编写的模板系统生成页面，用内嵌条件将面向布局的 HTML 框架粘在变量插值周围。这一部分通常作为服务器端的 includes 运行，但有时也由 CGI 脚本处理。

也许在这之前您会有一个手工构建的文件系统缓存。*【前端】*那时通常会构建静态页面表示，首先在 [Photoshop](http://www.photoshop.com/) 或 [Illustrator](https://twitter.com/Illustrator) 中，然后在 [Dreamweaver](https://www.adobe.com/products/dreamweaver.html) 或 [FrontPage](https://en.wikipedia.org/wiki/Microsoft_FrontPage) 中转换为单个 HTML 页面母版，然后交给后端编码人员进行清理，并手工拆分成模板片段。单字节字符串编码，无线程，在内部数据结构上有一个面向对象的轻量级单板——你会有一个实际物理服务器的小集群，可能在一个数据中心，但通常在内部，有时在机架上，有时在角落里的实际塔式服务器，直接连接到一个容量少得可怜的互联网路由器。有时您的集群只有一台机器那么小。

从架构上来说，你需要一个网络服务器，如果你想把“沉重的”动态服务从较轻或静态的内容中分离出来，可能需要两个。您的数据库最终可能会有一个更好的 IO 和网络。如果你有足够多的 web 服务器，你可以在前面放置某种负载平衡器，也许是一个 HTTP 反向代理作为加速器缓存(通常是另一个 Apache，有时是 [Squid](http://squid-cache.org) )。在 2001 年，我不确定我是否完全理解了[CDN 甚至是](http://www.webopedia.com/TERM/C/CDN.html)是什么。你可以使用 [FTP](http://www.unix.com/man-page/Linux/1/ftp/) 或者 [rsync](https://rsync.samba.org/) 进行部署，有时生产文件系统通过 [NFS](https://www.freebsd.org/doc/handbook/network-nfs.html) 或者 SMB 进行本地挂载，你只需要复制一些东西，或者就地编辑。版本控制，如果你有任何可能只是重命名文件，也许 SCCS 或 RCS。高级用户可能有简历。设计师可能有一台[OS X 之前的 Macintosh](http://lowendmac.com/1998/wallstreet-powerbook-g3-series/) ，[套装会使用 Windows](https://www.amazon.co.uk/Microserfs-Novel-Douglas-Coupland-ebook/dp/B004W2YZ0I/) ，开发人员有更多免费的东西- [windows 2k](https://technet.microsoft.com/en-us/library/hh534433.aspx) ，[桌面 linux](http://www.slackware.com/) ，我用了几年[BeOS](https://www.youtube.com/watch?v=KlOi-L-N0X4)虽然那还是个东西，而且似乎**每个人**，但是*每个人*都使用 [emacs](https://www.gnu.org/software/emacs/) 来编写代码-gnt 有时[部署主机上的远程 XEmacs 客户机通过线路](http://x.cygwin.com/docs/ug/using-remote-apps.html)连接到本地 X11 服务器。疯狂的日子。

### 天啊，到处都是星星

这就是 2001 年的场景，当时我作为 SDE 加入了 Amazon.com 家族，在新的 IMDb 平台上工作。我是一个相当热门的 perl 程序员，花了几年时间设计和重写定制的 web“框架”并优化 mod_perl 架构。我真的很擅长 SQL，至少我认为与大多数同龄人相比是这样，而且我对当时有点不常见的 [PostgreSQL 数据库引擎](https://www.postgresql.org/)产生了特别的喜爱。我做过不少网络方面的事情——早期的企业内部网门户、[爱好网站](https://www.beatworm.co.uk)、[比较受欢迎的网络出版社](http://sift.com)，但这是向一个完全更大的联盟迈出的一步。

事实上，特别是当我事后回想时，我可以看到我对自己在做什么知之甚少，但几乎没有人知道。没有太多关于建筑的出版材料——每个人都阅读 [Greenspun](http://philip.greenspun.com/panda/) ,但是没有任何东西像现代技术网络、可扩展性色情、会议电路那样。没有 [HN](https://news.ycombinator.com) ，没有 [Reddit](https://programming.reddit.com) ，没有 [twitter](https://twitter.com/colinstrickland) ，没有脸书，而[在 StackOverflow](https://stackoverflow.com/user/cms) 上查找资料仍然是近十年后的事情。甚至很难找到有多少信息，你必须记住，谷歌几乎还不是一个东西。信息共享往往发生在邮件列表上，使用真实的电子邮件，或者仍然在 USENET 上。([保罗·格拉厄姆](http://idlewords.com/2005/04/dabblers_and_blowhards.htm)还没有写下“[垃圾邮件计划](http://www.paulgraham.com/spam.html)”，我们也没有真正的功能性自动垃圾邮件过滤)。

IMDb 那天有一个不寻常的工作安排，就像它诞生于一个 USENET 记者联盟一样。每个人都完全远程工作，分散在世界各地。在我加入的时候，有一种明确的偏好，员工可以在午餐时参加每周的公司会议，在布里斯托尔附近([在一个自助餐厅，附在一个游泳池](https://www.google.co.uk/maps/place/Nuffield+Health+Fitness+%26+Wellbeing+Gym/@51.5155833,-2.5374252,596m/data=!3m1!1e3!4m5!3m4!1s0x0:0xa861d25017b98e44!8m2!3d51.5171796!4d-2.5334001))并且大多数开发软件的技术团队现在都在这个地区。家庭互联网连接仍然主要是 [56kbps 或更低的拨号连接](http://www.diamondmm.com/diamond-multimedia-56k-modems.html)，可能是计量的，尽管我很幸运地在布里斯托尔的一个地区有资格获得[快得惊人的 1Mbps 电缆连接](https://www.flickr.com/photos/boodoo/56093254/in/photolist-5Xuz5-9F9P8A-7y484X-4YyG99-7enBNf-mF8F4Y-n4uWf5-e6mWYJ-4BHLVD-wbyPSP-btQtir-84qR5g-vZsdt-kDGHQp-JTowk-6iRwQX-2ziSPB-4BN4s1-bmtT5Z-j8eUCB-4B8Pen-bNF4BM-bmtT4x-a1JoEg-4onQL2-8zufVs-6JvK13-5Xukw-mNh6Nj-bmKq6o-kAAnCF-bzLqnU-HbkM3-a1M37h-4NqfBo-oXDJVh-nN6z7R-bNF4vc-da1Drv-4C2PgC-6ZHkDS-bzLqpq-9GrJqR-4YdHVj-bzLquh-bNF4AP-bzLqr9-bNF4wr-kw3KdT-76g4EZ)。

预计到必须处理大量的 DP，可能会离线，我问是否可以为我提供一台具有 SMP 和 RAID 容量的小型服务器，结果一台小型塔式 HP Proliant 设备出现在我家，被包裹在一个装载托盘上，大得无法通过前门，这让我非常惊讶。我不得不把它一片一片拆开，拿到我的“家庭办公室”里，那是一间放满宜家桌子的箱式卧室，桌子有点高，不适合做舒适的桌子，然后把它组装好。我将它命名为 mavis.imdb.com，并在上面安装了 Debian stable，这需要花费一天的时间来弄清楚硬件 RAID 驱动程序，从那时起，它的风扇和磁盘就成了我接下来五年日常生活中不可或缺的一部分。最终，搬家让我可以把它放进一个临时的服务器橱柜里，在那里我可以用门、毯子和窗帘来减弱这种持续的噪音。我现在偶尔会想，在我中年的时候，我的听力中是否有一个频率间隙来匹配那个特定的音高，但如果是的话，它对我的影响还没有大到需要去测量它。由于噪音往往会干扰音乐，在最初的几年里，我养成了从早上到午夜收听 BBC 广播 4 台的习惯，因此，当没有测试赛可听时，在我生命中的一小段时间里，我对来来往往的[“弓箭手”](https://www.bbc.co.uk/programmes/b006qpgr)产生了不同寻常的专业知识。

远程工作和不完整连接的一个后果是，技术团队中的开发工作被非正式地隔离到各个工程师拥有所有权的子系统中。在 mavis 上获得整个堆栈的工作构建后，我的第一个任务是将[统计数据](https://www.imdb.com/stats)页面移植到新的 web 堆栈(内部称为‘mayhem’，源自[项目 mayhem](https://www.imdb.com/title/tt0137523/) ，每个人都热衷于电影参考，这是自然的)以熟悉应用程序和基础架构。我敷衍地尝试了一下，然后我开始四处寻找更有价值的东西。论坛，或“留言板”似乎是一个自然的候选人。

在我之前的工作中，我最近做的工作[是为我们的通用内容管理系统贡献一个线程讨论系统，它允许将一个对话树附加到目录中的任何内容 id，因此网站用户可以有一个附加到任何内容的线程评论部分。这种方法效果很好。相比之下，IMDb 有一个非常破旧的通用论坛系统，一个独立的](http://www.accountingweb.co.uk/) [phpbb](https://www.phpbb.com/) 安装，几乎完全与系统的其余部分隔离，组织成几十个通用的，我想甚至有一个单独的登录系统。

下一年的商业目标是提高用户注册，论坛系统似乎是一个很好的辅助功能。它提供了额外的网站价值，只有注册用户才可行。另一个目标是将公告板系统更直接地集成到电影数据库中，允许人们将对话直接附加到电影和节目的页面上。另一个重要的需求是允许系统让数据贡献者直接与数据管理团队交流。因此，我的任务是在论坛上做一些事情来实现这些广泛的目标，它的实施和设计在很大程度上取决于我，通过更广泛的团队对每周进度报告的定期反馈以及团队午餐会议来了解信息。

### 我们需要一艘更大的船

我考虑了很多方法。

*   我本来可以扩展 PHP 论坛系统，以支持新的功能，但我真的没有考虑超过几分钟——这是 PHP，我不是很了解它，也不喜欢它，它更难与 mayhem 应用程序的其余部分紧密集成，这是一个域优化的 mod_perl web 服务。
*   我想包装一个 USENET 服务，它很有吸引力，因为很多基本的层次结构机制都已经被覆盖了，还有一个高度可伸缩的架构，它有一个可移植的标准和几个现有的后端实现。我真的很喜欢这个想法，但当我意识到很难构建一个集成的 web 前端来提供与独立新闻阅读器一样多的功能时，我最终拒绝了它。如果我能找到一个像样的开源 web NNTP 客户端，我可能会这样做。
*   另一个选择是找到一个更适合定制的论坛系统。我考虑过使用为 slashdot.org 提供动力的 slash 系统，但我拒绝了，因为当时它的性能和正常运行时间都很差，并且正在努力应对巨魔。我真的应该多注意这些想法，这两个想法都会回来困扰我
*   最终，我混合了天真、狂妄、自负、热情和实用主义，决定定制一些东西，扩展我在之前工作中用于评论模块的想法。

这个系统的基础是我引以为豪的，从某种意义上来说，这是一个非常聪明的做法。我们想要线程化的讨论，但是在 SQL 中建模树是众所周知的棘手问题。我的第一次尝试是在运行时将 SQL 结果集的平面列表合并成树，对于当时的硬件来说，计算量有点大，并且在带注释的文章中会降低页面渲染的速度。

所以我想出了一个巧妙的方案。我将针对注释记录存储几个排序字段——一个表示线程中的垂直位置，一个表示缩进级别，每次在注释线程中插入一个回复时，我将通过给父回复加 1 来计算正确的缩进级别，将垂直位置设置为比父回复大 1，然后更新每个更大的排序序列，使其递增 1；以便它们在被该索引读取时按线程顺序存储。由于我存储了时间戳和一个连续的帖子 id，因此我有了一个可以按照时间顺序、发帖顺序或回复顺序轻松读取**回复对话的系统。这意味着**发布**在计算上相对昂贵，但只在数据库服务器上，而阅读简单快速。我推断读取比写入频繁很多倍，以这种方式偏置系统将为常见情况优化它，并避免需要[构建缓存失效系统](https://www.martinfowler.com/bliki/TwoHardThings.html)。**

这个系统实际上在实践中运行得很好，至少对于[会计网站](http://www.accountingweb.co.uk)评论区来说是这样。尽管这在概念上很简洁，但由于几个原因，它实际上也很愚蠢*。*

1.  更新记录在 PostgreSQL 中有很高的开销，因为它的并发实现的[机制](https://www.postgresql.org/docs/current/static/mvcc-intro.html)
2.  这个系统意味着，随着线程规模的增长，添加注释的成本会线性增加。*一个系统越受欢迎，发布个人评论所需的工作量就以多项式方式增加*

哎呀。

我并不*完全*愚蠢，我已经计算了这个缺点，并且我已经在纸上做了一些缩放计算，看看在 IMDb 实施这个的成本会是多少，这里我犯了我的第一个真正愚蠢的错误，我使用现有论坛系统的指标来尝试和预测新系统的容量。我现在不记得确切的数字了，我早就把笔记本放错地方了，但它是每天一千个帖子以下的东西，平均帖子长度是几十个帖子。亚马逊可以负担得起一个有用的数据库服务器，看起来我很容易就有了几个数量级的空间。告诉自己 *[过早的优化是所有邪恶](http://wiki.c2.com/?PrematureOptimization)* 的根源，并且轻易地忽略了这个设计实际上完全是由一个优化黑客承担的事实，我决定继续这个计划。

### 给我看所有的蓝图

我对这个设计想了很多。在垃圾邮件和二进制文件使 USENET 变得不适合居住之前，我曾经是一名 USENET 用户。我*崇拜* slashdot。从那以后，我使用了很多糟糕的网络论坛，我设计了一个灵活的引擎，可以处理任何基于帖子的讨论分组。我认为这是一个很好的机会来设计一个我想自己使用的讨论系统。*搔自己的痒处*。我想我已经提到过了，我真的不知道我自己在做什么。啊，青春。

我认为我在其他系统中看到的大多数悲伤和垃圾邮件，主要是因为用户身份的廉价和一次性。我想我们可以通过禁止匿名帖子来解决这个问题，这与增加用户注册的目标是一致的——也许最终我们可以将他们与 Amazon.com 账户联系起来，从而获得真实身份。我想让用户能够个性化和管理他们的网站主页，这样他们就可以对他们重视的社区进行投资，并对公众负责。

我注意到的关于其他论坛的另一件事是，他们很快就陷入了一个占主导地位的小圈子，并阻止了新的加入者。我认为这部分是因为永久记录；对话变得陈旧，因为所有的事情都已经说过了，然后这些小组往往被一大把有明显后历史的高地位成员所主导。群体思维占主导地位，局外人被回避，过滤泡沫盛行。我认为一个有趣的解决方案是主动终止用户帖子。IMDb 已经有了一个用户评论系统，对附加在数据库条目上的更静态的用户内容进行评论。留言板是用来交流的——所以我们只是定期删除旧的内容，对此毫不掩饰。这应该会停止熵锁定，并为我们提供一种控制数据库/线程大小的机制，以帮助提高性能。一切都应该保持新鲜，闪闪发光，自我更新。

我知道很多这是天真的想法，通过 2017 年的后知之明，很容易看到缺陷。然而在 2001 年，在线社区管理的经验要少得多。我们认为我们了解钓鱼，因为我们经历过以前的社区，但我不认为任何人已经掌握了它在一个显著的大众媒体消费者互联网中的规模和范围。

我*真的*想要嵌套线程，这是一个非常好的，也许太好了，促进面向回复的发布和阅读的方式。出于同样原因，我不希望线程成为默认的模式，因为我认为它会促进逐点反驳，从而导致争论和激烈的争论。因此，我设想了一个系统，它可以在平面视图或嵌套视图之间无缝切换，并使用 cookie 来根据您的个人偏好进行调整。

每个帖子都有两个动作——线程中的一个新的顶级帖子，或者对特定帖子的回复，不同的视图选项将允许您从每个角度查看线程时间线是如何组合在一起的。我觉得这将鼓励回复，而不是把它们作为唯一的话语形式。这意味着组织系统是 topic(或者是一个类属，或者是一个数据库对象)，由一个线程组成——由任何用户在 topic 级别上发表的开篇文章定义。然后收集了大量的回复，这些回复本身可能包含回复的子线索。

考虑到这仍然是一个昂贵、缓慢的拨号上网和低端计算机的时代，我希望能够在窄视图或扩展视图中查看。我不想强迫人们下载巨大的浏览器页面和令人窒息的深度嵌套表格布局，所以我们可以在大纲视图和展开视图以及平面视图和嵌套视图之间切换。我希望人们有一个静态的，但可定制的主页，他们可以添加内容，风格和天赋；希望给他们一种监管、所有权和身份感，这应该有助于阻止太多的反社会或负面行为。我不确定我是否足够聪明去思考人们是否会使用他们的主页来存放令人不快的内容。(当然，有些人做到了)。

所以我开始建造它。最初进行得很顺利。在数据模型和存储引擎方面，我有着非常坚实的基础，这是我熟悉的领域。我继续使用 PostgreSQL，并且我们指定了一个合适的服务器来托管它。完全没有高可用性或复制。我现在对这个想法感到震惊，但当时我认为我们正在建立一个辅助的、有目的的短暂的边车讨论系统，它与主站点有不同的存储层，我们对常规的热备份没有问题——在发生灾难的情况下，我们可以在不影响主站点的情况下关闭它们，并从备份中恢复。在完全彻底的灾难的情况下，我们可以将它们重置为零，重新开始，反正它们不是为永久而设计的。来自团队其他成员的关于设计和特性的反馈是积极的，有大量的增强和建议的调整，系统开始成形。

UX 层比我预期的要难得多，正因为如此，我开始在第一个可交付成果的“第二个 90%”中陷入困境。该团队构建的 mayhem 引擎(一个真正聪明的软件设计，我没有时间在这里进行公正的评价)从来没有真正迎合高度动态的页面——它的核心目的是为几乎只读的静态编译的电影和人物数据集提供灵活的视图。它最初是以一种特别优化的方式建立起来的。

我不得不构建自己的 HTTP POST 和表单处理层，这些层将与现有的 HTTP 处理程序集成，起点比我以前做的要低一些，这耗费了我相当多的测试和调试时间。更糟糕的是显示代码。在模板系统中，我们没有太多的工具来实现动态页面布局——这是高度定制化的，而且很复杂；站点页面模板用于通过自定义编译器驱动静态构建系统-模板中的标记指定了构建将生成什么数据视图，这指导了编译二进制电影数据库的数据构建器-页面被有效地编译到特定路由的存根处理程序，该存根处理程序将寻找特定数据索引中的对象索引，然后基本上将数据作为水合网页从端口 80 输出。这是一种为具有相同结构的不同页面提供服务的快速方法，但并不立即适用于高度自适应的不断更新的动态页面或提交表单。尽管如此，我还是希望 boards 系统尽我所能地存在于现有的堆栈中，因此我努力将缺失的功能以一种可以很好地集成的方式构建到我的系统中，这涉及到至少一次完全放弃和重写内部 API。

实际的板显示模板本身是一个重要的时间浸泡。我们有一个很棒的设计师，他用我丑陋的盒状表格原型输出，为所有不同的视图模式和静态网页形式制作出好看的蓝图设计。这当然是浏览器战争的时代，我们被期望支持从 Netscape 3.x 时代开始的一系列令人困惑的用户代理，包括像 AOL 客户端和 MSN 网络电视机顶盒等怪异的东西，天知道还有什么...

将这些复杂的基于表格的视图分解并重新组合成一种神秘的标记和逻辑语言，添加各种( *session global* )模式标志，以使所有不同的视图组合呈现为功能页面，这些页面优雅地降级了我*周*。我错过了发货日期，进入了一个可怕的死亡之旅，试图把东西运出去。无益的是，这一切都发生在我的家庭生活有些紧张的时候，我也在努力平衡这种在家工作的合理惯例，我在朝九晚五的分心和通过晚上和周末工作的过度补偿之间来回切换。最终我们不得不拿出一些特性来发布。

我大幅削减了主页定制，放弃了所有计划中但尚未开始的搜索索引工作，只来得及添加最基本的管理功能。我曾想将现有的帖子迁移到新系统，但我甚至还没有开始着手，这也影响到了剪辑室。在技术团队其他成员的大力协助下，我们在 2002 年夏天的某个时候在最初的 TNG 电路板系统上实现了发布，比计划晚了几个月。留言板的这种模式对所有接触过它们的人来说都比预期的要多，这将是未来几年的主流。

### 旨在激发情感反应的测试

用户的反馈立刻是负面的，并且非常激烈。游说活动立即开始，要求恢复以前的制度。人们抱怨新的设计，新的显示选项的复杂性，不可避免的启动错误。我傻傻地加入了谈话，帮助解释发布活动并征求反馈，从那时起，我收到了大量的直接联系信息和电子邮件，偶尔是积极和友好的，但更多的时候是怪异和无礼的，有时是辱骂。你确实试图告诉自己，你可以忽略这些巨魔，但事实上，很难完全不受那些将你比作儿童强奸犯并以冒犯的语言呼吁你死亡的电子邮件的影响，即使这只是因为你在特定版本的 [Internet Explorer 3](https://en.wikipedia.org/wiki/Internet_Explorer_3) 中破坏了字体大小。我发现你永远都不会习惯。在所有这些工作之后，我对所有的负面情绪感到非常沮丧，尽管团队是积极的，并向我保证一些董事会用户可能会像那样，并且一般来说，人们在抱怨时会更加直言不讳，自然会对改变有所抵制。我仍然感到很沮丧。

几周后，我的情绪确实很快发生了变化。这种新的主板相当受欢迎。也许一个*红极一时*。他们很快以一种有点令人担忧的方式超过了我潦草的规模计算。通过一些明智的数据库调优，性能保持良好。暂时如此。然后，我们添加了每个标题页的链接(IMDb 页面被细分为标题页，用于电视节目和电影，由一个名为 *tconst* 的键识别，看起来像 `tt1234567`和姓名页，用于人、机器人、动物等。来自演员和工作人员，他们通过一个名为 *nconst* 的看起来像 `nm1234567`的键来识别；没有链接到其他数据库对象的顶级板因此获得了一个新的键类型，称为 *bdconst* ，有些不一致，这些看起来像 `bd1234567`并且没有太大关系，因为只有几十个独立的板)并且数字开始正确[曲棍球棒](https://green.blogs.nytimes.com/2010/09/23/the-hockey-stick-lives/?_r=0)。

那时，我们在一份每周报告中计算页面浏览量，该报告根据一级目录列出了排名前 *N* 的子部分。我们从来没有公开分享流量数据，所以即使过了这么久，我还是会小心翼翼地含糊其辞，但是最高的排行榜榜首位置显然是像/title，/name，/search /news /chart 等。在发布时，这些主板潜伏在底部，无处可见，但在我们开始标题对话后，它们稳稳地进入前五名，并保持着不断积累的数字，用户注册也相应增加。

从那时起，在接下来的几年里，我醒着的时候花了大量的时间“做板子”。最初我忙着添加我们在发布前推出的缺失功能——帖子编辑、帖子标记，然后是手工制作的 [BBCode](http://bbcode.org/) 版本的个人资料；再次愚蠢地坚持显示时间优化，我在编写时将它转换为 HTML，这意味着当我们添加后期编辑时，我必须将 HTML 反向解析回 bbcode 以进行重新编辑，所有这些都使用了一系列[错误的链式正则表达式](https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454)。这导致了无穷无尽的解析错误，几乎保证了标记和表情符号(虽然他们还没有被称为表情符号，我们称之为“表情符号”)集将被永久有效地修复，即使我已经不厌其烦地添加了一个管理编辑工具，允许非开发人员通过 CMS API 对标记进行更新。

我拼凑了一个简单的搜索 API，完全基于未索引的 SQL 子字符串，我完全打算在发布后替换它。它从来没有工作过，系统填充得如此之快，以至于它通过不断地表格扫描文本完全杀死了页面缓存，以至于我在第一周就把它钉死了，并且从来没有机会进行它的计划替换。在我离开五年后，我仍然收到电子邮件抱怨这件事。

随着人气的飙升，负面的用户行为越来越多，我不得不越来越多地投入开发时间，为我们的小型审核团队添加滥用处理工具，这曾经只是管理系统的事后想法。我们从未着手将用户账户与亚马逊账户联系起来，我也从未计划添加用户驱动的审核。我对用户 [killfiles](https://en.wikipedia.org/wiki/Kill_file) (改名为“忽略列表”，这是一个更好、更友好的名字)，全局 killfiles(被称为“[幻影区](https://tvtropes.org/pmwiki/pmwiki.php/Main/PhantomZone)，因为我喜欢[超人](http://superman.wikia.com/wiki/The_Phantom_Zone))的帐户历史清除和删除的不切实际的希望是不够的，处理滥用报告的工具太笨重、太慢，很大程度上是因为我没有从一开始就为它们做好足够的计划。

我现在正在两条战线上打一场持久战。这个系统的受欢迎程度远远超过了我最初估计的每天几千篇帖子。我们很快升级到一个点，真正受欢迎的离题板是实时聊天室的替代品，在高峰时期每秒接受数百个帖子。所有这些都在一个直接连接到 HTTP 显示服务器的游标池同步阻塞数据库中。我花了大量的工作时间，只是不断地重写所有的部分，以提高效率。首先是索引和模式的改变，然后是硬件升级和系统软件的调整和配置，然后是使用存储过程完全重写所有数据库逻辑，最后是早就应该进行的表分片，这样我们就可以在不同的表和表空间之间对板进行集群，以平衡 IO 和垃圾负载。与此同时，在另一方面，我们正试图找到降低钓鱼和虐待成本的方法。

我的搭档此时暂时驻扎在伦敦，所以我独自在家，除了那只狗。这个时候的工作日通常包括从卧室走 12 步，在大约 9:30 的时候仍然刷牙，收到一封支持邮件，开始用板子戳一些有趣的东西，然后直到第二天凌晨才放弃。我对这一切相当着迷，我的健康也受到了影响，尽管当时我离这一切太近了，无法正确地看到这一点。我出现了一系列奇怪的神经症状，顽固地拒绝诊断，随后似乎完全是由压力引起的。

在高峰负载时间，我们仍然会窒息，这开始对网站的其他部分产生连锁反应。最终，一位才华横溢的同事帮我实现了一个可行的缓存数据库代理，这是我拙劣设计的一个版本；他似乎是一夜之间用 C 语言实现的，它使用 postgresql [有线协议](https://www.postgresql.org/docs/9.1/static/libpq.html)并将结果集缓存在我们安装在 ramdisk 上的文件系统中。有点像自制的 [memcached](https://memcached.org/) 和 [pgbouncer](https://pgbouncer.github.io/) 的组合。它的简单性和有效性简直让我窒息，就像一个教训，如果一个软件不存在，你*可以*自己做。一切都只是 1 和 0，就像我一直喜欢说的那样。

有了这个补充，我们就达到了一个系统足够稳定的状态。我们实施了更多的禁止和报告，添加了一个基于信誉分数的系统，该系统降低了信誉分数较低的用户的发帖率，这也有助于减少峰值时的饱和写负载。最终，我们添加了一个具有学习能力和可插入规则集的自动调节机器人。我叫他[狼牙](http://tomandjerry.wikia.com/wiki/Spike_Bulldog)。他工作得相当好，尽管有时有点生硬。

我希望我没有在这里给人一种完全负面的印象。这几年绝对是大起大落。令人振奋，也非常有趣。这些板子是不知从哪里冒出来的活物，实际上是我在备用卧室里创造的东西。这有点像太平洋大小的一群海猴子，永远在我的空房间里随着意想不到的活动而消失。

虽然他们经常令人沮丧，但用户也是鼓舞人心的，有创造力的，令人惊讶的，偶尔还很有趣，甚至是一些(温和的)巨魔。除了可以理解的沮丧和烦恼之外，我发现我对他们以及他们对这个系统的抱怨和失望有一种同情。所有这一切都发生在“社交媒体”时代之前，我几乎可以感觉到它的形状挂在那里，稍微超出了我们前进的方向，偏离了赛道，朝着我们可能不应该冒险进入的方向。

一个一致的惊喜是人们在管理他们有限的个人资料空间方面所付出的努力，以及对我们来说是多么的社会和跑题。我们不断遇到试图使用个人社交空间的人——我主张在某个时候为每个用户提供单独的个人板，但管理团队解释说，我们并不真正处于一般社交网络的核心业务中。当时我很困惑，我不得不思考一会儿，但我认为这是正确的想法，其中有很多智慧。你不可能把所有可能的事情都做好。在一个小团队和一个大世界里，你从完全专注于你最擅长的事情和你想做得更好的事情中受益最多。

一些愚蠢的巨魔脱颖而出。有一个早期的格里夫·T2，我们很容易通过 IP 追踪到他在一个学校图书馆，我想是在加拿大。我们一直等到一天下午他正在上课，然后如果我没记错的话，管理层给他的班主任打了电话，然后班主任就当场逮捕了他们。还有另一个非常愚蠢的[鲶鱼](https://www.urbandictionary.com/define.php?term=catfish)钓鱼者，名叫 `tabitha_cyeg`，有着明显伪造的身份。他们的作案手法是发布关于网站技术和我的奇怪的阴谋论，在此期间，他们声称使用[l33t](https://en.wikipedia.org/wiki/Leet)-听起来很像但完全不相关的 [NetBIOS 漏洞](https://technet.microsoft.com/en-us/library/security/ms03-026.aspx)充满了伪造的服务器日志，有一次“黑客”从我自己的电子邮件中暴露了我的真实姓名，类似于“Claude M. Savoire”。相当多的用户似乎完全被说服了，但对我来说，这是 pythonesque。

被联邦政府联系来处理那些发布关于布什总统的死亡威胁的用户是很奇怪的，至少这是第一次，我收到了一些来自实际行业人物的 pm 和电子邮件，这总是很令人兴奋。有一次，我个人禁止了一个相当有名的好莱坞制片人，因为他发布了辱骂性的帖子，这有点奇怪。我记得大约在这个时间段去电影院看[杰伦和沉默的鲍勃反击](www.imdb.com/title/tt0261392/)，并且从他们[单独访问所有对他们以前的电影无礼的互联网论坛海报](https://www.youtube.com/watch?v=tsXKAtpLm4I)的子情节中获得了特别的快感。

我看着人们打架和交朋友。从常客那里看到了一些浪漫和一两次婚姻。我阅读，偶尔参与，尽管我有更好的判断，在迷人和富有成效的对话。我仍然会在现实生活中遇到一些人，他们回忆起那些董事会，直到今天，当我告诉他们我在董事会的创建中起了很大的作用时，他们仍然对我印象深刻。有一次，我在一个昏暗的餐厅露台上度过了一个晚上，泪流满面，一位好心的男子向我解释说，他的小女儿因患癌症住进了医院，生命垂危，在最后一年里，她把哈利·波特·IMDb 的书板作为主要的社交生活，这对他和她来说意味着什么。像这样的故事只是一个深刻的特权，甚至最轻微的参与。

而我**学到了**这么多。与*这样的*聪明的团队一起工作，在互联网如此伟大和特别的一块。了解从磁盘块到网络再到网络扩展 web 堆栈的方方面面。这个时代仍然是 [32 位](https://stackoverflow.com/questions/19821103/what-does-it-mean-by-word-size-in-computer) [英特尔](https://upload.wikimedia.org/wikipedia/commons/4/44/Intel_Inside_Logo.svg)硬件，我学到了大量相关知识，还有 [UNIX](https://linux.die.net/man/1/sar) [剖析](http://www.unix.com/man-page/Linux/8/vmstat/)，linux [虚拟内存系统](https://www.kernel.org/doc/gorman/pdf/understand.pdf)和[文件系统](http://www.win.tue.nl/~aeb/linux/lk/lk-8.html)，以及 [HTTP 缓存](https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching)。我犯了太多的错误，因为我没有其他的学习方法，而且我确实找到了如何改正或改进它们的方法。

我学习了 PostgreSQL 内部的一些细节，从网络协议一直到存储模型，直到今天，在我需要的时候，我还是一个非常出色的 PostgreSQL DBA。我学到了很多关于 UX 的影响和操控行为，尽管大部分都是错误的。我学到了构建搜索引擎和面向服务的架构，以及为什么你真的不应该把响应系统挂在阻塞的 I/O 上，也许消息队列*是有用的*。我学会了如何测量系统性能，一直测量到 [CPU 缓存级别](https://www.extremetech.com/extreme/188776-how-l1-and-l2-cpu-caches-work-and-why-theyre-an-essential-part-of-modern-chips)。我学会了如何把注意力集中在我还不知道如何解决或者可能还不明白的问题上。我学到了很多很多关于电影和电影史的东西，大部分都是通过潜移默化地钻研数据源。我学会了如何更好地管理自己的时间和项目，我学会了[筋疲力尽](http://www.infoworld.com/article/2625739/it-management/developer-burnout--time-to-end-the--disposable-geek--mentality.html)的感觉，以及当你知道自己筋疲力尽时应该做些什么。自从我离开 Amazon.com，我已经有了一个伟大而多样的职业生涯，我认为至少 75%我知道如何做好的有用的事情都是在那份工作中学到的，我一直珍惜并尊重这一点。

### 一直都是。是。关门了。

现在他们关闭了董事会。奇怪的是，我最初是通过短信听说这件事的；但在那之后不久，我的新闻订阅上到处都是这件事，紧接着是一连串缓慢的电子邮件，询问我的情况。朋友，前同事，他们中的一些来自前董事会用户。我对此感到奇怪的震惊，在某种程度上，有点情绪化。在互联网时代，16 年是一段很长的时间。当我加入亚马逊时，网络本身还不到 16 岁，更老的 IMDb 也不到 16 岁。我自己不再使用这些公告板了，尽管我偶尔会浏览一下，可能一年一两次。有一段时间很明显，他们没有得到他们曾经使用的一小部分，这是公平的。网络在 2017 年是一个完全不同的东西，这也是一件好事。

通信技术不断发展，并有望不断进步。人们现在有各种各样的社交网络来交流，其中大部分发生在不同的，更小的屏幕上，比我第一次在网格笔记本上勾画铅笔想法时所能想象的任何东西都要小。我相信是一个真正的文件夹。看到注意到 IMDb 声明的推特流量，以及把这件事写得意义重大的[实际](https://www.bbc.co.uk/news/technology-38879674) [适当](http://variety.com/2017/digital/news/imdb-message-boards-shut-down-1201977581/) [新闻](https://www.engadget.com/2017/02/05/imdb-shuts-down-message-boards/) [网站](https://www.theguardian.com/film/2017/feb/06/imdb-shuts-down-message-boards)的数量，令人感到非常惭愧。the Verge 的报道似乎认为 IMDb 的留言板是划时代的。我想，这是一件了不起的事情。一切都会过去的。

### 还有一件事困扰着我

*Mjeyds*’。在 imdb board bbcode 语法中，有一个特殊的笑脸，您可以使用这个奇怪的单词进行标记。人们偶尔会问这个术语是什么意思，我一直很喜欢这个谜，是世界上极少数声称知道答案的人之一。我想是时候揭晓了。

表情包是由我以前的设计师同事策划、上传和配置的。他负责给它们命名。他不是英国人，来自丹麦，我相信他去过其他几个国家。当我要求他解释“mjeyds”时，他说这应该是一种拟声词，类似于蒙蒂·派森的电影《生命的意义》中的一个场景，已故的格雷厄姆·查普曼无精打采地说“是”时吸着烟斗的样子。如果是的话，我想如果你用丹麦字母会更好？如果你读完这篇文章只是为了找到这个问题的答案，那么如果这是一个虎头蛇尾，我很抱歉，但谢谢你的阅读。也许有些事情还是保持神秘比较好。又学到了一课。

### 疯狂学分

这是一个个人网页，完全是我个人的主观复述，讲述了我很久以前建设和维护 IMDb.com 一小部分的经历。虽然我很高兴为大量的董事会创作和灵感承担个人责任，但我不希望人们觉得这是一个人的努力。上面概述的所有工作都是在一个小型专门团队的背景下完成的，尽管我没有指名道姓，也没有把想法归功于其他地方，但这更多地是出于不想漏掉任何人的愿望——过了这么长时间，我根本没有办法把我记得的部分归功于个人，而不把我已经忘记的同样重要的贡献归功于其他人。我已经尽最大努力对事实和时间表保持诚实，并试图不去过多推断第三方的动机，但我知道我已经忘记了一些事情，并错误地记住了其他人。凭记忆工作，过了这么长时间，这样的错误只是人之常情。如果您发现任何严重的错误，或者有任何问题或更正，请与我们联系。我要感谢 2001-2005 年 IMDb 团队的全体成员，感谢他们与我在上述所有事情上的合作，以及更多。伟大的团队，伟大的时代

posted by [cms](/) on <time class="dt-published" datetime="2017-02-05 18:46">2017-02-05 18:46</time>

标记为