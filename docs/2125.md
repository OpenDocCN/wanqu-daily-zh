# 清洁编码器博客

> 原文:[http://blog . clean coder . com/uncle-bob/2016/01/14/stabilization . html？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://blog.cleancoder.com/uncle-bob/2016/01/14/Stabilization.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)



当我喝着早晨的咖啡，在手机上浏览 facebook 时，我发现自己被特斯拉车主的更新淹没了，他们对自己的汽车现在可以自动驶入车库感到兴奋。我对这些 facebook 更新的反应可能有点愤世嫉俗；但我告诉他们所有人:

> 在我相信软件能驾驶我的车之前，还需要很长时间。
> 因为我——**知道**。

我知道什么？我知道为每一个突发事件测试软件系统有多难。我知道欺骗自己很容易。

这让我开始思考应该如何测试无人驾驶汽车的软件。

那次让我开始思考人们*如何*测试软件系统。

那次终于让我开始思考*的稳定阶段*。

你知道什么是稳定期，对吧？稳定阶段出现在一个版本的末尾。留出时间只是为了让系统运行。一个星期，或者一个月，每个人只是看着系统运行。他们把它当成熟睡的婴儿。他们避免大声的噪音、摔门和大声的谈话。他们踮着脚四处张望，时不时地窥视它，希望它不会醒来而失败。

好吧，也许这有点过了。也许吧。我想象大多数运行稳定阶段的团队实际上非常努力地给他们的系统施加压力。至少我希望如此。他们应该在不同的负载下通过系统运行大量数据；包括格式错误的数据，以及在过去引起过问题的数据。

但是关于稳定阶段有一点:

> 我们跑是因为我们害怕。我们害怕是因为我们不确定这个系统会做什么。

自称为专业人士和对我们创造的东西如此不确定以至于我们害怕它会做什么之间存在一定的不协调。人们期望一个专业团队有高度的自信和确定性。

团队希望稳定阶段运行的时间越长，团队对系统就越不确定。只需要一天的团队比需要一周或一个月的团队对他们的系统更有把握。

这里的逻辑缺陷是*执行时间表示质量*。但时间其实和质量无关。时间只是提升了*假*的信心。

稳定阶段的系统行为与生产阶段的系统行为几乎没有关系；因为进入生产系统的数据是全新的数据。新数据可能会驱使系统沿着稳定阶段从未执行过的路径运行。

所以稳定阶段实际上只是制造虚假的信心。这是 CYA 的策略。当系统在生产中出现故障时，你至少可以声称你在稳定阶段做了一个月运行系统的尽职调查；从而免除团队在系统中留下严重缺陷的责任。

问题的关键在于稳定阶段的存在是因为开发团队已经产生了他们不确定的代码。所以他们运行这个系统一个月，以创造足够的虚假信心来抵消这种不确定性。

团队真正需要做的是直接解决他们的不确定性。不是让系统无用地运行一个月；而是通过纠正发展过程中导致不确定性的缺陷。考虑以下清单:

1.  你在运行覆盖率工具吗？你检查每个`if`语句和`while`循环都被覆盖了吗？单元测试覆盖率是否接近 100%。你需要通过编写更多的单元测试来把它驱动得更高一点吗？
2.  您有由业务和 QA 编写的(或者至少由他们验证的)自动化验收测试吗？这些测试的覆盖率够高吗？是否需要通过要求 QA 考虑更多的边角案例来将它推得更高？
3.  您有架构师和开发主管编写的自动化集成测试吗？这些测试强调组件之间的通信路径吗？他们会检查角落情况、边界问题和超时吗？他们会在不同的负载下探测系统行为吗？
4.  如果你有多个线程，你有一个在单元测试和验收测试中给这些线程施加压力的策略吗？例如，您是否实现了引入随机延迟和随机负载的工具，从而放大了竞争条件的可能性。更好的是，您是否通过消除线程间的可变状态逐渐消除了竞争条件的可能性？您是否绘制了所有的消息序列图，并检查了它们的潜在竞争？

这份清单只是一个例子。我相信你能想出更多的东西放在上面。关键是，对于你的不确定性，积极主动比消极被动要好。稳定阶段是被动的。

目前使用稳定阶段的软件团队的目标应该是随着时间的推移增加他们的确定性，从而减少他们稳定阶段的持续时间。从一个月减少到一周。然后从一周到一天。然后从一天到一小时。

最后，增加你的确定性，这样你就可以一劳永逸地消除稳定阶段*。*

* * *

**奇闻:**

> 我最近试驾了一辆特斯拉。这辆车开起来很有趣。我是说，真的很有趣。我尝试了“自动转向”功能，双击转向柱上的按钮即可轻松启动。汽车愉快地通知你，汽车现在正在自动驾驶；警告你把手放在方向盘上。注意这个警告！T3】

> 当道路标记清晰可见时，这辆车的表现还算不错，但似乎也很愿意把我撞到一堆建筑路障上。把手从方向盘上拿开或者眼睛离开路面是不安全的**。对我来说，这使得这个功能更有用。**

 **> 售货员坐在我旁边。有一次，我们以每小时 45 英里的速度向一辆红灯前停下的汽车追尾。推销员说:“相信这辆车。”我想:“我当然愿意！”我踩了刹车。

> *这个技术很可爱；但是很危险。**千万不要**“相信汽车”！*

> 或许你可以说，自动驾驶汽车的前景并没有让我充满热情。我将继续好奇在 2 月 29 日午夜过后的一秒钟，这些汽车会做些什么。** 