# 满足安全性 bot:大规模开源自动化安全性- Dropbox

> 原文：<https://blogs.dropbox.com/tech/2017/02/meet-securitybot-open-sourcing-automated-security-at-scale/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

安全事故时有发生。当他们这样做的时候，他们需要被迅速处理*。这就是检测发挥作用的地方。事件检测得越快，就能越快地移交给安全团队并得到解决。为了尽可能快地进行检测，团队通常会得到监控基础设施的帮助，只要有一点点可疑的事情发生，监控基础设施就会发出警报。这些警报可能导致信息泛滥，使工程师难以筛选。更糟糕的是，这些警报中有大量是误报，是由工程师任意运行`sudo` `-i`或`nmap`造成的。*

 *忽略其中一些警报是很诱人的。毕竟，对于每个涉及个人的警报，安全团队的成员都需要手动联系他们。更多的提醒意味着更多的工作:我们都知道 Chris 每天运行`nmap`大约六次，而 SREs 需要经常运行`sudo`。所以我们可以忽略这些警报，对吗？**错了**。这开创了一个危险的先例[，从来没有好下场](http://www.bloomberg.com/news/articles/2014-03-13/target-missed-warnings-in-epic-hack-of-credit-card-data)。显然需要一种系统来减轻安全团队的警报负担。

一年前， [Slack 着手解决这个问题。他们没有手动联系员工来验证他们的行动，而是构建了一个自动化系统，用于联系员工并将汇总结果发送回安全团队。我们受到了启发:如果我们在 Dropbox 的团队创建了一个我们自己的自动化、分布式警报机器人会怎么样。我们能否减轻安全团队的警报负担，并帮助他们以前所未有的速度整理警报？为了回答这个问题，我们开发并部署了**安全机器人**，并发现是的，我们可以。](https://slack.engineering/distributed-security-alerting-c89414c992d6#.6dqng58c7)

但是我们不想就此止步。作为 TODO Group 的创始成员，我们致力于通过支持开源项目与更大的技术社区分享我们的知识。所以，今天我们也开源我们的实现，希望其他公司可以从我们的构建中受益。

# 高效的事件检测

安全监控中最困难、最耗时的部分之一是手动联系员工以确认他们的操作。尽管我们已经花了大量的时间进行拓展，但仍有一些警报我们没有时间跟进。我们希望实现一个能够覆盖更多用户的系统，同时允许我们在其他事情上花费更多时间，例如构建更好的检测工具和主动搜索坏人。

Securitybot 现在在我们的警报检测链中找到了自己的位置。警报发出后不久，员工会收到一条消息，要求他们确认是否执行了潜在的恶意操作。他们的回答被存储起来，然后发送给安全团队。随后，员工对机器人的响应会增加警报汇总。如果员工报告他们*没有*采取行动，安全团队会立即收到警报。这意味着将大多数警报保留在后台，但将真正需要立即关注和跟进的警报暴露出来。我们的安全工程师现在有更多的时间致力于改善我们整体安全状况的基础项目，而不是花费时间反复联系。

# 设计

在设计 Securitybot 时，我们希望抓住 Slack 帖子中的所有要点。核心思想保留了下来:Securitybot 与我们的检测和警报系统以及我们公司范围内的 Slack 实例绑定在一起。收到警报后，机器人会联系触发警报的人，并为安全团队记录响应。然而，我们也想扩展这个设计，让它对 Dropbox 和整个社区更有用。目标是使我们的实现模块化和可重用。例如，如果我们改变聊天平台或监控系统，我们希望能够在不重写核心代码的情况下做到这一点。Securitybot 是围绕一组核心功能设计的，这些功能通过一组简单的可组合插件与监控和通信系统相联系。

Securitybot 在从我们的监控工具获取新警报和与员工沟通之间移动。每当遇到新的警报时，它都会被记录下来，并为触发它的人排列一条消息。定期轮询可确保我们及时收到警报，并尽快处理它们。稍后，当收集到响应时，它们会被带回我们的监控系统，以便与我们的其他警报一起使用。

Securitybot 确保了用户交互的迅速和简化。对于每一个警报，我们只是简单地询问一个员工是否触发了它，并要求一个简短的解释。然后，这些响应将被聚合回我们的监控基础架构中，这样，当我们审查每小时或每天的聚合时，所有响应都在那里供审查。响应通过 2FA 得到保护，因此即使攻击者设法破坏 Slack，他们也无法欺骗机器人。

最后，我们增加了一点用户友好性。我们没有用信息轰炸员工，而是让大多数提醒“打盹”如果我们因为您使用了`sudo`而对您进行 ping 操作，那么您将来很有可能会再次使用它。所以，我们在一段时间内不打扰你，因为我们可以相当确定连续三个`sudo`的，在相同的上下文中，都是你。

# 有效性

首先，Securitybot 帮助安全团队以前所未有的速度整理警报。无需联系员工即可解决误报，并立即上报可能的事件。

Securitybot 不仅帮助安全团队，也帮助所有 Dropbox 员工。回复一个礼貌的聊天机器人比完整地回复一个安全团队的成员要容易得多。这不仅节省了我们安全工程师的时间，也节省了我们所有员工的时间。(毕竟，不仅仅是生产工程师——通过这个机器人，我们可以对员工电子邮件和 Dropbox 账户中的异常事件以及他们笔记本电脑上的异常活动发出警报。)

我们理解不得不回应唠叨的安全团队的烦恼，拥有一个不理解“我很忙，我过会儿去做”的无情机器人不会让事情变得更好。因此，我们花了一些时间来研讨机器人和用户之间的交互，以确保处理起来足够愉快。我们想让我们的机器人变得礼貌、亲切，而不是生硬、机械。事实证明，给我们的互动增加一点个性可以让机器人从“烦人”变成“可爱”*  *# 开放源码

最后，我们很高兴地分享我们已经

[open sourced Securitybot](https://github.com/dropbox/securitybot)

。据我们所知，这将是唯一一个在分布式范围内自动确认和汇总员工可疑行为的开源项目。我们希望，通过提出一个初始的开源实现，我们可以帮助其他人改进他们的内部检测，并轻松地让他们的分布式安全性启动和运行。我们也希望安全社区能够分享和改进代码。虽然我们使用 Securitybot 进行内部监控，但同样的系统也可以用于面向用户的外部检测。最后，这有望给其他团队一个创建自己系统的起点。*