# 何时从零开始重写——失败软件的解剖

> 原文:[http://code ahoy . com/2016/04/21/when-to-write-from-scratch-of-a-failed-software/？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://codeahoy.com/2016/04/21/when-to-rewrite-from-scratch-autopsy-of-a-failed-software/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

[![](../Images/be7f69e25f0ba22ad452f76a1c38873a.png)](https://www.unlaunch.io) 

那是 2012 年的冬天。我在一家初创公司的一个小团队中担任软件开发人员。我们刚刚向一个真正的公司客户发布了我们软件的第一个版本。开发如期完成。当我们发射时，我欣喜若狂，非常自豪。看着这个系统每天处理几百万个不同的用户，发出几千万条短信，这是非常令人满意的。到了夏天，公司有了真正的收入。我被提升为软件经理。我们雇了新人。该公司准备发展。生活很美好。然后我们犯了一个巨大的错误，决定重写软件。从零开始。

## 为什么我们觉得需要从头重写？

我们用枪顶着脑袋写下了最初的系统。我们不得不跑向终点线，并承担了技术债务。我们没有进行长时间的设计讨论或审查会议——我们没有时间做这些事情。我们会尽可能快地完成一个功能，对它进行测试，然后发布给客户。我们有一个共享的办公室(来自 TRTech ),我记得其他公司的新软件开发人员进入冗长的设计和重复的关于设计模式的架构辩论，这是我们无法承担的。

尽管敏捷是类固醇设计，但最初的系统写得并不差，总体来说结构良好。有一些从公司以前的概念验证尝试中遗留下来的代码，我们没有碰过，因为它正在工作，我们没有时间。但是，我们没有考虑增量改进，而是说服自己需要从头重写，因为:

*   旧代码很糟糕，很难维护。
*   “monolith java 架构”不足以满足我们未来支持拥有 6000 万移动用户和多站点部署的超大型运营商的需求。
*   我*希望*尝试新的、闪亮的技术，如 Apache Cassandra、虚拟化、二进制协议、面向服务的架构等。

我们说服了整个组织和董事会，不幸的是，我们如愿以偿了。

## 重写之旅

开发于 2012 年春天正式开始，我们将 2013 年 1 月底定为发布日期。因为愿景如此宏大，我们需要更多的人。我在印度雇佣了顾问和几个远程开发者。然而，我们没有完全预料到在新开发的同时维护原有系统的需要，并且低估了客户的需求。记得我一开始说过我们有一个真正的客户吗？该客户是南美最大的移动运营商之一，一旦我们的系统被其用户采用，他们就开始要求改变和新功能。所以我们不得不继续更新原来的系统，尽管半心半意，因为我们正在挖它的坟墓。我们尽可能地回避来自客户的新功能请求，因为我们无论如何都要扔掉旧的。这导致了延误，我们错过了一月份的最后期限。事实上，我们错过了整整 8 个月！

但是让我们跳到最后。当项目最终完成时，它看起来很棒，符合所有要求。负载测试表明，它可以轻松支持超过 1 亿用户。配置是集中的，它有一个漂亮的 UI 工具来查看图表和图形。是时候淘汰旧系统，代之以新系统了……**直到客户拒绝升级**。原来原来的系统已经获得了广泛的采用，他们的用户已经开始依赖它。他们不想冒任何风险。长话短说，几个月来来回回，我们一无所获。该项目正式宣告失败。

## 吸取的教训

*   你几乎不应该从头开始重写。我们因为错误的原因重写了剧本。虽然部分代码是糟糕的，但是如果我们花时间阅读和理解其他人写的源代码，我们可以很容易地通过重构来修复它们。为了支持更复杂的业务逻辑，我们确实担心体系结构的可伸缩性和性能，但是我们可以逐步引入这些变化。
*   从头重写的系统不会给用户带来新的价值。对于工程团队来说，新技术和流行词汇可能听起来很酷，但如果它们不能提供客户需要的新功能，对客户来说就毫无意义。
*   当我们专注于重写时，我们错过了真正的机会。我们有一个非常基本的“网络工具”，客户可以用来查看图表和报告。随着参与程度的提高，他们开始要求额外的功能，如实时图表、访问级别等。因为我们对旧代码不感兴趣，也没有时间，我们要么拒绝新的请求，要么做得不好。因此，该客户停止使用该工具，并坚持通过电子邮件进行报告。另一个失去的机会是建立一个强大的分析平台的机会，这是 T2 非常需要的。
*   我低估了在新系统开发期间维护旧系统的努力。我们估计一个月有 3-5 个请求，结果收到了 3 倍多的请求。
*   我们认为我们的代码更难阅读和维护，因为我们没有使用其他开发人员花了几天时间讨论的适当的设计模式和实践。事实证明，我在大型组织中见过的大多数专业代码比我们的糟糕两倍。所以我们完全错了。

## 什么时候重写答案？

乔尔·斯波尔斯基强烈反对重写，并建议人们永远不要这样做。我对此不太确定。有时候渐进式改进和重构非常困难，而**理解**代码的唯一方法就是重写代码。另外，软件开发人员喜欢写代码和创造新事物——阅读别人的代码并试图理解他们的代码和他们的‘精神抽象’是很无聊的。但是好的程序员也是好的维护者。

如果您想重写，请出于正确的原因，并为以下内容做好适当的计划:

*   在某些情况下，在发布新版本之后很久，旧代码仍然需要维护。维护两个版本的代码将需要巨大的努力，你需要问自己是否有足够的时间和资源来证明基于项目的规模。
*   想想失去其他机会，分清轻重缓急。
*   重写大系统比重写小系统风险更大。问问自己是否可以增量重写。我们切换到一个新的数据库，成为一个“面向服务的架构”,并改变我们的协议为二进制，所有这一切都在同一时间。我们可以逐步引入这些变化。
*   考虑开发者的偏见。当开发人员想要学习一种新的技术或语言时，他们希望用它编写一些代码。虽然我不反对，而且这是良好环境和文化的标志，但你应该考虑到这一点，并权衡风险和机遇。

迈克尔·梅多斯对何时有必要进行“大规模”重写进行了出色的观察:

> **技术**
> 
> *   组件的耦合性非常高，以至于对单个组件的更改无法与其他组件隔离开来。单个组件的重新设计不仅会导致相邻组件的级联更改，还会间接影响所有组件。
> *   技术堆栈非常复杂，以至于未来的状态设计需要多种基础设施变更。这在完全重写中也是必要的，但是如果在增量重新设计中需要，那么你就失去了优势。
> *   重新设计一个组件无论如何都会导致该组件的完全重写，因为现有的设计太糟糕了，没有什么值得保存的。同样，如果是这样的话，你就失去了优势。
> 
> **政治**
> 
> *   不能让发起人理解增量重新设计需要对项目的长期承诺。不可避免的是，大多数组织对渐进式重新设计造成的持续预算流失失去了兴趣。对于重写来说，这种胃口的丧失也是不可避免的，但是发起人更倾向于继续，因为他们不想在部分完整的新系统和部分过时的旧系统之间分裂。
> *   该系统的用户过于依赖他们的“当前屏幕”如果是这种情况，您将没有许可证来改进系统的一个重要部分(前端)。重新设计可以让你避开这个问题，因为他们从一些新的东西开始。他们仍然会坚持获得“相同的屏幕”，但是你有更多的弹药来反击。请记住，增量重新设计的总成本总是高于完全重写，但对组织的影响通常较小。在我看来，如果你能证明重写是正确的，并且你有超级明星开发人员，那么就去做吧。

放弃工作项目是危险的，我们浪费了大量的金钱和时间来复制我们已经拥有的工作功能，拒绝新的功能，激怒了客户并使我们自己拖延了几年。如果你开始了重写的旅程，所有的权力都在你身上，但是要确保你有正确的理由去做，理解风险并为此做好计划。

