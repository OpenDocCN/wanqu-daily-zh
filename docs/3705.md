# 死亡之线——文本/普通

> 原文:[https://textslashplain.com/2017/01/14/the-line-of-death/?UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://textslashplain.com/2017/01/14/the-line-of-death/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

当构建显示不可信内容的应用程序时，安全设计人员面临一个主要问题——如果攻击者完全控制了一个像素块，他可以将这些像素变成他想要的任何样子，包括应用程序本身的 UI。然后，他可以诱导用户采取不安全的行动，用户将一无所知。

在 web 浏览器中，浏览器本身通常控制窗口的顶部，而顶部下方的像素则由站点控制。我最近听说这个叫做**死亡线:**

如果用户信任死亡线以上的像素，他们就会安全，但是如果他们被说服信任死亡线以下的像素，*他们就会死*。

*不幸的是*，这个关键的界限并没有明确地向用户指出，更不幸的是，它并不是绝对的。

例如，因为 LoD 上面的区域非常小，所以有时需要更多的空间来显示可信 UI。Chrome 试图通过展示一个跨越 LoD 的小**人字形**来解决这个问题:

…因为不受信任的标记不能跨越 LoD。可惜截图中可以看到，待遇不一致；在 PageInfo 弹出按钮中，人字形指向锁的底部，PageInfo 框与 LoD 重叠，而在权限弹出按钮中，人字形指向 omnibox 的底部，权限框仅邻接 LoD。有时，山形符会被省略，就像在认证对话框的情况下，从 **Chrome 70** 开始，所有 UI 的山形符似乎都被*完全移除了*。

唉，即使是在 Chrome 中，山形纹也很微妙，我预计大多数用户会爱上一个伪造的山形纹，就像一些网站已经开始使用 <sup>1</sup> :

更大的问题是，LoD 之上允许一些攻击者数据；虽然相信 LoD 以下的内容会扼杀您的安全性，但也有线以上的死亡区域。一张更准确的**死亡地带**地图可能是这样的:

在区域 1 中，显示攻击者选择的图标和页面标题。这些信息完全由攻击者控制，因此可能完全由欺骗性内容和谎言组成。

在区域 2 中，显示了攻击者的域名。一些信息安全专家会争辩说，这是 URL 中唯一“值得信任”的部分，只要 URL 是 HTTPS，那么这个域就能正确地识别你所连接的站点。不幸的是，你对*值得信任*的想法可能与专家不同；`https://paypal-account.com/`可能真的是你加载的域名，但是和`https://paypal.com`找到的合法支付服务没有关系。

区域 3 中 URL 的路径组件完全不可信；URL `http://account-update.com/**paypal.com/**`也与 Paypal 无关，虽然这里的欺骗不太令人信服，但对好人来说也更难阻止，因为欺骗内容在 DNS 中找不到，也不会在[证书透明度](https://www.certificate-transparency.org/)日志中创建任何记录。

区域 4 是网络内容区域。这个地区的任何东西都不可信。不幸的是，在窗口操作系统上，这比听起来更糟糕，因为它创造了**画中画攻击**的可能性，其中整个浏览器窗口*包括其信任的像素*可以被伪造:

当听到画中画攻击时，许多人立即头脑风暴防御；许多与个性化有关。例如，如果你用自定义的主题运行你的操作系统或浏览器，你就不会被愚弄。不幸的是，有证据表明事实并非如此。

### *故事时间*

早在 2007 年，当 IE 团队推出扩展验证(EV)证书时，微软研究院[发表了一篇论文](https://www.adambarth.com/papers/2007/jackson-simon-tan-barth.pdf)质疑它们的有效性。一家财富 500 强金融公司拜访了 IE 团队，他们正在评估是否要进入 EV 认证中心业务。他们对前景感到兴奋(我们也一样，因为他们是一个具有天然协同效应的知名品牌)，但他们指出，他们认为画中画问题是一个致命的缺陷。

我为自己辩护——“这很有趣，”我承认道，“但我不认为这是一次非常合理的攻击。”

他们反驳道:“嗯，我们把这张截图传到了整个信息安全部门，没人能看出这是一次画中画攻击。可以吗？”他们把一张 8.5×11 的彩色照片滑过桌子。

“当然！”我说，马上松了口气。当我意识到*他们*无法分辨这一事实的*含义*时，我很快变得非常沮丧。

“怎么会？”他们要求。

“这是一张 IE7 浏览器在 Windows Vista 上运行的透明航空玻璃主题的图片，其中一页包含一张 IE7 浏览器在 Windows XP 上运行的 Luna-aka-Fisher Price 主题的 JPEG 图片？”我指出。

“哦。哼。”他们重新检查照片时注意到了这一点。

我认为将浏览器个性化作为一种有效的缓解措施的想法在那天破灭了。

提出了其他缓解措施；一家 CA 开发了一个扩展，将鼠标悬停在 EV 锁图标(“信任徽章”)上将会使除徽章之外的整个屏幕变暗。一个团队提议使用图像分析来扫描当前网页，寻找任何看起来像假电动车徽章的东西。

就我个人而言，我最喜欢的方法是 Tyler Close 的想法，即浏览器应该使用 [PetNames](https://www.w3.org/2005/Security/usability-ws/papers/02-hp-petname/) 作为站点标识——把它们想象成加盐证书散列的 Gravatar 图标——它们不仅会使每个 HTTPS 站点的标识对每个用户来说都是独一无二的，而且这还可以用作检测欺诈或错误颁发证书的手段(在我们拥有证书透明性之前的世界)。

## 未来就在眼前…而且更糟

HTML5 增加了全屏 API，也就是说死亡地带看起来是这样的:![zodfullscreen](../Images/4ade653daa13cec0da2f74cd49e49c88.png)

Windows 8 中 Internet Explorer 的 Metro/Immersive/moden 模式也遭遇了同样的问题；因为它的设计理念是“内容重于 chrome”，所以没有值得信赖的像素。我请求在屏幕的右下角装饰一个永久的**信任徽章**(显示安全来源和一把锁),但被否决了。一个有进取心的 Windows 安全测试人员制作了一个视觉上完美的 Paypal 欺骗网站，在那里甚至显示短暂浏览器 UI 的用户手势都被拦截，并显示虚假指示。这是可怕的事情，只有希望没有人会使用新的模式才能减轻。([范例概念验证](https://webdbg.com/test/fullscreenandauth.html))

几乎所有的移动操作系统都面临着同样的问题——由于 UI 空间的限制，没有值得信任的像素，这使得任何应用程序都可以欺骗另一个应用程序或操作系统本身。历史上，一些操作系统试图通过引入一种始终显示可信 UI 的**安全用户手势**(在 Windows 上，是 Ctrl+Alt+Delete)来缓解这一问题，但这种措施往往会让用户感到困惑(限制了他们的效率)，而且当 UX 团队的设计师获得产品时，往往会“优化掉”。

看看 WebVR 如何试图在更大的范围内解决这个问题将会很有趣。

## 更新:PWA 窗口控件覆盖

从 Microsoft Edge 版本 105 开始，作为渐进式 Web 应用程序安装的 Web 应用程序可以利用一项新功能，应用程序的作者可以控制窗口的几乎每个像素，这与传统的本机代码应用程序非常相似:

你可以在 Edge 团队的窗口覆盖控制博客文章中读到更多关于这个功能的内容。从攻击者的角度来看，这种新的 PWA 功能具有相当高的准入门槛——要滥用它，你必须已经说服用户“安装”你的恶意应用程序，如果你能做到这一点，你很可能已经让他们进行其他危险的操作。

## 超越浏览器

当然，其他应用程序也有 LoD 的概念，包括 web 应用程序。不幸的是，他们经常弄错。考虑 Outlook.com 对一封电子邮件的渲染:

当 Outlook 收到来自可信发件人的电子邮件时，他们会通过“此邮件来自可信发件人”来通知用户注意。它直接出现在死亡地带:

大胆的网络钓鱼者利用了这一点，在他们的网络钓鱼内容上生成他们自己的假冒“可信发件人”通知。针对[电子邮件签名机制](https://int21.de/slides/sec-t-lightning-pgp/#/)也存在类似的攻击。

安全 UI 比较硬。

埃里克

他们为什么要伪造许可提示？他们会得到什么？“你问？因为对于一个真正的权限提示，如果你点击**阻止**，他们就再也不会问你了，而对于一个假的提示，他们可以随意给你发垃圾邮件。另一方面，如果你点击**允许**，他们会立即呈现*真实*提示。

### 像这样:

像 装...