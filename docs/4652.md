# 监控和可观察性。与几个朋友午餐时，在深夜… |由辛迪 Sridharan |媒体

> 原文：<https://medium.com/@copyconstruct/monitoring-and-observability-8417d1952e1c?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

# 监控和可观察性

在 7 月下旬与几个朋友共进午餐时，可观察性的话题被提了出来。在不到一个月的时间里，我有一个关于[速度](https://conferences.oreilly.com/velocity/vl-ny)的演讲，名为 ***云原生*** 时代的监控，所以我一直在和朋友们谈论他们如何在他们工作的地方进行监控。在这次谈话中，我的一个朋友提到:



他只是半开玩笑。我听过这个笑话的几种变体，其中一些是:

> —为什么称之为监控？这已经不够性感了。
> 
> —可观察性，因为将运营更名为开发运营还不够糟糕，现在他们也在进行开发监控
> 
> ——这是不是应该像德沃普斯的第二次降临？或者是第二种方式？我不记得了。反正这一切都感觉如此邪教。

那么。“监控”和“可观察性”之间有什么区别？或者后者只是最新的时髦词汇，被鞭打和硬塞到我们的喉咙里，直到榨干它所有的价值？

## 从前有“监控”

“监控”传统上是运营工程师的专利。这个术语经常会在许多长期从事这项工作的人的脑海中唤起不太愉快的记忆，他们还记得 Nagios 是最先进的技术的时候。在许多人看来，“监控”让人回想起老式软件操作方式的许多不正常的方面，尤其是在那个完全主宰一切的时代可用的工具的不成熟，以至于“监控”这个术语直到今天还会让一些人想到简单的上/下检查。

诚然，十年前，up/down 检查可能是“监控”工具所能做到的全部，但近年来，“监控”工具已经有了很大的发展*，以至于很多很多人不再认为监控只是外部 pings。虽然他们可能仍然称之为“监控”，但他们使用的方法和工具更加强大和简化。时间序列、日志和跟踪如今比以往任何时候都更加流行，是“*白盒*监控”的一种形式，指的是基于从系统内部获得的信息的一类监控。*



*白盒监控不再是一个真正的革命性想法，至少自从 Etsy 发表了[开创性的博客文章](https://codeascraft.com/2011/02/15/measure-anything-measure-everything/)介绍`statsd`之后。这篇博文接着指出:*

> *一般来说，我们倾向于在三个层次上进行测量:网络、机器和应用。应用程序度量通常是三者中最难的，但也是最重要的。它们非常特定于您的业务，并且随着您的应用程序的变化而变化(Etsy 变化很大)。我们没有试图计划出我们想要测量的一切，并将其放入经典的[配置管理系统](http://www.opscode.com/chef/)中，而是决定让任何工程师几乎毫不费力地将他们可以计数或计时的任何东西放入图表中。*

*尽管有缺陷，`statsd`是一个*游戏规则改变者*，它的受欢迎程度和无处不在证明了它是如何引起业界广泛共鸣的，以至于大多数基于开源时间序列的系统以及商业监控解决方案多年来一直支持`statsd`风格的指标。虽然不完美，`statsd`风格度量收集是对以前“监控”方式的巨大改进。*

## *婴儿的第一次观察力*

*另一方面，“可观察性”是我几年前在 Twitter 的科技博客上阅读一篇[帖子](https://blog.twitter.com/engineering/en_us/a/2013/observability-at-twitter.html)时第一次遇到的术语，从那以后我就一直听到这个术语，不是在现实生活中，也不是在我工作过的地方，而是在科技会议上。Twitter 已经在其当前的可观察性堆栈上发布了一篇[两篇](https://blog.twitter.com/engineering/en_us/a/2016/observability-at-twitter-technical-overview-part-i.html)T4 篇的博文。这些帖子更多的是关于不同组件的架构，而不是术语本身，但是第一篇帖子的开头是这样说的:*

> *这是可观测性工程团队章程的四大支柱:*
> 
> *-监控
> -警报/可视化
> -分布式系统跟踪基础设施
> -日志聚合/分析*

*根据这个定义，“可观察性”是“监控”的一个超集，提供“监控”工具所不能提供的某些好处和见解。在检查这些收益可能是什么以及何时需要它们之前，让我们首先理解“监控”到底是什么，它的缺点是什么，以及为什么对于某些用例，仅仅“监控”是不够的。*

## *监控用于基于症状的警报*

*《SRE 书》中写道:*

> *您的监控系统应该解决两个问题:什么坏了，为什么坏了？“什么坏了”表示症状；“为什么”表示一个(可能是中间的)原因。“是什么”与“为什么”是编写具有最大信号和最小噪声的良好监控的最重要区别之一。*

*黑盒监控——即从外部将系统视为黑盒进行监控——我发现它非常擅长回答*出了什么问题*和对已经发生的问题发出警报(最好是对最终用户有影响)。另一方面，白盒监控对于我们可以提前*预测*并留意的信号来说是非常棒的。换句话说，白盒监控是针对系统的 ***已知的、硬的*** 故障模式，可以说，这种类型很容易以*可控制的*方式显示任何偏差。*

*需要“监控”的一个很好的例子是存储服务器用完了磁盘空间，或者代理服务器用完了文件描述符。与内存绑定服务相比，I/O 绑定服务具有不同的故障模式。与 CP 系统相比，AP 系统具有不同的故障模式。*



*构建“可监控”系统需要能够主动了解系统关键组件 ***的故障域。*** 这是个高要求。*特别是*对于复杂系统。对于简单的系统来说更是如此，这些系统之间的交互*很复杂*。*



*One of my favorite kellabyte rants of all time*



*一个系统越成熟，其故障模式就越容易理解。久经沙场的[、【无聊】技术](http://mcfunley.com/choose-boring-technology)往往伴随着[广为人知、广为人知和*可监控的*故障模式](https://medium.com/@Pinterest_Engineering/learn-to-stop-using-shiny-new-things-and-love-mysql-3e1613c2ce14)。在构建系统时，能够完全设计出故障模式是一个人能做的最好的事情。一个人能做的下一个最好的事情是能够“监控”即将发生的故障并相应地发出警报。*

*这听起来可能很奇怪，但我开始认为构建系统的设计目标之一应该是尽可能地使其可监控，这意味着将未知的数量最小化。为了使监控*有效，*能够识别系统的一小组硬故障模式或能够准确指示系统健康状况的一组核心指标变得非常重要。有些人认为，理想的“监控”信号数量是 3-5 个，绝对不能超过 7-10 个。在我和朋友的交谈中，经常出现的一个常见问题是*的“监控”有多吵。或者正如我的一个朋友所说，**

> *我们有**吨** *吨*的度量标准。我们试图收集 ***一切*** 但是绝大多数这些指标从来没有被关注过。这导致了严重的度量疲劳，以至于我们的一些工程师现在看不到向组合中添加新度量的意义，因为当只有少数度量真正被使用时，为什么还要费心呢？*

*SRE 的书对此提出了警告:*

> *潜在复杂性的来源是永无止境的。像所有的软件系统一样，监控会变得非常复杂，以至于变得脆弱、复杂，并且成为维护负担。因此，设计您的监控系统时要着眼于简单性。在选择要监视的内容时，请记住以下准则:*
> 
> *—最常捕捉真实事件的规则应该尽可能简单、可预测和可靠。
> —很少使用的数据收集、聚合和警报配置(例如，一些 SRE 团队不到一个季度一次)应该删除。
> —收集到的信号，但未在任何预烘焙仪表板中显示，也未被任何警报使用，是移除的候选者。*

*前述几点的推论是*监控*数据*T3】需要*可操作。*我从与许多人的交谈中收集到的信息是，当监控数据不用于直接驱动警报时，应该对其进行优化，以提供系统总体健康状况的鸟瞰图*。在出现故障时，监控数据应该能够立即提供故障影响的可见性，以及所部署的任何修复的效果。这里需要理解的重要一点是，监控并不能保证完全避免故障。监控提供了一个系统健康状况的良好近似*,但是监控不能完全防止 T11 故障。****

*我写这篇文章感到特别痛苦，因为就在上周，我工作的地方出现了几个小时的性能下降。这不是我们监控上的空白造成的。这是 MySQL 表现出的最糟糕的失败模式之一。无聊的老 MySQL 是几年前选择的，因为它的无聊和成熟以及我们以前的经验。无聊的旧 MySQL 在被引入堆栈时是正确的选择，但考虑到我们不断发展的需求，这不再是正确的选择。就像监控一样，无聊技术本身并不是万能的。*

*监控可以提供一个系统在野外的性能和行为的全景。监控还可以通过否定一个人对系统设计选择的假设，极大地帮助理解系统的缺点和不断发展的需求。因此，监控是构建、操作和运行系统的绝对*要求*。然而，它并没有使我们的系统完全*固若金汤*失败，这也不应该是它的*目标*。*

## *然后是“可观察性”*

*再次引用 SRE 的书:*

> *将监视与检查复杂系统的其他方面结合起来可能很有吸引力，例如详细的系统概要分析、单进程调试、跟踪异常或崩溃的详细信息、负载测试、日志收集和分析或流量检查。虽然这些主题中的大多数都与基本监控有共同之处，但是将太多的主题混合在一起会导致系统过于复杂和脆弱。*

*SRE 的书并没有完全使用“可观察性”这个术语，但清楚地列出了“监控”不是也不应该成为的一切。我发现这是一个有趣的悖论，复杂系统的“监控”本身应该是简单的。然而，这是完全有道理的，因为经验证明，另一种选择是不够的。*

*“监控”和“可观察性”的目标是不同的。“可观察性”不是“监控”的替代品，也不排除“监控”的必要性；它们是互补的。“可观察性”可能是一个新奇的术语，但它真的不是一个新颖的想法。事件、跟踪、异常跟踪都是日志的衍生物，如果你一直在使用这些工具中的任何一个，你已经有了某种形式的“可观察性”。的确，新工具和新供应商对这个术语会有他们自己的定义和理解，但本质上“可观察性”抓住了“监控”所没有的东西(理想情况下，*不应该*)。*

*“监控”最适合报告系统的整体健康状况。旨在“监控一切”可能被证明是一种反模式。因此，监控最好局限于从基于时间序列的仪器、已知故障模式以及黑盒测试中获得的关键业务和系统指标。另一方面，“可观察性”旨在提供对系统 ***行为的高度精细的洞察，以及丰富的上下文*** ，非常适合调试目的。既然仍然不可能预测一个系统可能遇到的每一种故障模式，或者预测一个系统可能*行为不端*的每一种可能方式，那么我们构建能够 ***调试*** 的系统就变得很重要，这需要证据而不是猜测。*



## ***调试***

*我最近最喜欢的两个演讲是 [***在炮火下调试:当系统失去理智时保持冷静***](https://www.youtube.com/watch?v=30jNsCVLpAE) 和 [**斑马一路向下:数据路径的工程挑战**](https://www.youtube.com/watch?v=fE2KDzZaxvE) ，都是由 [Bryan Cantrill](https://twitter.com/bcantrill) 所作。因为我可能说不出更好的话，所以我将从这些演讲中借用几张幻灯片(整个系列绝对值得一看)。*







*调试是一个*迭代*的过程，包括对系统报告的各种观察和事实进行迭代自省，做出正确的推断，并测试理论是否成立。证据不能凭空变出来，也不能从总量、平均值、百分位数、历史模式或主要为*监测*目的收集的任何其他形式的数据中推断出来。证据需要由系统以高度精确和上下文相关的事实和观察的形式*报告*，这些证据可以在以后的调试中使用，以推断为什么某些事情可能没有按预期工作。*



*此外，与以*已知* *故障为中心*的“监控”不同，“可观察性”不一定与停电或用户投诉紧密相关。它可以作为一种更好地理解系统性能和行为的方法，即使是在系统的“正常”运行期间。*

## *背景很重要*

*在我最近的谈话中出现的另一个主题是，简单地购买或安装一个工具并不能让组织中的每个人都真正使用它。正如我与之交谈的一个人沮丧地指出的那样:*

> *我们有齐普金！我们不遗余力地拉拢开发人员来装备一切，让 Zipkin 启动并运行，但是开发团队并不怎么使用它。回想起来，这不值得努力。*

*工具只能帮到这么多。在购买或构建一个工具之前，评估它能为特定团队面临的一系列独特的工程挑战提供的最大效用变得很重要。然而，我的另一个朋友对我说，他在一个非常受欢迎的开源项目中工作，这个项目是按照一个大公司内部工具的思路建模的:*

> *几年前我们开源[编辑]的时候，邮件列表里的问题都是非常智能和高质量的。既然[修订版]已经变得非常流行，我们看到的是问题的质量正在直线下降。我们现在有企业问我们是否可以提供[编校]作为 SaaS 服务，因为他们自己承认他们的开发者不是想要或者将能够自己运行[编校]的时髦类型。*

*背景是关键。在 X 公司运行良好的工具不一定在 y 公司也能运行良好，尤其是在将大公司的工具带给大众的时候。组织结构和文化、开发人员和操作工程师的素质、已经在使用的工具、代码库的状态、对风险的偏好都在很大程度上影响一个工具的成功程度。*

## *最后一件事*

*观察可以引导开发人员找到答案，但不能让他们找到答案。检查手头的证据(观察)并能够推断的过程仍然需要对系统、领域以及良好的直觉有很好的理解。再多的“可观察性”或“监控”工具都不能替代良好的工程直觉和本能。*















