# 网飞的艺术品个性化|网飞科技博客|网飞科技博客

> 原文:[https://medium . com/网飞-tech blog/artwork-personal ization-c 589 f 074 ad 76？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://medium.com/netflix-techblog/artwork-personalization-c589f074ad76?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

# 网飞的艺术品个性化

由[阿肖克·钱德拉舍卡](https://www.linkedin.com/in/ashok-chandrashekar-31195154/)、[费尔南多·艾买提](https://www.linkedin.com/in/fernando-amat-6110931/)、[贾斯汀·巴西利科](https://twitter.com/JustinBasilico)和[托尼·杰巴拉](https://twitter.com/TonyJebara)

多年来，网飞个性化推荐系统的主要目标是在正确的时间将正确的书目呈现在我们每个成员的面前。拥有涵盖数千种图书的目录和涵盖一亿多个账户的多元化会员基础，为每个会员推荐合适的图书至关重要。但是推荐工作并没有就此结束。你为什么要关心我们推荐的任何特定标题呢？对于一个新的不熟悉的标题，我们能说些什么来激起你的兴趣呢？我们如何让你相信一个标题值得一看？回答这些问题对于帮助我们的会员发现优秀内容至关重要，尤其是对于不熟悉的标题。应对这一挑战的一个途径是考虑我们用来描绘标题的艺术品或图像。如果代表一个标题的艺术作品抓住了一些吸引你的东西，那么它就像一扇通往那个标题的大门，给你一些视觉上的“证据”，说明为什么这个标题可能对你有好处。艺术作品可能会突出您认识的演员，捕捉汽车追逐等激动人心的时刻，或包含传达电影或电视节目本质的戏剧场景。如果我们在你的主页上展示完美的图片(正如他们所说:一张图片胜过千言万语)，那么也许，仅仅是也许，你会尝试一下。这也是网飞不同于传统媒体的另一个方面:我们没有一种产品，而是有超过 1 亿种不同的产品，为我们的每个成员提供一种个性化的推荐和个性化的视觉效果。



A Netflix homepage without artwork. This is how historically our recommendation algorithms viewed a page.



在[之前的](https://medium.com/netflix-techblog/selecting-the-best-artwork-for-videos-through-a-b-testing-f6155c4595f6) [作品](https://media.netflix.com/en/company-blog/the-power-of-a-picture)中，我们讨论了在*所有*我们的成员中为每个标题寻找单一完美艺术品的努力。通过多臂强盗算法，我们为一个标题搜寻最好的艺术作品，比如说更奇怪的东西，这将从我们最大部分的成员那里获得最多的播放。然而，考虑到品味和偏好的巨大差异，如果我们能为我们的每个成员找到最好的艺术作品来突出与他们特别相关的方面不是更好吗？



Artwork for Stranger Things that each receive over 5% of impressions from our personalization algorithm. Different images cover a breadth of themes in the show to go beyond what any single image portrays.



作为灵感，让我们探索艺术作品个性化有意义的场景。考虑下面的例子，其中不同的成员具有不同的观看历史。左边是一个成员过去看的三个标题。箭头的右边是我们为会员推荐的特定电影的插图。

让我们考虑尝试个性化我们用来描绘电影《心灵捕手》的图像。在这里，我们可以根据成员对不同风格和主题的偏好程度来个性化这个决定。如果我们展示包含马特·达蒙和明妮·德瑞弗的艺术作品，看过许多浪漫电影的人可能会对善意狩猎感兴趣，而如果我们使用包含著名喜剧演员罗宾·威廉姆斯的艺术作品，则看过许多喜剧的成员可能会被电影吸引。



在另一个场景中，让我们想象一下演员的不同偏好会如何影响电影《低俗小说》的艺术作品的个性化。一个观看了许多乌玛·瑟曼电影的会员可能会对含有 Uma 的低俗小说的艺术作品做出积极的反应。与此同时，如果低俗小说以约翰为主角，约翰·特拉沃尔塔的粉丝可能会更有兴趣观看低俗小说。



当然，并不是所有个性化艺术品的场景都如此清晰和明显。因此，我们不列举这种手动导出的规则，而是依靠数据来告诉我们使用什么信号。总的来说，通过个性化的艺术作品，我们帮助每个标题向每个会员展示其最佳的一面，从而改善我们的会员体验。

# 挑战

在网飞，我们拥抱个性化，并在算法上适应我们会员体验的许多方面，包括我们为主页选择的[行](https://medium.com/netflix-techblog/learning-a-personalized-homepage-aa8ec670359a)，我们为这些行选择的[标题](https://medium.com/netflix-techblog/netflix-recommendations-beyond-the-5-stars-part-2-d9b96aa399f5)，我们展示的画廊，我们发送的消息，等等。我们个性化的每个新方面都有独特的挑战；个性化我们展示的艺术品也不例外，并提出了不同的个性化挑战。图像个性化的一个挑战是，我们只能*选择*一个单独的*艺术品来代表我们展示它的每个地方的每个标题。相比之下，典型的推荐设置让我们向成员呈现*多选*，我们可以随后从成员选择的项目中了解他们的偏好。这意味着图像选择是一个封闭循环中的先有鸡还是先有蛋的问题:如果一个成员播放一个标题，它只能来自我们决定呈现给该成员的图像。我们试图了解的是*何时*为标题*展示特定的艺术作品影响*成员播放(或不播放)标题，以及*何时*成员会播放(或不播放)标题*而不管*我们展示的是哪张图片。因此，艺术品个性化位于传统推荐问题之上，算法需要相互配合工作。当然，为了正确地学习如何个性化艺术品，我们需要收集大量的数据来寻找信号，表明一件艺术品何时对会员明显更好。*

另一个挑战是理解我们在两次会议之间为一个成员展示一个标题而改变作品的影响。改变作品是否会降低标题的可识别性，并使其难以在视觉上再次定位标题，例如，如果成员认为之前感兴趣但尚未观看它？或者，改变艺术品本身是否会导致会员因为选择的改进而重新考虑它？很明显，如果我们找到更好的艺术品呈现给会员，我们可能会使用它；但是持续的变化也会让人迷惑。改变图像也引入了归属问题，因为变得不清楚哪个图像导致成员对标题感兴趣。

接下来，我们面临的挑战是，如何理解一幅作品相对于我们在同一页面或会话中选择的其他作品的表现。也许一个醒目的主角特写可以作为一个页面的标题，因为它比其他作品更突出。但是如果每个标题都有相似的图片，那么整个页面可能看起来就不那么吸引人了。孤立地看每一件艺术品可能是不够的，我们需要考虑如何在一个页面和整个会话中选择一组不同的图像。除了其他标题的插图，标题插图的有效性可能取决于其他类型的证据和资产(如概要、预告片等。)我们也显示为标题。因此，我们可能需要一个多样化的选择，每一个都可以突出一个标题的互补方面，这可能会吸引一个成员。

为了实现有效的个性化，我们还需要为每个标题准备一个好的艺术作品库。这意味着我们需要几个资产，每个资产都是引人入胜的、信息丰富的、有代表性的，以避免“点击诱饵”。标题的图像集也需要足够多样化，以覆盖对内容的不同方面感兴趣的广泛的潜在观众。毕竟，一件艺术品到底有多吸引人，有多丰富的信息，取决于看它的人。因此，我们需要的作品不仅要突出不同的主题，还要突出不同的审美。我们的艺术家和设计师团队努力创造多种多样的图像。他们还考虑了个性化算法，这些算法将在他们创作艺术作品的过程中选择图像。

最后，大规模个性化艺术品还有工程上的挑战。一个挑战是，我们的会员体验非常直观，因此包含许多图像。因此，对每个资产使用个性化选择意味着以低延迟处理每秒超过 2000 万个请求的峰值。这样的系统必须是健壮的:不能在我们的 UI 中正确地呈现艺术品会大大降低体验。我们的个性化算法还需要在标题启动时快速响应，这意味着在冷启动的情况下快速学习个性化。然后，在推出后，算法必须不断适应，因为艺术品的有效性可能会随着时间的推移而变化，因为标题在其生命周期中不断发展，会员的口味也在不断变化。

# 背景强盗方法

网飞推荐引擎的大部分是由机器学习算法驱动的。传统上，我们收集一批关于我们的成员如何使用服务的数据。然后我们对这批数据运行新的机器学习算法。接下来，我们通过 [A/B 测试](https://medium.com/netflix-techblog/its-all-a-bout-testing-the-netflix-experimentation-platform-4e1ca458c15)针对当前生产系统测试这个新算法。A/B 测试通过在成员的随机子集上进行试验，帮助我们了解新算法是否优于我们当前的生产系统。A 组成员获得当前的生产经验，而 B 组成员获得新的算法。如果 B 组的成员对网飞有更高的参与度，那么我们就向全体成员推广新算法。不幸的是，这种批处理方法招致遗憾:许多成员在很长一段时间内没有从更好的体验中受益。下图对此进行了说明。





为了减少这种遗憾，我们远离批处理机器学习，考虑在线机器学习。对于艺术品个性化，我们使用的具体在线学习框架是*语境强盗*。与其等着收集一整批数据，等着学习一个模型，然后等着 A/B 测试得出结论，上下文强盗们会迅速为每个成员和上下文找出最佳的个性化艺术作品选择。简而言之，上下文土匪是一类在线学习算法，其在收集持续学习无偏模型所需的训练数据的成本与将学习的模型应用于每个成员上下文的好处之间进行权衡。在我们之前的[非个性化图像选择工作](https://medium.com/netflix-techblog/selecting-the-best-artwork-for-videos-through-a-b-testing-f6155c4595f6)中，我们使用了非上下文土匪，不管上下文如何，我们都能找到获胜的图像。对于个性化，成员是*上下文*，因为我们期望不同的成员对图像有不同的反应。

情境强盗的一个关键特性是，它们被设计用来*最小化*后悔。在高层次上，通过在学习模型的预测中注入受控的随机化来获得上下文土匪的训练数据。随机化方案在复杂性上可以变化，从具有均匀随机性的简单ε-贪婪公式到根据模型不确定性自适应地改变随机化程度的闭环方案。我们将这一过程统称为*数据探索*。可用于一个标题的候选艺术品的数量以及将为其部署该系统的总人口的规模告知了数据探索策略的选择。在这样的探索中，我们需要记录每个作品选择的随机化信息。这种日志记录允许我们纠正偏斜的选择倾向，从而以公正的方式执行离线模型评估，如后面所述。

由于我们在会员会话中选择的作品可能不会使用该会话的最佳预测图像，因此在上下文环境中的探索通常是有成本(或遗憾)的。这种随机化对会员体验有什么影响(从而对我们的指标有什么影响)？exploration 拥有超过 1 亿名会员，因此产生的遗憾通常非常小，并且分摊到我们庞大的会员群中，每个会员都暗中帮助为目录的一小部分提供关于艺术品的反馈。这使得每个成员的探索成本可以忽略不计，这是在选择上下文强盗来驱动我们的成员体验的一个关键方面时的一个重要考虑因素。如果探索的成本很高，那么随机选择和用背景强盗进行探索就不太合适了。

在我们的在线探索方案下，我们获得一个训练数据集，该数据集为每个(成员、标题、图像)元组记录该选择是否导致标题的播放。此外，我们可以控制探索，使艺术作品的选择不会改变太频繁。这使得会员对特定艺术品的参与度更加清晰。我们还通过查看参与质量来仔细确定每个观察的标签，以避免学习推荐“点击诱饵”图像的模型:这些图像诱使成员开始玩游戏，但最终导致低质量的参与。

## 模特培训

在这个在线学习环境中，我们训练我们的上下文 bandit 模型，根据每个成员的上下文为他们选择最好的作品。我们通常每个标题有几十个候选作品图像。为了学习选择模型，我们可以考虑一个问题的简化，通过在标题之间独立地排列成员的图像。即使进行了这种简化，我们仍然可以了解不同标题的成员图像偏好，因为对于每个候选图像，我们都有一些收到该图像并参与该标题的成员，以及一些收到该图像但没有参与的成员。可以对这些偏好进行建模，以便为每个(成员、标题、图像)元组预测该成员将享受高质量参与的概率。这些可以是监督学习模型，也可以是具有 Thompson 采样、LinUCB 或贝叶斯方法的上下文 bandit 对应物，它们可以智能地平衡做出最佳预测和数据探索。

## 潜在信号

在上下文土匪中，上下文通常被表示为作为模型的输入而提供的特征向量。对于这个问题，我们可以使用许多信号作为特征。特别是，我们可以考虑成员的许多属性:他们播放的标题、标题的类型、成员与特定标题的交互、他们的国家、他们的语言偏好、成员使用的设备、一天中的时间和星期几。由于我们的算法结合我们的个性化推荐引擎来选择图像，我们还可以使用关于我们的各种推荐算法如何看待标题的信号，而不管用什么图像来表示它。

一个重要的考虑因素是，一些图像自然比候选池中的其他图像更好。在我们的数据探索中，我们观察了所有图像的总体*拍摄率*，它只是高质量播放的数量除以印象的数量。我们之前在非个性化艺术品选择方面的工作使用了拍摄率的总体差异来确定为整个人群选择的最佳图像。在我们新的上下文个性化模型中，总体接受率仍然很重要，个性化仍然恢复与非个性化模型的排名平均一致的选择。

## 图像选择

图像作品到成员的最优分配是一个从标题的可用图像池中找到最佳候选图像的选择问题。一旦模型如上所述被训练，我们使用它来为每个上下文的图像排序。该模型预测在给定的成员上下文中给定图像的播放概率。我们根据这些概率对候选图像集进行排序，并挑选概率最高的一个。这就是我们呈现给那个特定成员的形象。

# 性能赋值

## 脱机的

为了评估我们的上下文强盗算法，然后将它们在线部署到真实成员上，我们可以使用一种称为*重放* [ [1](https://dl.acm.org/citation.cfm?id=1935878) 的离线技术。这种方法允许我们根据记录的勘探数据回答反事实问题(图 1)。换句话说，如果我们以一种不偏不倚的方式使用不同的算法，我们可以离线比较不同场景下的历史会话中会发生什么。



**Figure 1: Simple example of calculating a replay metric from logged data. For each member, a random image was assigned (top row). The system logged the impression and whether the profile played the title (green circle) or not (red circle). The replay metric for a new model is calculated by matching the profiles where the random assignment and the model assignment are the same (black square) and computing the take fraction over that subset.**



重放让我们看到，如果我们假设展示的图像是通过新算法而不是生产中使用的算法选择的，成员们会如何处理我们的标题。对于图像，我们对几个指标感兴趣，特别是拍摄比例，如上所述。图 2 显示了与随机选择或非上下文相关的 bandit 相比，上下文相关的 bandit 方法如何帮助提高整个目录的平均 take 分数。



**Figure 2: Average image take fraction (the higher the better) for different algorithms based on replay from logged image explore data. The Random (green) policy selects one image at random. The simple Bandit algorithm (yellow) selects the image with highest take fraction. Contextual Bandit algorithms (blue and pink) use context to select different images for different members.**





**Figure 3: Example of contextual image selection based on the type of profile. Comedy refers to a profile that mostly watches comedy titles. Similarly, Romance watches mostly romantic titles. The contextual bandit selects the image of Robin Williams, a famous comedian, for comedy-inclined profiles while selecting an image of a kissing couple for profiles more inclined towards romance.**



## 在线的

在离线实验了许多不同的模型并找到了重放次数大幅增加的模型后，我们最终进行了 A/B 测试，以比较最有希望的个性化上下文土匪与非个性化土匪。正如我们所怀疑的那样，个性化起了作用，并在我们的核心指标上产生了显著的提升。我们也看到了我们在回放中离线测量的数据和我们在模型中在线看到的数据之间的合理关联。在线结果也产生了一些有趣的见解。例如，在成员之前没有与标题交互的情况下，个性化的改进更大。这是有道理的，因为当一个标题不太熟悉时，我们会认为这个艺术品对某人来说更重要。

# 结论

通过这种方式，我们已经迈出了第一步，为我们的推荐和整个服务个性化选择艺术品。这使得我们的成员发现新内容的方式有了有意义的改进…所以我们已经向每个人推出了它！这个项目不仅个性化了我们推荐的内容，也个性化了我们如何推荐给我们的会员。但是有很多机会来扩展和改进这种最初的方法。这些机会包括开发算法，通过尽快个性化新图像和新标题来处理冷启动，例如通过使用计算机视觉技术。另一个机会是将这种个性化方法扩展到我们使用的其他类型的艺术品和描述我们标题的其他证据，如概要、元数据和预告片。还有一个更广泛的问题:帮助艺术家和设计师找出我们应该在布景中添加哪些新的图像，以使标题更加引人注目和个性化。

如果您对这些挑战感兴趣，请告诉我们！我们一直在寻找优秀的人才加入我们的团队，对于这些类型的项目，我们特别期待拥有[机器学习](http://jobs.netflix.com/search?q=%22machine%20learning%22)和/或[计算机视觉](http://jobs.netflix.com/search?q=%22computer%20vision%22)专业知识的候选人。

# 参考

[1] L. Li，W. Chu，J. Langford 和 X. Wang，“基于上下文信息的新闻文章推荐算法的无偏离线评估”，载于第四届 ACM 网络搜索和数据挖掘国际会议论文集*，美国纽约州纽约市，2011 年，第 297–306 页。*







