# RethinkDB:我们失败的原因| defmacro

> 原文：<http://www.defmacro.org/2017/01/18/why-rethinkdb-failed.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

当我们[宣布【RethinkDB 正在关闭时，我答应写一篇分析文章。我花了一些时间来处理这段经历，现在我可以清楚地写下来。](https://rethinkdb.com/blog/rethinkdb-shutdown/)

在 [HN 讨论帖](https://news.ycombinator.com/item?id=12649414)中，人们提出了 RethinkDB 失败的许多原因，从人类本性的莫名其妙的反常和 MongoDB 营销人员的聪明诡计，到未能建立一个经验丰富的走向市场团队，到缺乏 64 位之外的数字类型支持`float`。我把这些评论汇总成一个失败原因的列表[，这里是](https://gist.github.com/coffeemug/af8dcb6f653a7f9c31daedbbdaa3402c)。

这些原因中有些听起来很有道理，但它们是症状而不是原因。例如，说我们未能赚钱是同义反复。它没有阐明*为什么*我们失败的原因。

事后看来，有两件事出了差错——我们选择了一个糟糕的市场，并针对错误的品质标准优化了产品。每一个错误都可能让 RethinkDB 的估值下降一到两个数量级。因此，如果我们做对了其中任何一个，RethinkDB 将会是 MongoDB 的大小，如果我们做对了两个，我们最终将会是 Red Hat 的大小[1]。

# 可怕的市场

我们的想法是这样的。新公司不会建立在甲骨文的基础上，所以有机会建立一个新的基础设施公司。数据库市场是巨大的。如果我们生产的产品能占领部分市场，我们最终会建立一个非常成功的公司。

不幸的是，你并不在你认为你在的市场中——你在你的用户认为你在的市场中。我们的用户显然认为我们是一家开源开发工具公司，因为这就是我们的真实身份。这被证明是非常不幸的，因为开源开发者工具市场是[最糟糕的市场之一](https://techcrunch.com/2014/02/13/please-dont-tell-me-you-want-to-be-the-next-red-hat/)，一个人可能会在结束[。成千上万的人使用 RethinkDB，通常是在商业环境中，但大多数人愿意支付比一杯星巴克咖啡更低的终身使用费用(也就是说，他们根本不愿意支付任何费用)。](https://techcrunch.com/2014/08/22/will-developer-tools-startups-ever-find-investors/)

这不是因为产品太好了，人们不需要为支持付费，也不是因为开发者不控制预算，或者因为资本主义的失败。答案是基础微观经济学。开发人员喜欢构建开发人员工具，通常是免费的。因此，尽管有巨大的需求，供应远远超过它。这[推动](https://en.wikipedia.org/wiki/Porter's_five_forces_analysis)替代品的数量上升，价格下降到零。

要了解这种情况对其他公司的影响，可以考虑 MongoDB(价值约 16 亿美元，拥有约 700 名员工)和 Docker(价值约 10 亿美元，拥有约 300 名员工)。两家公司在各自的市场上都完全占据主导地位。对于处于成长期的私营科技公司来说，两个非常粗略的经验法则是，估值是年收入的 10 倍，每个员工的收入大约是 20 万美元/年。这意味着 MongoDB 的年收入在 1.4 亿至 1.6 亿美元左右，Docker 的年收入在 6000 万至 1 亿美元左右。

这看起来很不错，直到你看到在市场中占主导地位的 B2B 技术公司，它们不是开发者工具。像 SalesForce、Palantir 或 Box(面临激烈竞争)这样的公司。突然之间，MongoDB 和 Docker 开始变得渺小。

这些都是巨大的成功。如果拥有现有合作关系、分销基础设施和大客户的相对成熟的公司在发展中遇到困难，这对处于萌芽阶段的初创公司意味着什么？

对我们来说，这意味着一个棘手的客户获取渠道。如果一个肥沃的 B2B 市场中的创业公司必须处理 100 个线索才能获得 10 个机会来达成一笔销售，那么对于一个开发工具创业公司来说，这个数字会上升 10 倍。你可以接触到大量高质量的潜在客户——很多人下载你的产品并与你接触，但你必须通过大量的线索才能达成一笔交易。

这产生了灾难性的多米诺骨牌效应。这会挫伤团队的士气，让吸引投资和雇佣顶尖人才变得非常困难。反过来，这限制了你的资源，所以你不能在产品和分销上进行足够的投资。创业公司的生死取决于势头，早期的分销挑战几乎总是注定你最终会死亡。

# 错误的品质标准

好吧，市场不景气，但其他开发工具公司仍在销售大量产品。为什么不重新思考 DB？

虽然我们对市场的动态变化无能为力(除了建立其他东西)，但产品决策完全在我们的控制之内。我们希望打造一款优雅、坚固、美观的产品，因此我们针对以下指标进行了优化:

*   **正确性。**我们做了非常严格的保证，[虔诚地履行了](https://aphyr.com/posts/329-jepsen-rethinkdb-2-1-5)他们。
*   界面的简单性。我们承担了实施中的大部分复杂性，因此应用程序开发人员不必承担。
*   **一致性。**从查询语言、客户端驱动程序、集群配置、文档到首页的营销文案，我们都尽可能做到了一致。

如果这些权衡看起来很熟悉，那么它们直接来自于“越差越好”的文章。事实证明，对大多数用户来说，正确性、界面的简单性和一致性是错误的 T2 衡量标准。大多数用户希望在这三个方面进行权衡:

*   **及时到达。**他们希望产品在他们需要的时候实际存在，而不是三年后。
*   **可触及的速度。**人们希望 RethinkDB 在工作负载上更快，他们*实际上尝试了*，而不是我们建议的“真实世界”工作负载。例如，他们会编写快速脚本来测量插入一万个文档需要多长时间，而不需要回读它们。MongoDB 出色地控制了这些工作负载，而我们却打了一场教育市场的败仗。
*   **一个用例。**我们着手为*构建一个好的数据库系统*，但是用户希望*有一个好的方法来做 X* (例如，一个存储来自 hapi 的 JSON 文档的好方法，一个存储和分析日志的好方法，一个创建报告的好方法，等等。)

这并不是说我们没有尝试快速发布，使 RethinkDB 快速，并围绕它建立生态系统，使做有用的工作变得容易。我们做到了。但是正确、简单和一致的软件需要很长时间来构建。这让我们落后市场三年。

当我们觉得 RethinkDB 满足了我们的设计目标，并且我们有足够的信心推荐它用于生产时，几乎每个人都在问“RethinkDB 与 MongoDB 有什么不同？”我们努力解释为什么正确性、简单性和一致性是重要的，但最终这些并不是对大多数用户来说重要的好的标准。

老实说，很疼。很疼。我们很难理解为什么人们会选择一个系统，它几乎不做它应该做的事情(存储数据)，有一个大的内核锁，随机丢弃错误，实现当你分片时停止工作的单节点功能，有一个几乎不工作的分片系统，尽管它是产品的核心功能之一，基本上不提供正确性保证，并且暴露了一个没有可辨别的一致性或统一性的接口大杂烩。

每次 MongoDB 发布新版本，人们祝贺他们做出了改进，我都会感到愤怒。他们会宣布他们修复了 BKL，但实际上他们会将粒度级别从数据库降低到集合。他们会添加更多的操作，但不是一个适合系统其余部分的可组合接口，而是简单地附加上一次性命令。他们会对分片进行改进，但是很明显他们不愿意或者不能保证最基本的数据一致性。

但随着时间的推移，我学会了欣赏群众的智慧。MongoDB 在人们需要的时候把普通开发人员变成了英雄，而不是在事情发生多年后。它使数据存储速度更快，并让人们快速运送产品。随着时间的推移，MongoDB 成长了起来。一个接一个，他们修复了架构的问题，现在它是一个优秀的产品。它可能没有我们想要的那么漂亮，但它确实起了作用，而且做得很好。

当我们在 2014 年年中变得明显无法竞争时，我们努力与 MongoDB 区分开来。我们找到了一种非常优雅的方式来添加[实时推送](https://rethinkdb.com/blog/1.16-release/)，希望能够让开发者构建他们之前无法构建的一代应用。但这还不够。突然，我们发现自己在与 Meteor 和 Firebase 竞争，这两家公司在我们想到实时问题之前就致力于解决这个问题。我们又一次落后市场三年，又一次发现自己无法竞争。

# 云呢？

一些人建议我们应该构建一个云产品。我们实际上已经有一个在工作中，所以这是一个有趣的话题，我想涵盖。

小型数据库公司构建云服务的一个明显问题是，它的模式与一种常见的创业失败模式相匹配——分散焦点。构建、交付和运营可靠的多租户云服务非常困难。这需要非同小可的专业知识和资源，所以如果你沿着这条路走下去，你会发现自己同时经营着两家创业公司。但是我们面临着生死存亡的威胁，很快就别无选择，所以我们还是试了一试。让我们暂时假设我们能成功。

我们的推理是这样的。数据库云产品可能意味着三件事之一:托管、数据库即服务(DBaaS)或增值平台即服务(PaaS)。让我们用 20 万美元/名员工的年收入来快速回顾一下餐巾纸市场分析[我们上面使用的经验法则](https://www.saastr.com/how-to-figure-out-your-competitors-revenues-in-about-70-seconds/):

|   | 托管托管 | 巴波斯 | PaaS |
| --- | --- | --- | --- |
| **公司** | 我，mLab | FaunaDB | 解析，火焰基地，流星 |
| **员工** | ~30 | ~30 | ~30 |
| **收入** | 低于 1000 万美元 | 低于 1000 万美元 | 低于 1000 万美元 |

所以这些市场很小，甚至比数据库市场本身还要小。但是他们中的一个会比其他的更好吗？

托管本质上是为 AWS 上的人运行数据库，所以他们不必这么做。使用这些服务的替代方法是自己在 AWS 上设置数据库。这很痛苦，但实际上并没有那么难。因此，托管数据库托管服务的收费有一个非常严格的上限。考虑到 Compose.io 和 mLab 提供的 MongoDB 的用户数量比 RethinkDB 多一到两个数量级，我们认为提供托管服务不会有什么影响。

数据库即服务是托管的一个更复杂的版本，DBaaS 产品完全从用户那里抽象出节点管理。您只需运行您的查询，系统就会处理它们。你不知道有多少节点在运行。这项业务非常具有挑战性——部分原因是 DBaaS 公司必须与巨头竞争(例如 DynamoDB 和 DocumentDB ),部分原因是当有如此多的其他替代品和备选方案时，客户非常抗拒将数据管理完全交给初创公司(你*是否*认识任何使用初创公司 DBaaS 产品的人？)所以 DBaaS 产品已经过时了。

最后一个选择是构建增值平台即服务。我们认为这是一个有前途的方向，因为我们在这方面有巨大的技术优势。Firebase 和 Meteor 必须在 MongoDB 之上构建应用级实时逻辑，这从根本上限制了实时查询能力和大规模性能。另一方面，我们一直控制着堆栈，所以我们可以提供 Firebase 和 Meteor 无法提供的显著优势。

因此，我们建立了 [Horizon](http://horizon.io/) 并开始致力于 Horizon Cloud——这是用户部署和扩展 RethinkDB/Horizon 应用程序的一种方式。在一个非常小的团队中构建三个大型项目(RethinkDB、Horizon 和 Horizon Cloud)的挑战最终困扰了我们，我们从未能在资金耗尽之前交付云产品。不过，还是要表扬工程团队。他们非常非常接近。

我们还可以进行一个层次的根本原因分析。为什么我们选择了一个糟糕的市场，并针对错误的指标优化了产品？

当我还是个小孩的时候，我想制造自己的收音机。我用胶合板做了一个盒子，往里面扔了一些金属垃圾，然后把盒子接上了电源线。我家里有关于电子学的书，但我不认为我需要它们——我坚定不移地相信我可以独自完成。最终我确实造出了一个可以工作的接收器，但我花了几年时间才最终意识到我需要学习基本的电子学。

早期的 RethinkDB 与此颇为相似。我们对产品或市场没有直觉，所以我们会在没有真正理解我们在做什么的情况下，经历建立一家公司的运动。此外，我们有巨大的乐观偏见。就像医生知道制药公司的礼物会对其他医生产生偏见，但认为他们不会受到这种影响一样，我们相信我们不会受到经济规律和经营企业数学的影响。当然，数学最终还是赶上了我们。

我们能做些什么来避免这些错误吗？就像我小时候造不出一台能用的收音机一样。我们无意识地无能，这种无能过了很多年才变得有意识。

一些人指出，如果我们建立了一个经验丰富的走向市场团队，我们会做得更好。那是 100%正确的，但是我们个人发展的时间安排与公司的需求不一致。最初，我们不知道我们需要走向市场的专业知识，所以我们没有寻求将其纳入创始团队[2]。当我们建立了一个很好地映射到现实的心理模型时，我们发现自己现金短缺，在一个充满强大竞争对手的困难市场中，一个产品落后了三年。到那时，世界上最好的上市团队也救不了我们。

# 离别的思绪

许多人对开发者工具市场有着非常强烈的感受。工程师喜欢构建开发工具，所以他们非常希望开发工具公司能够兴旺发达。

我不愿完全否定市场——部分原因是我不想从单一经验中得出结论，部分原因是我不喜欢说“这不可能”，部分原因是有相当多的例外。GitHub、MongoDB 和 Docker 已经建立了强大的公司。GitLab 和 Unity 似乎做得不错。

如果你打算建立一个开发者工具公司，小心行事。市场上充满了好的替代品。用户期望值高，价格低。深入思考你为客户提供的价值。记住——想要世界变成某种样子并不能让它变成那样。

2009 年，在 YCombinator 演示日，我们向一群投资者展示了 RethinkDB 的早期想法(当时我们还没有软件)。我们以一张包含三个需要记住的要点的幻灯片结束了推介。“如果你只记得关于 RethinkDB 的三件事，”我们说，“记住这些。”成功了。人们不记得球场的其他事情，但他们记得最后的三分。

我现在留给你们三个需要记住的要点。如果你记得这篇文章的任何内容，请记住:

*   选择一个大市场，但要为特定用户打造。
*   学会发现你缺少的人才，然后努力让他们加入你的团队。
*   虔诚地阅读经济学人。会让你好的更快。

* * *

不要过于仔细地解读这些数字。我只是粗略地说了一下，但它应该会让你对这些错误的代价有一个大致的概念。

顺便说一句，在没有强烈商业直觉的情况下识别优秀的商业人士，就像在没有强烈工程直觉的情况下识别优秀的工程师一样困难。