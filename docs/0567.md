# 深入了解提前输入搜索| Evernote | Evernote 博客

> 原文:[https://blog . evernote . com/tech/2013/05/21/an-inside-look-at-type-ahead-search-in-evernote/？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://blog.evernote.com/tech/2013/05/21/an-inside-look-at-type-ahead-search-in-evernote/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

当我加入 Evernote 时，我做的第一件事就是为 Evernote Mac 客户端设计和实现预输入搜索。

这是它今天的样子:

**![](../Images/647efb095641ec1fb74cbb3b240dce24.png)T2】**

我们中的大多数人，在某些时候，面对搜索框和闪烁的光标时，都面临着不知道到底要搜索什么的挑战。我们引入了提前输入搜索，通过在用户输入时从他们自己的笔记内容中为他们的搜索提供建议，来改善这种体验。

在这篇博文中，我想谈谈 Evernote 中提前输入搜索的一些实现细节。

## Evernote 的 Type Ahead 搜索品牌有什么独特之处？

对我们大多数人来说，提前输入搜索是第二天性。停一会儿，想象一下，如果在你输入的时候，谷歌不提供建议，那么在谷歌上搜索会是什么样子。尽管这在不久前还是一种常态，但我们现在已经开始期待在我们遇到的每个搜索框后出现一系列“聪明”的建议。

然而，并不是所有的搜索魔法都是平等的。首先，谷歌从不断增长的公众搜索查询语料库中获取建议。这对用户来说意味着，你看到的建议通常是其他人以前搜索过的，你可能不熟悉。然而，这种模式对于试图在世界范围内搜索信息的网络搜索引擎来说非常有效。作为对比，Evernote 中的搜索是非常个人化的体验。你在 Evernote 中看到的唯一搜索结果是你自己策划的，这也是我们应用于搜索建议的相同主题。对于我们的目的来说，语料库是单个用户的笔记集，它位于一个筒仓中，不能与任何其他用户的数据进行通信。因此，当许多其他服务谈论有“大数据”问题时，Evernote 有成千上万的“小数据”问题。每个数据集都是每个用户的，每个用户都是独一无二的。

另一个区别是从中提取建议的内容类型。许多支持提前输入搜索的 web 服务从有限(但很大)的集合中提供离散的建议——例如搜索查询、人或公司。相比之下，你在 Evernote 中看到的建议可以从你的任何笔记中出现的任何结构化或非结构化内容中提取，以任何你能读或写的语言。我们旨在通过分析笔记本身的内容，找出哪些建议与您相关。

## 选择实施平台

作为一家多平台公司，我们认为所有 Evernote 用户都应该在自己喜欢的设备上拥有一流的体验。尽管如此，当选择第一个提前输入搜索实现的平台时，我们需要做出一个重要的决定:我们应该构建一个可能跨客户端使用的服务器端系统，还是从单个客户端上的本地实现开始？首先，我们决定在 Mac 上进行本地化，原因如下:

1.  我们希望提前输入搜索，就像常规的搜索体验一样，可以离线工作。

2.  我们希望利用特定于平台的优化。例如，Mac OS 提供了一套丰富的语言 API，我们可以应用于这个问题。

3.  我们希望优化性能和出色的用户体验，即使这意味着我们要承担更多的工作。

## 本质(又称实现细节)

三个主要组成部分:建议索引、建议生成和建议检索。

### 建议指数

搜索建议存储在倒排索引中，与核心搜索索引分开。我们简要考虑了是否重用搜索索引，并发现，尽管它可以被强制驱动类型先行搜索，但它针对单个关键字搜索进行了仔细调整，其自身产生的建议质量非常低。

我们构建了建议索引，将建议映射到包含它的笔记列表。在信息检索中,“术语”是一个建议,“发布列表”是一个注释列表。

### 建议生成

提前键入搜索的第一部分早在用户在搜索框中键入字符之前就开始了。每次创建、修改或删除笔记时，我们都会根据笔记的标题、标签和内容生成一个潜在建议列表，然后将这些列表序列化并保存到倒排索引中。它是这样工作的。

我们从检测笔记文本中的单个单词开始。单词通过一系列过滤器，这些过滤器负责规范化文本(例如，小写、去除变音符号)并移除停用单词(极其常见的单词)。过滤后的单词然后基于某些规则被进一步聚合，这可以将它们组合成可能在较大文本的上下文中相关的短语。最后，过滤掉的单词和短语被序列化到建议索引中。

这个组件还必须确保考虑到 Evernote 用户最广泛使用的语言。例如，一些语言(如汉语和日语)不使用空格等字符来分隔一个单词的结束位置和下一个单词的开始位置。相反，必须应用更复杂的软件来在连续的字符序列中寻找断词。为了使问题更加有趣(阅读:“更难”)，笔记可以用不同语言混合编写。

当然，所有这些处理都必须基于资源可用性在后台完成，以免影响用户体验。

### 建议检索

我们准备执行搜索，现在会发生什么呢？当用户开始在搜索框中键入时，建议检索系统首先确定落入用户上下文的笔记集，即用户当前正在其中搜索的笔记本和标签的组合。然后，它在建议索引中查找搜索查询前缀，这产生了该前缀的一组完成。最后，它过滤掉所有不属于上下文注释的完成。

接下来，通过从 [TF-IDF](http://en.wikipedia.org/wiki/Tf%E2%80%93idf) 派生的定制公式对每个建议的相关性进行评分和排名。根据分数，前 K 个建议进入最后一步，在这一步中，非常相似的建议(例如，“溜冰”和“滑冰”)被合并。

在许多方面，这个组件是最复杂的，但它也必须是性能最好的一个，因为用户理所当然地期望亚秒级的体验。出于这个原因，我们对性能的大部分关注都集中在文字先行搜索系统的这一部分。

## 下一步是什么

如果你还没有使用过这个功能或 Mac 客户端，我鼓励你尝试一下，并让我们知道你的想法。

将来在我们的其他 Evernote 客户端中寻找这一点。