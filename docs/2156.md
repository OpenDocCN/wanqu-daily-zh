# 12 天的危机 DoS 攻击回顾| Linode

> 原文：<https://blog.linode.com/2016/01/29/christmas-ddos-retrospective/?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

<aside class="c-post__sign-up c-mkto-form--overlabels x-headings-as-h6">

### 注册订阅“In the Node”时事通讯

错误。

请重新加载页面并重试。

</aside>

从 12 月 25 日到 1 月 5 日的 12 天里，Linode 目睹了 100 多起针对我们基础设施各个主要部分的拒绝服务攻击，其中一些攻击严重中断了数十万 Linode 客户的服务。我想继续[我之前的更新](http://status.linode.com/incidents/mmdbljlglnfd),提供更多关于我们如何受到攻击以及我们正在做些什么来防止它再次发生的见解。

实际上，攻击者大致按照以下顺序提升了我们的筹码:

*   针对我们面向公众的网站的第 7 层(“400 不良请求”)攻击
*   对我们的网站、权威域名服务器和其他公共服务的大规模攻击
*   针对 Linode 网络基础设施的大规模攻击
*   针对我们的托管服务提供商网络基础设施的大规模攻击

大多数攻击是简单的体积攻击。*容量攻击*是最常见的*分布式拒绝服务* (DDoS)攻击，这种攻击将大量垃圾流量导向一个 IP 地址，将目标受害者从互联网上抹去。这实际上相当于使用租赁汽车故意造成交通堵塞，这种类型的攻击无处不在，已经在全球造成了数千亿美元的经济损失。

通常，Linode 每天都会看到几十次针对我们客户的容量攻击。然而，这些攻击几乎从来不会影响更广泛的 Linode 网络，因为我们使用一种叫做*远程触发的黑客攻击*的工具来保护自己。当一个 IP 地址被“黑入”时，互联网集体同意丢弃去往该 IP 地址的所有流量，阻止好的和坏的流量到达它。对于像 Linode 这样拥有数十万个 IP 的内容网络来说，黑客攻击是我们武器库中一个钝而关键的武器，它让我们能够“切掉一根手指以保全一只手”——也就是说，牺牲被攻击的客户，以保持其他人在线。

在一个明显但重要的情况下，黑客攻击作为一种有效的缓解手段是失败的:当被攻击的 IP——比如说，某个关键的基础设施——无法在不影响其他人的情况下离线。通常想到的例子是“服务器的服务器”，如 API 端点或 DNS 服务器，它们构成了其他基础设施的基础。虽然许多攻击是针对我们的“服务器中的服务器”，但我们最难防范的攻击是直接针对我们和我们的主机托管服务提供商的网络基础设施的攻击。

#### 次要地址

针对我们网络基础设施的攻击相对简单，但要减轻它们却不容易。作为历史的产物，我们将客户划分为单独的/24 子网，这意味着我们的路由器在每个子网中都必须有一个“辅助”IP 地址，供客户用作其网络网关。

随着时间的推移，我们的路由器积累了数百个这样的二级地址，每个都是潜在的攻击目标。当然，这不是我们的路由器第一次受到直接攻击。通常，采取特殊措施向我们的上游发送黑洞广告，而不在我们的核心中形成黑洞，在阻止攻击的同时允许客户流量照常通过。然而，我们对有人迅速地、不可预测地攻击我们路由器上几十个不同的二级 IP 的情况毫无准备。这有几个原因。首先，减轻对网络设备的攻击需要网络工程师的手动干预，这既缓慢又容易出错。第二，我们的上游提供商只能接受有限数量的黑洞广告，以限制错误情况下的潜在损害。

在与攻击者玩了几天猫捉老鼠的游戏后，我们能够与我们的主机托管提供商合作，要么黑掉我们所有的辅助地址，要么在他们的中转提供商网络的边缘丢弃流量，在那里黑掉是不可能的。

#### 交叉连接

针对我们的主机托管服务提供商的攻击同样简单，但更难防范。一旦我们的路由器不再能够被直接攻击，我们的主机托管合作伙伴和他们的中转提供商就成了下一个合乎逻辑的目标——特别是他们的交叉连接。一个*交叉连接*通常可以被认为是互联网上任意两个路由器之间的物理链接。该物理链路的每一端都需要一个 IP 地址，以便两台路由器能够相互通信，而这些 IP 地址正是目标。

就像我们自己的基础设施一样，这种攻击方法本身并不新奇。使这种方法如此有效的是攻击的快速性和不可预测性。在我们的许多数据中心中，上游网络中的数十个不同 IP 受到攻击，这需要我们的主机托管合作伙伴及其中转提供商之间一定程度的关注和协调，而这很难维持。到目前为止，我们最长的中断时间(在亚特兰大超过 30 小时)可以直接归因于 Linode 员工和有时与我们相距 4 度的人之间的频繁通信中断。在一些顽固的运输提供商最终承认他们的基础设施受到攻击并成功采取措施阻止攻击后，我们最终完全关闭了这一攻击媒介。

#### 经验教训

就个人而言，我们对发生这样的事情感到尴尬，我们从这次经历中学到了一些惨痛的教训。

***第一课:不要依赖中间人*** 事后看来，我们认为如果我们没有依赖我们的主机托管合作伙伴进行 IP 传输，那么更长时间的停机本来是可以避免的。这有两个具体原因:首先，在一些情况下，我们被误导，认为我们的主机托管服务提供商只是拥有比实际更多的 IP 传输能力。有几次，定向到 Linode 的攻击流量非常大，以至于我们的主机托管提供商别无选择，只能暂时停止与 Linode 网络的对等通信，直到攻击结束。第二，成功缓解一些更微妙的攻击需要来自不同第 1 级提供商的高级网络工程师的直接参与。在一个假日周末的凌晨 4 点，我们的共处伙伴成了我们和能解决我们问题的人之间额外的、不必要的障碍。

***第二课:吸收更大的攻击*** Linode 针对 IP transit 的容量管理策略一直很简单:当我们的峰值日利用率开始接近我们整体容量的 50%时，就是时候获取更多的链接了。这种策略是运营商网络的标准，但我们现在明白，它对于像我们这样的内容网络是不够的。具体来说，我们较小的数据中心网络的总 IP 传输能力为 40Gbps。对你们中的许多人来说，这似乎是很大的容量，但在 80Gbps 的 DDoS 无法被黑掉的情况下，只有 20Gbps 的余量会使我们在攻击期间出现严重的数据包丢失。

***第三课:让客户知道发生了什么*** 当我们失败时，承认是很重要的，我们在攻击的早期缺乏详细的沟通是一个很大的失败。在危机时刻提供详细的技术更新只能由那些对当前事态有详细了解的人来完成。通常，那些人也是救火的人。事情平息下来后，我们回顾了我们的公共沟通，我们得出的结论是，我们害怕措辞不当和引起不必要的恐慌，导致我们在状态更新中说得比我们应该说的更含糊。这是错误的，今后，一个指定的技术点-人将负责在这样的重大活动中进行详细沟通。此外，[我们的状态页面](http://status.linode.com/)现在允许客户通过“订阅更新”链接，通过电子邮件和短信提醒服务问题。

#### 我们的未来比我们的过去更加光明

记住这些教训，我们希望你知道我们是如何把它们付诸实践的。首先，简单的部分:我们通过实施 DDoS 缓解措施，减轻了针对面向公众的服务器的攻击威胁。我们的名称服务器现在由 Cloudflare 保护，我们的网站现在由强大的商业流量清理设备保护。此外，我们已经确保在这些假日袭击中实施的紧急缓解技术已经永久化。

就其本身而言，这些措施让我们相信，假期中发生的那类攻击不会再次发生。然而，我们需要做更多的工作。因此，今天我很高兴地宣布，Linode 将彻底改革我们的整个数据中心连接战略，将 200 的传输和对等容量从主要的区域存在点拉回我们的每个位置。

这是我们纽瓦克数据中心即将进行的基础设施改进的概述，它将是第一个接受这些容量升级的数据中心。

这个架构的头条是我们已经开始建设的光传输网络。这些网络将为该地区一些最重要的 pop 提供完全不同的路径，使 Linode 能够访问数百种不同的运营商选项和数千个直接对等合作伙伴。与我们现有的架构相比，此次升级的优势是显而易见的。我们将控制我们的整个基础设施，直到互联网的边缘。这意味着，我们将与我们所依赖的运营商直接合作，而不是依赖中间商进行 IP 传输。

此外，Linode 将使我们目前可用的带宽增加五倍，使我们能够吸收极大的 DDoS 攻击，直到得到适当缓解。随着未来攻击规模的增长，该体系结构将快速扩展以满足他们的需求，而无需任何重大的新资本投资。

#### 最后的话

最后，真诚的道歉是必要的。作为一家为客户托管关键基础架构的公司，我们有责任保持基础架构在线。我们希望这篇文章的透明度和前瞻性可以重新赢得一些信任。我们也要感谢你的理解和支持。我们很多人的假期都被这些无情的袭击毁了，很难向我们所爱的人解释。来自社区的支持真的很有帮助。我们鼓励您在下面发表您的问题或评论。