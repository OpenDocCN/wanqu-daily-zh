# 在 Twitter 做数据科学。这是我两年旅程的反思，罗伯特·张

> 原文:[https://medium . com/@ r Chang/my-two-year-journey-as-a-data-scientist-at-Twitter-f0c 13298 aee 6？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](https://medium.com/@rchang/my-two-year-journey-as-a-data-scientist-at-twitter-f0c13298aee6?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

# 在 Twitter 做数据科学

## 这是我迄今为止两年旅程的反思。样本量 N = 1

# 动机

2015 年 6 月 17 日，我庆祝了我的两周年[# Twitter 纪念日](https://twitter.com/search?q=%23twitterversary&src=typd) @Twitter。回顾过去，Twitter 的数据科学(简称 DS)领域发生了很大变化:

*   机器学习在许多以前不是 ML 驱动的核心 Twitter 产品中扮演着越来越重要的角色(例如，“[当你不在的时候](https://blog.twitter.com/2015/while-you-were-away-0)”)
*   在工具方面，我们已经摆脱了 Pig，所有新的数据管道现在都是用[burning](https://github.com/twitter/scalding)编写的，这是一种构建在级联之上的 Scala DSL，可以轻松指定 Hadoop MapReduce 作业
*   在组织上，我们转向了嵌入式模式，在这种模式下，DS 与产品/工程团队的合作比以往任何时候都更加紧密

这些只是众多变化中的一小部分！就个人而言，我最近从 Growth 扩展到 PIE(产品、仪器和实验),致力于我们自己开发的 A/B 测试平台的统计方法。

在 Twitter 真的很令人兴奋，因为它让我能够观察和学习第一手资料，即一家主要的技术公司如何利用数据和 DS 来创造竞争优势。

与此同时，从事数据科学的需求和愿望持续飙升。

> “大数据就像青少年性行为:每个人都在谈论它，没有人真正知道如何去做，每个人都认为其他人都在做，所以每个人都声称他们正在做。”——丹·艾瑞里

围绕如何成为一名数据科学家，有许多，我指的是[许多](http://www.quora.com/Data-Science)的讨论。虽然这些讨论提供了大量信息(我是受益者之一)，但它们往往过分强调技术、工具和技能集。在我看来，对于有抱负的数据科学家来说，了解在实践中作为一名 DS 工作的真实感受同样重要。

因此，当我在 Twitter 上呆了两年的时候，我想利用这个反思的机会来分享我的个人经历，希望这个领域的其他人也能这样做！

# A 型数据科学家 vs . B 型数据科学家

在 Twitter 之前，我得到的印象是所有的 DS 都需要是独角兽——从 Math/Stat、CS/ML/Algorithms 到 data viz。除了技术能力，写作和沟通能力也至关重要。此外，能够对项目进行优先排序、领导和管理对于执行来说至关重要。哦，对了，你还应该宣传数据驱动的文化。祝你好运！

工作几个月后，我了解到，虽然独角兽确实存在，但对于我们大多数仍在努力实现这一目标的人来说，一次性完成所有这些事情是不现实/不可行的。也就是说，几乎所有与数据相关的东西都与术语 DS 有关，作为一个新手，找到我的位置有点令人生畏。

随着时间的推移，我意识到不同类型的数据科学家之间存在一种过于简化但足够准确的二分法。我无法很好地表达这一点，直到我在 Quora 上看到迈克尔·霍克斯特的回答，他优雅地总结了这一点。用他的话说:

> **A 型数据科学家:**A 是用于分析的。这种类型主要涉及理解数据或以相当静态的方式处理数据。A 型数据科学家非常类似于统计学家(也可能是一名统计学家)，但他们知道统计学课程中没有教授的所有数据处理的实际细节:数据清理、处理非常大的数据集的方法、可视化、特定领域的深入知识、写好数据等等。
> 
> **B 型数据科学家:**B 是建筑用的。B 型数据科学家与 A 型共享一些统计背景，但他们也是非常强的编码员，可能是训练有素的软件工程师。B 型数据科学家主要对“在生产中”使用数据感兴趣他们建立与用户互动的模型，通常提供推荐(产品、你可能认识的人、广告、电影、搜索结果)。

我希望我早点知道这件事。事实上，作为一个有抱负的 DS，在你做职业决定和选择时，牢记这一点是非常有用的。

就我个人而言，我的背景是数学、运筹学和统计学。我认为自己主要是 A 型数据科学家，但我也非常喜欢涉及更多工程的 B 型项目！

# 早期初创企业、成长中的初创企业和那些实现规模的企业的 DS

在寻找技术工作时，最常见的决定之一是在加入大公司还是小公司之间做出选择。虽然有很多关于这个话题的很好的一般性讨论，但没有太多专门针对 DS 的信息——也就是说，DS 的角色将如何根据公司的阶段和规模而变化。

不同阶段的公司以不同的速度、种类和数量产生数据(臭名昭著的 3v)。一家试图找到自己产品市场契合度的初创企业，很可能不需要 Hadoop，因为没有太多数据。一家成长中的初创公司将会更加数据密集型，但使用 [PostgreSQL](http://www.postgresql.org/) 或 Vertica 可能也能做得很好。但是像 Twitter 这样的公司如果不使用 Hadoop 和 Map-Reduce 框架，就无法高效地处理所有数据。

我在 Twitter 学到的一个重要经验是，数据科学家从数据中提取价值的能力在很大程度上与其公司数据平台的成熟度相关联。了解你想参与什么样的 DS 工作，做你的研究来评估公司的基础设施是否能支持你的目标，这不仅是明智的，而且是确保正确的相互适合的最重要的。

*   在早期创业阶段:主要的分析重点是实现日志记录、构建 ETL 流程、建模数据和设计模式，以便可以跟踪和存储数据。这里的目标是建立分析基础，而不是分析本身
*   **处于成长中期的初创企业:**由于公司在成长，数据可能也在增长。数据平台需要适应，但随着基础的奠定，将会自然地转向洞察生成。除非[公司利用数据科学实现其战略差异化](http://technology.stitchfix.com/blog/2015/03/31/advice-for-data-scientists/)，否则许多分析工作都是围绕定义 KPI、归因于增长以及寻找下一个增长机会展开的
*   **实现规模的公司:**当公司规模扩大时，数据也随之扩大。It 需要利用数据来创造或保持竞争优势。例如，搜索结果需要更好，推荐需要更相关，物流或运营需要更高效——这是像 ML 工程师、优化专家、实验设计师这样的专家在加速游戏中发挥巨大作用的时候了。

当我加入 Twitter 时，它已经有了一个非常成熟的数据平台和稳定的基础设施。该仓库干净而可靠，ETL 流程每天轻松处理数百个 Map-Reduce 作业。最重要是，我们有才华 DS 在数据平台，产品洞察，增长，实验，搜索/相关性以及其他重点领域工作。

# 我的旅程

我是第一个专注于增长的数据科学家，事实是，我们花了好几个月的时间，产品、工程和 DS 才就 DS 如何在这一过程中发挥关键作用达成一致。根据我与产品团队密切合作的经验，我将我的职责分为四个方面:

*   **产品洞察**
*   **数据管道**
*   **实验(A/B 测试)**
*   **建模**

让我描述一下我在这些主题中的经历和学习。

# 产品洞察力

为消费技术公司工作的一个独特方面是，我们可以利用数据来理解和推断用户的声音和偏好。每当用户与产品交互时，我们都会记录有用的数据和元数据，并将它们存储起来以供将来分析。

这个过程被称为**测井**或**仪器**，并且在不断发展。通常，DS 可能会发现某个特定的分析很难执行，因为数据要么格式错误，要么不合适，要么丢失。在这里，与工程师建立良好的关系是非常有用的，因为 DS 可以帮助工程师识别系统中的错误或意外行为。反过来，工程师可以帮助 DS 缩小“数据差距”，使数据更丰富、更相关、更准确。

以下是我在 Twitter 上进行的一些产品相关分析的例子:

*   **推送通知分析** —有多少用户有资格获得推送通知？跨用户群？跨客户端？不同推送通知类型的点击率是多少？
*   **短信发送率** —我们如何计算 Twitter 在不同运营商间的短信发送率？我们在新兴国家的交付率更低吗？我们怎样才能让它们变得更好？
*   **多个账户** —为什么某些国家的多个账户比例较高？是什么驱使人们创建多个账户？

分析以不同的形式出现——有时你被要求提供简单数据拉取的直接答案(*推送分析*)，其他时候你可能需要发明并提出新的方法来计算新的但重要的运营指标(*短信交付率*)，最后你可能被要求更深入地了解用户行为(*多个账户*)。

通过产品分析产生洞察力是一个迭代的过程。它需要挑战所提出的问题，了解业务环境，并找出正确的数据集来回答这些问题。随着时间的推移，您将成为数据所在位置及其含义方面的专家。你会更好地估计进行一项分析需要多少时间。更重要的是，你将慢慢从**被动**状态转变为**主动**状态，并开始提出产品负责人可能想不到的有趣分析，因为他们不知道数据的存在，也不知道完全不同的数据源可以以特定的方式互补和组合。

> **此处使用的技能:**

*   测井和仪器仪表。确定数据差距。与工程师建立良好的关系
*   能够导航和识别相关数据集以及如何使用它们
*   了解不同类型的分析，并更好地估计它们需要的时间或难度
*   了解你的查询语言。使用 R 或 Python 的典型数据管理技巧

# 数据管道

尽管 A 类数据科学家可能不会产生直接面向用户的代码，但令人惊讶的是，我们仍然经常将代码提交到代码库中，以便进行**数据管道处理**。

如果您听说过 Unix 中的 operation | (pipe ),它有助于一系列命令的执行，那么数据管道就是一系列操作，当这些操作以流的形式连接在一起时，可以帮助我们自动捕获、管理和聚合数据。

在使用 Twitter 之前，我的大部分分析都是临时性的。它们通常在我的本地机器上运行和执行一次或几次。这些代码很少经过代码审查，而且它们很可能不受版本控制。当创建数据管道时，一组新的关注点开始浮出水面，例如依赖性管理、调度、资源分配、监控、错误报告和警报。

以下是创建数据管道的典型过程:

*   您意识到，如果数据集能够重复生成，世界将会变得更加美好
*   确认需求后，您首先开始设计最终产品，例如设计输出数据集的数据模式。
*   根据数据所在的位置，用 Pig、burning 或 SQL 编写代码。
*   提交**代码审查，**和准备好获得反馈并进行额外的修改，因为要么你的业务逻辑不正确，要么你的代码没有针对速度和效率进行优化 **#shipit** 。
*   可能会有一个测试和试运行你的工作的步骤，以确保一切按预期运行。
*   将您的代码合并到 master 中。部署代码并安排您的工作！
*   设置监控、错误报告和警报，以防出现问题

显然，管道比即席分析更复杂，但优势是这项工作现在可以自动运行，它产生的数据可用于驱动仪表板，以便更多用户可以使用您的数据/结果。更重要但微妙的一点是，这是一个获得工程最佳实践的伟大学习过程，它为您需要构建专门的管道(如机器学习模型(我将在最后一节详细讨论)或 A/B 测试平台)提供了基础。

> **这里使用的技能:**

*   版本控制，目前最流行的是 Git
*   学习如何进行代码评审并有效地提供反馈
*   知道如何在工作失败时进行测试、试运行和调试
*   依赖性管理、调度、资源分配、监控、错误报告、警报

# 实验(A/B 测试)

此时此刻，很有可能你正在使用的 Twitter 应用程序与我的略有不同，而且完全有可能你实际上有一个我没有看到的功能。在引擎盖下，由于 Twitter 有很多用户，它可以引导一小部分流量来体验一个尚未公开的新功能，因此要了解这些特定用户与那些不公开的用户(对照组)相比对它的反应如何——这被称为 A/B 测试，我们可以测试 A 或 B 哪个变体更好。

我个人认为 A/B 测试是在大型消费科技公司工作的独特福利之一。作为一名数据科学家，你可以通过运行实际的随机、受控实验来建立**因果关系(**观察数据很难做到的事情)。在推特上，“*很少有一天不运行至少一个实验”——工程副总裁 Alex Roetter*。A/B 测试根植于我们的 DNA 和产品开发周期中。

下面是运行 A/B 测试的典型过程: ***收集样本*** *- >* ***分配桶****->****应用处理***->***测量结果***->***进行比较*** 。这听起来很容易，不是吗？相反，我认为 A/B 测试是最不受重视和最棘手的分析工作之一，这是一项很少在学校教授的技能。为了证明我的观点，让我们再次回顾一下上面的 5 个步骤以及一些你可能遇到的实际问题:

*   收集样本 —我们需要多少样本？每个桶中应该有多少用户？能否保证实验会有足够的动力？
*   **分配桶** —谁有资格参加实验？我们应该从代码的哪里开始分配存储桶和显示处理呢？放置是否会引入数据稀释(例如，一些用户被分配到治疗，但从未看到它)？
*   **应用处理—** 组织中是否有其他团队在运行实验，在 app 中竞争同一个房地产？我们如何处理实验冲突并确保我们的数据不受污染？
*   **测量结果—** 实验的假设是什么？这个实验的成败衡量标准是什么？我们能追踪他们吗？又是怎么做到的？我们需要添加哪些额外的日志记录？
*   **做对比——**假设我们看到登录的用户数量急剧增加，是因为噪音吗？我们如何知道结果是否有统计学意义？即使是，它有实际意义吗？

解决上面的每一个问题都需要很好地掌握统计学。即使你在设计实验时尽可能严谨，其他人也可能做不到。一个项目经理将会被激励去提前查看数据，或者检查他们想要的结果(因为这是人类的本性)。工程师可能忘记记录我们计算成功度量所需的特定信息，或者实验代码可能以错误的方式编写，从而引入了非预期的偏差。

作为一名数据科学家，唱反调并帮助团队保持严谨是很重要的，因为浪费在运行设计不良的实验上的时间是不可收回的。更糟糕的是，基于糟糕数据的错误决策比其他任何事情都更具破坏性。

> **这里使用的技能:**

*   **假设检验**:统计检验，*p*——数值，统计显著性，功效，效果大小，多重检验
*   **实验陷阱**:遗留效应、指标精选、数据稀释、桶异常

# 预测建模

## &

# 机器学习

我在 Twitter 的第一个大项目是为我们现有的电子邮件通知产品增加一套疲劳规则，以减少用户收到的垃圾邮件。虽然这是一个崇高的姿态，但我们也知道电子邮件通知是最大的保留杠杆之一(我们知道这是因果关系，因为我们对它进行了实验)，所以找到正确的平衡是关键。

根据这一重要观察，我很快决定关注基于触发的电子邮件，当交互发生时，电子邮件类型往往会突然到达用户的电子邮件收件箱。作为一个雄心勃勃、试图证明自己价值的新 DS，我决定建立一个奇特的 ML 模型，在个人层面预测电子邮件点击率。我继续前进，在 Pig 中聚集了一堆用户级特征，并建立了一个随机森林模型来预测电子邮件点击。这个想法是，如果一个用户有一个持续的低点击率的长期历史，我们可以安全地阻止该用户的电子邮件。

只有一个问题——我所有的工作都是在 r 的本地机器上完成的。人们欣赏我的努力，但他们不知道如何使用我的模型，因为它不是“*生产的*”，而且基础设施无法与我的本地模型对话。**惨痛的教训！**

一年后，我发现了一个很好的机会，可以和另外两个来自 Growth 的 DS 一起建立一个客户流失预测模型。这一次，因为我已经积累了足够的构建数据管道的经验，我了解到构建 ML 管道实际上非常相似——有一个训练阶段，可以通过 Python 定期更新模型来离线完成；有一个预测部分，我们每天汇总用户特征，让预测函数发挥它的魔力(大部分只是点积)为每个用户产生一个流失概率分数。

我们在几周内建立了管道，确认它具有良好的预测能力，并通过将分数写入 HDFS 的 Vertica 和我们在 Twitter 上名为 Manhattan 的内部键值存储来推广它。我们让分析师、DS 和工程服务可以方便地查询分数，这有助于我们宣传和推动我们模型的用例。这是我学到的关于在生产中建立模型的最重要的一课。

在目前的讨论中，我故意忽略了构建 ML 模型所需的步骤——构建问题、定义标签、收集训练数据、设计特征、构建原型，以及客观地验证和测试模型。这些显然都很重要，但我觉得他们学得相当好，在这个问题上已经给出了许多好的建议。

我认为大多数优秀的 DS，尤其是 A 型 DS 都有相反的问题，他们知道如何正确地做，但不确定如何将这些模型推向生态系统。我的建议是与 B 型数据科学家交谈，他们在这个主题上有很多经验，找到所需的技能，找到交叉点并磨练自己的技能，以便在时机成熟时可以转向这些项目。让我引用下面的话来结束这一部分:

> “机器学习不等同于 R 脚本。ML 建立在数学基础上，用代码表达，并组装成软件。你需要成为一名工程师，并学会编写可读、可重用的代码:你的代码被其他人重读的次数会比你多，所以要学会编写代码，以便其他人也能读懂。”— Ian Wong，来自他在哥伦比亚数据科学课堂上的客座演讲

说得好。

> **这里使用的技能:**

*   **模式识别:**识别可以使用建模技术解决的问题
*   **建模和 ML 的所有基础知识**:探索性数据分析、构建特征、特征选择、模型选择、训练/验证/测试、模型评估
*   **生产化:**上面提到的所有关于数据管道的事情。设置您输出，以便不同的人和服务可以查询它

# 一些事后的想法…

成为一名数据科学家确实令人兴奋，找到特定见解的兴奋感可以像肾上腺素激增一样令人兴奋。从基础上构建一个数据管道或 ML 模型会令人非常满意，当运行 A/B 测试时，有很多有趣的“扮演上帝”的乐趣。也就是说，这条路并不平坦，一路上会有很多挣扎，但我认为一个积极而聪明的人会很快学会这些东西。

以下是我发现的一些非常有用的附加信息，我希望它们也对你有用:

**数据科学与软件工程:**

**A/B 测试:**

**招募:**

这是一个漫长的旅程，我们都还在学习。祝你好运，最重要的是，玩得开心！