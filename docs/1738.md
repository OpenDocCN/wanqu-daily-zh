# 代码审查——科学中需要的习惯

> 原文:[http://software-木工. org/blog/2015/10/code-review-habit . html？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://software-carpentry.org/blog/2015/10/code-review-habit.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

一年多前，Marian Petre 和 Greg Wilson 写了一篇关于[审查代码](http://arxiv.org/abs/1407.5648)的文章，但是直到上周 Greg 在伦敦的一个研讨会上谈到他们的发现时，我才意识到这一点(尽管[在](/blog/2014/01/code-review-round-2.html)之前已经提到过)。我审查代码已经很多年了，但是直到 GitHub 让它变得简单，我才意识到我在这么做。阅读他人的代码感觉就像校对西班牙语文本(或任何其他文本)，你必须注意拼写、语法以及它是否表达了它想要表达的意思(或者它做了它想要做的事情)。

自从我开始攻读博士学位，我就在我所在的研究所组织了<emph>编程俱乐部</emph>，作为同事之间分享知识的一种方式。但是在过去的 10 年里，我只做了两次“代码回顾”会议。第一次涉及外部人员(来自工业界)阅读科学代码，而第二次(上周)是在研究人员之间进行的。

第一次会议是作为一个项目的试运行，这个项目是我和一个朋友想出来的:“帮助科学家日”。我们的想法是让软件开发者研究科学家写的代码。但是在我们创建一个大事件之前，我们运行了一个测试，邀请我们认识的一些开发人员参加一个有免费披萨的晚上，来看一些由我们组的博士生写的代码。我们有三个代码要复习，它们是用 IDL 写的，你几乎可以注意到学生们在整个代码中的学习曲线。其中两个是一个有将近 2000 行代码的文件，没有函数和很少的文档。这些代码现在被要求在 NASA 任务的管道中运行，这是学生们在三年前从未预料到的。代码提前一周左右发布，但作者收到的代码反馈很少。这次会议与其说是一次审查，不如说是一次良好做法的讨论。我相信在场的许多学生(除了作者)都从中学到了很多。开发人员提出的一个非常重要的问题是“我们花多少时间编码”，我们的回答是大约 80%的时间。他们惊讶于我们没有谈论和讨论更多关于编码的内容。抛开语言的选择不谈，我们应该成为我们工作领域的专家。虽然我们中的许多人认为我们是，但我们不是，当我们在使用它 10 年后读到一些我们不知道的细节时，我们会感到惊讶。[其他成果](http://www.roundcrisis.com/2011/11/22/programming-science/)包括使用版本控制、深思熟虑的变量名和阅读他人代码。此后不久，我为了一个新的博士后职位搬到了另一个国家，而我们的“帮助科学家日”这一重大活动从未发生过。

四年后(也就是上周)，我向我工作的编程俱乐部的与会者提出了一个练习。规则是，找到你不久前写的一些代码，并向我为此建立的一个库发出一个拉请求。制定第一条规则有两个原因:避免他们在知道其他人会阅读的情况下为会议写东西；看看我们的现在——我了解我们的过去——我写了多少。我们只有六个人，我们有三段 IDL 代码和三段 Python 代码。在一个小时的会议中，我首先简要介绍了 GitHub 的拉式请求评论工具是如何工作的。我没有解释他们需要寻找什么，我只是告诉他们对任何他们不明白的事情发表评论。所以我们把我们两个配对成语言，就像结对编程一样进行复习，在两个人之间展开讨论...更糟糕的是，我让 IDL 团队审查 Python 代码，反之亦然。起初，他们对语言有些困惑，但是突出没有正确记录或风格的东西非常有用。比如为什么 Python 代码中的第 14 个元素:

```
pos_x = float(tstep.split()[14])

```

或者为什么 IDL 中的第 39 个其他:

```
int_upper = interpol(  radius_tot, density_pure_model[*,39], density_upper )

```

我们还发现了作者不记得为什么增加或减少变量的因素，或者容易识别的“复制粘贴”块。然后，我们一起查看每一对所做的评论，并通过每个团队审查另一段代码来继续会议，但这一次是用他们知道的语言。在这种情况下，评论更多地集中在如何以不同的方式帮助可读性或使这样的算法更通用。例如，如何通过对循环使用<emph>列表</emph>和<emph>的组合或者从函数本身解析参数来避免重复。他们所有人都非常喜欢这个课程——至少他们是这么告诉我的——不仅学会了复习，还意识到有时候我们未来的自己理解我们写的东西有多难。</emph>

总之，我不认为我可以对 Marian 和 Greg 的论文做更多的补充，但要强调在我们的研究小组中进行这种活动的必要性，以提高其重要性，因为当我们审查论文时，这些代码是科学进步的关键。

我认为值得一提的是这些年来我听到的不共享代码的不同理由，比如:

*   评论的不好你也不会懂；
*   论文发表时我会展示代码；
*   代码有一些缺点，如果我把它留给人们使用，他们会在不理解它的情况下发布错误的东西。；
*   我想让人们联系我来运营它，这样我就可以出现在他们的出版物中。

我相信，如果更多的研究人员习惯于审查代码，这些评论中的许多将会消失(也许不是最后一个；尽管人们可能不相信他们)。你怎么想呢?我们如何提高这种意识？你试过哪些东西？你找到了哪些借口，又是如何“回击”的？