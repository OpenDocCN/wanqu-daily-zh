# 如何避免软件工程中代价最大的错误之一

> 原文:[http://www . the effective engineer . com/blog/cardinal-sin-of-software-engineering？UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://www.theeffectiveengineer.com/blog/cardinal-sin-of-software-engineering?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)



几周前，一位年轻的创业工程师向我寻求建议。她的首席执行官给了她的团队 4 周的时间来重新编写网页产品。那是三个多月前的事了。该项目现在已经落后了 2 个月，团队每周加班 80 多个小时，还有一长串的错误。压力很大，没有发货的每一天都意味着他们羽翼未丰的创业公司的商业机会可能会落空。她该怎么办？

被一个落后于计划的重写项目夹在中间感觉糟透了。这是无法忽视的。我自己也经历过，在我职业生涯的早期。我参与的一个重写项目原定了 4 个月，但直到 9 个月后才发布。另一个持续了 9 个月，直到最终被放弃。非常有才华的工程师两次都工作了很长时间，有些人甚至累垮了。关于长时间重写最糟糕的部分之一是，当一个关键的新市场机会出现时，需要在被重写的代码之上构建，您必须做出艰难的选择:您是通过在新代码基础之上构建并等待新代码基础发布来推迟(并可能失去)机会，还是在旧代码基础之上构建，然后在新代码基础上再次重写？这两个选择都没有吸引力。

我参与的重写项目是痛苦的，但却是成长的经历。从那以后，我学会了每当有人提出一个雄心勃勃的重写项目时都要非常小心。我不是唯一有这种感觉的人。

## 谷歌文档的故事

今年早些时候，为了我即将出版的新书《有效的工程师[*，我采访了 Box 的工程副总裁、前谷歌应用程序主管萨姆·席莱斯。我问他的一个问题是，“你见过的工程团队犯的代价最大的错误是什么？”*](/book)

他的回答是:“试图从头重写一些东西。这是最大的罪过。”

Schillace 于 2006 年加入谷歌，是初创公司收购的一部分。他的 4 人团队开发了 Writely，这个产品最终形成了 Google Docs 的基础。该团队已经用 C#构建并发布了一个原型，本打算作为一个实验，结果却发现它像病毒一样传播开来，拥有 50 万用户。当谷歌收购他们的初创公司时，他们的第一件事就是迁移到谷歌的基础设施，以利用其容量和扩展能力。每天都有成千上万的用户继续注册，团队正在花费精力修补他们知道无法扩展的代码库。

从我在谷歌的时候起，我就知道谷歌的软件栈不支持 C#。所以当 Schillace 告诉我这个大错误时，我自然不得不继续问:“当你们把 Writely 转换成 Google Docs 时，你们是不是必须从头开始重写所有的东西？”

他看着我说，“我们确实做到了——尽管这里面有一个有趣的教训。”当他们开始重写时，他的一个联合创始人实际上在翻译代码的时候已经推动重写了部分代码。他们不喜欢用许多不同的方式构建的代码库。因此，在将应用程序翻译成 Java 的同时，为什么不同时重写它呢？为什么不花时间做一些改进呢？进行重大重写的诱惑非常大。谁想把代码库重写到一个中间状态，然后又不得不扔掉呢？

席勒不得不努力反对这种逻辑。最后，他说服团队为他们的重写设置一个非常有限的范围，并推迟其他改进。他们设定了一个明确的目标，即在谷歌的数据中心建立并运行网站，并且他们采取了最短的路径来实现这个目标。他们将该产品与 12 种不同的谷歌内部技术相结合。他们花了一周时间通过一系列正则表达式运行代码库，然后修复了数万到数十万个文件错误，以使代码能够编译。Java 和 C#的语义有时会有所不同——例如，C#中的字符串比较使用双等号(==)的逻辑比较，而 Java 检查引用是否相等——他们必须费力地访问每个实例并消除所有差异。

“那真的非常非常痛苦，”席勒告诉我。这是痛苦的缩影。12 周后，他们最终得到了他所描述的“古怪、怪异、残缺不全、看起来不对劲的代码库。”但这是一个在谷歌数据中心成功运行的代码库。他的团队创下了有史以来最快的将谷歌收购移植到谷歌基础设施的记录。如果他们将改进与重写捆绑在一起，他们肯定不会这么快地完成，并且项目可以很容易地扩大范围。如果像许多工程师一样，他们专注于“做正确的事情”并保持高质量的代码，他们可能会避免通过一堆正则表达式来破坏代码库。相反，他们做了必要的事情来尽快让 Writely 运行起来。

## 经验教训

这并不是说我们不应该重写或丢弃代码。我们总是在不完全了解软件将如何被使用或者最终需求是什么的情况下开发软件。MongoDB 的创始人 Eliot Horowitz 在一次会议上说，你应该认为代码的半衰期是 3-5 年，因此需要定期刷新。Google 技术如 MapReduce、Bigtable 等背后的架构师 Jeff Dean 说要将你的软件设计成 10 倍的规模，之后最好的设计看起来可能会大不相同。

当我们从头开始一次性重写整个代码库时，问题就出现了。我们往往严重低估成本，高估收益。

当我们没有经验时，我们会低估，因为我们不知道事情要花多长时间。我们没有足够的影响力或知识对激进的时间表说不。我们缺乏有效减少时间表差异的优先级和技术技能。我们对自己说，一个好的工程团队能够做到这一点。我们只需要足够努力，证明我们是优秀的。

当我们有经验时，我们会低估，部分原因是评估仍然很难，部分原因是我们对自己的能力过于自信。这是一种虚幻的优越感。问 100 个司机他们的驾驶能力，80%的人会认为自己在平均水平以上。询问 100 名教师，68%的人认为自己的教学能力在前 25%。同样的不平衡也出现在对智商、考试分数、记忆力、工作表现等的评估中。因此，难怪许多软件工程师认为截止日期失误只发生在平均水平或低于平均水平的团队中，并且他们自己不会受到困扰软件重写几十年的截止日期失误的影响。

当重写的最后期限到来时，我们经常用乐观的信念欺骗自己，也许我们会更加努力地工作，找到弥补失去的时间的方法。我们说服自己别无选择。它可能会工作一两次，但作为一个长期战略，它是不可持续的。你不能冲刺到马拉松的终点。

那么最好的策略就是怀疑从头重写整个代码库的价值。当你不得不这样做的时候，就像 Schillace 所做的那样，你用一组有限的目标来处理它，以尽可能快地达到一种状态，在这种状态下你又一次取得了增量改进。如果你发现自己加入了其他软件工程师的行列，成为一个失败的重写项目的牺牲品，你需要进行一次诚实但困难的对话，讨论如何弥合你期望的业务目标和你低估的目标之间的差距——无论是通过削减功能，将项目重新设置为更现实的时间表，还是将项目视为沉没成本并完全放弃。这些策略都存在，但是没有一个像你最初设计重写项目那样有影响力。

