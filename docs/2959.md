# Medium 的 CSS 其实相当不错。按脂肪计|中等

> 原文：<https://medium.com/@fat/mediums-css-is-actually-pretty-fucking-good-b8e2a6c78b06?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

# Medium 的 CSS 其实相当不错。

> 我始终相信，要成为最棒的，你必须闻起来像最棒的，穿起来像最棒的，行为举止像最棒的。当你把垃圾扔进垃圾桶的时候，它一定比其他任何把垃圾扔进垃圾桶的人都要好。
> 
> —李尔·韦恩



The best at drawing pictures of myself



我一直想在 Medium 写一些关于 CSS 的东西，因为我并不为此感到羞耻…

那是怎么发生的呢？我们做了哪些不同的事情？天哪，你怎么能做同样的事情？或者学学我们什么的？

以下是一些关于我们的 CSS 的注释，我们已经采取的步骤，以及我们今天生活的世界。

T2】

## 开始时(一些历史)

大约两年前，我加入了显见公司，从事软件应用程序*medium.com*(希望你能继续读下去)。

当时，Medium 已经经历了一系列的“重新设计”(*re-style 是指设计师通过设计出比他们之前设计的更漂亮的东西来毁掉你的生活，导致你不得不重写一堆 CSS/LESS/SASS/etc* )。由于这些重新设计的风格，有很多建立起来的 cruft——该公司非常依赖 LESS 的语言功能，具有页面驱动的语义，非精灵/非视网膜图像资产，以及其他类似的东西。

我翻遍了 git，设法找出了我们 2012 年的旧档案页面实现~不寒而栗~。看看下面的内容，注意其中一些不幸的模式:

*   所有东西都嵌套在一个 **profile-page** 类下，没有任何可重用组件(同样，几乎所有东西都以**为前缀)。个人资料**
*   超级通用的变量名，如 **@link-color** ，它没有任何作用域，但大概只在 **profile-page.less** 中使用
*   深度嵌套(**)。个人资料-页面。个人资料-帖子。首页-后期-总结。首页-后期-收藏-图像 img** 是下面生成的一个实际选择器——性能上超级粗糙)
*   禁止随地吐痰
*   没有 z 轴刻度，没有字体刻度，没有颜色刻度，没有刻度…



[https://gist.github.com/fat/a4af78882d0003d2345e](https://gist.github.com/fat/a4af78882d0003d2345e)



T2】

## 第一个项目:OMG 图像

那时，我已经做了很多库代码(Bootstrap，Ratchet 等)。)和所有的细节，努力写出尽可能好的 CSS。

Medium 的 CSS 明显不同。不是一个中性的差异，而是一个灵魂粉碎，低劣的差异。我想解决这个问题。

看着所有要做的事情，我首先处理的是图像。我记得我非常震惊，我们在 2012 年没有做任何形式的精灵…积累了数百个图像资产，如占位符、箭头、图标等。在这个疯狂的 **/** img **/** 目录中，它有点像图标的墓地。

为了远离那个世界，我做了两件事——首先，我写了一个叫做 SUS 的 CSS 实用程序脚本(我们今天还在使用它，我刚刚在这里开源:[https://github.com/medium/sus](https://github.com/medium/sus))。这主要是在 Guillermo Rauch 的帮助下用 IRC 编写的，用于从样式表中提取图像，并延迟加载到一个单独的数据 uri 文件中。不是一个原创的概念，只是一些简单的事情，可以帮助我们到达我们需要去的地方。



第二件事是 Geoff Teehan 和我坐下来创建了 Medium 的第一个图标字体。当时，我们很大程度上不知道我们在做什么…但是在 github 博客 icomoon 的帮助下，经过几个漫长的夜晚，我们能够发布一些东西~相当不错~中等程度。这是巨大的，因为这意味着我们可以删除 97%的 img 文件夹，我的 retina MacBook Pro 上的一切看起来都很好，而且我们需要的资源明显更少。



T2】

## 第二个项目:规模

我的下一个主要项目是 z 指数量表。Z-index 是一种非常容易失控的东西，它总是让我抓狂。我不想在中号也这样。

在这个项目开始之前，很常见的是看到一个 z-index 为 5 的元素，紧挨着一个 z-index 为 1000000 的兄弟元素(T2 );和另一个兄弟姐妹**z-index:1000001；**和另一个**z-index:99999；**。

这些代码的风格遍布整个代码库，没有明确的方法来确定如何对它们进行排序。

所以我承担了手工审计整个代码库的 z 索引值的艰巨任务。然后，我引入了一个私有标度(private to z-index.less ),它可以用于 z-indexing 组件(限制为 1-10)。最后，我将这个标度的所有实际赋值都移到了 z-index.less 内部，这样你就可以看到不同的组件是如何相对于彼此定位的(这实际上非常方便)。

下面是我们今天在 medium.com 使用的 z 索引文件。



[https://gist.github.com/fat/1f6da6b3bd0311a1f8a0](https://gist.github.com/fat/1f6da6b3bd0311a1f8a0)



当然，这个 z-index 标度之后很快就出现了颜色标度(代表黑色、灰色、白色、品牌颜色等的变量)和类型标度(代表字体大小、粗细、字母间距、行高等的变量)。).

此外，您可能会注意到变量名已经采用了一些更严格的语义值——稍后会详细介绍……

T2】

## 第三个项目:新风格指南

在 Medium 中引入 scales 后不久，我们开始了一个名为“Cocoon”的大的 re-style 代码。

Cocoon 弃用了几个帖子模板(Medium 最初有图像模板和报价模板，而不仅仅是一个文章模板)，还引入了帖子列表，而不是帖子“卡片”



我们以此为契机，后退一步，为 Medium 编写一份新的风格指南。

最初的努力由我、戴夫·加马什、达斯汀·塞诺斯和才华横溢的克里斯·欧文共同承担。

我们花了一些时间来认真思考如何在 Medium 编写生产 CSS/LESS——主要的更新是:

*   减少对变量和混合的限制(无嵌套、保护、扩展等)。)—虽然这些语言特性非常强大，但我们发现缺乏经验的开发人员经常很容易遇到麻烦。我们也更喜欢纯 CSS 的视觉美感(以及它所提供的一致性)，并希望尽可能合理地将我们的代码库向那个方向移动。
*   类和 id 都是小写的，单词之间用破折号隔开——这是我们大多数人当时用 Bootstrap、Skeleton、Ratchet 等编写 CSS 的方式。我们认为在这里做同样的事情是有意义的。另一个原因是它遵循了 CSS 语言本身规定的命名惯例，例如 border-radius-top-left 等。
*   更喜欢组件而不是页面级样式——我们希望我们的前端感觉像库代码，并开始将 profile.less 这样的文件分解成更小更集中的文件，如 button.less、dialog.less、tooltip.less 等。

这是它的全部内容:



[https://gist.github.com/fat/b27700946c777adacdf4](https://gist.github.com/fat/b27700946c777adacdf4)



无论如何，它并不完美，但它清理了一些基本的想法，让我们朝着感觉正确的方向前进。

不幸的是，即使在这种风格更新之后，人们仍然在纠结什么时候做一个组件，什么时候做一个子组件，等等…我们偶尔会得到一些不集中的、运行中的类名，比如:。**导航灯背景按钮**或。**按钮-主边栏-模糊。**

人们不再在页面级别上给类加前缀(这很好)，而是把由破折号分隔的任意单词串在一起。进化是:。**按钮** →。**按钮-初级** →。**按钮-原色-暗色→** 。**按钮-主-暗-容器** →。**按钮-主-暗-容器-标签**，**，**令人作呕。



T2】

## 第四个项目:识别未来

大约在这个时候，我开始在 Medium 内部写很多关于 CSS 的文章，我的崇高目标是让它成为世界上最好的。我真的不知道这意味着什么，但我知道我们目前的方向是行不通的。

> 人们很困惑。更糟糕的是，他们认为他们写的 CSS 很好，而事实上他们没有。

所以，我开始四处寻找——探索框架、尝试不同的工具、哲学、与朋友交谈、与朋友的朋友交谈等等。我很快就确定了三个主要项目，我想解决这些项目，以便让我们的 CSS 达到我认为它需要的地方。

1.  引入新的 CSS 变量、mixin 和类名语义，以避免连续的类名并提高可读性
2.  将我们从 LESS 转移到 [Rework](https://github.com/reworkcss/rework) 来获得更强大的 mixin 支持和更接近普通 CSS 的语法
3.  添加关于 CSS 性能(加载时间、fps、布局时间等)的工具，以便更容易跟踪样式随时间的变化和回归

T2】

## 第五个项目:语义学

我希望我们的代码库有更严格的语义，因为对于我们这样规模的团队来说，我觉得让我们依靠规则会更容易。如果这也意味着人们在创建新的 CSS 类时必须更加小心，我宁愿有一些更复杂的东西。无论如何，我想避免运行类名，或者至少使它更难创建。

我开始和达里尔·库泊史密斯以及我的好朋友尼古拉斯·加拉格尔详细讨论这个问题。



尼古拉斯和我有一种有趣的关系，因为尼古拉斯总是告诉我一些事情，我说他错了，用法语骂他(Va te faire foutre，enculé)，然后跳舞几个星期，然后不可避免地意识到他是对的，并把他的想法当成我自己的。

这一次也不例外，在熬夜了几个晚上之后，我最终确定了一种风格，这种风格与尼古拉斯在《随想录》中描述的风格相似。差不多，但是~稍微~好一点。

所以我开始抄袭尼古拉斯的作品。我扔掉了我们的旧风格指南，复制粘贴了他的大部分，编辑了一些东西。

最终，我想出了我们目前的指南，你可以在下面阅读它的全文，主要的补充是:

*   **。js-**JavaScript 选择器所依赖的元素的前缀类名
*   **。u-** 单用途实用程序类的前缀类名，如。 **u 型下划线**，。 **u 大写**等。
*   引入有意义的 hypens 和 came case—强调组件、后代组件和修饰符之间的分离
*   **。is-** 有状态类的前缀类(通常由 js 切换)，如**。被禁用**
*   新的 CSS 变量语义:[属性]-[值]-[组件]
*   Mixins 简化为仅聚合填充，并带有前缀**。m-**



[https://gist.github.com/fat/a47b882eb5f84293c4ed](https://gist.github.com/fat/a47b882eb5f84293c4ed)



复制粘贴一个样式指南是一回事，重写你所有的 CSS 应用程序是另一回事。

谢天谢地，我能够让公司相信这个项目的重要性，即使只是为了我的理智，并且给了我两周的时间来重写所有关于 Medium.com 的 CSS——如果你跟着做的话，这只是我们花在修复 CSS 下划线上的时间的一小部分。

也就是说，这种重写不仅是一种宣泄，它清理了大量的死样式，收紧并概括了整个站点的实现，将文件分解为更小的子组件，并且令我惊讶的是，只导致了少量的回滚。

当然，重构 CSS 也意味着重构我们的模板——全面增加更多的封装和更严格的语义。如今，我们有了一个单一的集中的头像模板，它接受布尔选项来触发不同的修饰，如大小、风格等，而不是有数百个带有随机头像类别的标签。这使得更新样式更容易，实现细节错误更少。



T2】

## x 项目:未来？

毫无疑问，我们现在的处境比两年前要好。在 Medium 上编写 CSS 实际上是非常愉快的，不同经验水平的开发人员正在贡献一些非常棒的东西。

也就是说，下一个 CSS 项目必须围绕性能展开。随着我们继续增加故事页面并将其推向下一个级别，您可以想象获得关于布局和渲染性能的准确、可靠的测量工具是多么重要……并且有点遗憾的是，我们在 2014 年还没有获得这些工具。

原来如此。还有更多的事情要做，但是我现在感觉很好。我觉得还是比平时好。

如果你能坚持到这篇无聊的长文的底部，那就干杯。

非常感谢凯蒂、戴夫、马克、库普、克里斯托夫、尼古拉斯和其他人帮助我写了这个东西(并修复了介质),甚至可能没有意识到它❤

# 附言（同 postscript）；警官（police sergeant）

(如果你乐此不疲？！考虑阅读我对 React 和 Redux 的看法: