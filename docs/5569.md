# react Native:uda city 移动工程团队的回顾| Nate Ebel | uda city 工程与数据

> 原文：<https://engineering.udacity.com/react-native-a-retrospective-from-the-mobile-engineering-team-at-udacity-89975d6a8102?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

# 反应本土:Udacity 移动工程团队的回顾



在 [Udacity](https://www.udacity.com/) 的移动团队最近删除了我们的应用中最后一些用 [React Native](https://facebook.github.io/react-native/) 编写的功能。

我们收到了许多关于我们的使用或 React Native 以及我们为什么停止投资它的问题。

在这篇文章中，我希望回答我们收到的大部分问题，并深入了解:

*   我们特定团队的规模和构成如何？
*   我们当初为什么要尝试 React Native？
*   移除它的原因是什么？
*   什么奏效了？什么没有？
*   …以及更多🙂

我当然不会自称是 React Native 方面的专家。我们团队中的其他人比我更有经验，但我怀疑他们也不会自称是专家。

我将从我们自己的经历来谈谈在我们的具体情况下，什么是有效的，什么是无效的。React Native 是否适合您的团队/项目取决于您，但希望这篇文章将提供一个额外的有用数据点供您考虑。

> “React Native 是否适合您的团队/项目取决于您”

我还想指出，这些经验和观点来自 Udacity 的移动工程团队，而不是其他人。这里的想法并不反映任何其他使用 React 或 React Native 或为其构建内容的团队的观点。



T2】

# 接缝

重要的事情先来。我们的团队是什么样的？您的团队的规模、经验和组织对 React Native for 您的项目的可行性有真正的影响。

我们的移动工程团队分布在 iOS 和 Android 平台上。

> 团队规模

**介绍 React Native 时:**

*   1 iOS dev
*   2 个 Android 开发人员
*   下午 1 点
*   1 名设计师

**今日:**

*   4 个 iOS 设备
*   3 个 Android 开发人员
*   下午 1 点
*   1 名设计师

在我们使用 React Native 的大约 18 个月时间里，我们的 iOS 和 Android 团队的规模都在扩大。

这个小组看到一位新首相掌权。

我们经历了多个设计师和设计范例的转变。

> 开发背景

当引入 React Native 时，每个团队对 Javascript 和 React 范式的适应程度如何？

**iOS**

iOS 团队中的唯一一名开发人员在之前拥有丰富的 Javascript 和 web 开发经验的情况下，非常适应 React Native。

今天，四分之三的 iOS 开发人员至少对使用 Javascript 和 React Native 相当满意。

**安卓**

在引入 React Native 时，两个 Android 开发人员中的一个对 Javascript 很熟悉。另一个人(我自己)几乎没有 Javascript、React 或网络背景。

加入团队的其他 Android 开发人员也没有多少 Javascript 或 web 经验。

T2】

# 应用程序

我们的应用程序能做什么？

我们的移动应用旨在为您的移动设备带来 Udacity 学习体验。它们支持身份验证、内容发现、计划注册(在某些情况下还支持付费)，以及跨各种计划和内容类型的学习材料消费。

这些应用也是新的实验性功能和计划的试验场，旨在改善我们用户的整体学习效果。

> **代码库的大小**

*   iOS:97400 行(。斯威夫特，。h，。m)
*   Android: 93，000 行(xml、java、kotlin、gradle)

> **奇偶性**

当 React Native 推出时，这些应用非常接近功能等同。

随着时间的推移，核心体验基本保持不变，但每个团队也增加了某个平台独有的“实验”数量。

此外，由于更大的国际需求，本地化和更小的 apk 大小等举措已经成为 Android 团队越来越优先考虑的问题。Android 团队有时也与其他地区的团队密切合作，开发 iOS 不优先考虑的市场特定功能。

T2】

# 我们为什么/如何采用 React Native？

> **我们为什么要介绍？**

我们推出了一个全新的手机专属功能。我们想在两个平台上快速试验和验证，所以跨平台是非常有吸引力的。

因为这是一个独立的新特性，所以被认为是一个非常有趣的尝试跨平台方法的机会。

选择 React Native 有几个原因:

*   提高跨平台解决方案的可行性
*   团队中的大多数人(2/3 的开发人员)对 Javascript 和 web 开发很熟悉
*   提高开发速度
*   公司外部其他团队的成功案例

> **我们是怎么介绍的？**

最初的 React 原生特性构建在一个单独的 GitHub 仓库中，并作为一个 [git 子树](https://www.atlassian.com/blog/git/alternatives-to-git-submodule-git-subtree)分别合并回 iOS 和 Android 仓库。

这允许非常快速的原型制作，并且如果需要的话，为作为独立产品发布的特性提供了机会。

更多的体验被原型化，最终我们在 React 原生代码库中引入了第二个更大的特性。

> **时间线**

*   2016 年 8 月:为*功能 1* 创建的 React 本地回购
*   2016 年 11 月:*功能 1* 在 Android 上发布
*   2016 年 11 月:*特性 2* 开始开发
*   2016 年 12 月:*特色 3* 原型化开始
*   2017 年 1 月:*功能 1* 开发结束
*   2017 年 2 月:*功能 2* 发布
*   2017 年 3 月:*功能 3* 原型制作结束
*   2017 年 11 月:*功能 2* 最后一次 Android 更新
*   2017 年 12 月:功能 4 原型为独立应用。由于性能问题，最终放弃了原生
*   2018 年 2 月:*功能 2* 最后一次 iOS 更新
*   2018 年 4 月:*功能 1* 从安卓移除
*   2018 年 6 月:*功能 2* 从两款应用中移除

T2】

# 移除的动机？

这个答案很简单。

我们从应用程序中删除了 React Native 的最后痕迹，因为唯一剩下的 React Native 功能是 sunset，我们不再需要支持它。

> "*为什么我们停止了对 React Native 新功能的投资？*

一个更有趣的问题可能是"*为什么我们停止了对 React Native 新功能的投资？*

我想到了几件事:

1.  同时在两个平台上构建的功能数量减少
2.  Android 特定产品请求的增加
3.  对长期维护成本的不满
4.  Android 团队不愿继续使用 React Native

T2】

# 我们用什么代替了它？

我们已经部署和移除的 React 原生特性不再受支持，也不需要替换。

T2】

# 什么进展顺利？

我们进军 React Native 的哪些方面进展顺利？

*   使用 React Native 并开始为两个平台进行构建非常容易
*   能够从更大的 React & Javascript 生态系统中引入库和工具
*   我们能够同时在两个平台上原型化*特性 1*
*   一个跨职能团队的开发人员能够同时为两个平台开发大部分的*特性 2*
*   团队对 React Native 的集体理解增加了

T2】

# 我们面临什么问题？

在与 React Native 合作期间，我们面临了许多问题。其中一些可以归因于我们的过程，一些归因于我们的用例，一些归因于本机本身的反应。

# **设计&体验挑战**

> **平台一致的 UI/UX**

因为我们将一些新的屏幕集成到了更大的现有体验中，所以我们希望新的 React 本机代码符合本机平台模式和现有样式。这意味着我们没有必要在两个平台上使用相同的 UI 设计。

在 React Native 中，确保每个平台都有自己的风格并不困难，但是需要了解每个代码库中使用的设计范例。最简单的是，这需要平台检查，可能还需要为每个操作系统定制小部件。

对我们来说，这通常需要与来自每个平台的开发人员和设计师接触，以了解需要什么，或者两者都使用单一风格，这通常会导致 Android 端的体验与应用程序的其他部分有明显不同的外观。

在更复杂的情况下，需要额外的平台特定代码来定制应用程序体验。

曾经这样的例子是确保一个备份图标的正确行为。因为新的 React 原生功能需要集成到现有应用程序中的位置/方式，确保后退/后退图标和后退按钮按下的正确行为需要特定于 Android 的原生代码和对 React 原生代码库的特定于 Android 的更改。

> **本地设计的改变可能需要改变本地代码来处理集成点**

至少有一次，Android 应用程序的导航结构发生了变化，这要求我们更新 React 本机代码，原因仅仅是为了改变如何处理本机到 React 本机集成。

React 本机特性不是被隔离到它自己的活动中，而是必须被移动到一个片段中，放置在一个带有 BottomNavigationView 的屏幕中，然后协调它自己和其他本机片段之间的状态。

这种类型的平台更改需要回到单独的代码库，进行更改，更新集成，并确保新的更改不会对 iOS 应用程序产生负面影响。

> **设备特定问题**

无论你称之为“*碎片化*还是“*多样性*”，事实仍然是有更多独特的 Android 设备配置需要考虑。

我们多次发现布局不能很好地适应不同尺寸的 Android 手机。我们发现，在最新的 iPhone 或 Pixel 设备上流畅运行的动画在 Android 应用更广泛的国际市场上的低端设备上运行不佳。

这些当然不是对本土问题唯一反应；这些是 Android 上常见的开发挑战，但是随着特定平台检查和考虑的数量增加，我们不得不开始考虑通过使用 React Native 我们实际上节省了多少时间。

> **全球增长**

在我们使用 React Native 期间，国际化成为 Android 团队更大的关注点。我们有几个国际办事处要求本地化和减少 apk 的规模。

React Native 中的字符串本地化可以完成，尽管它确实需要额外的设置。在我们的案例中，它需要对一个单独的回购协议进行修改。这增加了本地化任务的复杂性，这在向其他团队寻求本地化帮助时并不理想。这有助于降低反应原生特征被本地化的频率。

在这段时间里，我们能够减少我们的 apk 大小，但 React Native 的加入是一个相当大的大小增加，我们无法做太多的工作。去掉最后一个特性后，我们的 apk 因为命令资源减少和 React Native 本身的大小减少了~10MB。

# **整合挑战**

> **与本地组件的集成&导航结构**

根据我们的经验，如果 React Native 是一个独立的功能，那么将它集成到现有的应用程序中会非常简单，如果需要与现有的组件紧密集成并与之通信，则可能会有点困难。

我们发现自己经常需要大量的桥接代码来在本地组件和 React 本地组件之间进行通信。至少有一次，当我们需要改变 React 本地组件在导航层次结构中的位置时，这段代码需要更新。

> **工具/制造问题**

将 React Native 所需的更新整合到每个应用的构建流程中。我们使用 CircleCI 来构建我们的项目，这些项目需要重新配置以支持额外的 React 本地构建步骤。

正如之前分享的，在 Android 方面，这并不像我们希望的那样简单。

一旦我们的构建被更新为包括必需的 React 本地任务，它就将我们在 CircleCI 上的发布构建的持续时间增加了大约 20%。

从我们的代码库中删除最终的 React 原生特性后，我们看到了以下改进:

*   CircleCI 构建时间从大约 15 分钟减少到大约 12 分钟
*   发布的 apk 大小从 28.4MB 减少到 18.1MB

Android 团队有时也会遇到 Android/Gradle 构建工具与 React Native 冲突的问题。最近，我们一直在处理 Gradle 4 的[问题。](https://github.com/facebook/react-native/issues/16906)

iOS 团队也面临着相当大的挑战。

配置构建是痛苦的，因为我们有一个非标准的 React Native 文件结构。由于我们独立的项目回购，我们在 srcroot/ReactNative 下引入了 React 原生回购，许多现有的构建工具采用了默认的应用程序结构，即/ReactNative/ios/…ios。

此外，我们使用 cocoapods 进行依赖管理，这原本是包含 React Native 的建议方式，但后来被否决了。这进一步加剧了我们的非标准文件结构，我们必须在我们的 Podfile 中包含一些令人讨厌的 hacks，以使它从正确的位置读取。

由于 cocoapods 不再是包含 React Native 的标准方式，Podfile 更新依赖于社区来更新，而这并不总是同步的。有几个版本更新了 css/Yoga 依赖关系，但是 Podfile 引用了不正确的版本..直到最后，我们遇到了一些讨厌的安装后攻击，主要是 sed/regex 一些 include 调用。

最后，iOS 项目的 CI 也是一个难点。我们现在必须添加一个 npm 依赖层，并确保在继续安装之前正确更新。这给我们的构建步骤增加了大量的时间。

还有一个导致崩溃的问题，因为 npm 的一个版本有“package.lock ”,而另一个版本没有，这导致我们在 React 本机升级中安装了不正确的依赖关系版本。

T2】

# **应对本土挑战**

> **文档**

React Native 作为一个整体发展得非常快，我们发现有时缺少文档。特别是当我们第一次采用时，我们发现特定版本的文档/答案可能仍然相关，也可能不相关。

当时，将 React Native 与现有项目集成的文档似乎很少。这是我们在更新 CI 构建时遇到挑战的一个促成因素。

随着 React Native 的不断发展，文档和支持社区的贡献也得到了改进。如果我们从今天开始，我们可能会更容易找到一些问题的答案。

> **导航**

我们最初从 NavigationExperimental 开始，这不是最容易使用的导航库。当 [React Navigation](https://github.com/react-navigation/react-navigation) 问世时，它很快成为社区接受的导航，在 React Navigation 真正完全成熟之前，导航实验就被否决了。

尽管如此；在 ReactNavigation 中，如果不把事情拼凑在一起，有些事情我们是做不到(例如:在一个呈现的模态流中的推流)

> **性能**

如前所述，有时会发现性能问题。

我们能够制作一些非常好的动画，在精心设计的 iOS 和 Android 设备上看起来很棒，但在国际市场上更流行的欠驱动 Android 设备上表现不佳。

当进入应用程序的 React 本地部分时，加载时间比我们希望的要长。这通常不像是一个无缝的过渡。

当原型开发独立的*特性 4 时，*图形渲染性能是一个足够大的问题，以至于 React Native 被放弃以支持原生体验。

> **落后于原生平台**

因为它不是与 iOS 或 Android 一起构建的，React Native 有时会落后于原生平台。它通常在很大程度上依赖于社区来支持新的本地特性。

其中一个例子是 iPhone X 迫切需要[](https://facebook.github.io/react-native/docs/safeareaview.html)*安全区支持。我们最终选择在短时间内不支持安全区，因为它将很快推出。利用`SafeAreaView`是跨平台开发人员开发兼容应用时需要了解的平台特定特性的一个例子。*

*在其他时候，React Native 在采用新平台要求方面落后，例如 Android 应用程序[被要求在 2018 年 8 月之前以 api 26](https://android-developers.googleblog.com/2017/12/improving-app-security-and-performance.html) 为目标。该要求有几个[未解决的问题](https://github.com/facebook/react-native/issues/18095)。*

> ***突发更新***

*React Native 的非向后兼容升级相当令人沮丧。一个例子是当 React Native 升级它的底层 React 库时， [PropType 弃用](https://github.com/react-navigation/react-navigation/issues/1352)。*

*如果不维护我们自己的定制 fork，许多第三方库如果不再被维护就会变得不可用。*

*T2】*

# ***维护挑战***

*维护代码库的 React 原生部分有时对我们来说是一个挑战。如前所述，Android 经常需要额外的工作，无论是与现有代码集成还是修复 UI 问题。这导致 iOS 和 Android 在 React 原生代码库的不同分支上工作，因此一个平台不会降低另一个平台的速度。*

*由于这种分支，代码中的分歧开始慢慢形成，使它们一致所需的努力增加了。因此，一个平台或另一个平台的更新不会立即添加到另一个平台。*

*React Native 的变化速度也带来了挑战。因为有可能中断更改，所以更新依赖项以获得新功能或 bug 修复并不总是很快。*

*同样，有时这会导致摩擦增加，从而降低代码的维护速度。对于一个小团队和有限的带宽，如果它不是 React 本机代码中的一个简单/快速的修复，那么它被解决的可能性会低得多，因为它可能需要额外的开发工作。*

*随着 React Native 的加入，并不总是清楚 bug 存在于哪个级别。它在两个平台中都存在吗？只有一个站台吗？如果只是在一个平台上，是在原生代码中还是在 React 原生代码中？这些问题的复杂性有时会减慢 qa 过程。*

*当需要修复代码库的 React 原生部分的问题时，我们现在必须考虑 iOS 和 Android，并可能使用 3 个开发堆栈而不是 1 个。*

*此外，由于不到 100%的团队成员对 React Native 感到高效，能够快速投入并解决问题的开发人员数量也减少了。*

*T2】*

# *我们能做些什么不同的事情？*

*我相信我们面临的一些问题是我们的用例所固有的，但是我们可以做一些不同的事情来减轻这些问题。*

> ***较少发散***

*我们本可以做得更好，让每个应用程序都跟上 React 原生回购的最新变化。我相信，保持这些更新的同步将有助于我们为这些功能开发更强的跨平台开发意识。*

*越来越多的设备上测试，尤其是在 Android 上，可能已经导致在早期发现更多的 UI/性能问题，并允许我们在发布之前修复它们。这也可以通过在新事物开始之前修复问题来减少代码差异。*

> ***更一致的设计***

*从一开始就制定一个更具体的设计计划可能会改善这些特性的原始外观。一个具体的例子是使用与其他本地应用程序一致的文本/边距值，而不是在新体验中选择一个新值并在两个平台上使用。*

> ***更好的团队理解***

*不太熟悉 React Native 的团队成员可能会做更多的工作来适应额外的开发堆栈。这可能会增加能够快速修复这部分代码中的问题的人数。*

*T2】*

# *有我们认为更适合的用例吗？*

*我想我们团队没有人相信 React Native 是没有可取之处的。我当然相信有 React Native 非常适合的用例。*

*您是否需要在两个平台上快速地从头开始原型化/构建一个新的应用程序？*

*您是否正在构建一个无论平台如何，外观/行为都一样的应用程序/功能？*

*你是否有空闲开发周期的 Javascript 开发人员愿意为移动开发做贡献？*

*如果您对这些问题中的任何一个回答了*“是”*，那么 React Native 可能是您的一个可行选项。*

*特别是，我认为如果你有 Javascript/React 背景，并且希望构建一个不需要太多本机代码的应用程序，那么 React Native 是一个非常有吸引力的选择。它将使你无需学习两种不同的技术就能开始在移动设备上构建。*

*对于在完全跨平台的应用程序上进行全新开发，React Native 也是一个不错的选择。*

*T2】*

# *我们会再次使用 React Native 吗？*

*iOS 和 Android 团队对此意见不一。*

> ***iOS***

*可能吧。iOS 团队总体上对与 React Native 的合作非常满意，并考虑用它来构建新的功能。此外，在产品方面，我们的项目经理对运行在 iOS 上的 React 原生解决方案比对运行在 Android 上的更有信心。*

> ***安卓***

*不会。理想情况下，Android 团队不会在未来投资 React Native。我们发现与 React 原生组件集成的过程很麻烦，并认为由此产生的体验并不适用于所有 Android 设备。*

*此外，有一种倾向于坚持单一开发栈，而不是在 Android 框架上添加新的抽象层和可能的错误。*

*我们的印象是，React Native 在 Android 上运行新功能的速度更快，但该功能从早期阶段到完善的发布，再到长期维护，则需要更长的时间。*

*T2】*

# *我们会再次使用另一种跨平台解决方案吗？*

*作为一个团队，我们可能不会在近期投资跨平台开发。iOS 团队可能会使用 React Native 构建一些东西，但仍然保持它特定于 iOS，因为他们通常更喜欢这种体验。*

*就个人而言，团队成员继续关注 React Native 和 Flutter。随着 React Native 和 Flutter 等解决方案的不断发展，我们将继续为我们的团队评估它们。*

*T2】*

*这就是我们今天的情况。*

*我们对 React Native 如何适应我们的团队和路线图有了更好的理解。我们可以利用这些信息为我们的团队做出明智的技术选择。*

> *“我们能肯定地说 React Native 是否适合你吗？没有。”*

*我们看到了 React Native 的优点以及局限性。我们能确定 React Native 是否适合你吗？*

*号码*

*但是希望我们的经验可以作为您在评估 React Native 对于您的项目的可行性时的额外数据点。*

*T2】*

## *想了解更多关于移动开发的知识吗？*

## *跟着我们*

*更多关于构建 Udacity 的工程师和数据科学家的信息，请点击这里的关注我们。*

**有兴趣加入我们@udacity？* [*见我们当前的机遇*](http://www.udacity.com/jobs) *。**

## *移动 Udacity*