# 承诺的艺术——清单之外

> 原文:[http://alistapart.com/article/the-art-of-the-commit?UTM _ source = Wanqu . co&UTM _ campaign = Wanqu+Daily&UTM _ medium = website](http://alistapart.com/article/the-art-of-the-commit?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website)

Git 和像 GitHub 这样的工具提供了很多方法来查看提交中发生了什么变化。但是一个精心制作的提交消息可以通过简洁明了地总结所发生的变化，使您不必使用这些工具。

下文继续

日志消息可以说是提交中最重要的部分，因为它是唯一一个不仅能捕获更改内容，还能捕获更改原因的地方。

好的信息包含什么？首先，它需要简短，这不仅仅是因为简洁是智慧的灵魂。大多数时候，您将在 Git 的提交日志的上下文中查看提交消息，这里通常没有太多的空间来显示文本。

将提交日志视为项目的新闻提要，其中日志消息是每次提交的标题。你有没有浏览过报纸的标题(或者，一个更现代的例子，BuzzFeed ),然后以为你已经得到了世界上正在发生的事情的摘要？一个好的标题不一定要讲述整个故事，但它应该告诉你足够的信息，让你在阅读之前知道这个故事是关于什么的。

如果您独自工作，或者与一两个合作者一起工作，那么日志可能看起来很有趣，仅仅是出于历史的目的，因为大多数提交您都在那里。但是在有很多合作者的 Git 仓库中，提交日志作为一种知道当你不注意时发生了什么的方式可能更有价值。

严格地说，提交消息可以跨越多行，并且可以根据您的需要而定。Git 对提交消息的内容没有任何硬性限制，事实上，如果给定的提交确实需要额外的上下文，您可以向消息中添加额外的段落，如下所示:

```
 Updated Ruby on Rails version because security

Bumped Rails version to 3.2.11 to fix JSON security bug. 
See also http://weblog.rubyonrails.org/2013/1/8/Rails-3-2-11-3-1-10-3-0-19-and-2-3-15-have-been-released/ 
```

请注意，尽管此消息包含的上下文远不止一行，但第一行非常重要，因为日志中将只显示第一行:

```
 commit f0c8f185e677026f0832a9c13ab72322773ad9cf
Author: David Demaree 
Date:   Sat Jan 3 15:49:03 2013 -0500

Updated Ruby on Rails version because security 
```

就像一个好的标题一样，这里的第一行总结了提交的原因；消息的其余部分会更详细。

## 在您最喜欢的文本编辑器 [#section2](#section2) 中编写提交消息

尽管本书中的例子都让你内联输入你的信息，使用`--message`或`-m`参数到`git commit`，你可能更适合在你喜欢的文本编辑器中书写。Git 与许多流行的编辑器很好地集成在一起，无论是命令行(例如 Vim、Emacs)还是更现代的图形应用程序，如 Atom、Sublime Text 或 TextMate。配置好编辑器后，您可以省略`--message`标志，Git 会将草稿提交消息交给另一个程序进行创作。当你完成后，你通常可以关闭窗口，Git 会自动获取你输入的信息。

为了利用这种可爱的集成，首先您需要配置 Git 来使用您的编辑器(特别是您的编辑器的命令行程序，如果有的话)。在这里，我告诉 Git 将提交消息交给 Atom:

```
 $: git config --global core.editor "atom --wait" 
```

每个文本编辑器都有一组稍微不同的参数或选项可以传递，以便与 Git 很好地集成。(正如您在这里看到的，我们必须将`--wait`选项传递给 Atom 才能让它工作。)GitHub 的帮助文档有很好的，[设置几个流行编辑器的简要指南](http://bkaprt.com/gfh/05-05/)。

## 提交消息样式的元素 [#section3](#section3)

制作有效的提交信息没有什么硬性规定——只有大量的指导方针和良好的实践，如果你试图一直遵循它们，会很快让你陷入困惑。

为了方便起见，这里有几条我建议一直遵循的指导方针。

提交消息的目的是总结变更。但是总结变更的目的是帮助您和您的团队理解项目中正在发生的事情。因此，你放入信息中的信息应该对阅读它的人有价值和有用。

尽管使用提交消息空间骂人很有趣——针对 bug、Git 或您自己的笨拙——但请避免发表评论。避免编写类似“Aaaaahhh 愚蠢的 bug”的提交消息的诱惑相反，深呼吸，喝杯咖啡或花草茶，或者做任何你需要做的事情来清醒头脑。然后写一条消息，尽可能简洁明了地描述提交中的变化。

除了简短、清晰的描述之外，当提交与另一个系统中的一些信息相关时——例如，如果它修复了错误跟踪器中记录的一个错误——通常还会包括问题或错误号，如下所示:

```
 Replace jQuery onReady listener with plain JS; fixes #1357 
```

一些 bug 追踪器(包括每个 GitHub 项目内置的一个)甚至可以挂在 Git 上，这样这样的提交消息会自动将编号为`1357`的 bug 标记为完成，只要这个消息的提交被合并到`master`中。

### 详细(足够)[#第 5 节](#section5)

作为一名正在康复的软件工程师，我理解用乏味的细节填充提交信息——以及电子邮件、状态报告和站立会议——的诱惑。我喜欢书呆子气的细节。然而，虽然一些细节对于理解变化很重要，但几乎总是有更一般的原因可以更简洁地解释变化。此外，通常没有足够的空间来列出关于更改的每一个细节，并且仍然产生易于在终端窗口中浏览的提交日志。找到更简单的方式来描述某件事，不仅能让你的队友更容易理解你所做的改变；这也是节省空间的好方法。

一个好的经验法则是将提交消息的“主题”部分保持在一行，或者大约 70 个字符。如果有重要的细节值得包含在邮件中，但不需要放在主题行，记住你仍然可以把它们作为一个单独的段落。

无论您和您的同事决定如何编写提交消息，如果您都尝试遵循一组相似的规则，您的提交日志将会更有价值。提交消息太短，不需要详细的风格指南，但是通过对话建立一些约定，或者制作一个简短的 wiki 页面，提供一些特别好(或不好)的提交消息的例子，将有助于事情更顺利地进行。

### 使用主动语态[#第 7 节](#section7)

提交日志不是静态事物的列表；这是一个变化列表。它是你(或某人)所采取的行动的列表，这些行动导致了你的作品的版本。虽然使用提交消息来标记一个版本的工作可能很诱人——“版本 1.0”，“1 月 24 日可交付”——但是还有其他更好的方法。此外，很容易陷入这样的尴尬境地:

```
 # Making the last homepage update before releasing the new site
$: git commit -m "Version 1.0" 
```

```
 # Ten minutes later, after discovering a typo in your CSS
$: git commit -m "Version 1.0 (really)" 
```

```
 # Forty minutes later, after discovering another typo
$: git commit -m "Version 1.0 (oh FFS)" 
```

描述变更不仅是提交消息最正确的格式，也是最容易遵守的规则之一。不要关心抽象的问题，比如一个给定的提交是否是一件事情的发布版本，你可以关注一个简单得多的故事:*我刚刚做了一件事情，这就是我刚刚做的事情。*

因此，那些“版本 1.0”提交可以被更简单和准确地描述:

```
 $: git commit -m "Update homepage for launch"
$: git commit -m "Fix typo in screen.scss"
$: git commit -m "Fix misspelled name on about page" 
```

我还建议选择一种时态并坚持使用，以保持一致性。我倾向于用命令式现在时来描述提交:*修复 About 页面上拼错的名字而不是 fixed 或 fixing。**固定*或者*固定*都没什么问题，除了它们稍微长一点。如果另一种风格更适合你或你的团队，那就去尝试吧——试着坚持下去。

如果您的提交消息风格不一致，会发生什么？您的 Git repo 将会崩溃，您的所有工作都将毁于一旦。*开玩笑！*人是会犯错的，失误是会发生的，日志中的一点点废话是不可避免的。不过，请注意，实践越多，遵循这些风格规则就越容易。尽量写最好的提交消息，这样你的日志会更好，更有价值。