# 啃炖肉:为什么不直接用 X 重写？

> 原文：<https://nibblestew.blogspot.com/2017/04/why-dont-you-just-rewrite-it-in-x.html?utm_source=wanqu.co&utm_campaign=Wanqu+Daily&utm_medium=website>

每当一种新的编程语言变得流行时，它的粉丝们就开始通过访问现有的项目和提交类似这样的错误报告来宣扬它的优点。

*Hi, I noticed that this project is written in [programming language X]. You really should just rewrite it in [programming language Y] because it is better at [some feature Z]. Kthxbye!*

这么说的话，这似乎是显而易见的。更擅长于

*Z*

很好，所以每个人都应该把他们的项目移植到

*Y*

。

最近，Gnome 堆栈中各种软件项目使用的工具已经从 shell、Awk 和 Perl 的大杂烩转变为 Python 3。这样做的主要原因是，对于一个现代的、维护良好的项目，只有一个“脚本”依赖，这使得在 Windows 等平台上使用 Gnome 技术编译应用程序变得简单。在项目之间转移也变得更加容易。

正在经历这种转变的一种工具是

[GTK-doc](https://git.gnome.org/browse/gtk-doc/)

。这是一个主要用 Perl 编写的文档生成工具。我一直在和 upstream 合作，把它转换成 Python 3。这在很多方面都是一次教育经历。学到的第一件事是，任何两种语言之间的转换通常分为三个不同的阶段。

1.  手动语法转换
2.  修复由转换错误引起的错误
3.  将代码转换成惯用的目标语言

在 gtk-doc 的情况下，Perl 到 Python 的转换相对简单。它主要处理正则表达式、数组和字典。这三者在两种语言中的表现都非常相似，所以第一步主要是手工操作。第二步包括修复第一步中引入的所有错误和行为改变(许多是由第一步中的打字错误和注意力不集中引起的)。这个阶段基本是调试。第三步是将正则表达式和全局变量转换成对象和其他合理可读的结构。

在进行转换时，我主要关注第一步，而 gtk-doc 维护者已经同意完成第二步和第三步的工作。转换 6000 多行文件时

gtkdoc-mkdb

，我做了一些测量，结果表明我可以以每小时 500 行的峰值速率进行转换，这意味着每行代码大约 7 秒。

这只能在易于转换的代码上实现，基本上是 Emacs 指法的练习。代码不时会使用“奇特的”Perl 特性。转换这些部件的速度要慢 10 倍、100 倍，有时甚至慢 1000 倍。如果该端口需要架构上的返工(例如，当将一种 lax 语言转换成一种在编译器中有生命周期检查器的语言时，这种情况可能会发生),它会使事情变得更加缓慢。

我不知道第二步和第三步需要多少工作，但根据某些 IRC 频道上发布的评论，可能很多。让我们慷慨地说，总的来说，这三项每小时要转换 250 行代码。

现在真正悲伤的部分来了。这种转化速度是不可持续的。手动将代码从一种格式转换成另一种格式是你能想象到的最无聊、最耗费精力、最折磨人的工作。我每天最多只能这样做几个小时，然后我不得不停止，因为我所能看到的只是一堆美元符号、分号和花括号。基于此，我们可以估计一个人可以保持的持续转化率大约是每小时 100 行代码(如果项目持续数周，这个速度不太可能保持，但是因为没有度量，所以我们现在忽略它)。

根据 Ohloh 的说法，cURL 项目包含大约 10 万行 C 代码。如果我们假设将它转换成某种其他语言就像将简单的 Perl 转换成 Python 一样简单(这似乎不太可能)，那么转换将需要 1000 个人小时。每天 8 小时，相当于 5 个月的全职工作。一旦完成，您就可以移植自开始转换以来在 trunk 中所做的所有更改。暂停整个项目，同时将它从一种语言转换成另一种语言是不可取的。

这给了我们一个清晰的答案，为什么人们不只是将他们的项目从一种语言转换成另一种语言:

**There is no such thing as "just rewrite it in X".**

### 后手稿

有些工具可以自动将一种语言转换成另一种语言。他们可以帮忙，但只是在第一步。第二步和第三步仍然存在，可能比手动转换代码需要更多的工作，因为通常手动转换会产生更多人类可以理解的代码。可悲的是，图灵完备性说我们不能拥有美好的事物。